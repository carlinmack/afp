<div id="Group_Adjoin">
<div class="head">
<h1>Theory Group_Adjoin</h1>
</div>
<pre class="source"> <span class="comment1">(*
    File:      Group_Adjoin.thy
    Author:    Manuel Eberl, TU M√ºnchen
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπAdjoining Elements to a Finite Abelian Group‚Ä∫</span></span>
<span class="keyword1"><span class="command">theory</span></span> Group_Adjoin
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Algebra/Multiplicative_Group.html">HOL-Algebra.Multiplicative_Group</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  This theory provides the notion of adjoining a single element to a subgroup of a finite
  abelian group, and, in particular, an induction principle based upon this: We can show that
  some property holds for a group by showing that it holds for some fixed subgroup and that
  it is preserved when adjoining a single element.

  The general idea for this was taken from Apostol's 
  ``Analytic Number Theory''~\cite{apostol1976analytic}.
‚Ä∫</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπMiscellaneous Group Theory‚Ä∫</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> ord_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">[^]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">ùü≠</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">‚â§</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms pow_eq_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> bij_betw_mult_left <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">Œª</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">‚äó</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">inv</span></span></span> <span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">‚äó</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> finite_comm_group <span class="main">=</span> comm_group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> order_gt_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_gt_0_iff_finite<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_imp_finite_comm_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite_comm_group <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_group<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">insert</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> H.subset fin<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_comm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπSubgroup indicators and adjoining elements‚Ä∫</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subgroup_indicator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">‚áí</span> <span class="tfree">'a</span> set <span class="main">‚áí</span> <span class="tfree">'a</span> <span class="main">‚áí</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subgroup_indicator</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚àß</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span></sub><span class="hidden">‚áô</span> <span class="bound">k</span> <span class="main">‚àà</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">adjoin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">‚áí</span> <span class="tfree">'a</span> set <span class="main">‚áí</span> <span class="tfree">'a</span> <span class="main">‚áí</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">adjoin</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span></sub><span class="hidden">‚áô</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span></sub><span class="hidden">‚áô</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">‚àß</span> <span class="bound">k</span> <span class="main">&lt;</span> subgroup_indicator <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> nat_pow_closed <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="main">‚üπ</span> pow <span class="free">G</span> <span class="free">a</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_pow_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_pow_modify_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span></sub><span class="hidden">‚áô</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_indicator_modify_carrier <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subgroup_indicator <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H'</span><span class="main">‚¶à</span><span class="main">)</span> <span class="free">H</span> <span class="free">a</span> <span class="main">=</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgroup_indicator_def nat_pow_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoin_modify_carrier <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"adjoin <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H'</span><span class="main">‚¶à</span><span class="main">)</span> <span class="free">H</span> <span class="free">a</span> <span class="main">=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adjoin_def nat_pow_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_indicator_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subgroup_indicator_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Least_equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_pow_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_indicator_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="free">n</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">‚â§</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> subgroup_indicator_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Least_le<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_comm_group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ord_pos<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ord_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> subgroup_indicator_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   pow_subgroup_indicator<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound"><span class="bound">h</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="bound">h</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ord <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_pos pow_ord_eq_1 fin<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚àß</span> <span class="free">a</span> <span class="main">[^]</span> <span class="var">?h</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroup_indicator_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI_ex<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="var">?h</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_indicator_le_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">‚â§</span> ord <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_indicator_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pow_ord_eq_1 fin ord_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_indicator_trivial<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">a</span> <span class="main">=</span> group.ord <span class="free">G</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> sg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pow_subgroup_indicator<span class="main">[</span><span class="operator">OF</span> sg assms<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym subgroup_indicator_le_ord ord_min<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq subgroup_indicator_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_adjoin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> subgroup_indicator_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adjoin_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_indicator_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_pow_closed<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pow_subgroup_indicator<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">‚äó</span> <span class="skolem">y'</span><span class="main">)</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> m_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_div_mod_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nat_pow_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_pow <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> pow_ord_eq_1 a'_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="skolem">y'</span> <span class="main">‚äó</span> <span class="skolem">a'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">h</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mod_less_divisor<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def h_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">‚äó</span> <span class="skolem">y'</span> <span class="main">‚äó</span> <span class="skolem">a'</span>"</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">h</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">ùü≠</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> subgroup_indicator_pos<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def h_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pow_subgroup_indicator<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def h_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem_adjoin<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a'</span> <span class="main">‚äó</span> <span class="skolem">a'</span><span class="main">)</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">a'</span> <span class="main">‚äó</span> <span class="main">(</span><span class="skolem">a'</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">a'</span> <span class="main">‚àà</span> <span class="free">H</span>‚Ä∫</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">x'</span> <span class="main">‚àà</span> <span class="free">H</span>‚Ä∫</span></span> inv_closed m_closed H.mem_carrier m_ac nat_pow_closed a<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">h</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> int_pow_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a'_def int_pow_int<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">h</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">h</span> <span class="main">-</span> int <span class="skolem">k</span> <span class="main">=</span> int <span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_int<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">a'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">h</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def h_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">a'</span>"</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adjoin_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> subgroup_indicator_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> a<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adjoined_in_adjoin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> adjoin_id<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_indicator_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> pow_subgroup_indicator<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">ùü≠</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adjoin_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">‚äÜ</span> carrier <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_adjoin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àâ</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">‚â°</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span> <span class="main">√ó</span> <span class="main">{..&lt;</span><span class="free">h</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">k</span> <span class="skolem">y</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">‚äó</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> m_ac wf inv_closed m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">‚äó</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> m_ac wf inv_closed m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> int <span class="skolem">l</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> int <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> int_pow_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>nat <span class="main">¬¶</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">¬¶</span><span class="main">)</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">‚â§</span> <span class="skolem">l</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> * <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>nat <span class="main">¬¶</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">¬¶</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_diff_distrib int_pow_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> * <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span>nat <span class="main">¬¶</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">¬¶</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False a 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_neg <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> nat_diff_distrib int_pow_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">‚â†</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword2"><span class="keyword">and</span></span> ** <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">‚â§</span> nat <span class="main">¬¶</span>int <span class="skolem">l</span> <span class="main">-</span> int <span class="skolem">k</span><span class="main">¬¶</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_indicator_le<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">&lt;</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">h</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">h</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_adjoin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àâ</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"card <span class="main">(</span>adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> card <span class="free">H</span> <span class="main">*</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">H</span> <span class="main">√ó</span> <span class="main">{..&lt;</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">‚Ä¶</span> <span class="main">=</span> card <span class="main">(</span><span class="free">H</span> <span class="main">√ó</span> <span class="main">{..&lt;</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_image inj_on_adjoin assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def card_cartesian_product<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> finite_comm_group_adjoin <span class="main">=</span> finite_comm_group <span class="main">+</span> subgroup <span class="quoted"><span class="free">H</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">H</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_in_carrier <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_notin_subgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àâ</span> <span class="free">H</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unadjoin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">‚áí</span> <span class="tfree">'a</span> <span class="main">√ó</span> nat"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unadjoin</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="main">√ó</span> <span class="main">{..&lt;</span>subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">}</span> <span class="main">‚àß</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> fst <span class="bound">z</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> snd <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adjoin_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">‚â°</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">‚àÉ!</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="main">√ó</span> <span class="main">{..&lt;</span>subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">}</span> <span class="main">‚àß</span> <span class="free">x</span> <span class="main">=</span> fst <span class="bound">z</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> snd <span class="bound">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">z1</span> <span class="skolem">z2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_adjoin<span class="main">[</span><span class="operator">OF</span> this a_in_carrier a_notin_subgroup<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> 2 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unadjoin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fst <span class="main">(</span>unadjoin <span class="free">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>unadjoin <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
          <span class="quoted"><span class="quoted">"fst <span class="main">(</span>unadjoin <span class="free">x</span><span class="main">)</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> snd <span class="main">(</span>unadjoin <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> theI'<span class="main">[</span><span class="operator">OF</span> adjoin_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> unadjoin_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> unadjoin_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">&lt;</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"unadjoin <span class="main">(</span><span class="free">y</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="free">h</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> theI'<span class="main">[</span><span class="operator">OF</span> adjoin_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> unadjoin_def<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_adjoin<span class="main">[</span><span class="operator">OF</span> is_subgroup a_in_carrier a_notin_subgroup<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> * assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unadjoin_unique'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">&lt;</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"unadjoin <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> unadjoin_unique<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> unadjoin_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unadjoin <span class="main">ùü≠</span> <span class="main">=</span> <span class="main">(</span><span class="main">ùü≠</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> unadjoin_unique'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subgroup_indicator_pos is_subgroup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unadjoin_in_base <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="main">‚üπ</span> unadjoin <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> unadjoin_unique'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subgroup_indicator_pos is_subgroup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unadjoin_adjoined <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unadjoin <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">ùü≠</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> unadjoin_unique'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_subgroup a_notin_subgroup
    <span class="keyword1"><span class="command">using</span></span> pow_subgroup_indicator<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> subgroup_indicator_pos <span class="main">[</span><span class="operator">OF</span> is_subgroup a_in_carrier<span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπInduction by adjoining elements‚Ä∫</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_comm_group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> group_decompose_adjoin_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> carrier <span class="free">G</span> <span class="main">‚à®</span> 
           <span class="main">(</span><span class="main">‚àÉ</span><span class="bound">H'</span> <span class="bound">a</span><span class="main">.</span> <span class="free">H</span> <span class="main">‚äÜ</span> <span class="bound">H'</span> <span class="main">‚àß</span> subgroup <span class="bound">H'</span> <span class="free">G</span> <span class="main">‚àß</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="bound">H'</span> <span class="main">‚àß</span> carrier <span class="free">G</span> <span class="main">=</span> adjoin <span class="free">G</span> <span class="bound">H'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚ãÄ</span><span class="bound">H</span><span class="main">.</span> subgroup <span class="bound">H</span> <span class="free">G</span> <span class="main">‚üπ</span> <span class="bound">H</span> <span class="main">‚â†</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="skolem">P</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="bound">H</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="bound">H</span><span class="main">)</span><span class="main">)</span>
                <span class="main">‚üπ</span> <span class="skolem">P</span> <span class="bound">H</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="main">‚ãÄ</span><span class="bound">H</span><span class="main">.</span> subgroup <span class="bound">H</span> <span class="free">G</span> <span class="main">‚üπ</span> <span class="bound">H</span> <span class="main">=</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="skolem">P</span> <span class="bound">H</span><span class="main">)</span> <span class="main">‚üπ</span>
                <span class="main">(</span><span class="main">‚ãÄ</span><span class="bound">H</span><span class="main">.</span> <span class="main">¬¨</span> subgroup <span class="bound">H</span> <span class="free">G</span> <span class="main">‚üπ</span> <span class="skolem">P</span> <span class="bound">H</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="skolem">P</span> <span class="skolem">a0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">a0</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction_schema</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_bounded_set<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="skolem">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">‚â†</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> H'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">‚äÇ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> H'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="skolem">H</span> <span class="skolem">a</span> <span class="main">‚äÜ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adjoin_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="skolem">H</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àâ</span> <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoined_in_adjoin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="skolem">H</span> <span class="skolem">a</span> <span class="main">‚â†</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> H <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">(</span><span class="bound">B</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="bound">A</span> <span class="main">‚äÇ</span> <span class="bound">B</span> <span class="main">‚àß</span> <span class="bound">B</span> <span class="main">‚äÜ</span> carrier <span class="free">G</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> adjoin_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mem_adjoin<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">B</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">(</span><span class="bound">B</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="bound">A</span> <span class="main">‚äÇ</span> <span class="bound">B</span> <span class="main">‚àß</span> <span class="bound">B</span> <span class="main">‚äÜ</span> carrier <span class="free">G</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">‚àß</span> carrier <span class="free">G</span> <span class="main">‚äÜ</span> carrier <span class="free">G</span> <span class="main">‚àß</span> <span class="skolem">B</span> <span class="main">‚äÜ</span> carrier <span class="free">G</span> <span class="main">‚àß</span> <span class="skolem">A</span> <span class="main">‚äÇ</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">H</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ind<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.hyps"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.hyps"</span> <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H</span> <span class="skolem">a</span><span class="main">)</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adjoin_subgroup<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.IH"</span><span class="main">[</span><span class="operator">folded</span> a_def<span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àÉ</span><span class="bound">H'</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">H</span> <span class="main">‚äÜ</span> <span class="bound">H'</span> <span class="main">‚àß</span> subgroup <span class="bound">H'</span> <span class="free">G</span> <span class="main">‚àß</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="bound">H'</span> <span class="main">‚àß</span> carrier <span class="free">G</span> <span class="main">=</span> adjoin <span class="free">G</span> <span class="bound">H'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="skolem">H</span> <span class="free">G</span>‚Ä∫</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">H</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="skolem">H</span> <span class="skolem">a</span> <span class="main">‚äÜ</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="skolem">H'</span> <span class="free">G</span>"</span></span> 
                                 <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem_adjoin<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="skolem">H</span> <span class="free">G</span>‚Ä∫</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> a
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">H'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> group_decompose_adjoin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H0</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H0</span> <span class="main">‚â†</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">H</span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H0</span> <span class="main">‚äÜ</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> group_decompose_adjoin_aux<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_adjoin_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base adjoin<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H0</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H0</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> adjoin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">H</span> <span class="bound">a</span><span class="main">.</span> subgroup <span class="bound">H</span> <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">H0</span> <span class="main">‚äÜ</span> <span class="bound">H</span> <span class="main">‚üπ</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="bound">H</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="bound">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="main">‚üπ</span> 
                           <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="bound">H</span> <span class="bound">a</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_def fin<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="skolem">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H0</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H0</span> <span class="main">‚äÜ</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def subset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">H</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_psubset_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>psubset <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="free">H0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> base<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">interpret</span></span> H_sg<span class="main">:</span> subgroup <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H</span><span class="main">‚¶à</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_imp_finite_comm_group<span class="main">)</span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">have</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H0</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_sg.subgroup_axioms <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="free">H0</span> <span class="free">G</span>‚Ä∫</span></span> psubset.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subgroup_incl<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> H.group_decompose_adjoin<span class="main">[</span><span class="operator">OF</span> sg<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> False
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> H'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H0</span> <span class="main">‚äÜ</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="skolem">H'</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àà</span> <span class="skolem">H</span> <span class="main">-</span> <span class="skolem">H'</span>"</span></span> 
                              <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="skolem">H'</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="skolem">H</span> <span class="free">G</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> H'<span class="main">(</span>2<span class="main">)</span> group.incl_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> H' <span class="keyword2"><span class="keyword">and</span></span> adjoined_in_adjoin<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H'</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="skolem">H'</span> <span class="free">G</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> mem_adjoin<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H'</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àà</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àâ</span> <span class="skolem">H'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">‚äÜ</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">‚äÇ</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> psubset.IH <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">H'</span> <span class="main">‚äÇ</span> <span class="skolem">H</span>‚Ä∫</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="skolem">H'</span> <span class="free">G</span>‚Ä∫</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="free">H0</span> <span class="main">‚äÜ</span> <span class="skolem">H'</span>‚Ä∫</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H'</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> H' <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="skolem">H'</span> <span class="free">G</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adjoin<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> H' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subgroup_adjoin_induct' <span class="main">[</span><span class="operator">case_names</span> singleton adjoin<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> adjoin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">H</span> <span class="bound">a</span><span class="main">.</span> subgroup <span class="bound">H</span> <span class="free">G</span> <span class="main">‚üπ</span> <span class="bound">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">-</span> <span class="bound">H</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="bound">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="main">‚üπ</span> 
                           <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="bound">H</span> <span class="bound">a</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_adjoin_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Multiplicative_Characters">
<div class="head">
<h1>Theory Multiplicative_Characters</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Multiplicative_Characters.thy
    Author:    Manuel Eberl, TU M√ºnchen
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπMultiplicative Characters of Finite Abelian Groups‚Ä∫</span></span>
<span class="keyword1"><span class="command">theory</span></span> Multiplicative_Characters
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Group_Adjoin.html">Group_Adjoin</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπDefinition of characters‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  A (multiplicative) character is a completely multiplicative function from a group to the
  complex numbers. For simplicity, we restrict this to finite abelian groups here, which is
  the most interesting case.

  Characters form a group where the identity is the \emph{principal} character that maps all
  elements to $1$, multiplication is point-wise multiplication of the characters, and the inverse
  is the point-wise complex conjugate.

  This group is often called the \emph{Pontryagin dual} group and is isomorphic to the original
  group (in a non-natural way) while the double-dual group <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">‚àó</span></span>‚Äπis‚Ä∫</span></span> naturally isomorphic to the
  original group.

  To get extensionality of the characters, we also require characters to map anything that is
  not in the group to $0$.
‚Ä∫</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">principal_char</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">‚áí</span> <span class="tfree">'a</span> <span class="main">‚áí</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">principal_char</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">‚àà</span> carrier <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inv_character</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_character</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> cnj <span class="main">(</span><span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_character_principal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv_character <span class="main">(</span>principal_char <span class="free">G</span><span class="main">)</span> <span class="main">=</span> principal_char <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def principal_char_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_character_inv_character <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv_character <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_inv_character<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_character <span class="free">œá</span> <span class="free">j</span> <span class="main">=</span> cnj <span class="main">(</span><span class="free">œá</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def<span class="main">)</span>


<span class="keyword1"><span class="command">bundle</span></span> character_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">notation</span></span> principal_char <span class="main">(</span><span class="quoted">"<span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>ƒ±"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> character <span class="main">=</span> finite_comm_group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">œá</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">‚áí</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> char_one_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">ùü≠</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> char_eq_0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àâ</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> char_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">b</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">‚äó</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">*</span> <span class="free">œá</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπBasic properties‚Ä∫</span></span>

<span class="keyword1"><span class="command">lemma</span></span> char_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">ùü≠</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> char_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">ùü≠</span></span> <span class="quoted"><span class="main">ùü≠</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">ùü≠</span> <span class="main">*</span> <span class="main">(</span><span class="free">œá</span> <span class="main">ùü≠</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> char_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> char_one_nz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> char_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> char_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> ord <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> ord <span class="free">a</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> ord <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> char_power<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> ord <span class="free">a</span> <span class="main">=</span> <span class="main">ùü≠</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pow_ord_eq_1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> char_root'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> order <span class="free">G</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> order <span class="free">G</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> order <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> order <span class="free">G</span> <span class="main">=</span> <span class="main">ùü≠</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pow_order_eq_1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_char<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> order <span class="free">G</span> <span class="main">=</span> norm <span class="main">(</span><span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> order <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_power<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> order <span class="free">G</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> char_root'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> order <span class="free">G</span> <span class="main">=</span> <span class="main">1</span> <span class="main">^</span> order <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> power_eq_iff_eq_base<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> char_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> char_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚ü∑</span> <span class="free">a</span> <span class="main">‚àâ</span> carrier <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚ü∑</span> norm <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚ü∑</span> <span class="free">a</span> <span class="main">‚àâ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> norm_char<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_character<span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_character_def char_eq_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_inv_character<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">k</span> <span class="main">*</span> inv_character <span class="free">œá</span> <span class="free">k</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">k</span> <span class="main">*</span> inv_character <span class="free">œá</span> <span class="free">k</span> <span class="main">=</span> of_real <span class="main">(</span>norm <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> complex_norm_square<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_char_def norm_char<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    char_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> char_inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">a</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">=</span> <span class="main">ùü≠</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span> <span class="main">‚äó</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="free">œá</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> char_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> mult_inv_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def principal_char_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span><span class="free">œá</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> character_principal <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span>principal_char <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_char_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> finite_comm_group.character_principal

<span class="keyword1"><span class="command">lemma</span></span> character_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá'</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> <span class="free">œá'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">œá'</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> character.char_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> character_mult <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">œá'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> œá'<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">œá'</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> œá.char_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> character_inv_character_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span> <span class="main">‚ü∑</span> character <span class="free">G</span> <span class="free">œá</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> character.inv_character <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> character.inv_character<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">characters</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">‚áí</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">‚áí</span> complex<span class="main">)</span> set"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">characters</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">œá</span><span class="main">.</span> character <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">œá</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe Character group‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The characters of a finite abelian group $G$ form another group $\widehat{G}$, which is called
  its Pontryagin dual group. This generalises to the more general setting of locally compact
  abelian groups, but we restrict ourselves to the finite setting because it is much easier.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Characters</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">‚áí</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">‚áí</span> complex<span class="main">)</span> monoid"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Characters</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">‚¶á</span> carrier <span class="main">=</span> characters <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> mult <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">œá<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">œá<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="bound">œá<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">œá<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">k</span><span class="main">)</span><span class="main">,</span>
                          one <span class="main">=</span> principal_char <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">‚¶à</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> carrier_Characters<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">=</span> characters <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Characters_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> one_Characters<span class="main">:</span> <span class="quoted"><span class="quoted">"one <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">=</span> principal_char <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Characters_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_Characters<span class="main">:</span> <span class="quoted"><span class="quoted">"mult <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="free">œá<span class="hidden">‚á©</span><sub>1</sub></span> <span class="free">œá<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="free">œá<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">a</span> <span class="main">*</span> <span class="free">œá<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Characters_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> finite_comm_group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> principal<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"principal_char <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_characters <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>characters <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"characters <span class="free">G</span> <span class="main">‚äÜ</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> 
                          Pi<span class="hidden">‚á©</span><sub>E</sub> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">^</span> order <span class="free">G</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">‚äÜ</span> <span class="var">?h</span> <span class="main">`</span> <span class="var">?Chars</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">œá</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">(</span>restrict <span class="skolem">œá</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="var">?h</span> <span class="main">`</span> <span class="var">?Chars</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> œá.char_root'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">(</span>restrict <span class="skolem">œá</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œá</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff œá.char_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?h</span> <span class="main">`</span> <span class="var">?Chars</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI finite_PiE finite_roots_unity<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_comm_group_Characters <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite_comm_group <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œá</span> <span class="skolem">œá'</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá'</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def carrier_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">interpret</span></span> œá'<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá'</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def  carrier_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="skolem">œá'</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> œá.char_eq_0 one_Characters 
                                         mult_Characters characters_def  carrier_Characters<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">œá'</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def one_Characters mult_Characters  carrier_Characters<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span>principal_char <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">ùü≠</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def one_Characters mult_Characters  carrier_Characters<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œá</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def carrier_Characters<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">ùü≠</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">œá</span> <span class="main">=</span> <span class="skolem">œá</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">=</span> <span class="skolem">œá</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_char_def fun_eq_iff œá.char_eq_0 one_Characters mult_Characters<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> Units <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def carrier_Characters<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> inv_character <span class="skolem">œá</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
         <span class="quoted"><span class="quoted">"inv_character <span class="skolem">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">œá</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> œá.mult_inv_character mult_ac one_Characters mult_Characters<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_character <span class="skolem">œá</span> <span class="main">‚àà</span> carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def carrier_Characters<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> Units_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">‚äÜ</span> Units <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_char_def one_Characters mult_Characters carrier_Characters<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> character<span class="main">)</span> character_in_order_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> principal_char <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>carrier <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Diff_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> card_0_eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_char_def char_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> characters_in_order_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"characters <span class="free">G</span> <span class="main">=</span> <span class="main">{</span>principal_char <span class="free">G</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> character.character_in_order_1 <span class="main">[</span><span class="operator">OF</span> _ assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> character<span class="main">)</span> inv_Characters<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="free">œá</span> <span class="main">=</span> inv_character <span class="free">œá</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> Characters<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Characters.inv_equality<span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def mult_inv_character mult_ac 
                   carrier_Characters one_Characters mult_Characters<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> inv_Characters'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚àà</span> characters <span class="free">G</span> <span class="main">‚üπ</span> <span class="keyword1">inv</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="free">œá</span> <span class="main">=</span> inv_character <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> character.inv_Characters<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> Characters_simps <span class="main">=</span> 
  carrier_Characters mult_Characters one_Characters inv_Characters'

<span class="keyword1"><span class="command">lemma</span></span> inv_Characters'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚àà</span> characters <span class="free">G</span> <span class="main">‚üπ</span> <span class="keyword1">inv</span><span class="hidden">‚áò</span><sub>Characters <span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="free">œá</span> <span class="main">=</span> inv_character <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> character.inv_Characters<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">œá</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπRelationship of characters and adjoining‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  We now study the set of characters of two subgroups $H$ and $H_x$, where $x\in G\setminus H$
  and $H_x$ is the smallest supergroup of $H$ that contains <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>x‚Ä∫</span></span></span></span>.

  Let $n$ denote the indicator of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>x‚Ä∫</span></span></span></span> in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> (i.\,e.\ the smallest positive number such
  that $x^n\in H$) We show that any character on $H_x$ corresponds to a pair of
  a character <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>œá‚Ä∫</span></span></span></span> on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> and an $n$-th root of $\chi(x^n)$ (or, equivalently, an $n$-th
  root of unity).
‚Ä∫</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_comm_group_adjoin
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_character<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">‚¶à</span><span class="main">)</span> <span class="free">œá</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"character <span class="var">?G''</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="keyword1">then</span> <span class="free">œá</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"character <span class="var">?G'</span> <span class="var">?œá</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> G''<span class="main">:</span> finite_comm_group <span class="var"><span class="quoted"><span class="var">?G''</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_finite_comm_group adjoin_subgroup<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="free">H</span> <span class="free">G</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> finite_comm_group <span class="var"><span class="quoted"><span class="var">?G'</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_finite_comm_group adjoin_subgroup<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> character <span class="var"><span class="quoted"><span class="var">?G''</span></span></span> <span class="quoted"><span class="free">œá</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="var">?G'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> carrier <span class="var">?G'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?œá</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="var">?G'</span></sub><span class="hidden">‚áô</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?œá</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?œá</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> char_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> mem_adjoin<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="free">H</span> <span class="free">G</span>‚Ä∫</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> char_one<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> char_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift_character</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">‚áí</span> complex<span class="main">)</span> <span class="main">√ó</span> complex <span class="main">‚áí</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">‚áí</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lift_character</span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">œá</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">œá</span> <span class="main">(</span>fst <span class="main">(</span>unadjoin <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> snd <span class="main">(</span>unadjoin <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_character<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">‚â°</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="free">œá</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"character <span class="var">?G'</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">^</span> <span class="free">h</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">‚¶à</span><span class="main">)</span> <span class="main">(</span>lift_character <span class="main">(</span><span class="free">œá</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"character <span class="var">?G''</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adjoin_subgroup is_subgroup<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> G''<span class="main">:</span> finite_comm_group <span class="var"><span class="quoted"><span class="var">?G''</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_finite_comm_group adjoin_subgroup<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="free">H</span> <span class="free">G</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> finite_comm_group <span class="var"><span class="quoted"><span class="var">?G'</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_finite_comm_group adjoin_subgroup<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> character <span class="var"><span class="quoted"><span class="var">?G'</span></span></span> <span class="quoted"><span class="free">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> char_one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> char_one<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoin_def h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unadjoin <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> unadjoin_unique'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unadjoin <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y'</span><span class="main">,</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y l <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> unadjoin_unique'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> char_mult'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">‚äó</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> char_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> char_power'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> that char_one <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> char_mult' <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> char_one<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def r_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mod_less_divisor subgroup_indicator_pos is_subgroup<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="free">h</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zz_def h_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_pow_closed<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pow_subgroup_indicator is_subgroup<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">zz</span> <span class="main">‚äó</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_mult zz_def nat_pow_pow r_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x y r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unadjoin <span class="main">(</span><span class="skolem">x</span> <span class="main">‚äó</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">‚äó</span> <span class="skolem">y'</span> <span class="main">‚äó</span> <span class="skolem">zz</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> unadjoin_unique' m_closed<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lift_character <span class="main">(</span><span class="free">œá</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="var">?G''</span></sub><span class="hidden">‚áô</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">‚äó</span> <span class="skolem">y'</span> <span class="main">‚äó</span> <span class="skolem">zz</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">^</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_character_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="main">(</span><span class="free">œá</span> <span class="skolem">zz</span> <span class="main">*</span> <span class="free">z</span> <span class="main">^</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x<span class="main">(</span>1<span class="main">)</span> y<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> char_mult' char_power'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="skolem">zz</span> <span class="main">*</span> <span class="free">z</span> <span class="main">^</span> <span class="skolem">r</span> <span class="main">=</span> <span class="free">z</span> <span class="main">^</span> <span class="main">(</span><span class="free">h</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> h_def zz_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπsubgroup <span class="free">H</span> <span class="free">G</span>‚Ä∫</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> char_power'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pow_subgroup_indicator h_def power_mult power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="free">z</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> lift_character <span class="main">(</span><span class="free">œá</span><span class="main">,</span><span class="free">z</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">*</span> lift_character <span class="main">(</span><span class="free">œá</span><span class="main">,</span><span class="free">z</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_character_def power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_character_lift_character<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚àà</span> characters <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="keyword1">then</span> lift_character <span class="main">(</span><span class="free">œá</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
          <span class="quoted"><span class="quoted">"lift_character <span class="main">(</span><span class="free">œá</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span>"</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> char_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">‚äó</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> œá.char_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> char_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> œá.char_one that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> char_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">using</span></span> œá.char_eq_0 mem_adjoin<span class="main">[</span><span class="operator">OF</span> is_subgroup _ a_in_carrier<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">using</span></span> œá.char_one is_subgroup
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def adjoined_in_adjoin<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_character_lower_character<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚àà</span> characters <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lift_character <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="keyword1">then</span> <span class="free">œá</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">,</span> <span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">‚¶à</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="var"><span class="quoted"><span class="var">?G'</span></span></span> <span class="quoted"><span class="free">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> unadjoin_correct<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="free">G</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adjoin_subgroup is_subgroup a_in_carrier<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span>unadjoin <span class="skolem">x</span><span class="main">)</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="var">?G'</span></sub><span class="hidden">‚áô</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="var">?G'</span></sub><span class="hidden">‚áô</span> snd <span class="main">(</span>unadjoin <span class="skolem">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span>fst <span class="main">(</span>unadjoin <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="var">?G'</span></sub><span class="hidden">‚áô</span> snd <span class="main">(</span>unadjoin <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> œá.char_mult<span class="main">)</span> 
                               <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_pow_modify_carrier mem_adjoin adjoined_in_adjoin<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="var">?G'</span></sub><span class="hidden">‚áô</span> snd <span class="main">(</span>unadjoin <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">^</span> snd <span class="main">(</span>unadjoin <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> œá.char_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoined_in_adjoin<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def œá.char_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_character_unchanged <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lift_character <span class="free">œáz</span> <span class="free">x</span> <span class="main">=</span> fst <span class="free">œáz</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mem_adjoin<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> is_subgroup
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">œáz</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_character_adjoined <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">œáz</span><span class="main">)</span> <span class="main">‚üπ</span> lift_character <span class="free">œáz</span> <span class="free">a</span> <span class="main">=</span> snd <span class="free">œáz</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_subgroup character.char_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">œáz</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_character_def adjoined_in_adjoin character.char_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_characters_adjoin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">‚â°</span> subgroup_indicator <span class="free">G</span> <span class="free">H</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw lift_character
                  <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">œá</span><span class="main">:</span>characters <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">^</span> <span class="free">h</span> <span class="main">=</span> <span class="bound">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="free">h</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                  <span class="main">(</span>characters <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">‚¶à</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">Œª</span></span><span class="bound"><span class="bound">œá</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">Œª</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">‚àà</span></span> <span class="free"><span class="free">H</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="bound"><span class="bound">œá</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">œá</span></span> <span class="free"><span class="free">a</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def h_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lift_character<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> characters_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">œá</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lower_character<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">œá</span><span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> œá<span class="main">:</span> character <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="free">H</span> <span class="free">a</span><span class="main">‚¶à</span>"</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œá</span> <span class="free">a</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> œá.char_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> is_subgroup 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoined_in_adjoin nat_pow_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> œá.char_power<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> is_subgroup a_in_carrier pow_subgroup_indicator <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subgroup_indicator_pos œá.char_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lower_character_lift_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="skolem"><span class="skolem">w</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"snd <span class="skolem"><span class="skolem">w</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">œá</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_character_lower_character<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπNon-trivial facts about characters‚Ä∫</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_comm_group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The following theorem is a very central one. It shows that any character on a subgroup <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> can
  be extended to a character on the full group in exactly $[G : H]$ ways.

  The proof is by induction; we start with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> and then successively adjoin elements until we
  have reached <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>G‚Ä∫</span></span></span></span>. As we showed before, when we lift a character from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> to $H_x$, we have
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>n‚Ä∫</span></span></span></span> choices to do so, where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>n‚Ä∫</span></span></span></span> is the indicator of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>x‚Ä∫</span></span></span></span> in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span>. Since $|H_x| = n |H|$, the
  induction step is valid.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">theorem</span></span> card_character_extensions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="free">œá</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">œá'</span></span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subgroup_adjoin_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">œá'</span></span> <span class="main">‚àà</span> characters <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">œá</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> base <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff characters_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> character_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> base <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>adjoin <span class="skolem">H'</span> <span class="skolem">a</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> subgroup <span class="quoted"><span class="skolem">H'</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H'</span><span class="main">‚¶à</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_imp_finite_comm_group<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> finite_comm_group_adjoin <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">H'</span></span> <span class="quoted"><span class="skolem">a</span></span>
    <span class="keyword1"><span class="command">using</span></span> adjoin.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> subgroup_indicator <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> adjoin <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_indicator_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> adjoin <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">‚àà</span> <span class="skolem">H'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def h_def pow_subgroup_indicator<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">H'</span><span class="main">.</span> <span class="main">{</span><span class="bound">œá'</span><span class="main">.</span> <span class="bound">œá'</span> <span class="main">‚àà</span> characters <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="bound">H'</span><span class="main">‚¶à</span><span class="main">)</span> <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">œá</span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">z</span> <span class="main">^</span> <span class="skolem">h</span> <span class="main">=</span> <span class="bound">œá</span> <span class="skolem">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ H'.finite_characters<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>

  <span class="comment1">(* TODO: extract lemma *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw H'.lift_character <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">œá</span><span class="main">:</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">œá</span><span class="main">)</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"H'.lift_character <span class="main">‚àà</span> Sigma <span class="main">(</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">)</span> <span class="skolem">I</span> <span class="main">‚Üí</span> <span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œá</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> <span class="skolem">C</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">‚àà</span> <span class="skolem">I</span> <span class="skolem">œá</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> H'.lift_character <span class="main">(</span><span class="skolem">œá</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">œá</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * adjoin.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"H'.lift_character <span class="main">(</span><span class="skolem">œá</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">‚àà</span> <span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> H'.lift_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def I_def h_def c_def characters_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">œá</span><span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="skolem">H'</span> <span class="keyword1">then</span> <span class="bound">œá</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">,</span> <span class="bound">œá</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">‚Üí</span> Sigma <span class="main">(</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">)</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œá</span> <span class="keyword3"><span class="command">assume</span></span> œá<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> <span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">xa</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">‚àà</span> <span class="skolem">H'</span> <span class="keyword1">then</span> <span class="skolem">œá</span> <span class="bound">xa</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">‚àà</span> <span class="skolem">C</span> <span class="skolem">H'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> H'.lower_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span><span class="main">]</span> adjoin.prems adjoin.hyps
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def characters_def character.char_eq_0<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span><span class="hidden">‚áò</span><sub><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">‚¶à</span></sub><span class="hidden">‚áô</span> subgroup_indicator <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">‚¶à</span><span class="main">)</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span>
              <span class="skolem">œá</span> <span class="skolem">a</span> <span class="main">^</span> subgroup_indicator <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">‚¶à</span><span class="main">)</span> <span class="skolem">H'</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> œá adjoin.prems adjoin.hyps
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> character.char_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def characters_def adjoined_in_adjoin<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œá</span> <span class="skolem">a</span> <span class="main">^</span> subgroup_indicator <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_consistent <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> h_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> œá <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="skolem">a</span> <span class="main">‚àà</span> <span class="skolem">I</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">xa</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">‚àà</span> <span class="skolem">H'</span> <span class="keyword1">then</span> <span class="skolem">œá</span> <span class="bound">xa</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> adjoin.hyps adjoin.prems
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def C_def characters_def character.char_power character.char_eq_0
                       pow_subgroup_indicator h_def c_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œáz</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œáz</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">œá</span><span class="main">:</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">œá</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">œá</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œáz</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">œá</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">œáz</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">xa</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">‚àà</span> <span class="skolem">H'</span> <span class="keyword1">then</span> H'.lift_character <span class="skolem">œáz</span> <span class="bound">xa</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">,</span> H'.lift_character <span class="skolem">œáz</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œáz</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H'.lower_character_lift_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">œá</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œá</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> <span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"H'.lift_character <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="skolem">H'</span> <span class="keyword1">then</span> <span class="skolem">œá</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">œá</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œá</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H'.lift_character_lower_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">œá</span><span class="main">:</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">œá</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">œá</span><span class="main">:</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">œá</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">a</span><span class="main">‚àà</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">I</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_SigmaI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">a</span><span class="main">‚àà</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">.</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">œá</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> character <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="skolem">H'</span><span class="main">‚¶à</span>"</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> characters_def C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="skolem">c</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> char_eq_0_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def h_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pow_subgroup_indicator adjoin<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def card_nth_roots<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">*</span> card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">*</span> card <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">=</span> card <span class="skolem">H'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> adjoin.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> adjoin.IH<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">*</span> card <span class="skolem">H'</span> <span class="main">=</span> card <span class="main">(</span>adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adjoin.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_adjoin<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> order <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="skolem">H'</span> <span class="skolem">a</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  By taking <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> to be the trivial subgroup, we obtain that the number of characters
  on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>G‚Ä∫</span></span></span></span> is precisely the order of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>G‚Ä∫</span></span></span></span> itself, i.\,e.\ $|\widehat{G}|=|G|$.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">corollary</span></span> card_characters<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>characters <span class="free">G</span><span class="main">)</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">œá</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">=</span> principal_char <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">‚¶à</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> triv<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> triv<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">‚¶à</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_imp_finite_comm_group<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> triv.is_subgroup<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">œá'</span></span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">*</span> card <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> œá_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_character_extensions triv.is_subgroup triv.character_principal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">œá'</span></span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> characters <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def character.char_one principal_char_def œá_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> order_Characters <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_def card_characters carrier_Characters<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  It also follows as a simple corollary that any character on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>H‚Ä∫</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">‚àó</span></span>‚Äπcan‚Ä∫</span></span> be extended
  to a character on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>G‚Ä∫</span></span></span></span>.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">corollary</span></span> character_extension_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">‚¶à</span><span class="main">)</span> <span class="free">œá</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">œá'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="main">‚üπ</span> <span class="free">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">œá'</span></span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_character_extensions assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">œá'</span></span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">œá'</span></span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">H</span><span class="main">.</span> <span class="bound">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">}</span> <span class="main">‚â†</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">œá'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="skolem">œá'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">H</span> <span class="main">‚üπ</span> <span class="skolem">œá'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">œá</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> characters_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Lastly, we can also show that for each $x\in H$ of order $n &gt; 1$ and each <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>n‚Ä∫</span></span></span></span>-th root of
  unity <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>z‚Ä∫</span></span></span></span>, there exists a character <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>œá‚Ä∫</span></span></span></span> on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>G‚Ä∫</span></span></span></span> such that $\chi(x) = z$.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">corollary</span></span> character_with_value_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚â†</span> <span class="main">ùü≠</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">^</span> ord <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">œá</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">triv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">triv</span> <span class="main">=</span> <span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">‚¶à</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> triv<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> triv<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span><span class="main">‚¶à</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_imp_finite_comm_group<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> triv.is_subgroup<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> finite_comm_group_adjoin <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">x</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> subgroup_indicator <span class="free">G</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_pow_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="main">=</span> <span class="main">ùü≠</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pow_subgroup_indicator<span class="main">[</span><span class="operator">OF</span> triv.is_subgroup assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subgroup_indicator_pos<span class="main">[</span><span class="operator">OF</span> triv.is_subgroup assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_pow_h triv.is_subgroup assms <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym subgroup_indicator_le_ord ord_min<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">œá</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">=</span> principal_char <span class="skolem">triv</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">œá'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá'</span> <span class="main">=</span> H.lift_character <span class="main">(</span><span class="skolem">œá</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>adjoin <span class="free">G</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">x</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adjoin_subgroup triv.is_subgroup assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> œá'<span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="main">(</span><span class="free">G</span><span class="main">‚¶á</span>carrier <span class="main">:=</span> adjoin <span class="free">G</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">x</span><span class="main">‚¶à</span><span class="main">)</span> <span class="skolem">œá'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H.lift_character<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> triv.character_principal assms x_pow_h
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> œá'_def œá_def principal_char_def triv_def h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">œá''</span></span> <span class="keyword2"><span class="keyword">where</span></span> œá''<span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="skolem">œá''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">‚àà</span> adjoin <span class="free">G</span> <span class="main">{</span><span class="main">ùü≠</span><span class="main">}</span> <span class="free">x</span> <span class="main">‚üπ</span> <span class="skolem">œá''</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">œá'</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> character_extension_exists<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá''</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">œá'</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> œá''<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms triv.is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoined_in_adjoin<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá'</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> œá'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> H.lift_character_adjoined<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> œá_def triv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá''</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  In particular, for any <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>x‚Ä∫</span></span></span></span> that is not the identity element, there exists a character <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>œá‚Ä∫</span></span></span></span>
  such that $\chi(x)\neq 1$.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">corollary</span></span> character_neq_1_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚â†</span> <span class="main">ùü≠</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">œá</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">x</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> ord <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_pow_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">^</span> ord <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z_def DeMoivre<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ord_ge_1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pow_ord_eq_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">k</span> <span class="main">/</span> real <span class="main">(</span>ord <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>ord <span class="free">x</span><span class="main">}</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">^</span> ord <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betw_roots_unity<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">k</span> <span class="main">/</span> real <span class="main">(</span>ord <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>ord <span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‚Äπord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">œá</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="skolem">œá</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> character_with_value_exists<span class="main">[</span><span class="operator">OF</span> assms z_pow_h<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe first orthogonality relation‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The entries of any non-principal character sum to 0.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> character<span class="main">)</span> sum_character<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> principal_char <span class="free">G</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_char_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> order <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="skolem">y</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_char_def fun_eq_iff char_eq_0_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">‚äó</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> bij_betw_mult_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="skolem">y</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl char_mult y<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">œá</span> <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">S</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> character_orthogonality1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span> <span class="main">*</span> cnj <span class="main">(</span><span class="free">œá'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> <span class="free">œá'</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> Characters <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> C<span class="main">:</span> finite_comm_group <span class="quoted"><span class="skolem">C</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_comm_group_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?œá</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span> <span class="main">*</span> inv_character <span class="free">œá'</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span> <span class="main">*</span> inv_character <span class="free">œá'</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> character_mult character.inv_character assms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span> <span class="main">*</span> cnj <span class="main">(</span><span class="free">œá'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="var">?œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_character_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?œá</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_character<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?œá</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="main">‚ü∑</span> <span class="free">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span> <span class="keyword1">inv</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span> <span class="free">œá'</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Characters_simps characters_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚ü∑</span> <span class="free">œá</span> <span class="main">=</span> <span class="free">œá'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span> <span class="keyword1">inv</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span> <span class="free">œá'</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> C.inv_equality <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> <span class="free">œá'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def Characters_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> <span class="free">œá'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span> <span class="keyword1">inv</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span> <span class="free">œá'</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="skolem">C</span></sub><span class="hidden">‚áô</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> C.r_inv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> carrier_Characters characters_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe isomorphism between a group and its double dual‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Lastly, we show that the double dual of a finite abelian group is naturally isomorphic
  to the original group via the obvious isomorphism $x\mapsto (\chi\mapsto \chi(x))$.
  It is easy to see that this is a homomorphism and that it is injective. The fact 
  $|\widehat{\widehat{G}}| = |\widehat{G}| = |G|$ then shows that it is also surjective.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">context</span></span> finite_comm_group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">double_dual_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">‚áí</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">‚áí</span> complex<span class="main">)</span> <span class="main">‚áí</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">double_dual_iso</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">œá</span><span class="main">.</span> <span class="keyword1">if</span> character <span class="free">G</span> <span class="bound">œá</span> <span class="keyword1">then</span> <span class="bound">œá</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> double_dual_iso_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span> <span class="main">‚üπ</span> double_dual_iso <span class="free">x</span> <span class="free">œá</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> double_dual_iso_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> character_double_dual_iso <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"character <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">(</span>double_dual_iso <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_comm_group_Characters<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"character <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">(</span>double_dual_iso <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> double_dual_iso_def characters_def Characters_def
                                              principal_char_def character.char_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> double_dual_iso_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">(</span><span class="free">x</span> <span class="main">‚äó</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span>
             double_dual_iso <span class="free">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span></sub><span class="hidden">‚áô</span> double_dual_iso <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> double_dual_iso_def Characters_def fun_eq_iff character.char_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> double_dual_iso_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">ùü≠</span> <span class="main">=</span> principal_char <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff double_dual_iso_def principal_char_def
                 carrier_Characters characters_def character.char_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_double_dual_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on double_dual_iso <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_comm_group_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> G''<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> G'.finite_comm_group_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">‚àà</span> hom <span class="free">G</span> <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> carrier_Characters characters_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inj_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">ùü≠</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="skolem">x</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span></sub><span class="hidden">‚áô</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚â†</span> <span class="main">ùü≠</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">œá</span></span> <span class="keyword2"><span class="keyword">where</span></span> œá<span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="skolem">œá</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="skolem">x</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> character_neq_1_exists<span class="main">[</span><span class="operator">OF</span> x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">x</span> <span class="main">‚â†</span> <span class="main">ùü≠</span>‚Ä∫</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">œá</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">œá</span> <span class="main">‚àà</span> characters <span class="free">G</span> <span class="keyword1">then</span> <span class="bound">œá</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">œá</span> <span class="main">‚àà</span> characters <span class="free">G</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> double_dual_iso_def Characters_def fun_eq_iff
                     principal_char_def characters_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="bound">œá</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> œá <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> characters_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_aux hom is_group G''.is_group <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> inj_on_one_iff'<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> double_dual_iso_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> <span class="free">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span> <span class="main">‚üπ</span> double_dual_iso <span class="free">x</span> <span class="main">=</span> double_dual_iso <span class="free">y</span> <span class="main">‚ü∑</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_double_dual_iso<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> double_dual_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">‚àà</span> iso <span class="free">G</span> <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> isoI<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_comm_group_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> G''<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> G'.finite_comm_group_Characters<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">‚àà</span> hom <span class="free">G</span> <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> carrier_Characters characters_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw double_dual_iso <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on double_dual_iso <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> inj_double_dual_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">`</span> carrier <span class="free">G</span> <span class="main">=</span> carrier <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_subset_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> G''.fin<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>carrier <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> carrier_Characters G'.card_characters card_characters order_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> card <span class="main">(</span>double_dual_iso <span class="main">`</span> carrier <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_image <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> inj_double_dual_iso<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>double_dual_iso <span class="main">`</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span>
                      card <span class="main">(</span>carrier <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="main">`</span> carrier <span class="free">G</span> <span class="main">‚äÜ</span> carrier <span class="main">(</span>Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> double_dual_is_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"Characters <span class="main">(</span>Characters <span class="free">G</span><span class="main">)</span> <span class="main">‚âÖ</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iso_sym<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> double_dual_iso <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‚Äπ<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_iso_def‚Ä∫</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The second orthogonality relation follows from the first one via Pontryagin duality:
‚Ä∫</span></span>
<span class="keyword1"><span class="command">theorem</span></span> sum_characters<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="bound">œá</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">ùü≠</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> finite_comm_group <span class="quoted"><span class="quoted">"Characters <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_comm_group_Characters<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> x<span class="main">:</span> character <span class="quoted"><span class="quoted">"Characters <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"double_dual_iso <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x.sum_character <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> double_dual_iso_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="main">ùü≠</span></span><span class="main">]</span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def carrier_Characters <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> double_dual_iso_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> character_orthogonality2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="bound">œá</span> <span class="free">x</span> <span class="main">*</span> cnj <span class="main">(</span><span class="bound">œá</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="bound">œá</span> <span class="free">x</span> <span class="main">*</span> cnj <span class="main">(</span><span class="bound">œá</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="bound">œá</span> <span class="main">(</span><span class="free">x</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character.char_inv character.char_mult characters_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="free">y</span> <span class="main">=</span> <span class="main">ùü≠</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_characters<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚äó</span> <span class="keyword1">inv</span> <span class="free">y</span> <span class="main">=</span> <span class="main">ùü≠</span> <span class="main">‚ü∑</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inv_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_Characters">
<div class="head">
<h1>Theory Dirichlet_Characters</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_Characters.thy
    Author:    Manuel Eberl, TU M√ºnchen
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπDirichlet Characters‚Ä∫</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Characters
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Multiplicative_Characters.html">Multiplicative_Characters</a>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Residues.html">HOL-Number_Theory.Residues</a>"</span>
  <span class="quoted">"<a href="../Dirichlet_Series/Multiplicative_Function.html">Dirichlet_Series.Multiplicative_Function</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Dirichlet characters are essentially just the characters of the multiplicative group of
  integer residues $\mathbb{ZZ}/n\mathbb{ZZ}$ for some fixed $n$. For convenience, these residues
  are usually represented by natural numbers from $0$ to $n - 1$, and we extend the characters to 
  all natural numbers periodically, so that $\chi(k\mod n) = \chi(k)$ holds.

  Numbers that are not coprime to $n$ are not in the group and therefore are assigned $0$ by
  all characters.
‚Ä∫</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe multiplicative group of residues‚Ä∫</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">residue_mult_group</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> nat monoid"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">residue_mult_group</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">‚¶á</span> carrier <span class="main">=</span> totatives <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> monoid.mult <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> one <span class="main">=</span> <span class="main">1</span> <span class="main">‚¶à</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">principal_dchar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> nat <span class="main">‚áí</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">principal_dchar</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> coprime <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_coprime <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">k</span> <span class="free">n</span> <span class="main">‚üπ</span> principal_dchar <span class="free">n</span> <span class="free">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> principal_dchar_not_coprime <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬¨</span>coprime <span class="free">k</span> <span class="free">n</span> <span class="main">‚üπ</span> principal_dchar <span class="free">n</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_dchar_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"principal_dchar <span class="free">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_minus1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"principal_dchar <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> coprime_diff_one_left_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> principal_dchar_coprime<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mod_in_totatives<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">‚üπ</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àà</span> totatives <span class="free">n</span> <span class="main">‚ü∑</span> coprime <span class="free">a</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def mod_greater_zero_iff_not_dvd <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> coprime_common_divisor_nat<span class="main">)</span>

<span class="keyword1"><span class="command">bundle</span></span> dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">notation</span></span> principal_dchar <span class="main">(</span><span class="quoted">"<span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>ƒ±"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> residues_nat <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">‚â°</span> residue_mult_group <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> order <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> totient <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_def G_def totient_def residue_mult_group_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> totatives_mod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚àà</span> totatives <span class="free">n</span> <span class="main">‚üπ</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mod_less<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order.not_eq_order_implies_strict<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_minus1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"principal_dchar <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> principal_dchar_minus1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">sublocale</span></span> finite_comm_group <span class="quoted"><span class="free">G</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def totatives_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coprime_common_divisor_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def totatives_def
                   mod_greater_zero_iff_not_dvd le_Suc_eq <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> coprime_mult_left_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">y</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def mult_ac mod_mult_right_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def totatives_def 
                               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order.not_eq_order_implies_strict<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> Units <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">unfolding</span></span> Units_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">x</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def totatives_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‚Äπcoprime <span class="skolem">x</span> <span class="free">n</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coprime_iff_invertible'_nat<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">y</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coprime_iff_invertible_nat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">a</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="main">‚àß</span> <span class="skolem">x</span> <span class="main">‚äó</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">ùü≠</span><span class="hidden">‚áò</span><sub><span class="free">G</span></sub><span class="hidden">‚áô</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def totatives_def mult.commute <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">‚äÜ</span> Units <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def mult_ac<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπDefinition of Dirichlet characters‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The following two functions make the connection between Dirichlet characters and the
  multiplicative characters of the residue group.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">c2dc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">‚áí</span> complex<span class="main">)</span> <span class="main">‚áí</span> <span class="main">(</span>nat <span class="main">‚áí</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c2dc</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dc2c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">‚áí</span> complex<span class="main">)</span> <span class="main">‚áí</span> <span class="main">(</span>nat <span class="main">‚áí</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dc2c</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dc2c_c2dc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dc2c <span class="main">(</span>c2dc <span class="free">œá</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff dc2c_def c2dc_def char_eq_0_iff G_def
                           residue_mult_group_def totatives_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> dcharacter <span class="main">=</span> residues_nat <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">œá</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">‚àà</span> totatives <span class="free">n</span> <span class="main">‚üπ</span> <span class="free">b</span> <span class="main">‚àà</span> totatives <span class="free">n</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">*</span> <span class="free">œá</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq_zero<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬¨</span>coprime <span class="free">a</span> <span class="free">n</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">1</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_eq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_zero<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n mult_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> one_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> totatives_def<span class="main">)</span>   

<span class="keyword1"><span class="command">lemma</span></span> periodic_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> Suc <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> periodic<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_one_periodic <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> periodic_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">a</span> <span class="main">=</span> <span class="free">b</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="free">n</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cong_iff_lin_nat<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">a</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> periodic_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> periodic_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">a</span> <span class="main">*</span> <span class="free">œá</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">n</span> <span class="main">‚àß</span> coprime <span class="free">b</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àà</span> totatives <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àà</span> totatives <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def mod_greater_zero_iff_not_dvd coprime_absorb_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def mod_mult_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¨</span>coprime <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> mult<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="free">œá</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚ü∑</span> <span class="main">¬¨</span>coprime <span class="free">x</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cong_solve_coprime_nat <span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="free">œá</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>‚Ä∫</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_one'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span> n<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> periodic_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult.power<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> power2_eq_1_iff<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c2dc_dc2c <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"c2dc <span class="main">(</span>dc2c <span class="free">œá</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c2dc_def dc2c_def fun_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> character_dc2c<span class="main">:</span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="main">(</span>dc2c <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">insert</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def dc2c_def totatives_def
                              <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eq_zero<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> dc2c<span class="main">:</span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"dc2c <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> character_dc2c<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dcharacter_inv_character <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dcharacter <span class="free">n</span> <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_character_def eq_zero periodic<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> coprime <span class="free">k</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">k</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> dc2c <span class="free">œá</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dc2c_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> coprime <span class="free">k</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dc2c.norm_char<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def residue_mult_group_def mod_in_totatives<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_le_1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> norm<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dcharacters</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> <span class="main">(</span>nat <span class="main">‚áí</span> complex<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dcharacters</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">œá</span><span class="main">.</span> dcharacter <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">œá</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> residues_nat
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> character_dc2c<span class="main">:</span> <span class="quoted"><span class="quoted">"dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚üπ</span> character <span class="free">G</span> <span class="main">(</span>dc2c <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dcharacter.character_dc2c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">œá</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dcharacter_c2dc<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"character <span class="free">G</span> <span class="free">œá</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dcharacter <span class="free">n</span> <span class="main">(</span>c2dc <span class="free">œá</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> character <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¨</span>coprime <span class="skolem">x</span> <span class="free">n</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"c2dc <span class="free">œá</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c2dc_def char_eq_0_iff G_def residue_mult_group_def totatives_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> char_mult char_one n<span class="main"><span class="keyword3">,</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c2dc_def G_def residue_mult_group_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> char_mult char_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"principal_dchar <span class="free">n</span> <span class="main">=</span> c2dc <span class="main">(</span>principal_char <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c2dc_def principal_dchar_def principal_char_def G_def
                residue_mult_group_def fun_eq_iff mod_in_totatives<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> principal<span class="main">:</span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"principal_dchar <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_dchar_altdef dcharacter_c2dc <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> G_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c2dc_principal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"c2dc <span class="main">(</span>principal_char <span class="free">G</span><span class="main">)</span> <span class="main">=</span> principal_dchar <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_dchar_altdef<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dc2c_principal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dc2c <span class="main">(</span>principal_dchar <span class="free">n</span><span class="main">)</span> <span class="main">=</span> principal_char <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dc2c <span class="main">(</span>c2dc <span class="main">(</span>principal_char <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dc2c <span class="main">(</span>principal_dchar <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> c2dc_principal<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> dc2c_c2dc<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> bij_betw_dcharacters_characters<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw dc2c <span class="main">(</span>dcharacters <span class="free">n</span><span class="main">)</span> <span class="main">(</span>characters <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">c2dc</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def dcharacters_def dcharacter_c2dc 
                 character_dc2c dcharacter.c2dc_dc2c<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_characters_dcharacters<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw c2dc <span class="main">(</span>characters <span class="free">G</span><span class="main">)</span> <span class="main">(</span>dcharacters <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">dc2c</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> characters_def dcharacters_def dcharacter_c2dc 
                 character_dc2c dcharacter.c2dc_dc2c<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_dcharacters <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dcharacters <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_finite <span class="main">[</span><span class="operator">OF</span> bij_betw_dcharacters_characters<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> card_dcharacters <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>dcharacters <span class="free">n</span><span class="main">)</span> <span class="main">=</span> totient <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_same_card <span class="main">[</span><span class="operator">OF</span> bij_betw_dcharacters_characters<span class="main">]</span> card_characters <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_character_eq_principal_dchar_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"inv_character <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚ü∑</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff inv_character_def principal_dchar_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπSums of Dirichlet characters‚Ä∫</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> sum_dcharacter_totatives<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>totatives <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>totatives <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>carrier <span class="free">G</span><span class="main">.</span> dc2c <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def dc2c_def G_def residue_mult_group_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> dc2c <span class="free">œá</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>order <span class="free">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dc2c.sum_character<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dc2c <span class="free">œá</span> <span class="main">=</span> principal_char <span class="free">G</span> <span class="main">‚ü∑</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c2dc_dc2c dc2c_principal principal_dchar_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> sum_dcharacter_block<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span>totatives <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def eq_zero_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I order.not_eq_order_implies_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_dcharacter_totatives<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> sum_dcharacter_block'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum <span class="free">œá</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">œá</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">œá</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> i <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?g</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_zero_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_dcharacter_block<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> sum_lessThan_dcharacter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">‚à™</span> <span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">‚Ä¶</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_dcharacter_block<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{..&lt;</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> periodic<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{..&lt;</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> periodic<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less.IH<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_geq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> sum_dcharacter_lessThan_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">‚â§</span> totient <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_lessThan_dcharacter<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àß</span> coprime <span class="bound">x</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àß</span> coprime <span class="bound">x</span> <span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_norm_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àß</span> coprime <span class="bound">x</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> card <span class="main">(</span>totatives <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_le_iff
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àß</span> coprime <span class="bound">x</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> totatives <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> totient <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> totient_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> sum_dcharacter_atMost_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">‚àë</span><span class="bound">x</span><span class="main">‚â§</span><span class="free">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">x</span><span class="main">)</span> <span class="main">‚â§</span> totient <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_dcharacter_lessThan_le<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> lessThan_Suc_atMost<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues_nat<span class="main">)</span> sum_dcharacters<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">œá</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">[</span><span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚àà</span> totatives <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_in_totatives<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">œá</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> c2dc <span class="bound">œá</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_betw_characters_dcharacters<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>characters <span class="free">G</span><span class="main">.</span> <span class="bound">œá</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2dc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> order <span class="free">G</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_characters<span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> G_def residue_mult_group_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚ü∑</span> <span class="main">[</span><span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd.commute<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_red_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="main">¬¨</span>coprime <span class="free">x</span> <span class="free">n</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">œá</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter.eq_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">‚â†</span> <span class="main">1</span>‚Ä∫</span></span> <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dcharacter<span class="main">)</span> even_dcharacter_linear_sum_eq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">-</span> of_nat <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_subtractf sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">Œª</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_dcharacter_block<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">k</span> <span class="main">=</span> of_nat <span class="skolem">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> periodic_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="skolem">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_L_Functions">
<div class="head">
<h1>Theory Dirichlet_L_Functions</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_L_Functions.thy
    Author:    Manuel Eberl, TU M√ºnchen
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπDirichlet $L$-functions‚Ä∫</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_L_Functions
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Dirichlet_Characters.html">Dirichlet_Characters</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
  <span class="quoted">"<a href="../Zeta_Function/Zeta_Function.html">Zeta_Function.Zeta_Function</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  We can now define the Dirichlet $L$-functions. These are essentially the functions in the complex
  plane that the Dirichlet series $\sum_{k=1}^\infty \chi(k) k^{-s}$ converge to, for some fixed 
  Dirichlet character $\chi$.

  First of all, we need to take care of a syntactical problem: The notation for vectors uses 
  $\chi$ as syntax, which causes some annoyance to us, so we disable it locally.
‚Ä∫</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">bundle</span></span> vec_lambda_notation
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">notation</span></span> vec_lambda <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">œá</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">bundle</span></span> no_vec_lambda_notation
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">no_notation</span></span> vec_lambda <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">œá</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπDefinition and basic properties‚Ä∫</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  We now define Dirichlet $L$ functions as a finite linear combination of Hurwitz $\zeta$ functions.
  This has the advantage that we directly get the analytic continuation over the full domain
  and only need to prove that the series really converges to this definition whenever it
  does converge, which is not hard to do.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Dirichlet_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> <span class="main">(</span>nat <span class="main">‚áí</span> complex<span class="main">)</span> <span class="main">‚áí</span> complex <span class="main">‚áí</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Dirichlet_L</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> 
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="main">=</span> principal_dchar <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> eval_fds <span class="main">(</span>fds <span class="free"><span class="bound"><span class="entity">œá</span></span></span><span class="main">)</span> <span class="main">1</span>
      <span class="keyword1">else</span> 
        of_nat <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">œá</span></span></span> <span class="bound">k</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span>real <span class="bound">k</span> <span class="main">/</span> real <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_conv_hurwitz_zeta_nonprincipal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span> <span class="main">=</span>
             of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span>real <span class="bound">k</span> <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Analyticity everywhere except $1$ is trivial by the above definition, since the
  Hurwitz $\zeta$ function is analytic everywhere except $1$. For $L$ functions of non
  principal characters, we will have to show the analyticity at $1$ separately later.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span> holomorphic_Dirichlet_L_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">‚àâ</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">m</span> <span class="free">œá</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> of_nat <span class="free">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="bound">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span>real <span class="bound">k</span> <span class="main">/</span> real <span class="free">m</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
           <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Dirichlet_L_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">‚ü∑</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">context</span></span> dcharacter
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  For a real value greater than 1, the formal Dirichlet series of an $L$ function
  for some character $\chi$ converges to the L function.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   abs_summable_Dirichlet_L<span class="main">:</span>  <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   summable_Dirichlet_L<span class="main">:</span>      <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   sums_Dirichlet_L<span class="main">:</span>          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   Dirichlet_L_conv_eval_fds_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_Suc_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">rule</span> summable_comparison_test <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ summable_zeta_real<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">insert</span> s norm<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_powr_real_powr<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_norm_cancel<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> <span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">..&lt;</span><span class="bound">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_group<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> <span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">..&lt;</span><span class="bound">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">..&lt;</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> periodic_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="skolem">k</span> <span class="main">/</span> of_nat <span class="free">n</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">*</span> of_nat <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self1 div_mult_self2 div_mult_self3 div_mult_self4<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="skolem">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> powr_times_real<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">+</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> periodic_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="keyword1">sums</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> of_real <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span>
                   <span class="main">(</span>of_nat <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_sum sums_mult sums_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">‚Ä¶</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> summable <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff L_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def sums_iff powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> fds_nth_fds'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">‚üπ</span> fds_abs_converges <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_summable_Dirichlet_L<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> fds_nth_fds'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c</span>"</span></span><span class="main"><span class="main">]</span></span> conjI fds_abs_converges_weak<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Dirichlet $L$ functions have the Euler product expansion
  \[L(\chi, s) = \prod_p \left(1 - \frac{\chi(p)}{p^{-s}}\right)\]
  for all $s$ with $\mathfrak{R}(s) &gt; 1$.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   Dirichlet_L_euler_product_LIMSEQ<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="main">‚àè</span><span class="bound">p</span><span class="main">‚â§</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">œá</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>
                <span class="main">‚á¢</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   Dirichlet_L_abs_convergent_euler_product<span class="main">:</span>
            <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">Œª</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span>  <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">œá</span> <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.completely_multiplicative_function_axioms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_summable_Dirichlet_L<span class="main">[</span><span class="operator">OF</span> s<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_nth_fds' powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="main">‚àè</span><span class="bound">p</span><span class="main">‚â§</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">œá</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>
          <span class="main">‚á¢</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_euler_product_LIMSEQ' <span class="main">[</span><span class="operator">OF</span> mult conv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds' <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_Dirichlet_L<span class="main">[</span><span class="operator">OF</span> s<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff fds_nth_fds' powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> fds_abs_convergent_euler_product' <span class="main">[</span><span class="operator">OF</span> mult conv<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_Re_gt_1_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds' mult.completely_multiplicative_function_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_summable_Dirichlet_L<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_nth_fds' powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">‚ü∑</span> <span class="main">(</span><span class="main">‚àÉ</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> fds_nth <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="bound">p</span> <span class="main">=</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_abs_convergent_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Dirichlet_L_conv_eval_fds_weak<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¨</span><span class="main">(</span><span class="main">‚àÉ</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> fds_nth <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="bound">p</span> <span class="main">=</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> nat_power <span class="skolem">p</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">1</span> <span class="main">&lt;</span> real <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_less_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">1</span> <span class="main">‚â§</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> Re <span class="free">s</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_of_nat_ge_one_iff prime_ge_Suc_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> norm <span class="main">(</span>nat_power <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_nat_power norm_powr_real_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="skolem">p</span> <span class="free">s</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_fds' norm<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_dcharacter_antimono_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x0</span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="free">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">‚áí</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonprincipal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="main">‚â§</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="free">x0</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="free">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="free">x0</span> <span class="main">‚üπ</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f'_nonpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="free">x0</span> <span class="main">‚üπ</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">‚â§</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real <span class="main">-`</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> deriv <span class="main">=</span> has_field_derivative_at_within <span class="main">[</span><span class="operator">OF</span> f'<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_continuous_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> ab <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> I'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ab deriv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
                      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">t</span> <span class="main">*</span> of_real <span class="main">(</span><span class="free">f'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> C_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="var">?A</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">‚â§</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> nonprincipal
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_dcharacter_atMost_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?A</span> <span class="free">b</span> <span class="main">*</span> <span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="var">?A</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="free">a</span> <span class="main">-</span> 
             <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real <span class="main">-`</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab x0 cont f'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> partial_summation_strong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">]</span></span> has_vector_derivative_of_real<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real <span class="main">-`</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?A</span> <span class="free">b</span> <span class="main">*</span> <span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="var">?A</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="free">a</span> <span class="main">-</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> norm <span class="main">(</span><span class="var">?A</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="var">?A</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> norm <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> norm_triangle_ineq4<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">I</span> <span class="main">‚â§</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">-</span><span class="skolem">C</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="free">f'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">using</span></span> I I' f'_nonpos ab C
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_norm_bound_integral integrable_on_cmult_left<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff norm_mult mult_right_mono_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_linear<span class="main">[</span><span class="operator">OF</span> _ bounded_linear_of_real<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f'</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main">]</span> I'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff o_def <span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">-</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>sum_upto <span class="free">œá</span> <span class="free">b</span><span class="main">)</span> <span class="main">‚â§</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>sum_upto <span class="free">œá</span> <span class="free">a</span><span class="main">)</span> <span class="main">‚â§</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">-</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> f_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono C_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summable_dcharacter_antimono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x0</span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="free">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">‚áí</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonprincipal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="free">x0</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="free">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="free">x0</span> <span class="main">‚üπ</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f'_nonpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚â•</span> <span class="free">x0</span> <span class="main">‚üπ</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">‚â§</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">‚§è</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_bounded_partials <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚åà</span><span class="free">x0</span><span class="main">‚åâ</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">0</span> <span class="free">x0</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"max <span class="main">0</span> <span class="free">x0</span> <span class="main">‚â§</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">&lt;</span> real <span class="skolem">b</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_le_iff ceiling_le_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span><span class="main">{</span><span class="skolem">a</span><span class="main">&lt;..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="free">f</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real <span class="main">-`</span> <span class="main">{</span>real <span class="skolem">a</span><span class="main">&lt;..</span>real <span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="free">f</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nonprincipal * f' f_nonneg f'_nonpos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_dcharacter_antimono_bound<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendsto_mult_right_zero filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lim<span class="main"><span class="main">]</span></span> filterlim_real_sequentially<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_le_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonprincipal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ereal <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_dcharacter_antimono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> s assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendsto_neg_powr filterlim_ident<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">s'</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s'</span> <span class="main">‚àô</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">‚àß</span> fds_converges <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="bound">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">s</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_def powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_nth_fds'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summable_Dirichlet_L'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonprincipal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_le_0<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> fds_nth_fds'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   Dirichlet_L_conv_eval_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="bound">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   holomorphic_Dirichlet_L<span class="main">:</span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">‚äÜ</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span><span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">s</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aff_dim_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>complex"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> connected_punctured_convex convex_halfspace_Re_gt<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> that n assms False<span class="main"><span class="keyword3">,</span></span> 
         <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> convex_halfspace_Re_gt open_halfspace_Re_gt exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span> 
                      <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holomorphic_Dirichlet_L_weak
                      Dirichlet_L_conv_eval_fds_weak le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_le_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> no_isolated_singularity'<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_Dirichlet_L_weak<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">‚îÄ</span><span class="skolem">s</span><span class="main">‚Üí</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">(</span>eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_fds_eval holomorphic_on_imp_continuous_on<span class="main">)</span>
          <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_le_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">‚îÄ</span><span class="skolem">s</span><span class="main">‚Üí</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> continuous_on_eq_continuous_at<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt isCont_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">‚îÄ</span><span class="skolem">s</span><span class="main">‚Üí</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_filter <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">z</span><span class="main">.</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cnj_Dirichlet_L<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> summable_Dirichlet_L'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def fds_nth_fds' powr_minus sums_iff <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> inv_character <span class="free">œá</span> <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> cnj <span class="main">(</span>eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sums_cnj <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds <span class="main">(</span>inv_character <span class="free">œá</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> cnj <span class="main">(</span>eval_fds <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def fds_nth_fds' inv_character_def sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def cnj_powr eval_inv_character<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> holomorphic_Dirichlet_L <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚à®</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="main">1</span> <span class="main">‚àâ</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="main">1</span> <span class="main">‚àâ</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> holomorphic_Dirichlet_L_weak<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"principal_dchar <span class="free">n</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> dcharacter.holomorphic_Dirichlet_L<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> holomorphic_Dirichlet_L' <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚à®</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">‚â†</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> holomorphic_on_compose<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> holomorphic_Dirichlet_L<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">œá</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_Dirichlet_L<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚à®</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="main">1</span> <span class="main">‚àâ</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="main">(</span>Dirichlet_L <span class="free">n</span> <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_Dirichlet_L' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚à®</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">‚â†</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_compose2<span class="main">[</span><span class="operator">OF</span> continuous_on_Dirichlet_L<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_Dirichlet_L <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">‚üπ</span> <span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚à®</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="free">s</span> <span class="main">‚â†</span> <span class="main">1</span> <span class="main">‚üπ</span> 
     continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Dirichlet_L <span class="free">n</span> <span class="free">œá</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> continuous_on_Dirichlet_L<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> UNIV<span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at open_Compl<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_Dirichlet_L' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">‚üπ</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="free">f</span> <span class="main">‚üπ</span>
     <span class="free">œá</span> <span class="main">‚â†</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> dcharacter <span class="free">n</span> <span class="free">œá</span> <span class="main">‚à®</span> <span class="free">œá</span> <span class="main">=</span> principal_dchar <span class="free">n</span> <span class="main">‚àß</span> <span class="free">f</span> <span class="free">s</span> <span class="main">‚â†</span> <span class="main">1</span> <span class="main">‚üπ</span> 
     continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_compose3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> continuous_Dirichlet_L<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">context</span></span> residues_nat
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Applying the above to the $L(\chi_0,s)$, the $L$ function of the principal character, we find 
  that it differs from the Riemann $\zeta$ function only by multiplication with a constant that 
  depends only on the modulus $n$. They therefore have the same analytic properties as the $\zeta$
  function itself.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_principal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> zeta <span class="free">s</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="free">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">‚äÜ</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="main">‚àè</span><span class="bound">p</span><span class="main">‚â§</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>
                    <span class="main">‚á¢</span> Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> principal.Dirichlet_L_euler_product_LIMSEQ<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">‚ü∑</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚â§</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">‚á¢</span> Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="skolem">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> filterlim <span class="var">?g</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">p</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚â§</span><span class="skolem">m</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">m</span> <span class="main">‚àß</span> prime <span class="bound">p</span> <span class="main">‚àß</span> coprime <span class="bound">p</span> <span class="free">n</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> prod <span class="main">_</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_dchar_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">m</span> <span class="main">‚àß</span> prime <span class="bound">p</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">-</span> <span class="var">?C</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_imp_coprime <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coprime_absorb_left<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span> <span class="main">-</span> <span class="var">?C</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?C</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.subset_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?P</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span> <span class="main">-</span> <span class="var">?C</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?C</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?P</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?C</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?P</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?C</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod.cong<span class="main">)</span>
               <span class="main">(</span><span class="operator">insert</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_def exp_eq_1<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span> <span class="main">-</span> <span class="var">?C</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚â§</span><span class="skolem">m</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="var">?f</span> <span class="bound">p</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_cong_left<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">‚á¢</span> Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">‚á¢</span> <span class="var">?P</span> <span class="main">*</span> zeta <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult tendsto_const euler_product_zeta s<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?P</span> <span class="main">*</span> zeta <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‚Äπ<span class="free">s</span> <span class="main">‚â†</span> <span class="main">1</span>‚Ä∫</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holomorphic_Dirichlet_L_weak 
         open_halfspace_Re_gt exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span> connected_punctured_universe<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_def zeta_1<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe non-vanishing for $\mathfrak{R}(s)\geq 1$‚Ä∫</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coprime_prime_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bigger_prime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¨</span><span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The case of the principal character is trivial, since it differs from the Riemann $\zeta(s)$
  only in a multiplicative factor that is clearly non-zero for $\mathfrak{R}(s) \geq 1$.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues_nat<span class="main">)</span> Dirichlet_L_Re_ge_1_nonzero_principal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">‚â†</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="main">(</span>principal_dchar <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">‚â†</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> prod_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_prime_divisors<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¨</span><span class="main">(</span><span class="main">‚àÉ</span><span class="bound">p</span><span class="main">‚àà</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> Re <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> p assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def prime_gt_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> zeta_Re_ge_1_nonzero<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_principal<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The proof for non-principal character is quite involved and is typically very complicated
  and technical in most textbooks. For instance, Apostol~\cite{apostol1976analytic} proves the
  result separately for real and non-real characters, where the non-real case is relatively short
  and nice, but the real case involves a number of complicated asymptotic estimates.

  The following proof, on the other hand -- like our proof of the analogous result for the 
  Riemann $\zeta$ function -- is based on Newman's book~\cite{newman1998analytic}. Newman gives 
  a very short, concise, and high-level sketch that we aim to reproduce faithfully here.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">context</span></span> dcharacter
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">theorem</span></span> Dirichlet_L_Re_ge_1_nonzero_nonprincipal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">u</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">u</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">include</span></span> dcharacter_syntax
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span>Im <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def complex_eq_iff<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">œá'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá'</span> <span class="main">=</span> inv_character <span class="free">œá</span>"</span></span>

    <span class="comment1">‚Äï ‚ÄπWe define the function $Z(s)$, which is the product of all the Dirichlet $L$ functions,
        and its Dirichlet series. Then, similarly to the proof of the non-vanishing of the
        Riemann $\zeta$ function for $\mathfrak{R}(s) \geq 1$, we define
        $Q(s) = Z(s) Z(s + ia) Z(s - ia)$. Our objective is to show that the Dirichlet series
        of this function $Q$ converges everywhere.‚Ä∫</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z_fds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z_fds</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> fds <span class="bound">œá</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q_fds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q_fds</span> <span class="main">=</span> <span class="skolem">Z_fds</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> fds_shift <span class="main">(</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">Z_fds</span> <span class="main">*</span> fds_shift <span class="main">(</span><span class="main">-</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">Z_fds</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sings</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">}</span>"</span></span>
  
    <span class="comment1">‚Äï ‚ÄπSome preliminary auxiliary facts‚Ä∫</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">x</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> œá<span class="hidden">‚á©</span><sub>0</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal.dcharacter_axioms dcharacters_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="skolem">A</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> œá<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá'</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dcharacter_axioms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter.dcharacter_inv_character<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> zero dcharacter.cnj_Dirichlet_L<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> dcharacter_axioms
      <span class="keyword1"><span class="command">have</span></span> zero'<span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="skolem">œá'</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">using</span></span> œá<span class="hidden">‚á©</span><sub>0</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext prod.remove<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">*</span> zeta <span class="bound">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_principal P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Z_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">*</span> zeta <span class="bound">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> Z_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">*</span> zeta <span class="bound">s</span> <span class="main">*</span> Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="bound">s</span> <span class="main">*</span>
                       <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">œá</span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> œá<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">P</span> <span class="skolem">s</span> <span class="main">*</span> zeta <span class="skolem">s</span> <span class="main">*</span> 
              <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Z_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="skolem">s</span> <span class="main">*</span> 
                   <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">œá</span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span>  <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms œá that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.remove<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">‚Äï ‚ÄπWe again show that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> is locally bounded everywhere by showing that every
        singularity is cancelled by some zero. Since now, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">a</span></span><span class="antiquote">}</span></span> can be zero, we do a
        case distinction here to make things a bit easier.‚Ä∫</span>
    <span class="keyword1"><span class="command">have</span></span> Q_bigo_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="bound">s</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">1</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> œá assms n
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> taylor_bigo_linear holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span>
                             <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">*</span> zeta <span class="bound">s</span> <span class="main">*</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="bound">s</span> <span class="main">*</span>
                  <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">œá</span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> œá assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Z_eq'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n œá
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult continuous_imp_bigo_1 zeta_bigo_at_1 <span class="dynamic"><span class="dynamic">continuous_intros</span></span> *<span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">Œò[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Z_at_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">using</span></span> n œá
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_bigo_1 <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Z_at_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> bigo1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> 
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">œá</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms n that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> taylor_bigo_linear holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span>
                    <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span>
                     <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">œá</span><span class="main">}</span><span class="main">.</span> Dirichlet_L <span class="free">n</span> <span class="bound">œá</span>  <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Z_eq'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">using</span></span> that n
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult continuous_imp_bigo_1 <span class="dynamic"><span class="dynamic">continuous_intros</span></span> *<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat dcharacters_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_eq <span class="keyword1"><span class="command">using</span></span> n that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult zeta_bigo_at_1 continuous_imp_bigo_1 <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">Œò[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> bigo1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> 
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">œá</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">interpret</span></span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def G_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> bigo1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv_character <span class="skolem">œá</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span>"</span></span><span class="main">]</span> that cnj_Dirichlet_L<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter_inv_character<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> bigo2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> 
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">œá</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span>filtermap <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bigo1'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">œá</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute landau_o.big.in_filtermap_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> filtermap_at_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> bigo2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="skolem">œá</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> 
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">œá</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">interpret</span></span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def G_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> bigo2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv_character <span class="skolem">œá</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span>"</span></span><span class="main">]</span> that cnj_Dirichlet_L<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter_inv_character<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> Q_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Z</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def power2_eq_square mult_ac<span class="main">)</span>
  
      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àâ</span> <span class="var">?sings</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Q_eq <span class="keyword1"><span class="command">using</span></span> assms zero zero' False œá
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult bigo1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span> bigo1'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_eq
          <span class="keyword1"><span class="command">using</span></span> assms zero zero' False œá n
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult bigo2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span> continuous_imp_bigo_1<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z_def dcharacters_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">‚àà</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">](</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_eq
          <span class="keyword1"><span class="command">using</span></span> assms zero zero' False œá n
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult bigo2'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">œá</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span> continuous_imp_bigo_1<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z_def dcharacters_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def Z_def <span class="keyword1"><span class="command">using</span></span> n 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_bigo_1 <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def complex_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">‚Äï ‚ÄπAgain, we can remove the singularities from <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> and extend it to an entire function.‚Ä∫</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">Q'</span><span class="main">.</span> <span class="bound">Q'</span> <span class="keyword1">holomorphic_on</span> UNIV <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">z</span><span class="main">‚àà</span>UNIV <span class="main">-</span> <span class="var">?sings</span><span class="main">.</span> <span class="bound">Q'</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> removable_singularities Q_bigo_1<span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def Z_def dcharacters_def complex_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">‚àâ</span> <span class="var">?sings</span> <span class="main">‚üπ</span> <span class="skolem">Q'</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="comment1">‚Äï ‚Äπ<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q'</span></span><span class="antiquote">}</span></span> constitutes an analytic continuation of the Dirichlet series of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span>.‚Ä∫</span>
    <span class="keyword1"><span class="command">have</span></span> eval_Q_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">Q_fds</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">Q'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dcharacter <span class="free">n</span> <span class="skolem">œá</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds <span class="skolem">œá</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dcharacter.abs_conv_abscissa_weak<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">œá</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">Q_fds</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_fds_def Q_def eval_fds_mult eval_fds_power fds_abs_converges_mult 
              eval_fds_prod fds_abs_converges_prod dcharacter.Dirichlet_L_conv_eval_fds_weak
              fds_abs_converges_power eval_fds_zeta Z_fds_def Z_def fds_abs_converges<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">Q'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">‚Äï ‚ÄπSince the characters are completely multiplicative, the series for this logarithm can
        be rewritten like this:‚Ä∫</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">[</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">then</span> totient <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ln_Q_fds_eq<span class="main">:</span>
      <span class="quoted"><span class="quoted">"fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">I</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
        <span class="keyword1"><span class="command">using</span></span> dcharacter.Suc_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">œá</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> fds_ln_mult<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> l'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> fds_ln_power<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
                   fds_ln_prod<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> fds_ln <span class="main">0</span> <span class="main">(</span>fds <span class="bound">œá</span><span class="main">)</span> <span class="main">+</span> 
              fds_shift <span class="main">(</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fds_ln <span class="main">0</span> <span class="main">(</span>fds <span class="bound">œá</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> fds_shift <span class="main">(</span><span class="main">-</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fds_ln <span class="main">0</span> <span class="main">(</span>fds <span class="bound">œá</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_fds_def Z_fds_def simps nz sum.distrib sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> 
                         fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">œá</span> <span class="bound">k</span> <span class="main">*</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span><span class="main">_</span><span class="main">.</span> <span class="var">?l</span> <span class="bound">œá</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">œá</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def G_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="skolem">œá</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds' mult.completely_multiplicative_function_axioms<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ln <span class="main">0</span> <span class="main">(</span>fds <span class="skolem">œá</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">œá</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">‚á©</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_completely_multiplicative<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult<span class="main"><span class="main">]</span></span> fds_nth_fds' fds_eq_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="skolem">œá</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="keyword1">/<span class="hidden">‚á©</span><sub>R</sub></span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">ùóÇ</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real numeral_fds<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="keyword1">/<span class="hidden">‚á©</span><sub>R</sub></span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span>of_real<span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cos_exp_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">œá</span> <span class="bound">k</span> <span class="main">*</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cos_of_real <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> 
                                 <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right sum_divide_distrib scaleR_conv_of_real sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">I</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_dcharacters<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">‚Äï ‚ÄπThe coefficients of that logarithm series are clearly nonnegative:‚Ä∫</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span>fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">‚àà</span> <span class="main">‚Ñù<span class="hidden">‚á©</span><sub>‚â•</sub><span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> cos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> cos <span class="skolem">x</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> 
          <span class="keyword1"><span class="command">using</span></span> cos_ge_minus_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span>
                of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">I</span> <span class="skolem">k</span> <span class="main">*</span> mangoldt <span class="skolem">k</span> <span class="main">/</span> ln <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_fds' ln_Q_fds_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚àà</span> <span class="main">‚Ñù<span class="hidden">‚á©</span><sub>‚â•</sub><span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> I_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nonneg_Reals_of_real_iff<span class="main">)</span> 
             <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg divide_nonneg_pos cos mangoldt_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_Q_fds_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">‚Äï ‚ÄπTherefore <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q_fds</span></span><span class="antiquote">}</span></span> also has non-negative coefficients.‚Ä∫</span>
    <span class="keyword1"><span class="command">hence</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="skolem">Q_fds</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nonneg_dirichlet_series_lnD<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound">x</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter.Suc_0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">0</span> <span class="main">=</span> fds_nth <span class="skolem">Q_fds</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_fds_def Z_fds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="comment1">‚Äï ‚ÄπAnd by Pringsheim--Landau, we get that the Dirichlet series of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> converges
        everywhere.‚Ä∫</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">Q_fds</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_fds_def Z_fds_def fds_shift_prod
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_conv_abscissa_power_leI abs_conv_abscissa_mult_leI abs_conv_abscissa_prod_le<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter.abs_conv_abscissa_weak<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nonneg <span class="keyword2"><span class="keyword">and</span></span> eval_Q_fds <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‚Äπ<span class="skolem">Q'</span> <span class="keyword1">holomorphic_on</span> UNIV‚Ä∫</span></span>
      <span class="keyword1"><span class="command">have</span></span> abscissa<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">Q_fds</span> <span class="main">=</span> <span class="main">-</span><span class="main">‚àû</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> entire_continuation_imp_abs_conv_abscissa_MInfty<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main">)</span>
  
    <span class="comment1">‚Äï ‚ÄπAgain, similarly to the proof for $\zeta$, we select a subseries of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span>. This time
        we cannot simply pick powers of 2, since 2 might not be coprime to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">n</span></span><span class="antiquote">}</span></span>, in which 
        case the subseries would simply be 1 everywhere, which is not helpful. However, it is
        clear that there \emph{is} always some prime $p$ that is coprime to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">n</span></span><span class="antiquote">}</span></span>, so we
        just use the subseries <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> that corresponds to powers of $p$.‚Ä∫</span>
    <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coprime_prime_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R_fds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R_fds</span> <span class="main">=</span> fds_primepow_subseries <span class="skolem">p</span> <span class="skolem">Q_fds</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="skolem">R_fds</span> <span class="main">‚â§</span> abs_conv_abscissa <span class="skolem">R_fds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">R_fds</span> <span class="main">‚â§</span> abs_conv_abscissa <span class="skolem">Q_fds</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> R_fds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_restrict<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">-</span><span class="main">‚àû</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> abscissa'<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="skolem">R_fds</span> <span class="main">=</span> <span class="main">-</span><span class="main">‚àû</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="comment1">‚Äï ‚ÄπThe following function $g(a,s)$ is the denominator in the Euler product expansion of 
        the subseries of $Z(s + ia)$. It is clear that it is entire and non-zero for 
        $\mathfrak{R}(s) &gt; 0$ and all real $a$.‚Ä∫</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">‚áí</span> complex <span class="main">‚áí</span> complex"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">œá</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> of_real <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> g_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">a</span> <span class="skolem">s</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> prod_zero_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_dcharacters<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">œá</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">œá</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def G_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">&gt;</span> real <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_less_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">-</span> Re <span class="skolem">s</span> <span class="main">&lt;</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_less_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">-</span> norm <span class="main">(</span><span class="skolem">œá</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult norm norm_powr_real_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">œá</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_triangle_ineq2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> *<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">a</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">A</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>

    <span class="comment1">‚Äï ‚ÄπBy taking Euler product expansions of every factor, we get
          \[R(s) = \frac{1}{g(0,s)^2 g(a,s) g(-a,s)} = 
              (1 - 2^{-s})^{-2} (1 - 2^{-s+ia})^{-1} (1 - 2^{-s-ia})^{-1}\]
        for every $s$ with $\mathfrak{R}(s) &gt; 1$, and by analytic continuation also for
        $\mathfrak{R}(s) &gt; 0$.‚Ä∫</span>

    <span class="keyword1"><span class="command">have</span></span> eval_R<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">R_fds</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">0</span> <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="skolem">s</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">R_fds</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p g_nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> g_nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> g_nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_nz<span class="main">)</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="skolem">œá</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="skolem">œá</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œá</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">interpret</span></span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def dcharacters_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="skolem">œá</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="skolem">œá</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">œá</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds' mult.completely_multiplicative_function_axioms<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dcharacter <span class="free">n</span> <span class="skolem">œá</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dcharacters_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds <span class="skolem">œá</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">œá</span>
          <span class="keyword1"><span class="command">using</span></span> that z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dcharacter.abs_conv_abscissa_weak<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">œá</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">R_fds</span> <span class="skolem">z</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z p
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_fds_def Q_fds_def Z_fds_def eval_fds_mult eval_fds_prod eval_fds_power 
               fds_abs_converges_mult fds_abs_converges_power fds_abs_converges_prod g_def mult_ac
               fds_primepow_subseries_euler_product_cm powr_minus powr_diff powr_add  prod_dividef
               fds_abs_summable_zeta g_nz fds_abs_converges power_one_over divide_inverse <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> that abscissa'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span> convex_connected open_halfspace_Re_gt
                                               convex_halfspace_Re_gt <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">‚Äï ‚ÄπWe again have our contradiction: $R(s)$ is entire, but the right-hand side has a pole at 0
        since $g(0,0) = 0$.‚Ä∫</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> not_tendsto_and_filterlim_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g_limit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="skolem">a</span> <span class="main">‚§è</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="main">(</span><span class="skolem">g</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="skolem">g</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_interior<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_subset<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">0</span> <span class="bound">s</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚§è</span> <span class="skolem">g</span> <span class="main">0</span> <span class="main">0</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> 
              <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> g_limit<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> p <span class="keyword2"><span class="keyword">and</span></span> œá<span class="hidden">‚á©</span><sub>0</sub> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">œá</span> <span class="skolem">p</span> <span class="main">*</span> of_nat <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">0</span> <span class="main">+</span> <span class="keyword1">ùóÇ</span> <span class="main">*</span> of_real <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_dchar_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">0</span> <span class="bound">s</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="bound">s</span> <span class="main">‚â†</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_nz<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">0</span> <span class="bound">s</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="bound">s</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> 
                         <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?f</span> at_infinity <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?lim</span></span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_divide_at_infinity<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span>
                     tendsto_mult_filterlim_at_infinity<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lim</span> <span class="main">‚ü∑</span> filterlim <span class="main">(</span>eval_fds <span class="skolem">R_fds</span><span class="main">)</span> at_infinity <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_R<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="main">‚Ä¶</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="skolem">R_fds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abscissa'<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>eval_fds <span class="skolem">R_fds</span> <span class="main">‚§è</span> eval_fds <span class="skolem">R_fds</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">‚â•</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">‚â•</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> closure <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> closure_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>complex"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">‚àà</span> <span class="main">‚Ä¶</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">‚â†</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> at_within_eq_bot_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> Dirichlet_L_Re_gt_1_nonzero<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπAsymptotic bounds on partial sums of Dirichlet $L$ functions‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The following are some bounds on partial sums of the $L$-function of a character that are
  useful for asymptotic reasoning, particularly for Dirichlet's Theorem.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span> sum_upto_dcharacter_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span>sum_upto <span class="free">œá</span> <span class="free">x</span><span class="main">)</span> <span class="main">‚â§</span> totient <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">œá</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span>nat <span class="main">‚åä</span><span class="free">x</span><span class="main">‚åã</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> totient <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_dcharacter_atMost_le<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_minus_partial_sum_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">œÉ</span> <span class="main">‚â°</span> Re <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span><span class="main">)</span> <span class="main">‚â§</span> 
             real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> cmod <span class="free">s</span> <span class="main">/</span> <span class="free">œÉ</span><span class="main">)</span> <span class="main">/</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">œÉ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_norm_ubound<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_Dirichlet_L'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Dirichlet_L_conv_eval_fds<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff eval_fds_def powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> fds_nth_fds'<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> <span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span><span class="bound">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">‚á¢</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def' atLeast0AtMost<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span><span class="bound">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>
           <span class="main">‚á¢</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> sum_upto <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real<span class="main">-`</span><span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>
              <span class="main">‚â§</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> cmod <span class="free">s</span> <span class="main">/</span> <span class="free">œÉ</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">œÉ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span>  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">M</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                        <span class="skolem">M</span> <span class="skolem">y</span> <span class="main">*</span> of_real <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">-</span> <span class="skolem">M</span> <span class="skolem">x</span> <span class="main">*</span> of_real <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">-</span>
                       <span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real<span class="main">-`</span><span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_real <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> partial_summation_strong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> has_vector_derivative_real_field <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">n</span><span class="main">‚àà</span>real<span class="main">-`</span><span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
             <span class="skolem">M</span> <span class="skolem">y</span> <span class="main">*</span> of_real <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">-</span> <span class="skolem">M</span> <span class="skolem">x</span> <span class="main">*</span> of_real <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">-</span>
             integral <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">M</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> norm <span class="main">(</span><span class="skolem">M</span> <span class="skolem">y</span> <span class="main">*</span> of_real <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">M</span> <span class="skolem">x</span> <span class="main">*</span> of_real <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">+</span>
                 norm <span class="main">(</span>integral <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">M</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> norm_triangle_ineq4<span class="main"><span class="main">]</span></span> add_mono order.refl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">M</span> <span class="skolem">y</span> <span class="main">*</span> of_real <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">‚â§</span> totient <span class="free">n</span> <span class="main">*</span> <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy assms <span class="keyword1"><span class="command">unfolding</span></span> norm_mult M_def œÉ_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono sum_upto_dcharacter_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> totient <span class="free">n</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono powr_mono2'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> œÉ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">M</span> <span class="skolem">x</span> <span class="main">*</span> of_real <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">‚â§</span> totient <span class="free">n</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy assms <span class="keyword1"><span class="command">unfolding</span></span> norm_mult M_def œÉ_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono sum_upto_dcharacter_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">M</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span>
                 integral <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">s</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_norm_bound_integral integrable_on_cmult_left<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">s</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">œÉ</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">M</span> <span class="skolem">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> of_real <span class="skolem">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> 
              real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="free">s</span> <span class="main">*</span> <span class="skolem">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> norm_mult M_def œÉ_def <span class="keyword1"><span class="command">using</span></span> xy t assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono sum_upto_dcharacter_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_powr_real_powr<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">M</span> <span class="skolem">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> of_real <span class="skolem">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">s</span> <span class="main">*</span> <span class="skolem">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> I<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">s</span> <span class="main">*</span> integral <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> 
               <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> œÉ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="free">œÉ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">/</span> <span class="free">œÉ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> œÉ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">+</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">+</span>
                 real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">œÉ</span> <span class="main">/</span> <span class="free">œÉ</span><span class="main">)</span> <span class="main">=</span>
               real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="free">s</span> <span class="main">/</span> <span class="free">œÉ</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">œÉ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">m</span><span class="main">.</span> norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> 
                          <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span><span class="bound">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>
          <span class="main">‚â§</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> cmod <span class="free">s</span> <span class="main">/</span> <span class="free">œÉ</span><span class="main">)</span> <span class="main">/</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">œÉ</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚åä</span><span class="free">x</span><span class="main">‚åã</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span><span class="skolem">m</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚àà</span><span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">‚àß</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
      <span class="keyword1"><span class="command">using</span></span> elim <span class="quoted"><span class="quoted">‚Äπ<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Groups_Big.sum_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                            <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_less_iff floor_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚àà</span><span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> real <span class="main">-`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..</span>real <span class="skolem">m</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="quoted"><span class="quoted">‚Äπ<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_less_iff floor_less_iff not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚àà</span><span class="main">‚Ä¶</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">‚â§</span> 
                 real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> cmod <span class="free">s</span> <span class="main">/</span> <span class="free">œÉ</span><span class="main">)</span> <span class="main">/</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">œÉ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="quoted"><span class="quoted">‚Äπ<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>‚Ä∫</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_less_iff floor_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> partial_Dirichlet_L_sum_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span><span class="main">)</span>
          <span class="main">‚â§</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="free">s</span> <span class="main">/</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span><span class="main">)</span>
            <span class="main">‚â§</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="free">s</span> <span class="main">/</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> Re <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Dirichlet_L_minus_partial_sum_bound<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> elim assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> norm_divide
               <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self1 div_mult_self2 div_mult_self3 div_mult_self4<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπEvaluation of $L(\chi, 0)$‚Ä∫</span></span>

<span class="keyword1"><span class="command">context</span></span> residues_nat
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_0_principal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_principal prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àè</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">context</span></span> dcharacter
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_0_nonprincipal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonprincipal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> of_nat <span class="bound">k</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_conv_hurwitz_zeta_nonprincipal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_subtractf sum_dcharacter_block'
                              sum_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_0_even <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_L_0_nonprincipal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> even_dcharacter_linear_sum_eq_0<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">œá</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="free">œá</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">=</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_L_0_nonprincipal<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπProperties of $L(\chi, s)$ for real $\chi$‚Ä∫</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">unbundle</span></span> no_vec_lambda_notation
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">locale</span></span> real_dcharacter <span class="main">=</span> dcharacter <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">k</span> <span class="main">‚àà</span> <span class="main">‚Ñù</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Im_eq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_real_Re <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>Re <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> char_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="free">k</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> norm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>Re <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>Re <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="free">œá</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">œá</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_character_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv_character <span class="free">œá</span> <span class="main">=</span> <span class="free">œá</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_character_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_in_Reals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">‚àà</span> <span class="main">‚Ñù</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span> <span class="main">‚àà</span> <span class="main">‚Ñù</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cnj_Dirichlet_L<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Reals_cnj_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The following property of real characters is used by Apostol to show the non-vanishing of
  $L(\chi, 1)$. We have already shown this in a much easier way, but this particular result is
  still of general interest.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> sum_char_divisors_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="var">?A</span> <span class="free">k</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   sum_char_divisors_square_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"is_square <span class="free">k</span> <span class="main">‚üπ</span> Re <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sum<span class="main">:</span> multiplicative_function <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> mult.multiplicative_sum_divisors<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">k</span> <span class="main">‚àà</span> <span class="main">‚Ñù</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_Reals real<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="var">?A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="var">?A</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> sum_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">i</span><span class="main">‚â§</span><span class="skolem">m</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span><span class="skolem">m</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> bij_betw_prime_power_divisors<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">k</span><span class="main">‚â§</span><span class="skolem">m</span><span class="main">.</span> Re <span class="main">(</span><span class="free">œá</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â•</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_neg1 char_cases<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="var">?A</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">m</span> <span class="main">‚üπ</span> Re <span class="main">(</span><span class="var">?A</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="var">?A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àè</span><span class="bound">p</span><span class="main">‚àà</span>prime_factors <span class="free">k</span><span class="main">.</span> Re <span class="main">(</span><span class="var">?A</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.prod_prime_factors<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Re_prod_Reals<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> prod_nonneg ballI *<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_square <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="keyword1"><span class="command">using</span></span> k that <span class="keyword1"><span class="command">unfolding</span></span> m
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_power_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span><span class="main">)</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> prod_ge_1 ballI *<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">unbundle</span></span> vec_lambda_notation
<span class="comment1">(*&gt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_Theorem">
<div class="head">
<h1>Theory Dirichlet_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Dirichlet_Theorem.thy
  Author:   Manuel Eberl, TU M√ºnchen
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπDirichlet's Theorem on primes in arithmetic progressions‚Ä∫</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Theorem
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Dirichlet_L_Functions.html">Dirichlet_L_Functions</a>
  <a href="../Bertrands_Postulate/Bertrand.html">Bertrands_Postulate.Bertrand</a>
  <a href="../Landau_Symbols/Landau_More.html">Landau_Symbols.Landau_More</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  We can now turn to the proof of the main result: Dirichlet's theorem about the infinitude
  of primes in arithmetic progressions.

  There are previous proofs of this by John Harrison in HOL Light~\cite{harrison-dirichlet} and 
  by Mario Carneiro in Metamath~\cite{carneiro16}. Both of them strive to prove Dirichlet's
  theorem with a minimum amount of auxiliary results and definitions, whereas our goal was to
  get a short and simple proof of Dirichlet's theorem built upon a large library of Analytic
  Number Theory.

  At this point, we already have the key part -- the non-vanishing of $L(1,\chi)$
  -- and the proof was relatively simple and straightforward due to the large amount of Complex
  Analysis and Analytic Number Theory we have available. The remainder will be a bit more concrete,
  but still reasonably concise.

  First, we need to re-frame some of the results from the AFP entry about Bertrand's postulate a 
  little bit.
‚Ä∫</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπAuxiliary results‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The AFP entry for Bertrand's postulate already provides a slightly stronger version of
  this for integer values of $x$, but we can easily extend this to real numbers to obtain
  a slightly nicer presentation.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span> sum_upto_mangoldt_le<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">‚â•</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto mangoldt <span class="free">x</span> <span class="main">‚â§</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto mangoldt <span class="free">x</span> <span class="main">=</span> psi <span class="main">(</span>nat <span class="main">‚åä</span><span class="free">x</span><span class="main">‚åã</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef psi_def atLeastSucAtMost_greaterThanAtMost<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="numeral">551</span> <span class="main">/</span> <span class="numeral">256</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">‚åä</span><span class="free">x</span><span class="main">‚åã</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> psi_ubound_log<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">‚åä</span><span class="free">x</span><span class="main">‚åã</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Bertrand.ln_2_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  We can also, similarly, use the results from the Bertrand's postulate entry to show
  that the sum of $\ln p / p$ over all primes grows logarithmically.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Mertens_bigo<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">8</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¶</span><span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚â§</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="skolem">x</span><span class="main">¬¶</span> <span class="main">=</span>
          <span class="main">¬¶</span><span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚â§</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span><span class="main">)</span><span class="main">¬¶</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="main">¬¶</span><span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚â§</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span><span class="main">¬¶</span> <span class="main">+</span> <span class="main">¬¶</span>ln <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span><span class="main">¬¶</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_triangle_ineq4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¶</span><span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚â§</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span><span class="main">¬¶</span> <span class="main">‚â§</span> <span class="numeral">7</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Mertens<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¶</span>ln <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span><span class="main">¬¶</span> <span class="main">=</span> ln <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_of_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span> <span class="main">/</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ln_diff_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">)</span> <span class="main">/</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚â§</span> nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe contribution of the non-principal characters‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  The estimates in the next two sections are partially inspired by John Harrison's
  proof of Dirichlet's Theorem~\cite{harrison-dirichlet}.

  We first estimate the growth of the partial sums of
    \[-L'(1, \chi)/L(1, \chi) = \sum_{k=1}^\infty \chi(k) \frac{\Lambda(k)}{k}\]
  for a non-principal character $\chi$ and show that they are, in fact, bounded, which is 
  ultimately a consequence of the non-vanishing of $L(1, \chi)$ for non-principal $\chi$.
‚Ä∫</span></span>

<span class="keyword1"><span class="command">context</span></span> dcharacter
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonprincipal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">‚â°</span> Dirichlet_L <span class="free">n</span> <span class="free">œá</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_nonprincipal_mangoldt_bound_aux_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">L</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>
             <span class="main">‚â§</span> <span class="numeral">9</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">k</span><span class="main">.</span> mangoldt <span class="bound">d</span><span class="main">)</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mangoldt_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="main">‚àë</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">d</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_distrib_right sum_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">d</span><span class="main">.</span> <span class="free">œá</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_sum_divisors<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">d</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> <span class="main">‚Ä¶</span> <span class="main">=</span>
              sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">L</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">d</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_subtractf sum_distrib_left mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">‚Ä¶</span> <span class="main">‚â§</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">/</span> <span class="free">x</span> <span class="main">*</span> mangoldt <span class="bound">k</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_norm_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">d</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span> <span class="main">/</span> of_nat <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">œá</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="skolem">k</span> <span class="main">/</span> of_nat <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span>
            <span class="main">(</span><span class="skolem">B</span> <span class="main">*</span> real <span class="skolem">k</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="skolem">k</span> <span class="main">/</span> real <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_mult norm_divide
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono divide_left_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">L</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">d</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">d</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> <span class="skolem">B</span> <span class="main">*</span> real <span class="skolem">k</span> <span class="main">/</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Dirichlet_L_minus_partial_sum_bound<span class="main">[</span><span class="operator">OF</span> nonprincipal<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> 1 x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus B_def L_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> divide_nonneg_pos mangoldt_nonneg norm_le_1 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span>  <span class="skolem">B</span> <span class="main">/</span> <span class="free">x</span> <span class="main">*</span> mangoldt <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">/</span> <span class="free">x</span> <span class="main">*</span> sum_upto mangoldt <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚â§</span> <span class="skolem">B</span> <span class="main">/</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono sum_upto_mangoldt_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="numeral">9</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_L_nonprincipal_mangoldt_aux_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">L</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">9</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">use</span> Dirichlet_L_nonprincipal_mangoldt_bound_aux_strong <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonprincipal_mangoldt_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">‚àà</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">‚â†</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonprincipal <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Dirichlet_L_Re_ge_1_nonzero_nonprincipal<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_deriv <span class="main">(</span>fds <span class="free">œá</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conv_abscissa_le_0<span class="main">[</span><span class="operator">OF</span> nonprincipal<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges_deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_def fds_deriv_def scaleR_conv_of_real fds_nth_fds' <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> summable_minus_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> summable_imp_convergent_sum_upto <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">n</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">‚§è</span> <span class="skolem">c</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI_tendsto<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sum_in_bigo<span class="main">[</span><span class="operator">OF</span> Dirichlet_L_nonprincipal_mangoldt_aux_bound *<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">L</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="free">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe contribution of the principal character‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  Next, we turn to the analogous partial sum for the principal character and show that
  it grows logarithmically and therefore is the dominant contribution.
‚Ä∫</span></span>

<span class="keyword1"><span class="command">context</span></span> residues_nat
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> no_vec_lambda_notation dcharacter_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_sum_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> <span class="skolem">Q</span> <span class="bound">p</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fin<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fin<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span>
          <span class="keyword1">Œò(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">‚àà</span> <span class="keyword1">Œò(</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> 
               <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span> <span class="main">‚à™</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> <span class="main">¬¨</span><span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">‚à™</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> complex_of_real <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="main">‚Ä¶</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_dchar_def prime_gt_0_nat coprime_absorb_left prime_imp_coprime<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> of_real <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> landau_o.big.of_real_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Mertens_bigo<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> principal_dchar_sum_bound'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> Ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span>
               <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>complex_of_real <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">k</span></span> <span class="main">|</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> coprime <span class="bound">k</span> <span class="free">n</span><span class="main">.</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> 
                of_real <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> coprime <span class="bound">k</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_real_diff <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> norm_of_real
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Mertens_mangoldt_versus_ln<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">insert</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq le_nat_iff le_floor_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">k</span></span> <span class="main">|</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> coprime <span class="bound">k</span> <span class="free">n</span><span class="main">.</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span>
                 sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def of_real_sum <span class="keyword1"><span class="command">using</span></span> n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_dchar_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚àà</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> real <span class="bound">k</span> <span class="main">‚â§</span> <span class="skolem">x</span> <span class="main">‚àß</span> coprime <span class="bound">k</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="skolem">x</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_real_sum
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> principal_dchar_def le_nat_iff le_floor_iff prime_gt_0_nat
               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> sum_in_bigo<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> principal_dchar_sum_bound this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe main result‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  We can now show the main result by extracting the primes we want using the orthogonality
  relation on characters, separating the principal part of the sum from the non-principal ones
  and then applying the above estimates.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">h</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">/</span> totient <span class="free">n</span><span class="main">)</span>
             <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> sum <span class="main">_</span> <span class="main">(</span><span class="var">?A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">_</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">h</span> <span class="main">*</span> <span class="skolem">h'</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coprime_iff_invertible_nat<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"dcharacters <span class="free">n</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚àà</span> dcharacters <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def principal.dcharacter_axioms<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="bound">x</span><span class="main">.</span> mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span>
             <span class="keyword1">Œò(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> <span class="bound">œá</span> <span class="skolem">h'</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">œá</span> <span class="bound">k</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">‚àà</span> <span class="keyword1">Œò(</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="skolem">x</span><span class="main">.</span> of_real <span class="main">(</span>mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="skolem">x</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_left<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">œá</span> <span class="main">(</span><span class="skolem">h'</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">h'</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">‚â†</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">h'</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">h</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">h'</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">*</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong_scalar_left<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">h</span> <span class="main">=</span> <span class="free">h</span> <span class="main">*</span> <span class="skolem">h'</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac cong_sym<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">h</span> <span class="main">*</span> <span class="skolem">h'</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_scalar_right<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_sym<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_dcharacters sum_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> sum_distrib_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">h'</span> <span class="main">=</span> <span class="free">h</span> <span class="main">*</span> <span class="skolem">h'</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_scalar_right<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">h</span> <span class="main">*</span> <span class="skolem">h'</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">h'</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> h' 4
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_dcharacters sum_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> sum_distrib_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">œá</span> <span class="main">(</span><span class="skolem">h'</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span>dcharacters <span class="free">n</span><span class="main">.</span> <span class="bound">œá</span> <span class="skolem">h'</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dcharacters_def dcharacter.mult sum_distrib_left mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">=</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="skolem">h'</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> 
                    <span class="main">(</span><span class="main">‚àë</span><span class="bound">œá</span><span class="main">‚àà</span><span class="var">?B</span><span class="main">.</span> <span class="bound">œá</span> <span class="skolem">h'</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">Œª</span><span class="bound">k</span><span class="main">.</span> <span class="bound">œá</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>mangoldt <span class="bound">k</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">h'</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coprime_iff_invertible_nat<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult.commute<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span> <span class="skolem">h'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> principal_dchar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> n 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> complex_of_real <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ big_sum_in_bigo<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> principal_dchar_sum_bound' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">œá</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> dcharacter <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">œá</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def dcharacters_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">œá</span> <span class="main">‚â†</span> <span class="keyword1">œá<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_real_1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult_in_1 nonprincipal_mangoldt_bound<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="bound">x</span><span class="main">.</span> mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> landau_o.big.of_real_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="bound">x</span><span class="main">.</span> mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult_in_1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="bound">x</span><span class="main">.</span> mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> landau_o.big.of_real_iff
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬¶</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A'</span> <span class="skolem">x</span><span class="main">.</span> mangoldt <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚àà</span> <span class="var">?A'</span> <span class="skolem">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">¬¶</span> <span class="main">‚â§</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Mertens_mangoldt_versus_ln<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"nat <span class="main">‚åä</span><span class="skolem">x</span><span class="main">‚åã</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="bound">p</span> <span class="main">‚àà</span> <span class="var">?A'</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="var">?A</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sum_in_bigo<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> totient <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> totient <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> totient <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">‚àë</span><span class="bound">p</span><span class="main">‚àà</span><span class="var">?A</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">/</span> totient <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚Ä¶</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">‚ü∑</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.cmult_in_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  It is now obvious that the set of primes we are interested in is, in fact, infinite.
‚Ä∫</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Dirichlet<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">h</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">‚äÜ</span> <span class="main">{..&lt;</span><span class="skolem">K</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nat_iff_bounded<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span>
                        <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">K</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> K <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> 
            <span class="keyword1">Œò(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àë</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">‚àß</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="free">h</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">‚àß</span> real <span class="bound">p</span> <span class="main">‚â§</span> <span class="bound">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> <span class="keyword1">O(</span><span class="main">Œª</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> sum_in_bigo<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this Dirichlet_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚Äπ
  In the future, one could extend this result to more precise estimates of the distribution
  of primes in arithmetic progressions in a similar way to the Prime Number Theorem.
‚Ä∫</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>