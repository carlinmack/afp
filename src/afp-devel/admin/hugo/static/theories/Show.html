<div id="Show">
<div class="head">
<h1>Theory Show</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Show
    Author:      Christian Sternagel &lt;c.sternagel@gmail.com&gt;
    Author:      René Thiemann &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
    Maintainer:  René Thiemann &lt;rene.thiemann@uibk.ac.at&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Converting Arbitrary Values to Readable Strings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A type class similar to Haskell's \texttt{Show} class, allowing for constant-time concatenation of
  strings using function composition.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Show
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <a href="../Deriving/Generator_Aux.html">Deriving.Generator_Aux</a>
  <a href="../Deriving/Derive_Manager.html">Deriving.Derive_Manager</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span>
  <span class="quoted">"shows"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> string"</span></span>

<span class="comment1">― ‹show-functions with precedence›</span>
<span class="keyword1"><span class="command">type_synonym</span></span>
  <span class="tfree">'a</span> showsp <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> shows"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Show-Law›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The "show law", <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">shows_prec</span></span> <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">r</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">shows_prec</span></span> <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">r</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, states that
  show-functions do not temper with or depend on output produced so far.
›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> show_law_simps <span class="quoted">‹simplification rules for proving the "show law"›</span>
<span class="keyword1"><span class="command">named_theorems</span></span> show_law_intros <span class="quoted">‹introduction rules for proving the "show law"›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">show_law</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> showsp <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_law</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="bound">y</span> <span class="main">@</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="main">@</span> <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show-show_lawI"><span class="command">lemma</span></span> show_lawI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">p</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">s</span> <span class="bound">p</span> <span class="free">x</span> <span class="main">(</span><span class="bound">y</span> <span class="main">@</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">@</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> show_law <span class="free">s</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> show_law_def<span class="main">)</span>

<span class="keyword1" id="Show-show_lawE"><span class="command">lemma</span></span> show_lawE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law <span class="free">s</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">y</span> <span class="main">@</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">@</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> show_law_def<span class="main">)</span>

<span class="keyword1" id="Show-show_lawD"><span class="command">lemma</span></span> show_lawD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law <span class="free">s</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">y</span> <span class="main">@</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">@</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> show_lawE<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> <span class="quoted">"show"</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">shows_prec</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> showsp"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">shows_list</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> shows"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> shows_prec_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">shows_prec</span> <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">shows_prec</span> <span class="free">p</span> <span class="free">x</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    shows_list_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">shows_list</span> <span class="free">xs</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">shows_list</span> <span class="free">xs</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> shows_prec <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">show</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> shows <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="inner_quoted">''''</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Convert a string to a show-function that simply prepends the string unchanged.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shows_string</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_string</span> <span class="main">=</span> <span class="main">(@)</span>"</span></span>

<span class="keyword1" id="Show-shows_string_append"><span class="command">lemma</span></span> shows_string_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_string <span class="free">x</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> shows_string <span class="free">x</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_string_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">shows_sep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> shows<span class="main">)</span> <span class="main">⇒</span> shows <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_sep</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="main">[]</span> <span class="main">=</span> shows_string <span class="inner_quoted">''''</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_sep</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_sep</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="keyword1">o</span> <span class="free">shows_sep</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1" id="Show-shows_sep_append"><span class="command">lemma</span></span> shows_sep_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">showsx</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">showsx</span> <span class="bound">x</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">sep</span> <span class="main">(</span><span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">sep</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shows_sep <span class="free">showsx</span> <span class="free">sep</span> <span class="free">xs</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> shows_sep <span class="free">showsx</span> <span class="free">sep</span> <span class="free">xs</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-shows_sep_map"><span class="command">lemma</span></span> shows_sep_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_sep <span class="free">f</span> <span class="free">sep</span> <span class="main">(</span>map <span class="free">g</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> shows_sep <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="free">sep</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">shows_list_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> shows<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span> string <span class="main">⇒</span> string <span class="main">⇒</span> string <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_list_gen</span> <span class="free"><span class="bound"><span class="entity">showsx</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> shows_string <span class="free"><span class="bound"><span class="entity">e</span></span></span>
    <span class="keyword1">else</span> shows_string <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">o</span> shows_sep <span class="free"><span class="bound"><span class="entity">showsx</span></span></span> <span class="main">(</span>shows_string <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">o</span> shows_string <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show-shows_list_gen_append"><span class="command">lemma</span></span> shows_list_gen_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">showsx</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">showsx</span> <span class="bound">x</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shows_list_gen <span class="free">showsx</span> <span class="free">e</span> <span class="free">l</span> <span class="free">sep</span> <span class="free">r</span> <span class="free">xs</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> shows_list_gen <span class="free">showsx</span> <span class="free">e</span> <span class="free">l</span> <span class="free">sep</span> <span class="free">r</span> <span class="free">xs</span> <span class="free">s</span> <span class="main">@</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_list_gen_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-shows_list_gen_map"><span class="command">lemma</span></span> shows_list_gen_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_list_gen <span class="free">f</span> <span class="free">e</span> <span class="free">l</span> <span class="free">sep</span> <span class="free">r</span> <span class="main">(</span>map <span class="free">g</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> shows_list_gen <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="free">e</span> <span class="free">l</span> <span class="free">sep</span> <span class="free">r</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_list_gen_def shows_sep_map<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pshowsp_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> shows list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pshowsp_list</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> shows_list_gen id <span class="inner_quoted">''[]''</span> <span class="inner_quoted">''[''</span> <span class="inner_quoted">'', ''</span> <span class="inner_quoted">'']''</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> showsp <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">showsp_list</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> pshowsp_list <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">o</span> map <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show-showsp_list_code"><span class="command">lemma</span></span> showsp_list_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_list <span class="free">s</span> <span class="free">p</span> <span class="free">xs</span> <span class="main">=</span> shows_list_gen <span class="main">(</span><span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="inner_quoted">''[]''</span> <span class="inner_quoted">''[''</span> <span class="inner_quoted">'', ''</span> <span class="inner_quoted">'']''</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_list_def pshowsp_list_def shows_list_gen_map<span class="main">)</span>

<span class="keyword1" id="Show-show_law_list"><span class="command">lemma</span></span> show_law_list <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> show_law <span class="free">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> show_law <span class="main">(</span>showsp_list <span class="free">s</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> show_law_def showsp_list_code <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-showsp_list_append"><span class="command">lemma</span></span> showsp_list_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">p</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">s</span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">y</span> <span class="main">@</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="bound">p</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">@</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span>
    showsp_list <span class="free">s</span> <span class="free">p</span> <span class="free">xs</span> <span class="main">(</span><span class="free">y</span> <span class="main">@</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> showsp_list <span class="free">s</span> <span class="free">p</span> <span class="free">xs</span> <span class="free">y</span> <span class="main">@</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span> showsp_list_def pshowsp_list_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Show-Functions for Characters and Strings›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> char <span class="main">::</span> <span class="quoted"><span class="quoted">"show"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"shows_prec <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">::</span>char<span class="main">)</span> <span class="main">=</span> <span class="main">(#)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"shows_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">::</span>string<span class="main">)</span> <span class="main">=</span> shows_string <span class="free"><span class="bound"><span class="entity">cs</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_prec_char_def shows_list_char_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows_nl</span> <span class="main">=</span> shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''⏎''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows_space</span> <span class="main">=</span> shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">'' ''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows_paren</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''(''</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">o</span> shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">'')''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows_quote</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="numeral">0x27</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">o</span> shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="numeral">0x27</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">apply_if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> id<span class="main">)</span>"</span></span> <span class="comment1">― ‹conditional function application›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Parenthesize only if precedence is greater than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows_pl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> apply_if <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''(''</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">shows_pr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> apply_if <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>shows <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">'')''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show-shows_nl_append"><span class="command">lemma</span></span>
  shows_nl_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shows_nl <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> shows_nl <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  shows_space_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shows_space <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> shows_space <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  shows_paren_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> shows_paren <span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> shows_paren <span class="free">s</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  shows_quote_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> shows_quote <span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> shows_quote <span class="free">s</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  shows_pl_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shows_pl <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> shows_pl <span class="free">p</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  shows_pr_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shows_pr <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> shows_pr <span class="free">p</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_nl_def shows_space_def shows_paren_def shows_quote_def shows_pl_def shows_pr_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-o_append"><span class="command">lemma</span></span> o_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">‹show_generator.ML›</span>

<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹
  <span class="entity">Show_Generator.register_foreign_partial_and_full_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> "list"<span class="antiquote">}</span></span> <span class="inner_numeral">0</span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"pshowsp_list"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_list"</span><span class="antiquote">}</span></span> <span class="main">(</span>SOME <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> showsp_list_def<span class="antiquote">}</span></span></span><span class="main">)</span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"map"</span><span class="antiquote">}</span></span> <span class="main">(</span>SOME <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> list.map_comp<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">[</span>true<span class="main">]</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_list<span class="antiquote">}</span></span></span>
›</span>

<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"show"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"show"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"shows_prec <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">=</span> shows_list <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"shows_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xss</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> list list<span class="main">)</span> <span class="main">=</span> showsp_list shows_prec <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">xss</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span> shows_prec_list_def shows_list_list_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shows_lines</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>show list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_lines</span> <span class="main">=</span> shows_sep shows shows_nl"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shows_many</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>show list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_many</span> <span class="main">=</span> shows_sep shows id"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shows_words</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>show list <span class="main">⇒</span> shows"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shows_words</span> <span class="main">=</span> shows_sep shows shows_space"</span></span>

<span class="keyword1" id="Show-shows_lines_append"><span class="command">lemma</span></span> shows_lines_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_lines <span class="free">xs</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> shows_lines <span class="free">xs</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_lines_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-shows_many_append"><span class="command">lemma</span></span> shows_many_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_many <span class="free">xs</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> shows_many <span class="free">xs</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_many_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-shows_words_append"><span class="command">lemma</span></span> shows_words_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_words <span class="free">xs</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> shows_words <span class="free">xs</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_words_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show-shows_foldr_append"><span class="command">lemma</span></span> shows_foldr_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">showx</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">showx</span> <span class="bound">x</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldr <span class="free">showx</span> <span class="free">xs</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> foldr <span class="free">showx</span> <span class="free">xs</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Show-shows_sep_cong"><span class="command">lemma</span></span> shows_sep_cong <span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shows_sep <span class="free">f</span> <span class="free">sep</span> <span class="free">xs</span> <span class="main">=</span> shows_sep <span class="free">g</span> <span class="free">sep</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Show-shows_list_gen_cong"><span class="command">lemma</span></span> shows_list_gen_cong <span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shows_list_gen <span class="free">f</span> <span class="free">e</span> <span class="free">l</span> <span class="free">sep</span> <span class="free">r</span> <span class="free">xs</span> <span class="main">=</span> shows_list_gen <span class="free">g</span> <span class="free">e</span> <span class="free">l</span> <span class="free">sep</span> <span class="free">r</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> shows_sep_cong <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shows_list_gen_def<span class="main">)</span>

<span class="keyword1" id="Show-showsp_list_cong"><span class="command">lemma</span></span> showsp_list_cong <span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> showsp_list <span class="free">f</span> <span class="free">p</span> <span class="free">xs</span> <span class="main">=</span> showsp_list <span class="free">g</span> <span class="free">q</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_list_code <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> shows_list_gen_cong<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">shows_cons</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> shows <span class="main">⇒</span> shows"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">+#+</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">+#+</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> shows_string <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">shows_append</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"shows <span class="main">⇒</span> shows <span class="main">⇒</span> shows"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">+@+</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">+@+</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> String.literal <span class="main">::</span> <span class="quoted"><span class="quoted">"show"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">shows_prec_literal</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> String.literal <span class="main">⇒</span> string <span class="main">⇒</span> string"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"shows_prec <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> shows_string <span class="main">(</span>String.explode <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">shows_list_literal</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"String.literal list <span class="main">⇒</span> string <span class="main">⇒</span> string"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"shows_list <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">=</span> shows_string <span class="main">(</span>concat <span class="main">(</span>map String.explode <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show-shows_list_literal_code"><span class="command">lemma</span></span> shows_list_literal_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_list <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> shows_string <span class="main">(</span>String.explode <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ss</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shows_list <span class="skolem">ss</span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> shows_string <span class="main">(</span>String.explode <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ss</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ss</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_list_literal_def shows_string_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>
  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_prec_literal_def shows_list_literal_def shows_string_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Don't use Haskell's existing "Show" class for code-generation, since it is not compatible to the
  formalized class.
›</span></span>
<span class="keyword1"><span class="command">code_reserved</span></span> Haskell <span class="quoted">"Show"</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="files/show_generator.ML">
<div class="head">
<h1>File ‹show_generator.ML›</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Show
    Author:      Christian Sternagel &lt;c.sternagel@gmail.com&gt;
    Author:      René Thiemann &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
    Maintainer:  René Thiemann &lt;rene.thiemann@uibk.ac.at&gt;

Generate/register show functions for arbitrary types.

Precedence is used to determine parenthesization of subexpressions. In the automatically generated
functions 0 means "no parentheses" and 1 means "parenthesize". 
*)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">SHOW_GENERATOR</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>

<span class="comment1">(*generate show functions for the given datatype*)</span>
<span class="keyword1"><span class="keyword">val</span></span> generate_showsp <span class="main">:</span> string <span class="main">-&gt;</span> local_theory <span class="main">-&gt;</span> local_theory

<span class="keyword1"><span class="keyword">val</span></span> register_foreign_partial_and_full_showsp <span class="main">:</span>
  string <span class="main">-&gt;</span>     <span class="comment1">(*type name*)</span>
  int <span class="main">-&gt;</span>        <span class="comment1">(*default precedence for type parameters*)</span>
  term <span class="main">-&gt;</span>       <span class="comment1">(*partial show function*)</span>
  term <span class="main">-&gt;</span>       <span class="comment1">(*show function*)</span>
  thm option <span class="main">-&gt;</span> <span class="comment1">(*definition of show function via partial show function*)</span>
  term <span class="main">-&gt;</span>       <span class="comment1">(*map function*)</span>
  thm option <span class="main">-&gt;</span> <span class="comment1">(*compositionality theorem of map function*)</span>
  bool list <span class="main">-&gt;</span>  <span class="comment1">(*indicate which positions of type parameters are used*)</span>
  thm <span class="main">-&gt;</span>        <span class="comment1">(*show law intro rule*)</span>
  local_theory <span class="main">-&gt;</span> local_theory

<span class="comment1">(*for type constants (i.e., nullary type constructors) partial and full show functions
coincide and no other information is necessary.*)</span>
<span class="keyword1"><span class="keyword">val</span></span> register_foreign_showsp <span class="main">:</span> typ <span class="main">-&gt;</span> term <span class="main">-&gt;</span> thm <span class="main">-&gt;</span> local_theory <span class="main">-&gt;</span> local_theory

<span class="comment1">(*automatically derive a "show" class instance for the given datatype*)</span>
<span class="keyword1"><span class="keyword">val</span></span> show_instance <span class="main">:</span> string <span class="main">-&gt;</span> theory <span class="main">-&gt;</span> theory

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Show_Generator</span> <span class="main">:</span> <span class="entity">SHOW_GENERATOR</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword3"><span class="keyword">open</span></span> Generator_Aux

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mk_prec</span> <span class="main">=</span> <span class="entity">HOLogic.mk_number</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prec0</span> <span class="main">=</span> <span class="entity">mk_prec</span> <span class="inner_numeral">0</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prec1</span> <span class="main">=</span> <span class="entity">mk_prec</span> <span class="inner_numeral">1</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">showS</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">sort</span> <span class="quoted">"show"</span><span class="antiquote">}</span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">showsT</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"shows"</span><span class="antiquote">}</span></span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">showspT</span> <span class="entity">T</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span> --&gt; <span class="entity">T</span> --&gt; <span class="entity">showsT</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">showsify_typ</span> <span class="main">=</span> map_atyps <span class="main">(</span>K <span class="entity">showsT</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">showsify</span> <span class="main">=</span> map_types <span class="entity">showsify_typ</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">show_law_const</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> show_law<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">showspT</span> <span class="entity">T</span> --&gt; <span class="entity">T</span> --&gt; <span class="entity">HOLogic.boolT</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">shows_prec_const</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> shows_prec<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">showspT</span> <span class="entity">T</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">shows_list_const</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> shows_list<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">HOLogic.listT</span> <span class="entity">T</span> --&gt; <span class="entity">showsT</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">showsp_list_const</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> showsp_list<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">showspT</span> <span class="entity">T</span> --&gt; <span class="entity">showspT</span> <span class="main">(</span><span class="entity">HOLogic.listT</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dest_showspT</span> <span class="main">=</span> binder_types #&gt; tl #&gt; hd

<span class="keyword1"><span class="keyword">type</span></span> <span class="entity">info</span> <span class="main">=</span>
  <span class="main">{</span>prec <span class="main">:</span> int<span class="main">,</span>
   pshowsp <span class="main">:</span> term<span class="main">,</span>
   showsp <span class="main">:</span> term<span class="main">,</span>
   show_def <span class="main">:</span> thm option<span class="main">,</span>
   map <span class="main">:</span> term<span class="main">,</span>
   map_comp <span class="main">:</span> thm option<span class="main">,</span>
   used_positions <span class="main">:</span> bool list<span class="main">,</span>
   show_law_intro <span class="main">:</span> thm<span class="main">}</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Data</span> <span class="main">=</span> Generic_Data
  <span class="main">(</span><span class="keyword1"><span class="keyword">type</span></span> <span class="entity">T</span> <span class="main">=</span> <span class="entity">info</span> Symtab.table
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">empty</span> <span class="main">=</span> Symtab.empty
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">extend</span> <span class="main">=</span> I
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">merge</span> <span class="main">=</span> Symtab.merge <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">info1</span><span class="main">,</span> <span class="entity">info2</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">#</span>pshowsp <span class="entity">info1</span> <span class="main">=</span> <span class="main">#</span>pshowsp <span class="entity">info2</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">add_info</span> <span class="entity">tyco</span> <span class="entity">info</span> <span class="main">=</span> Data.map <span class="main">(</span>Symtab.update_new <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">info</span><span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">get_info</span> <span class="main">=</span> Context.Proof #&gt; Data.get #&gt; Symtab.lookup

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">the_info</span> <span class="entity">ctxt</span> <span class="entity">tyco</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">get_info</span> <span class="entity">ctxt</span> <span class="entity">tyco</span> <span class="keyword2"><span class="keyword">of</span></span>
    SOME <span class="entity">info</span> <span class="main">=&gt;</span> <span class="entity">info</span>
  <span class="main">|</span> NONE <span class="main">=&gt;</span> error <span class="main">(</span><span class="inner_quoted">"no show function available for type "</span> ^ quote <span class="entity">tyco</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">declare_info</span> <span class="entity">tyco</span> <span class="entity">p</span> <span class="entity">pshow</span> <span class="entity">show</span> <span class="entity">show_def</span> <span class="entity">m</span> <span class="entity">m_comp</span> <span class="entity">used_pos</span> <span class="entity">law_thm</span> <span class="main">=</span>
  Local_Theory.declaration <span class="main">{</span>syntax <span class="main">=</span> false<span class="main">,</span> pervasive <span class="main">=</span> false<span class="main">}</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">phi</span> <span class="main">=&gt;</span>
    <span class="entity">add_info</span> <span class="entity">tyco</span>
      <span class="main">{</span>prec <span class="main">=</span> <span class="entity">p</span><span class="main">,</span>
       pshowsp <span class="main">=</span> Morphism.term <span class="entity">phi</span> <span class="entity">pshow</span><span class="main">,</span>
       showsp <span class="main">=</span> Morphism.term <span class="entity">phi</span> <span class="entity">show</span><span class="main">,</span>
       show_def <span class="main">=</span> Option.map <span class="main">(</span>Morphism.thm <span class="entity">phi</span><span class="main">)</span> <span class="entity">show_def</span><span class="main">,</span>
       map <span class="main">=</span> Morphism.term <span class="entity">phi</span> <span class="entity">m</span><span class="main">,</span>
       map_comp <span class="main">=</span> Option.map <span class="main">(</span>Morphism.thm <span class="entity">phi</span><span class="main">)</span> <span class="entity">m_comp</span><span class="main">,</span>
       used_positions <span class="main">=</span> <span class="entity">used_pos</span><span class="main">,</span>
       show_law_intro <span class="main">=</span> Morphism.thm <span class="entity">phi</span> <span class="entity">law_thm</span><span class="main">}</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">register_foreign_partial_and_full_showsp</span> <span class="main">=</span> <span class="entity">declare_info</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">register_foreign_showsp</span> <span class="entity">T</span> <span class="entity">show</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tyco</span> <span class="main">=</span> <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">T</span> <span class="keyword2"><span class="keyword">of</span></span> Type <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">tyco</span> <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> error <span class="inner_quoted">"expected type constant"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">register_foreign_partial_and_full_showsp</span> <span class="entity">tyco</span> <span class="inner_numeral">0</span> <span class="entity">show</span> <span class="entity">show</span> NONE <span class="main">(</span><span class="entity">HOLogic.id_const</span> <span class="entity">T</span><span class="main">)</span> NONE <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">shows_string</span> <span class="entity">c</span> <span class="main">=</span>
  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> "shows_string"<span class="antiquote">}</span></span> $ <span class="entity">HOLogic.mk_string</span> <span class="main">(</span>Long_Name.base_name <span class="entity">c</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_shows_parens</span> <span class="main">_</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span> <span class="main">=</span> <span class="entity">t</span>
  <span class="main">|</span> <span class="entity">mk_shows_parens</span> <span class="entity">p</span> <span class="entity">ts</span> <span class="main">=</span> Library.foldl1 <span class="entity">HOLogic.mk_comp</span>
      <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> shows_pl<span class="antiquote">}</span></span> $ <span class="entity">p</span> :: separate <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> shows_space<span class="antiquote">}</span></span> <span class="entity">ts</span> @ <span class="main">[</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> shows_pr<span class="antiquote">}</span></span> $ <span class="entity">p</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">simp_only_tac</span> <span class="entity">ctxt</span> <span class="entity">ths</span> <span class="main">=</span>
  CHANGED o <span class="entity">full_simp_tac</span> <span class="main">(</span>clear_simpset <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span><span class="main">)</span> addsimps <span class="entity">ths</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_showsp</span> <span class="entity">tyco</span> <span class="entity">lthy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">tycos</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span> <span class="main">=</span> <span class="entity">mutual_recursive_types</span> <span class="entity">tyco</span> <span class="entity">lthy</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">tyco</span> <span class="main">=&gt;</span> <span class="inner_quoted">"generating show function for type "</span> ^ quote <span class="entity">tyco</span><span class="main">)</span> <span class="entity">tycos</span>
      |&gt; cat_lines |&gt; writeln

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">maps</span> <span class="main">=</span> <span class="entity">Bnf_Access.map_terms</span> <span class="entity">lthy</span> <span class="entity">tycos</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">map_simps</span> <span class="main">=</span> <span class="entity">Bnf_Access.map_simps</span> <span class="entity">lthy</span> <span class="entity">tycos</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">map_comps</span> <span class="main">=</span> <span class="entity">Bnf_Access.map_comps</span> <span class="entity">lthy</span> <span class="entity">tycos</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">tfrees</span><span class="main">,</span> <span class="entity">used_tfrees</span><span class="main">)</span> <span class="main">=</span> <span class="entity">type_parameters</span> <span class="main">(</span>hd <span class="entity">Ts</span><span class="main">)</span> <span class="entity">lthy</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">used_positions</span> <span class="main">=</span> map <span class="main">(</span>member <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="entity">used_tfrees</span> o TFree<span class="main">)</span> <span class="entity">tfrees</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ss</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">subT</span> <span class="inner_quoted">"show"</span><span class="main">)</span> <span class="entity">used_tfrees</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_Ts</span> <span class="main">=</span> map <span class="entity">showspT</span> <span class="entity">used_tfrees</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">arg_shows</span> <span class="main">=</span> map Free <span class="main">(</span><span class="entity">ss</span> ~~ <span class="entity">show_Ts</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dep_tycos</span> <span class="main">=</span> fold <span class="main">(</span><span class="entity">add_used_tycos</span> <span class="entity">lthy</span><span class="main">)</span> <span class="entity">tycos</span> <span class="main">[</span><span class="main">]</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_pshowsp</span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="inner_quoted">"pshowsp_"</span> ^ Long_Name.base_name <span class="entity">tyco</span><span class="main">,</span> <span class="entity">showspT</span> <span class="entity">T</span> |&gt; <span class="entity">showsify_typ</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">default_show</span> <span class="entity">T</span> <span class="main">=</span> absdummy <span class="entity">T</span> <span class="main">(</span><span class="entity">mk_id</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">string</span><span class="antiquote">}</span></span><span class="main">)</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">constr_terms</span> <span class="entity">lthy</span> <span class="main">=</span> <span class="entity">Bnf_Access.constr_terms</span> <span class="entity">lthy</span> #&gt; map <span class="main">(</span>apsnd <span class="main">(</span>fst o strip_type<span class="main">)</span> o dest_Const<span class="main">)</span>

    <span class="comment1">(* primrec definitions of partial show functions *)</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_pshow_eqs</span> <span class="entity">lthy</span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constrs</span> <span class="main">=</span> <span class="entity">constr_terms</span> <span class="entity">lthy</span> <span class="entity">tyco</span>
          |&gt; map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span> <span class="main">=&gt;</span>
               <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">Ts'</span> <span class="main">=</span> map <span class="entity">showsify_typ</span> <span class="entity">Ts</span>
               <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span>Const <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">Ts'</span> ---&gt; <span class="entity">T</span><span class="main">)</span> |&gt; <span class="entity">showsify</span><span class="main">,</span> <span class="entity">Ts'</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">shows_arg</span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">m</span> <span class="main">=</span> <span class="entity">Generator_Aux.create_map</span> <span class="entity">default_show</span>
              <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">p</span> <span class="main">=&gt;</span> Free <span class="main">(</span><span class="entity">mk_pshowsp</span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span> $ <span class="entity">p</span><span class="main">)</span> <span class="entity">prec1</span>
              <span class="main">(</span>equal <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"shows"</span><span class="antiquote">}</span></span><span class="main">)</span>
              <span class="main">(</span><span class="main">#</span>used_positions oo <span class="entity">the_info</span><span class="main">)</span> <span class="main">(</span><span class="main">#</span>map oo <span class="entity">the_info</span><span class="main">)</span>
              <span class="main">(</span>curry <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> $<span class="main">)</span> o <span class="main">#</span>pshowsp oo <span class="entity">the_info</span><span class="main">)</span>
              <span class="entity">tycos</span> <span class="main">(</span><span class="entity">mk_prec</span> o <span class="main">#</span>prec oo <span class="entity">the_info</span><span class="main">)</span> <span class="entity">T</span> <span class="entity">lthy</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">pshow</span> <span class="main">=</span> <span class="entity">Generator_Aux.create_partial</span> <span class="entity">prec1</span> <span class="main">(</span>equal <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"shows"</span><span class="antiquote">}</span></span><span class="main">)</span>
              <span class="main">(</span><span class="main">#</span>used_positions oo <span class="entity">the_info</span><span class="main">)</span> <span class="main">(</span><span class="main">#</span>map oo <span class="entity">the_info</span><span class="main">)</span>
              <span class="main">(</span>curry <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> $<span class="main">)</span> o <span class="main">#</span>pshowsp oo <span class="entity">the_info</span><span class="main">)</span>
              <span class="entity">tycos</span> <span class="main">(</span><span class="entity">mk_prec</span> o <span class="main">#</span>prec oo <span class="entity">the_info</span><span class="main">)</span> <span class="entity">T</span> <span class="entity">lthy</span>
          <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">pshow</span> $ <span class="main">(</span><span class="entity">m</span> $ Free <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span> |&gt; <span class="entity">infer_type</span> <span class="entity">lthy</span> <span class="keyword2"><span class="keyword">end</span></span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_eq</span> <span class="entity">lthy</span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">arg_Ts</span><span class="main">)</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span> <span class="entity">xs</span><span class="main">)</span> <span class="main">=</span> Name.variant <span class="inner_quoted">"p"</span> <span class="main">(</span>Variable.names_of <span class="entity">lthy</span><span class="main">)</span> |&gt;&gt; Free o rpair <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span>
              ||&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> Name.invent_names <span class="entity">ctxt</span> <span class="inner_quoted">"x"</span> <span class="entity">arg_Ts</span><span class="main">)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lhs</span> <span class="main">=</span> Free <span class="main">(</span><span class="entity">mk_pshowsp</span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span> $ <span class="entity">p</span> $ list_comb <span class="main">(</span><span class="entity">c</span><span class="main">,</span> map Free <span class="entity">xs</span><span class="main">)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rhs</span> <span class="main">=</span> <span class="entity">shows_string</span> <span class="main">(</span>dest_Const <span class="entity">c</span> |&gt; fst<span class="main">)</span> :: map <span class="entity">shows_arg</span> <span class="entity">xs</span>
              |&gt; <span class="entity">mk_shows_parens</span> <span class="entity">p</span>
          <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="main">(</span><span class="entity">HOLogic.mk_eq</span> <span class="main">(</span><span class="entity">lhs</span><span class="main">,</span> <span class="entity">rhs</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword2"><span class="keyword">in</span></span> map <span class="main">(</span><span class="entity">generate_eq</span> <span class="entity">lthy</span><span class="main">)</span> <span class="entity">constrs</span> <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eqs</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">generate_pshow_eqs</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">Ts</span><span class="main">)</span> |&gt; flat
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">bindings</span> <span class="main">=</span> <span class="entity">tycos</span> ~~ <span class="entity">Ts</span> |&gt; map <span class="entity">mk_pshowsp</span>
      |&gt; map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>Binding.name <span class="entity">name</span><span class="main">,</span> <span class="entity">T</span> |&gt; <span class="entity">showsify_typ</span> |&gt; SOME<span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">pshows</span><span class="main">,</span> <span class="entity">pshow_simps</span><span class="main">)</span><span class="main">,</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">lthy</span>
      |&gt; Local_Theory.begin_nested
      |&gt; snd
      |&gt; <span class="entity">BNF_LFP_Rec_Sugar.primrec</span> false <span class="main">[</span><span class="main">]</span> <span class="entity">bindings</span>
          <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="entity">eqs</span><span class="main">)</span>
      |&gt; Local_Theory.end_nested_result
          <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">phi</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">pshows</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="entity">pshow_simps</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>map <span class="main">(</span>Morphism.term <span class="entity">phi</span><span class="main">)</span> <span class="entity">pshows</span><span class="main">,</span> map <span class="main">(</span>Morphism.fact <span class="entity">phi</span><span class="main">)</span> <span class="entity">pshow_simps</span><span class="main">)</span><span class="main">)</span>

    <span class="comment1">(* definitions of show functions via partial show functions and map *)</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_show_defs</span> <span class="entity">tyco</span> <span class="entity">lthy</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ss</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">subT</span> <span class="inner_quoted">"show"</span><span class="main">)</span> <span class="entity">used_tfrees</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">arg_Ts</span> <span class="main">=</span> map <span class="entity">showspT</span> <span class="entity">used_tfrees</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">arg_shows</span> <span class="main">=</span> map Free <span class="main">(</span><span class="entity">ss</span> ~~ <span class="entity">arg_Ts</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">p</span> <span class="main">=</span> Name.invent <span class="main">(</span>Variable.names_of <span class="entity">lthy</span><span class="main">)</span> <span class="inner_quoted">"p"</span> <span class="inner_numeral">1</span> |&gt; the_single |&gt; Free o rpair <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">pshow</span><span class="main">,</span> <span class="entity">m</span><span class="main">)</span> <span class="main">=</span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="main">(</span><span class="entity">pshows</span> ~~ <span class="entity">maps</span><span class="main">)</span><span class="main">)</span> <span class="entity">tyco</span> |&gt; the
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ts</span> <span class="main">=</span> <span class="entity">tfrees</span> |&gt; map TFree |&gt; map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">T</span> <span class="main">=&gt;</span>
          AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">used_tfrees</span> ~~ map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="entity">x</span> $ <span class="entity">prec1</span><span class="main">)</span> <span class="entity">arg_shows</span><span class="main">)</span> <span class="entity">T</span>
          |&gt; the_default <span class="main">(</span><span class="entity">default_show</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">args</span> <span class="main">=</span> <span class="entity">arg_shows</span> @ <span class="main">[</span><span class="entity">p</span><span class="main">]</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rhs</span> <span class="main">=</span> <span class="entity">HOLogic.mk_comp</span> <span class="main">(</span><span class="entity">pshow</span> $ <span class="entity">p</span><span class="main">,</span> list_comb <span class="main">(</span><span class="entity">m</span><span class="main">,</span> <span class="entity">ts</span><span class="main">)</span><span class="main">)</span> |&gt; <span class="entity">infer_type</span> <span class="entity">lthy</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">abs_def</span> <span class="main">=</span> fold_rev lambda <span class="entity">args</span> <span class="entity">rhs</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> <span class="inner_quoted">"showsp_"</span> ^ Long_Name.base_name <span class="entity">tyco</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">showsp</span><span class="main">,</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">prethm</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">=</span>
          Local_Theory.define <span class="main">(</span><span class="main">(</span>Binding.name <span class="entity">name</span><span class="main">,</span> NoSyn<span class="main">)</span><span class="main">,</span> <span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">abs_def</span><span class="main">)</span><span class="main">)</span> <span class="entity">lthy</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eq</span> <span class="main">=</span> Logic.mk_equals <span class="main">(</span>list_comb <span class="main">(</span><span class="entity">showsp</span><span class="main">,</span> <span class="entity">args</span><span class="main">)</span><span class="main">,</span> <span class="entity">rhs</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> Goal.prove_future <span class="entity">lthy</span> <span class="main">(</span>map <span class="main">(</span>fst o dest_Free<span class="main">)</span> <span class="entity">args</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span> <span class="entity">eq</span> <span class="main">(</span>K <span class="main">(</span><span class="entity">unfold_tac</span> <span class="entity">lthy</span> <span class="main">[</span><span class="entity">prethm</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        Local_Theory.note <span class="main">(</span><span class="main">(</span>Binding.name <span class="main">(</span><span class="entity">name</span> ^ <span class="inner_quoted">"_def"</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="entity">thm</span><span class="main">]</span><span class="main">)</span> <span class="entity">lthy</span>
        |&gt;&gt; the_single o snd
        |&gt;&gt; `<span class="main">(</span>K <span class="entity">showsp</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">shows</span><span class="main">,</span> <span class="entity">show_defs</span><span class="main">)</span><span class="main">,</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">lthy</span>
      |&gt; Local_Theory.begin_nested
      |&gt; snd
      |&gt; fold_map <span class="entity">generate_show_defs</span> <span class="entity">tycos</span>
      |&gt;&gt; split_list
      |&gt; Local_Theory.end_nested_result
          <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">phi</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">shows</span><span class="main">,</span> <span class="entity">show_defs</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>map <span class="main">(</span>Morphism.term <span class="entity">phi</span><span class="main">)</span> <span class="entity">shows</span><span class="main">,</span> map <span class="main">(</span>Morphism.thm <span class="entity">phi</span><span class="main">)</span> <span class="entity">show_defs</span><span class="main">)</span><span class="main">)</span>

    <span class="comment1">(* alternative simp-rules for show functions *)</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_show_simps</span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="entity">lthy</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constrs</span> <span class="main">=</span> <span class="entity">constr_terms</span> <span class="entity">lthy</span> <span class="entity">tyco</span> |&gt; map <span class="main">(</span>apsnd <span class="main">(</span>map <span class="entity">freeify_tvars</span><span class="main">)</span><span class="main">)</span>
          |&gt; map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>Const <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">Ts</span> ---&gt; <span class="entity">T</span><span class="main">)</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span><span class="main">)</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">shows_arg</span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">create_show</span> <span class="main">(</span><span class="entity">T</span> <span class="keyword1"><span class="keyword">as</span></span> TFree <span class="main">_</span><span class="main">)</span> <span class="main">=</span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">used_tfrees</span> ~~ <span class="entity">arg_shows</span><span class="main">)</span> <span class="entity">T</span> |&gt; the
              <span class="main">|</span> <span class="entity">create_show</span> <span class="main">(</span>Type <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">shows</span><span class="main">)</span> <span class="entity">tyco</span> <span class="keyword2"><span class="keyword">of</span></span>
                    SOME <span class="entity">show_const</span> <span class="main">=&gt;</span> list_comb <span class="main">(</span><span class="entity">show_const</span><span class="main">,</span> <span class="entity">arg_shows</span><span class="main">)</span>
                  <span class="main">|</span> NONE <span class="main">=&gt;</span>
                    <span class="keyword2"><span class="keyword">let</span></span>
                      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">{</span>showsp <span class="main">=</span> <span class="entity">s</span><span class="main">,</span> used_positions <span class="main">=</span> <span class="entity">up</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=</span> <span class="entity">the_info</span> <span class="entity">lthy</span> <span class="entity">tyco</span>
                      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ts</span> <span class="main">=</span> <span class="main">(</span><span class="entity">up</span> ~~ <span class="entity">Ts</span><span class="main">)</span> |&gt; map_filter <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span>
                        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">then</span></span> SOME <span class="main">(</span><span class="entity">create_show</span> <span class="entity">T</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> NONE<span class="main">)</span>
                    <span class="keyword2"><span class="keyword">in</span></span> list_comb <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="entity">ts</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
              <span class="main">|</span> <span class="entity">create_show</span> <span class="entity">T</span> <span class="main">=</span>
                  error <span class="main">(</span><span class="inner_quoted">"unexpected schematic variable "</span> ^ quote <span class="main">(</span>Syntax.string_of_typ <span class="entity">lthy</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span>

            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show</span> <span class="main">=</span> <span class="entity">create_show</span> <span class="entity">T</span> |&gt; <span class="entity">infer_type</span> <span class="entity">lthy</span>
          <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">show</span> $ <span class="entity">prec1</span> $ Free <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_eq_thm</span> <span class="entity">lthy</span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">arg_Ts</span><span class="main">)</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span> <span class="entity">xs</span><span class="main">)</span> <span class="main">=</span> Name.variant <span class="inner_quoted">"p"</span> <span class="main">(</span>Variable.names_of <span class="entity">lthy</span><span class="main">)</span> |&gt;&gt; Free o rpair <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span>
              ||&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> Name.invent_names <span class="entity">ctxt</span> <span class="inner_quoted">"x"</span> <span class="entity">arg_Ts</span><span class="main">)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_const</span> <span class="main">=</span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">shows</span><span class="main">)</span> <span class="entity">tyco</span> |&gt; the
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lhs</span> <span class="main">=</span> list_comb <span class="main">(</span><span class="entity">show_const</span><span class="main">,</span> <span class="entity">arg_shows</span><span class="main">)</span> $ <span class="entity">p</span> $ list_comb <span class="main">(</span><span class="entity">c</span><span class="main">,</span> map Free <span class="entity">xs</span><span class="main">)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rhs</span> <span class="main">=</span> <span class="entity">shows_string</span> <span class="main">(</span>dest_Const <span class="entity">c</span> |&gt; fst<span class="main">)</span> :: map <span class="entity">shows_arg</span> <span class="entity">xs</span>
              |&gt; <span class="entity">mk_shows_parens</span> <span class="entity">p</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eq</span> <span class="main">=</span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="main">(</span><span class="entity">HOLogic.mk_eq</span> <span class="main">(</span><span class="entity">lhs</span><span class="main">,</span> <span class="entity">rhs</span><span class="main">)</span><span class="main">)</span> |&gt; <span class="entity">infer_type</span> <span class="entity">lthy</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dep_show_defs</span> <span class="main">=</span> map_filter <span class="main">(</span><span class="main">#</span>show_def o <span class="entity">the_info</span> <span class="entity">lthy</span><span class="main">)</span> <span class="entity">dep_tycos</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dep_map_comps</span> <span class="main">=</span> map_filter <span class="main">(</span><span class="main">#</span>map_comp o <span class="entity">the_info</span> <span class="entity">lthy</span><span class="main">)</span> <span class="entity">dep_tycos</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> Goal.prove_future <span class="entity">lthy</span> <span class="main">(</span>fst <span class="main">(</span>dest_Free <span class="entity">p</span><span class="main">)</span> :: map fst <span class="entity">xs</span> @ <span class="entity">ss</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span> <span class="entity">eq</span>
              <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span> <span class="entity">unfold_tac</span> <span class="entity">ctxt</span>
                <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> id_def o_def<span class="antiquote">}</span></span></span> @
                  flat <span class="entity">pshow_simps</span> @
                  <span class="entity">dep_map_comps</span> @ <span class="entity">show_defs</span> @ <span class="entity">dep_show_defs</span> @ flat <span class="entity">map_simps</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">thm</span> <span class="keyword2"><span class="keyword">end</span></span>

       <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thms</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">generate_eq_thm</span> <span class="entity">lthy</span><span class="main">)</span> <span class="entity">constrs</span>
       <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> <span class="inner_quoted">"showsp_"</span> ^ Long_Name.base_name <span class="entity">tyco</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="entity">lthy</span>
        |&gt; Local_Theory.note <span class="main">(</span><span class="main">(</span>Binding.name <span class="main">(</span><span class="entity">name</span> ^ <span class="inner_quoted">"_simps"</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">attributes</span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> <span class="entity">thms</span><span class="main">)</span>
        |&gt; apfst snd
      <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">show_simps</span><span class="main">,</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">lthy</span>
      |&gt; Local_Theory.begin_nested
      |&gt; snd
      |&gt; fold_map <span class="entity">generate_show_simps</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">Ts</span><span class="main">)</span>
      |&gt; Local_Theory.end_nested_result
          <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">phi</span> <span class="main">=&gt;</span> map <span class="main">(</span>Morphism.fact <span class="entity">phi</span><span class="main">)</span><span class="main">)</span>

    <span class="comment1">(* show law theorems *)</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">induct_thms</span> <span class="main">=</span> <span class="entity">Bnf_Access.induct_thms</span> <span class="entity">lthy</span> <span class="entity">tycos</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">set_simps</span> <span class="main">=</span> <span class="entity">Bnf_Access.set_simps</span> <span class="entity">lthy</span> <span class="entity">tycos</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sets</span> <span class="main">=</span> <span class="entity">Bnf_Access.set_terms</span> <span class="entity">lthy</span> <span class="entity">tycos</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_show_law_thms</span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">x</span><span class="main">)</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sets</span> <span class="main">=</span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">sets</span><span class="main">)</span> <span class="entity">tyco</span> |&gt; the
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">used_sets</span> <span class="main">=</span> map <span class="main">(</span>the o AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span>map TFree <span class="entity">tfrees</span> ~~ <span class="entity">sets</span><span class="main">)</span><span class="main">)</span> <span class="entity">used_tfrees</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_prem</span> <span class="main">(</span><span class="main">(</span><span class="entity">show</span><span class="main">,</span> <span class="entity">set</span><span class="main">)</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="comment1">(*val y = singleton (Name.variant_list [fst x]) "y" |&gt; Free o rpair T*)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">y</span> <span class="main">=</span> Free <span class="main">(</span><span class="entity">subT</span> <span class="inner_quoted">"x"</span> <span class="entity">T</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lhs</span> <span class="main">=</span> <span class="entity">HOLogic.mk_mem</span> <span class="main">(</span><span class="entity">y</span><span class="main">,</span> <span class="entity">set</span> $ Free <span class="entity">x</span><span class="main">)</span> |&gt; <span class="entity">HOLogic.mk_Trueprop</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rhs</span> <span class="main">=</span> <span class="entity">show_law_const</span> <span class="entity">T</span> $ <span class="entity">show</span> $ <span class="entity">y</span> |&gt; <span class="entity">HOLogic.mk_Trueprop</span>
          <span class="keyword2"><span class="keyword">in</span></span> Logic.all <span class="entity">y</span> <span class="main">(</span>Logic.mk_implies <span class="main">(</span><span class="entity">lhs</span><span class="main">,</span> <span class="entity">rhs</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prems</span> <span class="main">=</span> map <span class="entity">mk_prem</span> <span class="main">(</span><span class="entity">arg_shows</span> ~~ <span class="entity">used_sets</span> ~~ <span class="entity">used_tfrees</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">show_const</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=</span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="main">(</span><span class="entity">shows</span> ~~ <span class="entity">Ts</span><span class="main">)</span><span class="main">)</span> <span class="entity">tyco</span> |&gt; the
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">concl</span> <span class="main">=</span> <span class="entity">show_law_const</span> <span class="entity">T</span> $ list_comb <span class="main">(</span><span class="entity">show_const</span><span class="main">,</span> <span class="entity">arg_shows</span><span class="main">)</span> $ Free <span class="entity">x</span>
          |&gt; <span class="entity">HOLogic.mk_Trueprop</span>
      <span class="keyword2"><span class="keyword">in</span></span> Logic.list_implies <span class="main">(</span><span class="entity">prems</span><span class="main">,</span> <span class="entity">concl</span><span class="main">)</span> |&gt; <span class="entity">infer_type</span> <span class="entity">lthy</span> <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">xs</span> <span class="main">=</span> Name.invent_names <span class="main">(</span>Variable.names_of <span class="entity">lthy</span><span class="main">)</span> <span class="inner_quoted">"x"</span> <span class="entity">Ts</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_law_prethms</span> <span class="main">=</span> map <span class="entity">generate_show_law_thms</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">xs</span><span class="main">)</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rec_info</span> <span class="main">=</span> <span class="main">(</span><span class="entity">the_info</span> <span class="entity">lthy</span><span class="main">,</span> <span class="main">#</span>used_positions<span class="main">,</span> <span class="entity">tycos</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">split_IHs</span> <span class="main">=</span> <span class="entity">split_IHs</span> <span class="entity">rec_info</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">recursor_tac</span> <span class="main">=</span> <span class="entity">std_recursor_tac</span> <span class="entity">rec_info</span> <span class="entity">used_tfrees</span> <span class="main">#</span>show_law_intro
  
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">show_law_tac</span> <span class="entity">ctxt</span> <span class="entity">xs</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constr_Ts</span> <span class="main">=</span> <span class="entity">tycos</span>
          |&gt; map <span class="main">(</span><span class="main">#</span>ctrXs_Tss o <span class="main">#</span>fp_ctr_sugar o the o <span class="entity">BNF_FP_Def_Sugar.fp_sugar_of</span> <span class="entity">ctxt</span><span class="main">)</span>

        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ind_case_to_idxs</span> <span class="main">=</span> 
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">number</span> <span class="entity">n</span> <span class="main">(</span><span class="entity">i</span><span class="main">,</span> <span class="entity">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> :: <span class="entity">xs</span><span class="main">)</span> :: <span class="entity">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">n</span><span class="main">,</span> <span class="main">(</span><span class="entity">i</span><span class="main">,</span> <span class="entity">j</span><span class="main">)</span><span class="main">)</span> :: <span class="entity">number</span> <span class="main">(</span><span class="entity">n</span> + <span class="inner_numeral">1</span><span class="main">)</span> <span class="main">(</span><span class="entity">i</span><span class="main">,</span> <span class="entity">j</span> + <span class="inner_numeral">1</span><span class="main">)</span> <span class="main">(</span><span class="entity">xs</span> :: <span class="entity">ys</span><span class="main">)</span>
              <span class="main">|</span> <span class="entity">number</span> <span class="entity">n</span> <span class="main">(</span><span class="entity">i</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="main">]</span> :: <span class="entity">ys</span><span class="main">)</span> <span class="main">=</span> <span class="entity">number</span> <span class="entity">n</span> <span class="main">(</span><span class="entity">i</span> + <span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span> <span class="entity">ys</span>
              <span class="main">|</span> <span class="entity">number</span> <span class="main">_</span> <span class="main">_</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span>
          <span class="keyword2"><span class="keyword">in</span></span> AList.lookup <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span><span class="entity">number</span> <span class="inner_numeral">0</span> <span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span> <span class="entity">constr_Ts</span><span class="main">)</span> #&gt; the <span class="keyword2"><span class="keyword">end</span></span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">instantiate_IHs</span> <span class="entity">IHs</span> <span class="entity">assms</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">IH</span> <span class="main">=&gt;</span>
          <span class="entity">OF_option</span> <span class="entity">IH</span> <span class="main">(</span>replicate <span class="main">(</span>Thm.nprems_of <span class="entity">IH</span> - length <span class="entity">assms</span><span class="main">)</span> NONE @ map SOME <span class="entity">assms</span><span class="main">)</span><span class="main">)</span> <span class="entity">IHs</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">induct_tac</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="main">=</span>
          <span class="main">(</span>DETERM o <span class="entity">Induction.induction_tac</span> <span class="entity">ctxt</span> false
            <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">[</span>SOME <span class="main">(</span>NONE<span class="main">,</span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> false<span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="entity">xs</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span>SOME <span class="entity">induct_thms</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span>
          THEN_ALL_NEW <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">st</span> <span class="main">=&gt;</span>
            <span class="entity">Subgoal.SUBPROOF</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="entity">prems</span><span class="main">,</span> <span class="entity">params</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
              <span class="entity">f</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">st</span> - <span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">prems</span> <span class="entity">params</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="entity">st</span><span class="main">)</span>

        <span class="comment1">(*do not use full "show_law_simps" here, since otherwise too many
          subgoals might be solved (so that the number of subgoals does no longer
          match the number of IHs)*)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_law_simps_less</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span>
          shows_string_append shows_pl_append shows_pr_append shows_space_append<span class="antiquote">}</span></span></span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">o_append_intro_tac</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="main">=</span> HEADGOAL <span class="main">(</span>
          K <span class="main">(</span><span class="entity">Method.try_intros_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> o_append<span class="antiquote">}</span></span></span> <span class="main">[</span><span class="main">]</span><span class="main">)</span>
          THEN_ALL_NEW K <span class="main">(</span><span class="entity">unfold_tac</span> <span class="entity">ctxt</span> <span class="entity">show_law_simps_less</span><span class="main">)</span>
          THEN_ALL_NEW <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> <span class="entity">Subgoal.SUBPROOF</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
              <span class="entity">f</span> <span class="main">(</span><span class="entity">i</span> - <span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">solve_tac</span> <span class="entity">ctxt</span> <span class="entity">case_num</span> <span class="entity">prems</span> <span class="entity">params</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">i</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> <span class="entity">ind_case_to_idxs</span> <span class="entity">case_num</span> <span class="comment1">(*(constructor number, argument number)*)</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">k</span> <span class="main">=</span> length <span class="entity">prems</span> - length <span class="entity">used_tfrees</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">IHs</span><span class="main">,</span> <span class="entity">assms</span><span class="main">)</span> <span class="main">=</span> chop <span class="entity">k</span> <span class="entity">prems</span>
          <span class="keyword2"><span class="keyword">in</span></span>
            resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> show_lawI<span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span>
            THEN <span class="entity">Subgoal.FOCUS</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
              <span class="keyword2"><span class="keyword">let</span></span>
                <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">assms</span> <span class="main">=</span> map <span class="main">(</span>Local_Defs.unfold <span class="entity">ctxt</span> <span class="main">(</span>nth <span class="entity">set_simps</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span> <span class="entity">assms</span>
                <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">Ts</span> <span class="main">=</span> map <span class="main">(</span>fastype_of o Thm.term_of o snd<span class="main">)</span> <span class="entity">params</span>
                <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">IHs</span> <span class="main">=</span> <span class="entity">instantiate_IHs</span> <span class="entity">IHs</span> <span class="entity">assms</span> |&gt; <span class="entity">split_IHs</span> <span class="entity">Ts</span>
              <span class="keyword2"><span class="keyword">in</span></span>
                <span class="entity">unfold_tac</span> <span class="entity">ctxt</span> <span class="main">(</span>nth <span class="entity">show_simps</span> <span class="entity">i</span><span class="main">)</span>
                THEN <span class="entity">o_append_intro_tac</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt'</span> <span class="main">=&gt;</span>
                  resolve_tac <span class="entity">ctxt'</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> show_lawD<span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span>
                  THEN <span class="entity">recursor_tac</span> <span class="entity">assms</span> <span class="main">(</span>nth <span class="entity">Ts</span> <span class="entity">i</span><span class="main">)</span> <span class="main">(</span>nth <span class="entity">IHs</span> <span class="entity">i</span><span class="main">)</span> <span class="entity">ctxt'</span><span class="main">)</span>
              <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span>
          <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">induct_tac</span> <span class="entity">ctxt</span> <span class="entity">solve_tac</span> <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_law_thms</span> <span class="main">=</span> <span class="entity">prove_multi_future</span> <span class="entity">lthy</span> <span class="main">(</span>map fst <span class="entity">xs</span> @ <span class="entity">ss</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span> <span class="entity">show_law_prethms</span>
      <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
        HEADGOAL <span class="main">(</span><span class="entity">show_law_tac</span> <span class="entity">ctxt</span> <span class="main">(</span>map Free <span class="entity">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">show_law_thms</span><span class="main">,</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">lthy</span>
      |&gt; Local_Theory.begin_nested
      |&gt; snd
      |&gt; fold_map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">thm</span><span class="main">)</span> <span class="main">=&gt;</span>
          Local_Theory.note
            <span class="main">(</span><span class="main">(</span>Binding.name <span class="main">(</span><span class="inner_quoted">"show_law_"</span> ^ Long_Name.base_name <span class="entity">tyco</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">attributes</span> <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="entity">thm</span><span class="main">]</span><span class="main">)</span>
          #&gt; apfst <span class="main">(</span>the_single o snd<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">show_law_thms</span><span class="main">)</span>
      |&gt; Local_Theory.end_nested_result Morphism.fact

  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">lthy</span>
    |&gt; fold <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> <span class="entity">pshow</span><span class="main">)</span><span class="main">,</span> <span class="entity">show</span><span class="main">)</span><span class="main">,</span> <span class="entity">show_def</span><span class="main">)</span><span class="main">,</span> <span class="entity">m</span><span class="main">)</span><span class="main">,</span> <span class="entity">m_comp</span><span class="main">)</span><span class="main">,</span> <span class="entity">law_thm</span><span class="main">)</span> <span class="main">=&gt;</span>
         <span class="entity">declare_info</span> <span class="entity">tyco</span> <span class="inner_numeral">1</span> <span class="entity">pshow</span> <span class="entity">show</span> <span class="main">(</span>SOME <span class="entity">show_def</span><span class="main">)</span> <span class="entity">m</span> <span class="main">(</span>SOME <span class="entity">m_comp</span><span class="main">)</span> <span class="entity">used_positions</span> <span class="entity">law_thm</span><span class="main">)</span>
       <span class="main">(</span><span class="entity">tycos</span> ~~ <span class="entity">pshows</span> ~~ <span class="entity">shows</span> ~~ <span class="entity">show_defs</span> ~~ <span class="entity">maps</span> ~~ <span class="entity">map_comps</span> ~~ <span class="entity">show_law_thms</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ensure_info</span> <span class="entity">tyco</span> <span class="entity">lthy</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">get_info</span> <span class="entity">lthy</span> <span class="entity">tyco</span> <span class="keyword2"><span class="keyword">of</span></span>
      SOME <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">lthy</span>
    <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="entity">generate_showsp</span> <span class="entity">tyco</span> <span class="entity">lthy</span><span class="main">)</span>


<span class="comment1">(* proving show instances *)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dest_showsp</span> <span class="entity">showsp</span> <span class="main">=</span>
  dest_Const <span class="entity">showsp</span>
  ||&gt; <span class="main">(</span>
    binder_types #&gt; chop_prefix <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">T</span> <span class="main">=&gt;</span> <span class="entity">T</span> &lt;&gt; <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span><span class="main">)</span>
    #&gt;&gt; map <span class="main">(</span><span class="entity">freeify_tvars</span> o <span class="entity">dest_showspT</span><span class="main">)</span>
    ##&gt; map <span class="main">(</span>dest_TFree o <span class="entity">freeify_tvars</span><span class="main">)</span> o snd o dest_Type o hd o tl<span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">show_instance</span> <span class="entity">tyco</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Sorts.has_instance <span class="main">(</span>Sign.classes_of <span class="entity">thy</span><span class="main">)</span> <span class="entity">tyco</span> <span class="entity">showS</span>
      <span class="keyword1"><span class="keyword">andalso</span></span> error <span class="main">(</span><span class="inner_quoted">"type "</span> ^ quote <span class="entity">tyco</span> ^ <span class="inner_quoted">" is already an instance of class \"show\""</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln <span class="main">(</span><span class="inner_quoted">"deriving \"show\" instance for type "</span> ^ quote <span class="entity">tyco</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy</span> <span class="main">=</span> <span class="entity">Named_Target.theory_map</span> <span class="main">(</span><span class="entity">ensure_info</span> <span class="entity">tyco</span><span class="main">)</span> <span class="entity">thy</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lthy</span> <span class="main">=</span> <span class="entity">Named_Target.theory_init</span> <span class="entity">thy</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">{</span><span class="entity">showsp</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=</span> <span class="entity">the_info</span> <span class="entity">lthy</span> <span class="entity">tyco</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">showspN</span><span class="main">,</span> <span class="main">(</span><span class="entity">used_tfrees</span><span class="main">,</span> <span class="entity">tfrees</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">dest_showsp</span> <span class="entity">showsp</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tfrees'</span> <span class="main">=</span> <span class="entity">tfrees</span>
      |&gt; map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">S</span><span class="main">)</span> <span class="main">=&gt;</span>
        <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="entity">used_tfrees</span> <span class="main">(</span>TFree <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">S</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">showS</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">S</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">used_tfrees'</span> <span class="main">=</span> map <span class="main">(</span>dest_TFree #&gt; fst #&gt; rpair <span class="entity">showS</span> #&gt; TFree<span class="main">)</span> <span class="entity">used_tfrees</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> Type <span class="main">(</span><span class="entity">tyco</span><span class="main">,</span> map TFree <span class="entity">tfrees'</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">arg_Ts</span> <span class="main">=</span> map <span class="entity">showspT</span> <span class="entity">used_tfrees'</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">showsp'</span> <span class="main">=</span> Const <span class="main">(</span><span class="entity">showspN</span><span class="main">,</span> <span class="entity">arg_Ts</span> ---&gt; <span class="entity">showspT</span> <span class="entity">T</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">shows_prec_def</span> <span class="main">=</span> Logic.mk_equals
      <span class="main">(</span><span class="entity">shows_prec_const</span> <span class="entity">T</span><span class="main">,</span> list_comb <span class="main">(</span><span class="entity">showsp'</span><span class="main">,</span> map <span class="entity">shows_prec_const</span> <span class="entity">used_tfrees'</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">shows_list_def</span> <span class="main">=</span> Logic.mk_equals
      <span class="main">(</span><span class="entity">shows_list_const</span> <span class="entity">T</span><span class="main">,</span> <span class="entity">showsp_list_const</span> <span class="entity">T</span> $ <span class="entity">shows_prec_const</span> <span class="entity">T</span> $ <span class="entity">prec0</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> Long_Name.base_name <span class="entity">tyco</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">shows_prec_thm</span><span class="main">,</span> <span class="entity">shows_list_thm</span><span class="main">)</span><span class="main">,</span> <span class="entity">lthy</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">Class.instantiation</span> <span class="main">(</span><span class="main">[</span><span class="entity">tyco</span><span class="main">]</span><span class="main">,</span> <span class="entity">tfrees'</span><span class="main">,</span> <span class="entity">showS</span><span class="main">)</span> <span class="entity">thy</span>
      |&gt; <span class="entity">Generator_Aux.define_overloaded_generic</span>
        <span class="main">(</span><span class="main">(</span>Binding.name <span class="main">(</span><span class="inner_quoted">"shows_prec_"</span> ^ <span class="entity">name</span> ^ <span class="inner_quoted">"_def"</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">attributes</span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> <span class="entity">shows_prec_def</span><span class="main">)</span>
      ||&gt;&gt; <span class="entity">Generator_Aux.define_overloaded_generic</span>
        <span class="main">(</span><span class="main">(</span>Binding.name <span class="main">(</span><span class="inner_quoted">"shows_list_"</span> ^ <span class="entity">name</span> ^ <span class="inner_quoted">"_def"</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">attributes</span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> <span class="entity">shows_list_def</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">Class.prove_instantiation_exit</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_law_intros</span> <span class="main">=</span> <span class="entity">Named_Theorems.get</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">named_theorems</span> "show_law_intros"<span class="antiquote">}</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_law_simps</span> <span class="main">=</span> <span class="entity">Named_Theorems.get</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">named_theorems</span> "show_law_simps"<span class="antiquote">}</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">show_append_tac</span> <span class="main">=</span> resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> show_lawD<span class="antiquote">}</span></span></span>
          THEN' REPEAT_ALL_NEW <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="entity">show_law_intros</span><span class="main">)</span>
          THEN_ALL_NEW <span class="main">(</span>
            resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> show_lawI<span class="antiquote">}</span></span></span>
            THEN' <span class="entity">simp_only_tac</span> <span class="entity">ctxt</span> <span class="entity">show_law_simps</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="entity">Class.intro_classes_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="main">]</span>
        THEN <span class="entity">unfold_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">shows_prec_thm</span><span class="main">,</span> <span class="entity">shows_list_thm</span><span class="main">]</span>
        THEN REPEAT1 <span class="main">(</span>HEADGOAL <span class="entity">show_append_tac</span><span class="main">)</span>
     <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span> <span class="entity">lthy</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
  Theory.setup
    <span class="main">(</span><span class="entity">Derive_Manager.register_derive</span> <span class="inner_quoted">"show"</span> <span class="inner_quoted">"generate show instance"</span> <span class="main">(</span>K o <span class="entity">show_instance</span><span class="main">)</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Instances">
<div class="head">
<h1>Theory Show_Instances</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Show
    Author:      Christian Sternagel &lt;c.sternagel@gmail.com&gt;
    Author:      René Thiemann &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
    Maintainer:  René Thiemann &lt;rene.thiemann@uibk.ac.at&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Instances of the Show Class for Standard Types›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Show_Instances
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Show.html">Show</a>
  <a href="../../HOL/HOL/Rat.html">HOL.Rat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_unit</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> shows_string <span class="inner_quoted">''()''</span>"</span></span>

<span class="keyword1" id="Show_Instances-show_law_unit"><span class="command">lemma</span></span> show_law_unit <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_unit <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_unit_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">showsp_char</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"char showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_char</span> <span class="main">≡</span> shows_prec"</span></span>

<span class="keyword1" id="Show_Instances-show_law_char"><span class="command">lemma</span></span> show_law_char <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_char <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity"><span class="entity">showsp_bool</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted"><span class="quoted">"bool showsp"</span></span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">showsp_bool</span></span> <span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity">p</span></span></span></span></span></span> True <span class="main"><span class="main">=</span></span> shows_string <span class="inner_quoted"><span class="inner_quoted">''True''</span></span>"</span></span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">showsp_bool</span></span> <span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity">p</span></span></span></span></span></span> False <span class="main"><span class="main">=</span></span> shows_string <span class="inner_quoted"><span class="inner_quoted">''False''</span></span>"</span></span></span>

<span class="keyword1" id="Show_Instances-show_law_bool"><span class="command">lemma</span></span> show_law_bool <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_bool <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pshowsp_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>shows <span class="main">×</span> shows<span class="main">)</span> showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pshowsp_prod</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> shows_string <span class="inner_quoted">''(''</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">o</span> shows_string <span class="inner_quoted">'', ''</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">o</span> shows_string <span class="inner_quoted">'')''</span>"</span></span>

<span class="comment1">(*NOTE: in order to be compatible with automatically generated show funtions,
show-arguments of "map"-functions need to get precedence 1 (which may lead to
redundant parentheses in the output, but seems unavoidable in the current setup,
i.e., pshowsp via primrec followed by defining showsp via pshowsp composed with map).*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> showsp <span class="main">⇒</span> <span class="tfree">'b</span> showsp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">showsp_prod</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> pshowsp_prod <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">o</span> map_prod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show_Instances-showsp_prod_simps"><span class="command">lemma</span></span> showsp_prod_simps <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_prod <span class="free">s1</span> <span class="free">s2</span> <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span>
    shows_string <span class="inner_quoted">''(''</span> <span class="keyword1">o</span> <span class="free">s1</span> <span class="main">1</span> <span class="free">x</span> <span class="keyword1">o</span> shows_string <span class="inner_quoted">'', ''</span> <span class="keyword1">o</span> <span class="free">s2</span> <span class="main">1</span> <span class="free">y</span> <span class="keyword1">o</span> shows_string <span class="inner_quoted">'')''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_prod_def<span class="main">)</span>

<span class="keyword1" id="Show_Instances-show_law_prod"><span class="command">lemma</span></span> show_law_prod <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Basic_BNFs.fsts <span class="free">y</span> <span class="main">⟹</span> show_law <span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Basic_BNFs.snds <span class="free">y</span> <span class="main">⟹</span> show_law <span class="free">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
    show_law <span class="main">(</span>showsp_prod <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> Pair <span class="main">[</span><span class="operator">unfolded</span> prod_set_simps<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> o_apply <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> o_append <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> show_lawD * <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">string_of_digit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> string"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_digit</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="inner_quoted">''0''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="inner_quoted">''1''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="inner_quoted">''2''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="inner_quoted">''3''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">4</span> <span class="keyword1">then</span> <span class="inner_quoted">''4''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">5</span> <span class="keyword1">then</span> <span class="inner_quoted">''5''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">6</span> <span class="keyword1">then</span> <span class="inner_quoted">''6''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">7</span> <span class="keyword1">then</span> <span class="inner_quoted">''7''</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">8</span> <span class="keyword1">then</span> <span class="inner_quoted">''8''</span>
    <span class="keyword1">else</span> <span class="inner_quoted">''9''</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">showsp_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_nat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">10</span> <span class="keyword1">then</span> shows_string <span class="main">(</span>string_of_digit <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="free">showsp_nat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">10</span><span class="main">)</span> <span class="keyword1">o</span> shows_string <span class="main">(</span>string_of_digit <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">declare</span></span> showsp_nat.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Show_Instances-show_law_nat"><span class="command">lemma</span></span> show_law_nat <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span> showsp_nat.simps<span class="main">)</span>

<span class="keyword1" id="Show_Instances-showsp_nat_append"><span class="command">lemma</span></span> showsp_nat_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_nat <span class="free">p</span> <span class="free">n</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> showsp_nat <span class="free">p</span> <span class="free">n</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> show_lawD <span class="dynamic"><span class="dynamic">show_law_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_int</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> shows_string <span class="inner_quoted">''-''</span> <span class="keyword1">o</span> showsp_nat <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> showsp_nat <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show_Instances-show_law_int"><span class="command">lemma</span></span> show_law_int <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_int <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_int_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show_Instances-showsp_int_append"><span class="command">lemma</span></span> showsp_int_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_int <span class="free">p</span> <span class="free">i</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> showsp_int <span class="free">p</span> <span class="free">i</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> show_lawD <span class="dynamic"><span class="dynamic">show_law_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_rat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> quotient_of <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span>
      <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> showsp_int <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">d</span> <span class="keyword1">else</span> showsp_int <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">d</span> <span class="keyword1">o</span> shows_string <span class="inner_quoted">''/''</span> <span class="keyword1">o</span> showsp_int <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show_Instances-show_law_rat"><span class="command">lemma</span></span> show_law_rat <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_rat <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_rat_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show_Instances-showsp_rat_append"><span class="command">lemma</span></span> showsp_rat_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_rat <span class="free">p</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> showsp_rat <span class="free">p</span> <span class="free">r</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> show_lawD <span class="dynamic"><span class="dynamic">show_law_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Automatic show functions are not used for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> unit<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> prod<span class="antiquote"><span class="antiquote">}</span></span></span></span>, and numbers:
  for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> unit<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> prod<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we do not want to display <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Unity''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Pair''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> nat<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we do not want to display
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Suc (Suc (... (Suc 0) ...))''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; and neither <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> int<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  nor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> rat<span class="antiquote"><span class="antiquote">}</span></span></span></span> are datatypes.
›</span></span>

<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹
  <span class="entity">Show_Generator.register_foreign_partial_and_full_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> prod<span class="antiquote">}</span></span> <span class="inner_numeral">0</span>
       <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"pshowsp_prod"</span><span class="antiquote">}</span></span>
       <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_prod"</span><span class="antiquote">}</span></span> <span class="main">(</span>SOME <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> showsp_prod_def<span class="antiquote">}</span></span></span><span class="main">)</span>
       <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"map_prod"</span><span class="antiquote">}</span></span> <span class="main">(</span>SOME <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> prod.map_comp<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">[</span>true<span class="main">,</span> true<span class="main">]</span>
       <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_prod<span class="antiquote">}</span></span></span>
  #&gt; <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">unit</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_unit"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_unit<span class="antiquote">}</span></span></span>
  #&gt; <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">bool</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_bool"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_bool<span class="antiquote">}</span></span></span>
  #&gt; <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">char</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_char"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_char<span class="antiquote">}</span></span></span>
  #&gt; <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_nat"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_nat<span class="antiquote">}</span></span></span>
  #&gt; <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">int</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_int"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_int<span class="antiquote">}</span></span></span>
  #&gt; <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">rat</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_rat"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_rat<span class="antiquote">}</span></span></span>
›</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="quoted">"show"</span> <span class="quoted">option</span> <span class="quoted">sum</span> <span class="quoted">prod</span> <span class="quoted">unit</span> <span class="quoted">bool</span> <span class="quoted">nat</span> <span class="quoted">int</span> <span class="quoted">rat</span>

<span class="keyword1"><span class="command">export_code</span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>show option showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>show<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>show<span class="main">)</span> sum showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>show <span class="main">×</span> <span class="tfree">'b</span><span class="main">::</span>show<span class="main">)</span> showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> unit showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> char showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> bool showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> nat showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> int showsp"</span></span></span>
  <span class="quoted"><span class="quoted"><span class="quoted">"shows_prec <span class="main">::</span> rat showsp"</span></span></span>
  <span class="keyword2"><span class="keyword">checking</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Show_Poly">
<div class="head">
<h1>Theory Show_Poly</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
    License:     LPGL
*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Displaying Polynomials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a method which converts polynomials to strings and registers it in the Show class.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Show_Poly
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Show_Instances.html">Show_Instances</a>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">show_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_factor</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_factor</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''x''</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_factor</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="inner_quoted">''x^''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">show_coeff_factor</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_coeff_factor</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> show <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> show_factor <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> show <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">@</span> show_factor <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">show_poly_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">,</span>one<span class="main">,</span>show<span class="main">}</span> list <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_poly_main</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="inner_quoted">''0''</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_poly_main</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span> <span class="main">=</span> show_coeff_factor <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_poly_main</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">show_poly_main</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="keyword1">else</span>
    show_coeff_factor <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="inner_quoted">'' + ''</span> <span class="main">@</span> <span class="free">show_poly_main</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">show_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">,</span>one<span class="main">,</span>show<span class="main">}</span>poly <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> show_poly_main <span class="main">0</span> <span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">,</span>one<span class="main">,</span>show<span class="main">}</span>poly showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> shows_string <span class="main">(</span>show_poly <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> poly <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>show<span class="main">,</span>one<span class="main">,</span>zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"show"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"shows_prec <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span> showsp_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"shows_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> poly list<span class="main">)</span> <span class="main">=</span> showsp_list shows_prec <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>"</span></span>

<span class="keyword1" id="Show_Poly-show_law_poly"><span class="command">lemma</span></span> show_law_poly <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shows_prec <span class="free">p</span> <span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> shows_prec <span class="free">p</span> <span class="free">a</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shows_prec_poly_def showsp_poly_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shows_list_poly_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Real">
<div class="head">
<h1>Theory Show_Real</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Show for Real Numbers -- Interface›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We just demand that there is some function from reals to string and register this
  as show-function. Implementations are available in one of the theories \textit{Show-Real-Impl}
  and \textit{../Algebraic-Numbers/Show-Real-...}.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Show_Real
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Real.html">HOL.Real</a>
  <a href="Show.html">Show</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">consts</span></span> show_real <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> string"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_real</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span>show_real <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show_Real-show_law_real"><span class="command">lemma</span></span> show_law_real <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_real <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_real_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show_Real-showsp_real_append"><span class="command">lemma</span></span> showsp_real_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_real <span class="free">p</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> showsp_real <span class="free">p</span> <span class="free">r</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> show_lawD <span class="dynamic"><span class="dynamic">show_law_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹
  <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">real</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_real"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_real<span class="antiquote">}</span></span></span>
›</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="quoted">"show"</span> <span class="quoted">real</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Complex">
<div class="head">
<h1>Theory Show_Complex</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Show for Complex Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We print complex numbers as real and imaginary parts. Note that by transitivity, this theory
  demands that an implementations for \textit{show-real} is available, e.g., by using 
  one of the theories \textit{Show-Real-Impl} or \textit{../Algebraic-Numbers/Show-Real-...}.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Show_Complex
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Complex.html">HOL.Complex</a>
  <a href="Show_Real.html">Show_Real</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">show_complex</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span> <span class="bound">i</span> <span class="main">=</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> show_real <span class="bound">r</span> <span class="keyword1">else</span> <span class="keyword1">if</span> 
  <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> show_real <span class="bound">i</span> <span class="main">@</span> <span class="inner_quoted">''i''</span> <span class="keyword1">else</span>
  <span class="inner_quoted">''(''</span> <span class="main">@</span> show_real <span class="bound">r</span> <span class="main">@</span> <span class="inner_quoted">''+''</span> <span class="main">@</span> show_real <span class="bound">i</span> <span class="main">@</span> <span class="inner_quoted">''i)''</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_complex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex showsp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_complex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span>show_complex <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Show_Complex-show_law_complex"><span class="command">lemma</span></span> show_law_complex <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_complex <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_complex_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Show_Complex-showsp_complex_append"><span class="command">lemma</span></span> showsp_complex_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_complex <span class="free">p</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> showsp_complex <span class="free">p</span> <span class="free">r</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> show_lawD <span class="dynamic"><span class="dynamic">show_law_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹
  <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">complex</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_complex"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_complex<span class="antiquote">}</span></span></span>
›</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="quoted">"show"</span> <span class="quoted">complex</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Real_Impl">
<div class="head">
<h1>Theory Show_Real_Impl</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
    License:     LGPL
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Show Implemetation for Real Numbers via Rational Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We just provide an implementation for show of real numbers where we assume
  that real numbers are implemented via rational numbers.›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> Show_Real_Impl
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Show_Real.html">Show_Real</a>
  <a href="Show_Instances.html">Show_Instances</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> show_real<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">overloading</span></span> show_real <span class="main">≡</span> <span class="quoted">show_real</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">show_real</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">show_real</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Ratreal <span class="bound">y</span><span class="main">)</span> <span class="keyword1">then</span> show <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Ratreal <span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="inner_quoted">''Irrational''</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Show_Real_Impl-show_real_code"><span class="command">lemma</span></span> show_real_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"show_real <span class="main">(</span>Ratreal <span class="free">x</span><span class="main">)</span> <span class="main">=</span> show <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> show_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>