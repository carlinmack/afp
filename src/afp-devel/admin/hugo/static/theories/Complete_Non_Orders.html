<div id="Binary_Relations">
<div class="head">
<h1>Theory Binary_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Akihisa Yamada (2018-2021)
License: LGPL (see file COPYING.LESSER)
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Binary Relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We start with basic properties of binary relations.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Binary_Relations
  <span class="keyword2"><span class="keyword">imports</span></span>
<span class="comment1">(* To verify that we don't use the axiom of choice, import
    HOL.Complete_Partial_Order HOL.Wellfounded
   instead of *)</span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conj_imp_eq_imp_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="free">R</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> tranclp_trancl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tranclp_trancl_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tranclp_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"transp <span class="free">r</span> <span class="main">⟹</span> tranclp <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trancl_id<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> transp_trans<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>tranclp_trancl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transp_tranclp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"transp <span class="main">(</span>tranclp <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tranclp_trancl transp_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> funpow_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Below we introduce an Isabelle-notation for $\{ \ldots x\ldots \mid x \in X \}$.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_range"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> idts <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_ <span class="keyword3">/</span><span class="keyword1">|.</span><span class="keyword3">/ </span>_<span class="keyword1">}</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_image"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_ <span class="keyword3">/</span><span class="keyword1">|.</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∈</span> _<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">{</span><span class="free">e</span> <span class="main">|.</span> <span class="free">p</span><span class="main">}</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="main">{</span><span class="free">e</span> <span class="main">|</span> <span class="free">p</span><span class="main">.</span> <span class="keyword1">CONST</span> True<span class="main">}</span>"</span>
  <span class="quoted">"<span class="main">{</span><span class="free">e</span> <span class="main">|.</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> image <span class="main">(</span><span class="main">λ</span><span class="free">p</span><span class="main">.</span> <span class="free">e</span><span class="main">)</span> <span class="free">A</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> image_constant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Various Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we introduce various definitions for binary relations.
The first one is our abbreviation for the dual of a relation.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">dual</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>-</sup></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conversep_is_dual<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conversep <span class="main">=</span> dual"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Monotonicity is already defined in the library, but we want one restricted to a domain.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">monotone_on</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> monotone_onI <span class="main">=</span> monotone_on_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemma</span></span> monotone_onD<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">X</span> <span class="free">r</span> <span class="free">s</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> monotone_onE <span class="main">=</span> monotone_on_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">elim_format</span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_on_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on UNIV <span class="main">=</span> monotone"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_on_def monotone_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_on_dual<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">X</span> <span class="free">r</span> <span class="free">s</span> <span class="free">f</span> <span class="main">⟹</span> monotone_on <span class="free">X</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="free">s</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_on_id<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">X</span> <span class="free">r</span> <span class="free">r</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_on_cmono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> monotone_on <span class="free">B</span> <span class="main">≤</span> monotone_on <span class="free">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_funI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we define the following notions in a standard manner›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The symmetric part of a relation:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sympartp</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sympartp</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sympartpI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sympartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartpE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sympartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_dual<span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sympartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> reflclp_sympartp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sympartp <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span> <span class="main">=</span> sympartp <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">equivpartp</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_reflclp_equivp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span> <span class="main">=</span> equivpartp <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equivpartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equivpartI<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"equivpartp <span class="free">r</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sympartp_equivpartpI<span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="free">r</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> equivpartp <span class="free">r</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> equivpartpCI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> sympartp <span class="free">r</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> equivpartp <span class="free">r</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>equivpartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equivpartpE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivpartp <span class="free">r</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">y</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equivpartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equivpartp_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"equivpartp <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_equivpartp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span>equivpartp <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>equivpartp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> equivpartp_equivpartp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"equivpartp <span class="main">(</span>equivpartp <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>equivpartp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> equivpartp_sympartp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"equivpartp <span class="main">(</span>sympartp <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>equivpartp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 5 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equivpartp_dual<span class="main">:</span> <span class="quoted"><span class="quoted">"equivpartp <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> equivpartp <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equivpartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The asymmetric part:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">asympartp</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asympartpE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"asympartp <span class="main"><span class="free">(⊑)</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> asympartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> asympartpI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> asympartp_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> 

<span class="keyword1"><span class="command">lemma</span></span> asympartp_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asympartp <span class="main">(=)</span> <span class="main">=</span> bot"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> asympartp_sympartp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asympartp <span class="main">(</span>sympartp <span class="free">r</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sympartp_asympartp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span>asympartp <span class="free">r</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Restriction to a set:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Restrp</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↾</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="free">↾</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> RestrpI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> Restrp_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> RestrpE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> Restrp_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">elim_format</span><span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_Restrp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">↾</span> <span class="free">A</span> <span class="main">↾</span> <span class="free">B</span> <span class="main">≡</span> <span class="free">r</span> <span class="main">↾</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq Restrp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_Restrp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span><span class="free">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="free">r</span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Relational images:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Imagep</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">```</span>"</span> 59<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="free">```</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Imagep_Image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">```</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span> <span class="main">``</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_Imagep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">```</span> <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">r</span> <span class="bound">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ImagepI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">```</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_Imagep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subset_Imagep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">r</span> <span class="main">```</span> <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bounds of a set:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bound</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> boundI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> boundE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bound_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bound_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bound_insert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">b</span> <span class="main">∧</span> bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Extreme (greatest) elements in a set:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">extreme</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> extremeI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> extremeD<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">e</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> extremeE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">e</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">e</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> extreme_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"extreme UNIV <span class="main"><span class="free">(⊑)</span></span> <span class="free">t</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> extremes_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">X</span> <span class="free">r</span> <span class="free">b</span> <span class="main">⟹</span> extreme <span class="free">X</span> <span class="free">r</span> <span class="free">c</span> <span class="main">⟹</span> sympartp <span class="free">r</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> bound_cmono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bound <span class="free">Y</span> <span class="main">≤</span> bound <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_sympartp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span>sympartp <span class="free">r</span><span class="main">)</span> <span class="main">=</span> sympartp <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now suprema and infima are given uniformly as follows.
  The definition is restricted to a given set.
›</span></span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">extreme_bound</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> extreme <span class="main">{</span><span class="bound"><span class="bound">b</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> bound <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_boundI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">X</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">X</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sX<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">X</span> <span class="free">sX</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sY<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">Y</span> <span class="free">sY</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sX</span> <span class="main"><span class="free">⊑</span></span> <span class="free">sY</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">sY</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XY sY <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> sX sY <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">X</span> <span class="free">s</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_singleton_refl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"extreme_bound <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_image_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> extreme_bound <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_constant<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_UN_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span>
  extreme_bound <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ir</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'i</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">e</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fIA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">I</span> <span class="main"><span class="free">(≼)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">I</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_extreme_imp_extreme_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> monotone_onD<span class="main">[</span><span class="operator">OF</span> mono<span class="main">]</span> e fIA
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> extreme_boundI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> extremeE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_extreme_extreme_boundI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> monotone_extreme_imp_extreme_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locales for Binary Relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define basic properties of binary relations,
in form of \emph{locales}~\cite{Kammuller00,locale}.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntactic Locales›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following locales do not assume anything, but provide infix notations for
relations.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> less_eq_syntax <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">⊑</span></span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> less_syntax <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">⊏</span></span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> equivalence_syntax <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">equiv_class</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>∼</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]<span class="hidden">⇩</span><sub>∼</sub></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">∼</span></span> <span class="bound">y</span> <span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next ones introduce abbreviations for dual etc.
To avoid needless constants, one should be careful when declaring them as sublocales.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> less_eq_notations <span class="main">=</span> less_eq_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">greater_eq</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊒</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊒</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sym</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span> <span class="main">≡</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span> <span class="main">≡</span> asympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">greater</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊐</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊐)</span></span> <span class="main">≡</span> <span class="main">(⊏)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">equiv</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword3">(</span><span class="keyword1">≃</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(</span></span><span class="main"><span class="free">≃</span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> equivpartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asym_cases<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> asym sym<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> less_notations <span class="main">=</span> less_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">greater</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊐</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊐</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> related_set <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊑</span></span></span></span></span></span></span></span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Properties of Relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following we define basic properties in form of locales.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reflexivity restricted on a set:›</span></span>
<span class="keyword1"><span class="command">locale</span></span> reflexive <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_implies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> extreme <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> reflexive <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> reflexive.intro<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexiveE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflexive <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reflexive.refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> reflexive <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> reflexive <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflexive_def<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> irreflexive <span class="main">=</span> related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreflD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> implies_not_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_irreflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"irreflexive UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> irreflexive <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> irreflexive.intro<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> irreflexive <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> irreflexive <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irreflexive_def<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> transitive <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive UNIV <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bound_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> bound <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> trans BA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> asympartp_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="main">(⊏)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reflclp_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The symmetric part is also transitive, but this is done in the later semiattractive locale›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> transitive.intro<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">?</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> transitive <span class="free">A</span> <span class="free">r'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> transitive <span class="free">A</span> <span class="free">r'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> transitive.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> r<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> transitive.trans<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="free">r'</span> <span class="main">⟹</span> transitive <span class="free">A</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> transitive.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> r<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> transitive.trans<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tranclp_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="main">(</span>tranclp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tranclp_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">locale</span></span> symmetric <span class="main">=</span> related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">equiv</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sym<span class="main">[</span><span class="operator">sym</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">∼</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">∼</span></span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sym_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">∼</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main"><span class="free">∼</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_symmetric<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric UNIV <span class="main">(</span><span class="main"><span class="free">(∼)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> symmetric <span class="free">B</span> <span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> symmetric.intro<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> symmetric <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> symmetric <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> symmetric_def<span class="main">)</span>


<span class="keyword1"><span class="command">global_interpretation</span></span> sympartp<span class="main">:</span> symmetric <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"sympartp <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sympartp_symmetric<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">A</span> <span class="main">(</span>sympartp <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">locale</span></span> antisymmetric <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sym_iff_eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_iff_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> equivpartpE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">x</span> <span class="main">⟹</span> extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> extremeE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_extreme_iff_ex1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> Ex <span class="main">(</span>extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span> <span class="main">⟷</span> Ex1 <span class="main">(</span>extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_unique<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_extreme_iff_the<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> Ex <span class="main">(</span>extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span> <span class="main">⟷</span> extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span>The <span class="main">(</span>extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> extreme_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_antisymmetric<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric UNIV <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> antisymmetric <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">using</span></span> antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> antisymmetric.intro<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> antisymmetric <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> antisymmetric <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> antisymmetric_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"antisymmetric <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> antisymmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> antisymmetric <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> AB<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> A.antisym B.antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following notion is new, generalizing antisymmetry and transitivity.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> semiattractive <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_order_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≃</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> attract<span class="main">[</span><span class="operator">OF</span> _ _ _ x y z<span class="main">]</span> xy yz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> equivpartpE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="main">(</span><span class="main">≃</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≃</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≃</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≃</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_order_trans<span class="main">[</span><span class="operator">OF</span> xy _ x y z<span class="main">]</span> attract<span class="main">[</span><span class="operator">OF</span> _ _ _ z y x<span class="main">]</span> xy yz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>equivpartp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sym_order_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> attract<span class="main">[</span><span class="operator">OF</span> _ _ _ x y z<span class="main">]</span> xy yz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> sym<span class="main">:</span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∼)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∼</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∼</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∼</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sym_order_trans<span class="main">[</span><span class="operator">OF</span> xy _ x y z<span class="main">]</span> attract<span class="main">[</span><span class="operator">OF</span> _ _ _ z y x<span class="main">]</span> xy yz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> sym_transitive <span class="main">=</span> sym.transitive_axioms

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_quasi_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∼</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">C</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> extreme_boundI x<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> C0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> cC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> cC const <span class="keyword1"><span class="command">have</span></span> cx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∼</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bound <span class="free">C</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> cC <span class="keyword1"><span class="command">have</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> attract<span class="main">[</span><span class="operator">OF</span> _ _ cb x c b<span class="main">]</span> cx <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> const <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_quasi_const_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∼</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">C</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">C</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> extreme_bound_quasi_const<span class="main">[</span><span class="operator">OF</span> C x C0 const<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> extremes_equiv<span class="main">[</span><span class="operator">OF</span> y x<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> const C sym.trans<span class="main">[</span><span class="operator">OF</span> _ xy _ x y<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Cy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∼</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">C</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> extreme_bound_quasi_const<span class="main">[</span><span class="operator">OF</span> C y C0 Cy<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_semiattractive<span class="main">:</span> <span class="quoted"><span class="quoted">"semiattractive UNIV <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> attract<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> semiattractive_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> semiattractive <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">using</span></span> attract <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semiattractive_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"semiattractive <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> semiattractive <span class="free">A</span> <span class="free">r'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟹</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> semiattractive.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> r<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> semiattractive.attract<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⟹</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> semiattractive.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> r<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> semiattractive.attract<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> attractive <span class="main">=</span> semiattractive <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"semiattractive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dual<span class="main">:</span> semiattractive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span><span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span>sympartp <span class="bound">r</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> <span class="main">(∼)</span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> <span class="main">(∼)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equivpartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> <span class="main">(</span><span class="main">≃</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> attractive_axioms<span class="main">[</span><span class="operator">unfolded</span> attractive_def<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> attractive_axioms_def atomize_eq equivpartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> order_equiv_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≃</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual.attract<span class="main">[</span><span class="operator">OF</span> _ _ _ z y x<span class="main">]</span> xy yz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> order_sym_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∼</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual.attract<span class="main">[</span><span class="operator">OF</span> _ _ _ z y x<span class="main">]</span> xy yz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> semiattractive <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Restrp_semiattractive<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> dual.Restrp<span class="main">:</span> semiattractive <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual.Restrp_semiattractive<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_attractive<span class="main">:</span> <span class="quoted"><span class="quoted">"attractive UNIV <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> dual.Restrp.attract <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> attractive_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> attractive <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> attractive.intro attractive_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> semiattractive_subset dual.semiattractive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> attractive_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"attractive <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> attractive <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> attractive_def attractive_axioms_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> semiattractive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> antisymmetric <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> attractive
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> transitive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> attractive
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span><span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span>sympartp <span class="bound">r</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sympartp <span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"asympartp <span class="main">(</span>asympartp <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span> <span class="main">=</span> asympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"asympartp <span class="main">(</span>sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"asympartp <span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span> <span class="main">=</span> asympartp <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Combined Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some combinations of the above basic properties are given names.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> asymmetric <span class="main">=</span> related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> False"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> irreflexive
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> asym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_axioms<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> asym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_asymmetric<span class="main">:</span> <span class="quoted"><span class="quoted">"asymmetric UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>asym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> asymmetric <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">using</span></span> asym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_iff_irreflexive_antisymmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"asymmetric <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span> <span class="main">⟷</span> irreflexive <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span> <span class="main">∧</span> antisymmetric <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> asymmetric<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> asym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> irreflexive <span class="main">+</span> antisymmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>asymmetric.intro <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym irrefl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"asymmetric <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> asymmetric <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymmetric_iff_irreflexive_antisymmetric r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> irreflexive_cong antisymmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> quasi_ordered_set <span class="main">=</span> reflexive <span class="main">+</span> transitive
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasi_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> quasi_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> reflexive_subset transitive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasi_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quasi_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> quasi_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quasi_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> reflexive_cong transitive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> near_ordered_set <span class="main">=</span> antisymmetric <span class="main">+</span> transitive
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> antisymmetric <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Restrp_antisymmetric<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> transitive <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Restrp_transitive<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_near_order<span class="main">:</span> <span class="quoted"><span class="quoted">"near_ordered_set UNIV <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> near_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> near_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> antisymmetric_subset transitive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> near_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"near_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> near_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> near_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> antisymmetric_cong transitive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> pseudo_ordered_set <span class="main">=</span> reflexive <span class="main">+</span> antisymmetric
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sym_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_bound_singleton_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_order_iff_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> extreme <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">e</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">s</span> <span class="main">⟷</span> <span class="free">e</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pseudo_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> pseudo_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> reflexive_subset antisymmetric_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pseudo_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pseudo_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> pseudo_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> reflexive_cong antisymmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> partially_ordered_set <span class="main">=</span> reflexive <span class="main">+</span> antisymmetric <span class="main">+</span> transitive
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pseudo_ordered_set <span class="main">+</span> quasi_ordered_set <span class="main">+</span> near_ordered_set <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partially_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> partially_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> reflexive_subset transitive_subset antisymmetric_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partially_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partially_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> partially_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partially_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> reflexive_cong antisymmetric_cong transitive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> strict_ordered_set <span class="main">=</span> irreflexive <span class="main">+</span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> asymmetric
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> near_ordered_set_axioms<span class="main">:</span> <span class="quoted"><span class="quoted">"near_ordered_set <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> antisymmetric_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> asymmetric <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Restrp_asymmetric<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> transitive <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Restrp_transitive<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_strict_order<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_ordered_set UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> strict_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> irreflexive_subset transitive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> strict_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> irreflexive_cong transitive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> tolerance <span class="main">=</span> symmetric <span class="main">+</span> reflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tolerance_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> tolerance <span class="free">B</span> <span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> symmetric_subset reflexive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tolerance_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tolerance <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> tolerance <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tolerance_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> reflexive_cong symmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">global_interpretation</span></span> equiv<span class="main">:</span> tolerance <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"equivpartp <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>equivpartp_def<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> partial_equivalence <span class="main">=</span> symmetric <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="main"><span class="free">(∼)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(∼)</span></span><span class="main">↾</span><span class="free">A</span> <span class="main">≡</span> <span class="main"><span class="free">(∼)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span><span class="main"><span class="free">(∼)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span> <span class="main">≡</span> <span class="main"><span class="free">(∼)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> partial_equivalence_axioms
  <span class="keyword1"><span class="command">unfolding</span></span> partial_equivalence_axioms_def partial_equivalence_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq sym <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> partial_equivalence_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> partial_equivalence <span class="free">B</span> <span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> partial_equivalence.intro partial_equivalence_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> symmetric_subset transitive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partial_equivalence_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partial_equivalence <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> partial_equivalence <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partial_equivalence_def partial_equivalence_axioms_def r
      <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> transitive_cong symmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> equivalence <span class="main">=</span> symmetric <span class="main">+</span> reflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span>"</span></span> <span class="main">+</span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> tolerance <span class="main">+</span> partial_equivalence <span class="main">+</span> quasi_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> equivalence <span class="free">B</span> <span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> equivalence.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> symmetric_subset transitive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> equivalence <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equivalence_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> reflexive_cong transitive_cong symmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some combinations lead to uninteresting relations.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⨝</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">proposition</span></span> reflexive_irreflexive_is_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reflexive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ir<span class="main">:</span> <span class="quoted"><span class="quoted">"irreflexive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> irreflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ir<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> reflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⨝</span></span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> irrefl a <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> symmetric_antisymmetric_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span><span class="main">↾</span><span class="free">A</span> <span class="main">≤</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> symmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="main">+</span> antisymmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> antisym <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> nontolerance<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreflexive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span> <span class="main">∧</span> symmetric <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span> <span class="main">⟷</span> tolerance <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⨝</span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"irreflexive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> irreflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="main">+</span> symmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tolerance <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⨝</span></span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym irrefl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"tolerance <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⨝</span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> tolerance <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⨝</span></span> <span class="bound">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreflexive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_implies<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> irreflexive_transitive_symmetric_is_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreflexive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sym<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">A</span> <span class="main"><span class="free">(⨝)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span><span class="main">↾</span><span class="free">A</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bot_fun_def bot_bool_def eq_False<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> RestrpE<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> strict_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> strict_ordered_set_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> symmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⨝)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⨝</span></span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sym<span class="main">[</span><span class="operator">OF</span> xy x y<span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⨝</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Totality›</span></span>

<span class="keyword1"><span class="command">locale</span></span> semiconnex <span class="main">=</span> related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> semiconnex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cases<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> less eq greater<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> semiconnex assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> neqE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> semiconnex_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> semiconnex <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> semiconnex.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> semiconnex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> semiconnex.intro<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Totality is negated antisymmetry \cite[Proposition 2.2.4]{Schmidt1993}.›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> semiconnex_iff_neg_antisymmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"semiconnex <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span> <span class="main">⟷</span> antisymmetric <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI semiconnex.intro antisymmetric.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> semiconnex<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> neg<span class="main">:</span> antisymmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">y</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg.antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semiconnex_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"semiconnex <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> semiconnex <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiconnex_iff_neg_antisymmetric r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> antisymmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> semiconnex_irreflexive <span class="main">=</span> semiconnex <span class="main">+</span> irreflexive
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>neqE <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> semiconnex_irreflexive_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> semiconnex_irreflexive <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> semiconnex_irreflexive.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> semiconnex_subset irreflexive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semiconnex_irreflexive_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"semiconnex_irreflexive <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> semiconnex_irreflexive <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiconnex_irreflexive_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> semiconnex_cong irreflexive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> connex <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comparable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> reflexive <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">using</span></span> comparable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comparable_cases<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> le ge<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms comparable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comparable_three_cases<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> less eq greater<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊏</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms comparable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> not_iff_asym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> not_asym_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comparable<span class="main">[</span><span class="operator">OF</span> x y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> connex_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> connex <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> connex.intro comparable<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> connexE <span class="main">=</span> connex.comparable_cases

<span class="keyword1"><span class="command">lemmas</span></span> connexI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> connex.intro

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> connex_iff_semiconnex_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"connex <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> semiconnex <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> reflexive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">⟷</span> <span class="var">?t</span> <span class="main">∧</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> connex<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">using</span></span> comparable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> semiconnex <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> reflexive<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> semiconnex <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> chain_connect<span class="main">:</span> <span class="quoted"><span class="quoted">"Complete_Partial_Order.chain <span class="free">r</span> <span class="free">A</span> <span class="main">≡</span> connex <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq connex_def Complete_Partial_Order.chain_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> connex_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connex <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"connex <span class="free">Y</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connex <span class="main">(</span><span class="free">X</span><span class="main">∪</span><span class="free">Y</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connex_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> connex_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connex <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> connex <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> connex_iff_semiconnex_reflexive r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> semiconnex_cong reflexive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> total_pseudo_ordered_set <span class="main">=</span> connex <span class="main">+</span> antisymmetric
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pseudo_ordered_set <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_weak_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> comparable_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> total_pseudo_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> total_pseudo_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> antisymmetric_subset connex_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_pseudo_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"total_pseudo_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> total_pseudo_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_pseudo_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> connex_cong antisymmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> total_quasi_ordered_set <span class="main">=</span> connex <span class="main">+</span> transitive
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> quasi_ordered_set <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_quasi_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> total_quasi_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> transitive_subset connex_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_quasi_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"total_quasi_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> total_quasi_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_quasi_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> connex_cong transitive_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> total_ordered_set <span class="main">=</span> total_quasi_ordered_set <span class="main">+</span> antisymmetric
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> partially_ordered_set <span class="main">+</span> total_pseudo_ordered_set <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> total_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> total_quasi_ordered_subset antisymmetric_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> total_ordered_set.intro<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_ordered_set_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"total_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> total_ordered_set <span class="free">A</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_ordered_set_def r <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> total_quasi_ordered_set_cong antisymmetric_cong<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Well-Foundedness›</span></span>

<span class="keyword1"><span class="command">locale</span></span> well_founded <span class="main">=</span> related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> less<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> asymmetric
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> asymmetric.intro notI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">x</span> <span class="main">⟹</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prefixed_Imagep_imp_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span> <span class="main">```</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonempty_imp_ex_extremal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> QA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Q prefixed_Imagep_imp_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> QA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> well_founded <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">↾</span>UNIV <span class="main">=</span> <span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">P</span>
    <span class="keyword1"><span class="command">using</span></span> induct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Restrp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_founded UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Restrp_well_founded <span class="main">=</span> Restrp.well_founded_axioms
<span class="keyword1"><span class="command">lemmas</span></span> Restrp_induct<span class="main">[</span><span class="operator">consumes</span> 0<span class="main">,</span> <span class="operator">case_names</span> less<span class="main">]</span> <span class="main">=</span> Restrp.induct

<span class="keyword1"><span class="command">interpretation</span></span> Restrp.tranclp<span class="main">:</span> well_founded <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">↾</span> UNIV <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> induct_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> induct_step<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">y</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Restrp_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="skolem">y</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tranclp.cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> r_into_trancl
          <span class="keyword1"><span class="command">with</span></span> induct_step less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trancl_into_trancl <span class="skolem">b</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_founded UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Restrp_tranclp_well_founded <span class="main">=</span> Restrp.tranclp.well_founded_axioms
<span class="keyword1"><span class="command">lemmas</span></span> Restrp_tranclp_induct<span class="main">[</span><span class="operator">consumes</span> 0<span class="main">,</span> <span class="operator">case_names</span> less<span class="main">]</span> <span class="main">=</span> Restrp.tranclp.induct

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_foundedI_pf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span> <span class="main">```</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">¬</span><span class="skolem">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span> <span class="main">```</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">¬</span><span class="skolem">P</span> <span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pre<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> aA
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_foundedI_extremal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> well_foundedI_pf<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span> <span class="main">```</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a<span class="main">[</span><span class="operator">OF</span> XA<span class="main">]</span> pf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Imagep_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_iff_ex_extremal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">X</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">z</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> well_founded.nonempty_imp_ex_extremal well_foundedI_extremal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟷</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">r'</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟷</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> well_founded <span class="free">A'</span> <span class="free">r'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A'</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> well_foundedI_extremal<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r'</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> X0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> xX X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r'</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> xX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> well_founded.nonempty_imp_ex_extremal<span class="main">[</span><span class="operator">OF</span> wf _ this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r'</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI notI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> yX X <span class="keyword1"><span class="command">have</span></span> yA'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> x Ar<span class="main">[</span><span class="operator">OF</span> yX<span class="main">]</span> yx r <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> yA' x A<span class="main">[</span><span class="operator">OF</span> yx<span class="main">]</span> r X <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r'</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A'</span> <span class="free">r'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> well_foundedI_extremal<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> <span class="free">A'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> X0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> xX X B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r in_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> xX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> well_founded.nonempty_imp_ex_extremal<span class="main">[</span><span class="operator">OF</span> wf _ this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="free">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">r'</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI notI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> yX X <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> x Ar<span class="main">[</span><span class="operator">OF</span> yX<span class="main">]</span> yx r X y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> y x A yx r X <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wfP_iff_well_founded_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"wfP <span class="free">r</span> <span class="main">⟷</span> well_founded UNIV <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wfP_def wf_def well_founded_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">r</span> <span class="free">x</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> well_founded_iff_ex_extremal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_Restrp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="main">(</span><span class="free">r</span><span class="main">↾</span><span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> well_founded <span class="main">(</span><span class="free">A</span><span class="main">∩</span><span class="free">B</span><span class="main">)</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI well_foundedI_extremal<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XAB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> l<span class="main">[</span><span class="operator">THEN</span> well_founded.nonempty_imp_ex_extremal<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">r</span> <span class="main">↾</span> <span class="free">B</span><span class="main">)</span> <span class="bound">z</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> XAB <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Restrp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">r</span> <span class="main">↾</span> <span class="free">B</span><span class="main">)</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> r<span class="main">[</span><span class="operator">THEN</span> well_founded.nonempty_imp_ex_extremal<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> XA X0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">-</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">r</span> <span class="main">↾</span> <span class="free">B</span><span class="main">)</span> <span class="bound">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> well_founded<span class="main">)</span> well_founded_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms well_founded_axioms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> well_founded_iff_ex_extremal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">¬</span><span class="bound">b</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> well_foundedI_extremal<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> well_founded <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> well_founded <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XAB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> XAB <span class="keyword1"><span class="command">have</span></span> XB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> B.nonempty_imp_ex_extremal<span class="main">[</span><span class="operator">OF</span> XB X0<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> A.nonempty_imp_ex_extremal<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> XAe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span> <span class="main">∩</span> <span class="free">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">x</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> XAe xX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> xX XAB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> AB eA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> eX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> closed_UN_well_founded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> XX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">XX</span><span class="main">.</span> well_founded <span class="bound">X</span> <span class="main"><span class="free">(⊏)</span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">⋃</span><span class="free">XX</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="main">(</span><span class="main">⋃</span><span class="free">XX</span><span class="main">)</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> well_foundedI_extremal<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">XX</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">X</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">⋃</span><span class="free">XX</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword1"><span class="command">using</span></span> XX <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span>
  <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="free">XX</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> S0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">XX</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> xS xX <span class="keyword1"><span class="command">have</span></span> Sx0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∩</span> <span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> X XX <span class="keyword1"><span class="command">interpret</span></span> well_founded <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> nonempty_imp_ex_extremal<span class="main">[</span><span class="operator">OF</span> _ Sx0<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> zS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ zS<span class="main"><span class="main">]</span></span> ballI notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> yS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊏</span></span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> yXX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="free">XX</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S yS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> X zX yXX yz<span class="main">]</span> yS <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> min yz <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_cmono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_founded <span class="free">A</span> <span class="free">r'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> well_foundedI_extremal<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> well_founded.nonempty_imp_ex_extremal<span class="main">[</span><span class="operator">OF</span> wf this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r'</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> well_founded_ordered_set <span class="main">=</span> well_founded <span class="main">+</span> transitive _ <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> strict_ordered_set<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> Restrp<span class="main">:</span> strict_ordered_set <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span> <span class="main">+</span> Restrp<span class="main">:</span> well_founded <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Restrp_strict_order Restrp_well_founded <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Restrp_well_founded_order<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded_ordered_set UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_founded_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> well_founded_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">using</span></span> well_founded_subset transitive_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> well_founded<span class="main">)</span> Restrp_tranclp_well_founded_ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"well_founded_ordered_set UNIV <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span><span class="main">↾</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Restrp_tranclp_well_founded tranclp_transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

<span class="keyword1"><span class="command">locale</span></span> well_related_set <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonempty_imp_ex_extreme<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">e</span><span class="main">.</span> extreme <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="bound">e</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> connex
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> nonempty_imp_ex_extreme<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> connex_axioms <span class="main">=</span> connex_axioms

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> asym<span class="main">:</span> well_founded <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊏)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> well_founded_iff_ex_extremal<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> nonempty_imp_ex_extreme<span class="main">[</span><span class="operator">OF</span> XA X0<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme <span class="skolem">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">¬</span><span class="bound">z</span> <span class="main">⊏</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_related_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> well_related_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> well_related_set.intro nonempty_imp_ex_extreme<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_related_iff_neg_well_founded<span class="main">:</span>
  <span class="quoted"><span class="quoted">"well_related_set <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> well_founded <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> well_related_set_def well_founded_iff_ex_extremal extreme_def Bex_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> well_related_singleton_refl<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> well_related_set.intro exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_singleton_iff assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_UN_well_related<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> XX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">XX</span><span class="main">.</span> well_related_set <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">⋃</span><span class="free">XX</span><span class="main">.</span> <span class="main">¬</span><span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="main">(</span><span class="main">⋃</span><span class="free">XX</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> XX
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> well_related_iff_neg_well_founded<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> closed_UN_well_founded<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span>"</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_related_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> well_founded_extend<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> well_related_iff_neg_well_founded<span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">locale</span></span> pre_well_ordered_set <span class="main">=</span> semiattractive <span class="main">+</span> well_related_set
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> transitive
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x y z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> extreme <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="bound">e</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">e</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonempty_imp_ex_extreme<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="var">?P</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="var">?P</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> attract<span class="main">[</span><span class="operator">OF</span> xy this yz<span class="main">]</span> x y z <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> attract<span class="main">[</span><span class="operator">OF</span> yz zy zx<span class="main">]</span> x y z <span class="keyword1"><span class="command">have</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> attract<span class="main">[</span><span class="operator">OF</span> xy yx yz<span class="main">]</span> x y z <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> total_quasi_ordered_set<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> connex_axioms <span class="main">=</span> connex_axioms

<span class="keyword1"><span class="command">lemma</span></span> strict_weak_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> asympartpI notI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> trans xy yz x y z <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> trans<span class="main">[</span><span class="operator">OF</span> yz this<span class="main">]</span> y z x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> weak_strict_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> asympartpI notI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> trans xy yz x y z <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> trans<span class="main">[</span><span class="operator">OF</span> this xy<span class="main">]</span> z x y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> yz <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pre_well_ordered_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pre_well_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> total_quasi_ordered_set <span class="free">A</span> <span class="free">r</span> <span class="main">∧</span> well_founded <span class="free">A</span> <span class="main">(</span>asympartp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⟷</span> <span class="var">?t</span> <span class="main">∧</span> <span class="var">?w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> pre_well_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">r</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> total_quasi_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">r</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_founded UNIV <span class="main">(</span>asympartp <span class="free">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"asympartp <span class="free">r</span> <span class="main">↾</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">r</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">↾</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_iff_asym<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> well_related_iff_neg_well_founded<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semiattractive<span class="main">)</span> pre_well_ordered_iff_well_related<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_well_ordered_set <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> well_related_set <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> semiattractive <span class="quoted"><span class="free">X</span></span> <span class="keyword1"><span class="command">using</span></span> semiattractive_subset<span class="main">[</span><span class="operator">OF</span> XA<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> pre_well_ordered_set <span class="quoted"><span class="free">X</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_related_set <span class="quoted"><span class="free">X</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semiattractive_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"semiattractive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"semiattractive <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"semiattractive <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> semiattractive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> semiattractive <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> yB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> AB<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> zA yB<span class="main">]</span> yz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> semiattractive.intro <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>* AB<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> A.attract B.attract<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pre_well_order_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_well_ordered_set <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_well_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_well_ordered_set <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> pre_well_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> pre_well_ordered_set <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> pre_well_ordered_set.intro well_related_extend semiattractive_extend<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> AB<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> well_ordered_set <span class="main">=</span> antisymmetric <span class="main">+</span> well_related_set
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pre_well_ordered_set<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> total_ordered_set<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_ordered_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> well_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> well_related_subset antisymmetric_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> well_ordered_set.intro<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> connex_axioms <span class="main">=</span> connex_axioms

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> antisymmetric<span class="main">)</span> well_ordered_iff_well_related<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> well_related_set <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> antisymmetric <span class="quoted"><span class="free">X</span></span> <span class="keyword1"><span class="command">using</span></span> antisymmetric_subset<span class="main">[</span><span class="operator">OF</span> XA<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">X</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_related_set <span class="quoted"><span class="free">X</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less_eq</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> well_related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> trivial_well_related <span class="main">=</span> well_related_set_axioms

<span class="keyword1"><span class="command">lemma</span></span> trivial_pre_well_order<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_well_ordered_set <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> well_order_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="free">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ABa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> well_ordered_set.intro antisymmetric_union well_related_extend ABa AB<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> singleton<span class="main">:</span> antisymmetric <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> singleton_antisymmetric<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> singleton.antisymmetric_axioms

<span class="keyword1"><span class="command">lemma</span></span> singleton_well_ordered<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">a</span> <span class="main">⟹</span> well_ordered_set <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_UN_well_ordered<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> anti<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="main">(</span><span class="main">⋃</span> <span class="free">XX</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> XX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">XX</span><span class="main">.</span> well_ordered_set <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">⋃</span><span class="free">XX</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="main">(</span><span class="main">⋃</span><span class="free">XX</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> well_ordered_set.intro closed_UN_well_related anti<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> XX well_ordered_set.axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Directed sets:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">directed</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">y</span> <span class="bound">z</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> directedI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> directed_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> directedD <span class="main">=</span> directed_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> directedE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"directed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> directedD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> directed_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="main">{}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> directed_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dX<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dY<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">Y</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"directed <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> directedD<span class="main">[</span><span class="operator">OF</span> dX<span class="main">]</span> directedD<span class="main">[</span><span class="operator">OF</span> dY<span class="main">]</span> XY
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> directedI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> directed_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">X</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">Y</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"directed <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> directedD<span class="main">[</span><span class="operator">OF</span> Y yY yY<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> zY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> xX XY zY yz <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> directed_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X Y<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> connex <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> directed<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> comparable_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> le
    <span class="keyword1"><span class="command">with</span></span> refl<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span> y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ge
    <span class="keyword1"><span class="command">with</span></span> refl<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ir</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'i</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_connex_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">I</span> <span class="main"><span class="free">(≼)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> connex<span class="main">:</span> <span class="quoted"><span class="quoted">"connex <span class="free">I</span> <span class="main"><span class="free">(≼)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connex <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> connexI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> connex ij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">j</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> connexE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ij mono <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> monotone_onD<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_directed_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">I</span> <span class="main"><span class="free">(≼)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dir<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">I</span> <span class="main"><span class="free">(≼)</span></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"directed <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> directedI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> dir <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> directedE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> mono x y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> monotone_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> z <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fz</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">fz</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">fz</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Order Pairs›</span></span>

<span class="keyword1"><span class="command">locale</span></span> compatible <span class="main">=</span> related_set <span class="main">+</span> related_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">less</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compat_right<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compat_left<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">z</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> compatible_ordering <span class="main">=</span> reflexive <span class="main">+</span> irreflexive <span class="main">+</span> compatible <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> strict_implies_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The strict part is necessarily transitive.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following sequence of declarations are in order to obtain fact names in a manner
similar to the Isabelle/HOL facts of orders.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> strict<span class="main">:</span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compat_right<span class="main">[</span><span class="operator">OF</span> strict_implies_weak<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">sublocale</span></span> strict_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">thm</span></span> strict.trans asym irrefl

<span class="keyword1"><span class="command">lemma</span></span> strict_implies_not_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irrefl compat_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> transitive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asym_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> attractive_ordering <span class="main">=</span> compatible_ordering <span class="main">+</span> attractive

<span class="keyword1"><span class="command">locale</span></span> pseudo_ordering <span class="main">=</span> compatible_ordering <span class="main">+</span> pseudo_ordered_set
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> attractive_ordering <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> quasi_ordering <span class="main">=</span> compatible_ordering <span class="main">+</span> quasi_ordered_set
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> attractive_ordering <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> partial_ordering <span class="main">=</span> compatible_ordering <span class="main">+</span> partially_ordered_set
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pseudo_ordering <span class="main">+</span> quasi_ordering <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> well_founded_ordering <span class="main">=</span> quasi_ordering <span class="main">+</span> well_founded

<span class="keyword1"><span class="command">locale</span></span> total_ordering <span class="main">=</span> compatible_ordering <span class="main">+</span> total_ordered_set
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> partial_ordering <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> strict_total_ordering <span class="main">=</span> partial_ordering <span class="main">+</span> semiconnex <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> semiconnex_irreflexive <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> connex
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x y<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> strict_implies_weak<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> total_ordering <span class="keyword1"><span class="command">..</span></span>
<span class="comment1">(*
sublocale old: ordering "(⊑)" "(⊏)"
proof-
  have "a ⊑ b ⟹ a ≠ b ⟹ a ⊏ b" for a b
    by (cases a b rule: cases, auto dest: strict_implies_weak)
  then show "ordering (⊑) (⊏)"
    by (unfold_locales, auto dest:strict_implies_weak trans)
qed
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_weak<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main"><span class="free">⊏</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_implies_not_weak <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> strict_implies_weak<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">x</span> <span class="main"><span class="free">⊏</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> not_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relating to Classes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In Isabelle 2020, we should declare sublocales in class before declaring dual
sublocales, since otherwise facts would be prefixed by ``dual.dual.''›</span></span>

<span class="keyword1"><span class="command">context</span></span> ord <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">least</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">least</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> extreme <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">greatest</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">greatest</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> extreme <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(≤)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">supremum</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">supremum</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> least <span class="main">(</span>Collect <span class="main">(</span>bound <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(≤)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">infimum</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">infimum</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> greatest <span class="main">(</span>Collect <span class="main">(</span>bound <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Least_eq_The_least<span class="main">:</span> <span class="quoted"><span class="quoted">"Least <span class="free">P</span> <span class="main">=</span> The <span class="main">(</span>least <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Least_def extreme_def<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> atomize_eq<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> ext<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Greatest_eq_The_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"Greatest <span class="free">P</span> <span class="main">=</span> The <span class="main">(</span>greatest <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Greatest_def extreme_def<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> atomize_eq<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> ext<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ball_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">=</span> All"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> Bex_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">=</span> Ex"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">class</span></span> compat <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatible_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> compatible_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compat_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.compat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We should have imported locale-based facts in classes, e.g.:›</span></span>
<span class="keyword1"><span class="command">thm</span></span> order.trans order.strict.trans order.refl order.irrefl order.asym order.extreme_bound_singleton

<span class="keyword1"><span class="command">class</span></span> attractive_order <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"attractive_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We need to declare subclasses before sublocales in order to preserve facts for superclasses.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> attractive_ordering <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">using</span></span> attractive_order_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.attractive_order_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> compat <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> attractive_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">thm</span></span> order.extreme_bound_quasi_const

<span class="keyword1"><span class="command">class</span></span> psorder <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pseudo_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> pseudo_ordering <span class="quoted">UNIV</span> <span class="keyword1"><span class="command">using</span></span> psorder_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.psorder_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> attractive_order <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> pseudo_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> qorder <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quasi_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> quasi_ordering <span class="quoted">UNIV</span> <span class="keyword1"><span class="command">using</span></span> qorder_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.qorder_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> attractive_order <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> quasi_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> porder <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partial_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> partial_ordering <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">using</span></span> porder_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.porder_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> psorder <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">subclass</span></span> qorder <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> partial_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> wf_qorder <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_founded_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> well_founded_ordering <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">using</span></span> wf_qorder_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.wf_qorder_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> qorder <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> well_founded_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> totalorder <span class="main">=</span> ord <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total_ordering UNIV <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> total_ordering <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">using</span></span> totalorder_axioms <span class="keyword1"><span class="command">unfolding</span></span> class.totalorder_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> porder <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> total_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Isabelle/HOL's <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> preorder<span class="antiquote"><span class="antiquote">}</span></span></span></span> belongs to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> qorder<span class="antiquote"><span class="antiquote">}</span></span></span></span>, but not vice versa.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> preorder<span class="main">)</span> qorder
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> order_refl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> le_less_trans <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">using</span></span> less_le_trans <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">using</span></span> less_imp_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">using</span></span>  order_trans <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> order<span class="main">)</span> porder <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wellorder<span class="main">)</span> wf_qorder
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Isabelle/HOL's <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> linorder<span class="antiquote"><span class="antiquote">}</span></span></span></span> is equivalent to our locale <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> strict_total_ordering<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">context</span></span> linorder <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> strict_total_ordering <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subclass</span></span> totalorder <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> order<span class="main">:</span> strict_total_ordering <span class="quoted">UNIV</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> UNIV <span class="main">≡</span> True"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">↾</span> UNIV <span class="main">≡</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> True <span class="main">∧</span> <span class="bound">P</span> <span class="main">≡</span> <span class="bound">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ball UNIV <span class="main">≡</span> All"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Bex UNIV <span class="main">≡</span> Ex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(≤)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main">(≤)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">PROP</span> <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="bound">P1</span><span class="main">)</span> <span class="main">≡</span> Trueprop <span class="bound">P1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span>True <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">PROP</span> <span class="bound">P1</span> <span class="main">⟹</span> <span class="keyword1">PROP</span> <span class="bound">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Tests: facts should be available in the most general classes.›</span></span>

<span class="keyword1"><span class="command">thm</span></span> order.strict.trans<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>compat"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> order.extreme_bound_quasi_const<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>attractive_order"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> order.extreme_bound_singleton_eq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>psorder"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> order.trans<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>qorder"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> order.comparable_cases<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>totalorder"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> order.cases<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder"</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Declaring Duals›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> reflexive <span class="main">⊆</span> sym<span class="main">:</span> reflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span>sympartp <span class="bound">r</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span> <span class="main">≡</span> sympartp <span class="main">(</span><span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>atomize_eq<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> quasi_ordered_set <span class="main">⊆</span> sym<span class="main">:</span> quasi_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(</span>sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹At this point, we declare dual as sublocales.
In the following, ``rewrites'' eventually cleans up redundant facts.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> reflexive <span class="main">⊆</span> dual<span class="main">:</span> reflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">≡</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span><span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">↾</span> <span class="free">A</span> <span class="main">≡</span> <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> attractive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dual<span class="main">:</span> attractive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊒)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main">(⊒)</span> <span class="main">=</span> <span class="main">(∼)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equivpartp <span class="main">(⊒)</span> <span class="main">≡</span> <span class="main">(</span><span class="main">≃</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span><span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span> <span class="main">↾</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> sympartp <span class="main">(</span>sympartp <span class="bound">r</span><span class="main">)</span> <span class="main">≡</span> sympartp <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">↾</span> <span class="free">A</span> <span class="main">≡</span> <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> attract dual.attract <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> irreflexive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dual<span class="main">:</span> irreflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">↾</span> <span class="free">A</span> <span class="main">≡</span> <span class="main">(</span><span class="main"><span class="free">(⊏)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> irrefl <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> transitive <span class="main">⊆</span> dual<span class="main">:</span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">↾</span> <span class="free">A</span> <span class="main">≡</span> <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"asympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span>asympartp <span class="main"><span class="free">(⊑)</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> antisymmetric <span class="main">⊆</span> dual<span class="main">:</span> antisymmetric <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">↾</span> <span class="free">A</span> <span class="main">≡</span> <span class="main">(</span><span class="main"><span class="free">(⊑)</span></span> <span class="main">↾</span> <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atomize_eq<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> semiconnex <span class="main">⊆</span> dual<span class="main">:</span> semiconnex <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> semiconnex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> connex <span class="main">⊆</span> dual<span class="main">:</span> connex <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> chainI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>comparable<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> semiconnex_irreflexive <span class="main">⊆</span> dual<span class="main">:</span> semiconnex_irreflexive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊏)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pseudo_ordered_set <span class="main">⊆</span> dual<span class="main">:</span> pseudo_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> quasi_ordered_set <span class="main">⊆</span> dual<span class="main">:</span> quasi_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> partially_ordered_set <span class="main">⊆</span> dual<span class="main">:</span> partially_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> total_pseudo_ordered_set <span class="main">⊆</span> dual<span class="main">:</span> total_pseudo_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> total_quasi_ordered_set <span class="main">⊆</span> dual<span class="main">:</span> total_quasi_ordered_set <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> compatible_ordering <span class="main">⊆</span> dual<span class="main">:</span> compatible_ordering <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compat_left compat_right strict_implies_weak<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> attractive_ordering <span class="main">⊆</span> dual<span class="main">:</span> attractive_ordering <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pseudo_ordering <span class="main">⊆</span> dual<span class="main">:</span> pseudo_ordering <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> quasi_ordering <span class="main">⊆</span> dual<span class="main">:</span> quasi_ordering <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> partial_ordering <span class="main">⊆</span> dual<span class="main">:</span> partial_ordering <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> total_ordering <span class="main">⊆</span> dual<span class="main">:</span> total_ordering <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊏)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sympartp <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> sympartp <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> 0 4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> antisymmetric<span class="main">)</span> monotone_extreme_imp_extreme_bound_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ir</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">C</span> <span class="main"><span class="free">(≼)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">C</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">C</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual.extreme_unique monotone_extreme_extreme_boundI<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instantiations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, we instantiate our classes for sanity check.›</span></span>

<span class="keyword1"><span class="command">instance</span></span> nat <span class="main">::</span> <span class="quoted">linorder</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pointwise ordering of functions are compatible only if the weak part is transitive.›</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span><span class="quoted">qorder</span><span class="main">)</span> <span class="quoted">compat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> le_fun_def less_fun_def
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI le_funI notI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>order.trans<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">assume</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> gh <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">&lt;</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≤</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI le_funI notI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≤</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> fg <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">&lt;</span> <span class="skolem">g</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">f</span> <span class="main">&lt;</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span><span class="quoted">qorder</span><span class="main">)</span> <span class="quoted">qorder</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_fun_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> order.trans<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span><span class="quoted">porder</span><span class="main">)</span> <span class="quoted">porder</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≤</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> le_funE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> order.antisym<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Complete_Relations">
<div class="head">
<h1>Theory Complete_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Akihisa Yamada (2018-2021)
License: LGPL (see file COPYING.LESSER)
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Completeness of Relations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we formalize various order-theoretic completeness conditions.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Complete_Relations
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Binary_Relations.html">Binary_Relations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness Conditions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Order-theoretic completeness demands certain subsets of elements to admit suprema or infima.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complete</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">-complete</span>"</span><span class="main">[</span>999<span class="main">]</span>1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">CC</span></span></span><span class="keyword1"><span class="free">-complete</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound"><span class="bound">X</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">CC</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">X</span> <span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> completeI <span class="main">=</span> complete_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> completeD <span class="main">=</span> complete_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> complete_cmono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="main">⊆</span> <span class="free">DD</span> <span class="main">⟹</span> <span class="free">DD</span><span class="keyword1">-complete</span> <span class="main">≤</span> <span class="free">CC</span><span class="keyword1">-complete</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> complete_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="main">{}</span> <span class="free">r</span> <span class="main">⟷</span> <span class="main">{}</span> <span class="main">∉</span> <span class="free">CC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A related set $\tp{A,\SLE}$ is called \emph{topped} if there is a ``top'' element $\top \in A$,
a greatest element in $A$.
Note that there might be multiple tops if $(\SLE)$ is not antisymmetric.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">extremed</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">e</span><span class="main">.</span> extreme <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">e</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extremed_imp_ex_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"extremed <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> bound <span class="free">X</span> <span class="free">r</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extremed_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Toppedness can be also seen as a completeness condition,
since it is equivalent to saying that the universe has a supremum.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extremed_iff_UNIV_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"extremed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> <span class="main">{</span><span class="free">A</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extremed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">A</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> completeD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">A</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extremed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The dual notion of topped is called ``pointed'', equivalently ensuring a supremum
of the empty set.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pointed_iff_empty_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"extremed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_def extremed_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹One of the most well-studied notion of completeness would be the semilattice condition:
every pair of elements $x$ and $y$ has a supremum $x \sqcup y$
(not necessarily unique if the underlying relation is not antisymmetric).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pair_complete</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="main">|.</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">}</span><span class="keyword1">-complete</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pair_completeI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="free">r</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_complete_def complete_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pair_completeD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="free">r</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="bound">s</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> pair_complete_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pair_complete_imp_directed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"directed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> pair_completeD<span class="main">[</span><span class="operator">OF</span> comp this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> connex<span class="main">)</span> pair_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pair_completeI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>comparable_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> le
    <span class="keyword1"><span class="command">with</span></span> x y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ge
    <span class="keyword1"><span class="command">with</span></span> x y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next one assumes that every nonempty finite set has a supremum.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">finite_complete</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> finite <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span><span class="keyword1">-complete</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_complete_le_pair_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_complete <span class="main">≤</span> pair_complete"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pair_complete_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> complete_cmono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next one assumes that every nonempty bounded set has a supremum.
It is also called the Dedekind completeness.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">conditionally_complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> bound <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conditionally_complete_imp_nonempty_imp_ex_extreme_bound_iff_ex_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"conditionally_complete <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="free">r</span> <span class="free">X</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> bound <span class="free">X</span> <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $\omega$-completeness condition demands a supremum for an $\omega$-chain,
  $a_1 \sqsubseteq a_2 \sqsubseteq \dots$.
  We model $\omega$-chain as the range of a monotone map $f : i \mapsto a_i$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">omega_complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span>range <span class="bound">f</span> <span class="main">|</span> <span class="bound">f</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">.</span> monotone <span class="main">(≤)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">f</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> transitive<span class="main">)</span> local_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">C</span> <span class="bound">i</span> <span class="main"><span class="free">⊑</span></span> <span class="free">C</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> monotone <span class="main">(&lt;)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI allI monotoneI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> loc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">C</span> <span class="bound">i</span> <span class="main"><span class="free">⊑</span></span> <span class="free">C</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="skolem">i</span> <span class="main"><span class="free">⊑</span></span> <span class="free">C</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> loc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="free">⊑</span></span> <span class="free">C</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="skolem">k</span><span class="main">+</span>Suc <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> CA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> ij <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="skolem">i</span> <span class="main"><span class="free">⊑</span></span> <span class="free">C</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"monotone <span class="main">(&lt;)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="skolem">i</span> <span class="main"><span class="free">⊑</span></span> <span class="free">C</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> monotoneD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\emph{Directed completeness} is an important notion in domain theory~\cite{abramski94},
asserting that every nonempty directed set has a supremum.
Here, a set $X$ is \emph{directed} if any pair of two elements in $X$ has a bound in $X$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">directed_complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_directed_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"directed_complete <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dir<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">I</span> <span class="free">ri</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> I0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">I</span> <span class="free">ri</span> <span class="free">r</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> directed_complete_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> fI<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> monotone_directed_image<span class="main">[</span><span class="operator">OF</span> mono dir<span class="main">]</span> I0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next one is quite complete, only the empty set may fail to have a supremum.
The terminology follows \cite{Bergman2015},
although there it is defined more generally depending on a cardinal $\alpha$
such that a nonempty set $X$ of cardinality below $\alpha$ has a supremum.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">semicomplete</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span><span class="keyword1">-complete</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semicomplete_nonempty_imp_extremed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"semicomplete <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> extremed <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> extremed_iff_UNIV_complete
  <span class="keyword1"><span class="command">using</span></span> complete_cmono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">A</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> connex_dual_semicomplete<span class="main">:</span> <span class="quoted"><span class="quoted">"semicomplete <span class="main">{</span><span class="bound">C</span><span class="main">.</span> connex <span class="bound">C</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊇)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> CollectE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> connex <span class="bound">C</span> <span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"connex <span class="main">(</span><span class="main">⋂</span><span class="skolem">X</span><span class="main">)</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="main">{</span><span class="bound">C</span><span class="main">.</span> connex <span class="bound">C</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊇)</span> <span class="skolem">X</span> <span class="main">(</span><span class="main">⋂</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> extreme_bound <span class="main">{</span><span class="bound">C</span><span class="main">.</span> connex <span class="bound">C</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊇)</span> <span class="skolem">X</span> <span class="bound">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pointed Ones›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The term `pointed' refers to the dual notion of toppedness, i.e., there is a global least element.
  This serves as the supremum of the empty set.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complete_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">CC</span> <span class="main">∪</span> <span class="free">CC'</span><span class="main">)</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">CC'</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pointed_directed_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="free">r</span> <span class="main">⟷</span> directed_complete <span class="free">A</span> <span class="free">r</span> <span class="main">∧</span> extremed <span class="free">A</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∨</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> directed_complete_def pointed_iff_empty_complete complete_union<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Un_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹``Bounded complete'' refers to pointed conditional complete,
but this notion is just the dual of semicompleteness. We prove this later.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bounded_complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> bound <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">b</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relations between Completeness Conditions›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pair-completeness implies that the universe is directed. Thus, with directed completeness
implies toppedness.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> directed_complete_pair_complete_imp_extremed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dc<span class="main">:</span> <span class="quoted"><span class="quoted">"directed_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extremed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">A</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dc<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> directed_complete_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> pair_complete_imp_directed<span class="main">[</span><span class="operator">OF</span> pc<span class="main">]</span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">A</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extremed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Semicomplete is conditional complete and topped.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> semicomplete_iff_conditionally_complete_extremed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"semicomplete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> conditionally_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> extremed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span> <span class="quoted"><span class="quoted">"conditionally_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"extremed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mem_Collect_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> extremed_imp_ex_bound<span class="main">[</span><span class="operator">OF</span> e X<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">X</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cc X<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">with</span></span> semicomplete_nonempty_imp_extremed<span class="main">[</span><span class="operator">OF</span> l<span class="main">]</span> A
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> completeD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> complete_iff_pointed_semicomplete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> semicomplete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> extremed <span class="free">A</span> <span class="main">(⊒)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pointed_iff_empty_complete complete_union<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Un_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Conditional completeness only lacks top and bottom to be complete.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> complete_iff_conditionally_complete_extremed_pointed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> conditionally_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> extremed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> extremed <span class="free">A</span> <span class="main">(⊒)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complete_iff_pointed_semicomplete
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> extremed_imp_ex_bound<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> semicomplete_iff_conditionally_complete_extremed
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>completeI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If the universe is directed, then every pair is bounded, and thus has a supremum.
  On the other hand, supremum gives an upper bound, witnessing directedness.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> conditionally_complete_imp_pair_complete_iff_directed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"conditionally_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> directed <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pair_completeI completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> directedE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pc<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> directedI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> pc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> pair_completeD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Following is a new generalization of (weak) chain-completeness:›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">well_complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> well_related_set <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Duality of Completeness Conditions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Conditional completeness is symmetric.›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conditionally_complete_dual<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"conditionally_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conditionally_complete <span class="free">A</span> <span class="main">(⊒)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> CollectE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">b</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> bound <span class="skolem">X</span> <span class="main">(⊒)</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> bound <span class="skolem">X</span> <span class="main">(⊒)</span> <span class="bound">b</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> in_mono<span class="main">[</span><span class="operator">OF</span> XA<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> bound <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> comp<span class="main">[</span><span class="operator">THEN</span> completeD<span class="main">,</span> <span class="operator">OF</span> B<span class="main">]</span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">B</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> in_mono<span class="main">[</span><span class="operator">OF</span> XA<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main">(⊒)</span> <span class="skolem">X</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> extremeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Full completeness is symmetric.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complete_dual<span class="main">:</span>
  <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟹</span> UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main">(⊒)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> complete_iff_conditionally_complete_extremed_pointed<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> conditionally_complete_dual <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we show that bounded completeness is the dual of semicompleteness.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pointed_conditionally_complete_iff_bounded_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conditionally_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> extremed <span class="free">A</span> <span class="main">(⊒)</span> <span class="main">⟷</span> bounded_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pointed_iff_empty_complete<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> complete_union<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Un_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">CC</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">CC</span></span><span class="keyword1"><span class="keyword1">-complete</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="free"><span class="main"><span class="free">(⊑)</span></span></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">proposition</span></span> bounded_complete_iff_dual_semicomplete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bounded_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> semicomplete <span class="free">A</span> <span class="main">(⊒)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pointed_conditionally_complete_iff_bounded_complete<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> semicomplete_iff_conditionally_complete_extremed<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Complete_Relations.conditionally_complete_dual <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> connex_bounded_complete <span class="main">=</span> connex_dual_semicomplete<span class="main">[</span><span class="operator">folded</span> bounded_complete_iff_dual_semicomplete<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness Results Requiring Order-Like Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Above results hold without any assumption on the relation.
This part demands some order-like properties.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It is well known that in a semilattice, i.e., a pair-complete partial order,
every finite nonempty subset of elements has a supremum.
We prove the result assuming transitivity, but only that.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> transitive<span class="main">)</span> pair_complete_iff_finite_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> finite_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> CollectE conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> pc<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span> <span class="main">⟹</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> Ex <span class="main">(</span>extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pc<span class="main">[</span><span class="operator">THEN</span> pair_completeD<span class="main">,</span> <span class="operator">OF</span> x x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">X</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> pc<span class="main">[</span><span class="operator">THEN</span> pair_completeD<span class="main">]</span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bX<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="skolem">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI extreme_boundI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xb</span> <span class="keyword3"><span class="command">assume</span></span> xb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> bound_trans<span class="main">[</span><span class="operator">OF</span> bX bc X bA cA<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">c</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> xb xc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> cA<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> finite_complete_le_pair_complete<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Gierz et al.~\cite{gierz03} showed that a directed complete partial order is semicomplete
if and only if it is also a semilattice.
We generalize the claim so that the underlying relation is only transitive.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> transitive<span class="main">)</span> semicomplete_iff_directed_complete_pair_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"semicomplete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> directed_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> directed_complete_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeI pair_completeI completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dc<span class="main">:</span> <span class="quoted"><span class="quoted">"directed_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> pair_complete_iff_finite_complete <span class="keyword1"><span class="command">have</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> CollectE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">Y</span></span> <span class="main">⊆</span> <span class="skolem">X</span><span class="main">.</span> finite <span class="bound">Y</span> <span class="main">∧</span> <span class="bound">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="bound">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"directed <span class="var">?B</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> directedI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Y</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">B</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> XA Y B <span class="keyword1"><span class="command">have</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> fc<span class="main">[</span><span class="operator">THEN</span> completeD<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">c</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Y B c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_bound_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> AB c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> fc<span class="main">[</span><span class="operator">THEN</span> completeD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> XA
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xX <span class="keyword1"><span class="command">have</span></span> x'B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> extreme_boundI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> dc<span class="main">[</span><span class="operator">unfolded</span> directed_complete_def<span class="main">,</span> <span class="operator">THEN</span> completeD<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span> 1 2
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="var">?B</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI extreme_boundI UNIV_I<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> XA fc<span class="main">[</span><span class="operator">THEN</span> completeD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> c xX <span class="keyword1"><span class="command">have</span></span> cB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> extreme_boundI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> xX XA cA bA trans<span class="main">[</span><span class="operator">OF</span> xc cb<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Here transitivity is needed. ›</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Xx<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="skolem">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="var">?B</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> boundI UNIV_I<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">Y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Y</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> YX Xx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">Y</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> c xA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> b xA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> bA<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The last argument in the above proof requires transitivity,
but if we had reflexivity then $x$ itself is a supremum of $\set{x}$
(see <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> reflexive.extreme_bound_singleton<span class="antiquote"><span class="antiquote">}</span></span></span></span>) and so $x \SLE s$ would be immediate.
Thus we can replace transitivity by reflexivity,
but then pair-completeness does not imply finite completeness.
We obtain the following result.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> reflexive<span class="main">)</span> semicomplete_iff_directed_complete_finite_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"semicomplete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟷</span> directed_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span> finite_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> directed_complete_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeI pair_completeI completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dc<span class="main">:</span> <span class="quoted"><span class="quoted">"directed_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> CollectE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">Y</span></span> <span class="main">⊆</span> <span class="skolem">X</span><span class="main">.</span> finite <span class="bound">Y</span> <span class="main">∧</span> <span class="bound">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="bound">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"directed <span class="var">?B</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> directedI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Y</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">B</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> XA Y B <span class="keyword1"><span class="command">have</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> fc<span class="main">[</span><span class="operator">THEN</span> completeD<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">c</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Y B c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_bound_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> AB c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> extreme_bound_singleton<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> xX <span class="keyword1"><span class="command">have</span></span> xB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> dc<span class="main">[</span><span class="operator">unfolded</span> directed_complete_def<span class="main">,</span> <span class="operator">THEN</span> completeD<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span> B 1 2
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="var">?B</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI extreme_boundI UNIV_I<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> extreme_bound_singleton<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> x xX <span class="keyword1"><span class="command">have</span></span> cB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> Xx<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="skolem">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="var">?B</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> boundI UNIV_I<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">Y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Y</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> YX Xx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">Y</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> YX XA xA c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> xA b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> bA<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relating to Classes›</span></span>

<span class="comment1">(* HOL.Conditionally_Complete_Lattices imports choice.

text ‹Isabelle's class @{class conditionally_complete_lattice} satisfies @{const conditionally_complete}.
The other direction does not hold, since for the former,
@{term "Sup {}"} and @{term "Inf {}"} are arbitrary even if there are top or bottom elements.›

lemma (in conditionally_complete_lattice) "conditionally_complete UNIV (≤)"
proof (intro completeI, elim CollectE)
  fix X :: "'a set"
  assume "∃b∈UNIV. bound X (≤) b ∧ X ≠ {}"
  then have bdd:"bdd_above X" and X0: "X ≠ {}" by (auto 0 3)
  from cSup_upper[OF _ bdd] cSup_least[OF X0]
  have "supremum X (Sup X)" by (intro extremeI boundI, auto)
  then show "∃s. least {b ∈ UNIV. bound X (≤) b} s" by auto
qed
*)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Isabelle's class <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> complete_lattice<span class="antiquote"><span class="antiquote">}</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1"><span class="keyword1">-complete</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> complete_lattice<span class="main">)</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> UNIV <span class="main">(≤)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> completeI Sup_upper Sup_least Inf_lower Inf_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Set-wise Completeness›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> directed_sets_directed_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">DC</span><span class="main">.</span> <span class="bound">DC</span> <span class="main">⊆</span> <span class="free">AA</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">DC</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">DC</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AA</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">DC</span><span class="main">.</span> directed <span class="bound">DC</span> <span class="main">(⊆)</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">AA</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊆)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">XX</span>
  <span class="keyword3"><span class="command">assume</span></span> ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">XX</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">AA</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dir<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="skolem">XX</span> <span class="main">(⊆)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> cl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="skolem">XX</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"directed <span class="main">(</span><span class="main">⋃</span><span class="skolem">XX</span><span class="main">)</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> directedI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> UnionE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">XX</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">XX</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> directedD<span class="main">[</span><span class="operator">OF</span> dir X Y<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> <span class="skolem">XX</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ch xX yY <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"directed <span class="skolem">Z</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="free">r</span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>directedE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Z <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="main">⋃</span> <span class="skolem">XX</span><span class="main">.</span> <span class="free">r</span> <span class="skolem">x</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">r</span> <span class="skolem">y</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">AA</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊆)</span> <span class="skolem">XX</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">XX</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">AA</span><span class="main">.</span> directed <span class="bound">X</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊆)</span> <span class="skolem">XX</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> connex_directed_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> connex <span class="bound">C</span> <span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dir<span class="main">:</span> <span class="quoted"><span class="quoted">"directed <span class="free">CC</span> <span class="main">(⊆)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connex <span class="main">(</span><span class="main">⋃</span><span class="free">CC</span><span class="main">)</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> connexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> UnionE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> directedD<span class="main">[</span><span class="operator">OF</span> dir X Y<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> xX yY ch <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"connex <span class="skolem">Z</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="free">r</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>connexE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> connex_directed_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">DC</span><span class="main">.</span> directed <span class="bound">DC</span> <span class="main">(⊆)</span><span class="main">}</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> connex <span class="bound">C</span> <span class="free">r</span><span class="main">}</span> <span class="main">(⊆)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> connex_directed_Un<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Fixed_Points">
<div class="head">
<h1>Theory Fixed_Points</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Jérémy Dubut (2019-2021)
Author:  Akihisa Yamada (2019-2021)
License: LGPL (see file COPYING.LESSER)
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Fixed_Points
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Complete_Relations.html">Complete_Relations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Existence of Fixed Points in Complete Related Sets›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label{sec:qfp-exists}›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following proof is simplified and generalized from
  Stouti--Maaden \cite{SM13}. We construct some set whose extreme bounds 
  -- if they exist, typically when the underlying related set is complete -- 
  are fixed points of a monotone or inflationary function on any 
  related set. When the related set is attractive, those are actually the least fixed points.
  This generalizes \cite{SM13}, relaxing reflexivity and antisymmetry.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> fixed_point_proof <span class="main">=</span> related_set <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">AA</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">AA</span> <span class="main">≡</span>
  <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Y</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">⟶</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> AA_I<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">Y</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">∈</span> AA"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> AA_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> AA_E<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> AA <span class="main">⟹</span>
   <span class="main">(</span><span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">Y</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AA_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">C</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≡</span> <span class="main">⋂</span> AA"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> A_AA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> AA"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>AA_I f<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> C_AA<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">∈</span> AA"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> AA_I<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"C <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_def A_AA f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> C <span class="main">⊆</span> C"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def AA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> C"</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">B</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> AA"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> X B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AA_E<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> C"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def AA_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_AA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> C <span class="main">⊆</span> C"</span></span> <span class="keyword1"><span class="command">using</span></span> C_AA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AA_E<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">assumes</span></span> Cc<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> C <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> cC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> C"</span></span> <span class="keyword1"><span class="command">using</span></span> Cc C_AA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>AA_E<span class="main">)</span> 
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> fcC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">∈</span> C"</span></span> <span class="keyword1"><span class="command">using</span></span> cC AA_def C_AA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> fcA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fcC CA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> qfp_as_extreme_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> infl_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">∼</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI bexI sympartpI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main"><span class="free">⊑</span></span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fcC Cc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> infl_mono<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> cA<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Monotone case:›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">c</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> C<span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> AA"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> AA_I<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> D_def C_def <span class="keyword1"><span class="command">using</span></span> A_AA f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> fxC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> C <span class="main">⟹</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> C"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> C_AA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AA_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">D</span> <span class="main">⊆</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> D_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fxC<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> C"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cc xC CA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>monotoneD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> DC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> C"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> BD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Bb<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">B</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> C"</span></span> <span class="keyword1"><span class="command">using</span></span> DC BD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> C"</span></span> <span class="keyword1"><span class="command">using</span></span> C_AA Bb BD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AA_E<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> bfc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BD <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> f cA Bb
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_def image_subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> bC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="main">⊆</span> <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cC <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extreme_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fcc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">∼</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> qfp_as_extreme_bound<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monotone_onE<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> AA"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> AA_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> CollectI conjI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">L</span> <span class="main">⊆</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">L</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">L</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xL <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> fxA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">s</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xL sA sf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono fxA sA xA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>monotone_onE<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">note</span></span> fxfs <span class="main">=</span> this
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fxfs attract mono sf fxA sA xA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>monotone_onE<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> fxfs<span class="main">[</span><span class="operator">OF</span> sA<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> BL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">B</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> BL b <span class="keyword1"><span class="command">have</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bA<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">s</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sA BL b sf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> Bs <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> b sA Bs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> b sA Bs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="main">⊆</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def Inf_lower<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> cC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> L_def fcc
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> infl_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> qfp_as_extreme_bound<span class="main">[</span><span class="operator">OF</span> _  infl_mono<span class="main">]</span> completeD<span class="main">[</span><span class="operator">OF</span> comp CA C<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_extreme_qfp_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> extreme_qfp<span class="main">[</span><span class="operator">OF</span> _ attract mono<span class="main">]</span> completeD<span class="main">[</span><span class="operator">OF</span> comp CA C<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_extreme_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> completeD<span class="main">[</span><span class="operator">OF</span> comp CA C<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> Cc<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> C <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> extreme_qfp<span class="main">[</span><span class="operator">OF</span> Cc attract mono<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> Qc<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fcc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span> <span class="main">∼</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> qfp_as_extreme_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Cc<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cc CA <span class="keyword1"><span class="command">have</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Qc fcc cA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> fixed_point_proof <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">theorem</span></span> complete_infl_mono_imp_ex_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> infl_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ex_qfp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp _ infl_mono<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> antisymmetric<span class="main">)</span> complete_infl_mono_imp_ex_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> infl_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">b</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> complete_infl_mono_imp_ex_qfp<span class="main">[</span><span class="operator">OF</span> f comp infl_mono<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> f sA <span class="keyword1"><span class="command">have</span></span> fsA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> antisym fsA sA fss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> sA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> semiattractive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">theorem</span></span> complete_mono_imp_ex_extreme_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> dual<span class="main">:</span> fixed_point_proof <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊒)</span>"</span></span> <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"dual.sym <span class="main">=</span> <span class="main">(∼)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dual.ex_extreme_qfp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> complete_dual<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">]</span></span> _ _ monotone_on_dual<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mono<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> f sym_order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> antisymmetric<span class="main">)</span> complete_mono_imp_ex_extreme_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">s</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ex_extreme_qfp_fp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp _ _ mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> antisym f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> order_sym_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> antisym f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fixed Points in Well-Complete Antisymmetric Sets›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label{sec:well-complete}›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we prove that an
inflationary or monotone map over a well-complete antisymmetric set
has a fixed point.

In order to formalize such a theorem in Isabelle,
we followed Grall's~\cite{grall10} elementary proof for Bourbaki--Witt and Markowsky's theorems.
His idea is to consider well-founded derivation trees over $A$,
where from a set $C \subseteq A$ of premises
one can derive $f\:(\bigsqcup C)$ if $C$ is a chain.
The main observation is as follows:
Let $D$ be the set of all the derivable elements; that is,
for each $d \in D$ there exists a well-founded derivation
whose root is $d$.
It is shown that $D$ is a chain,
and hence one can build a derivation yielding $f\:(\bigsqcup D)$,
and $f\:(\bigsqcup D)$ is shown to be a fixed point.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bound_monotone_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="free">r</span> <span class="free">s</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rXa<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="free">X</span> <span class="free">r</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">(</span><span class="free">f</span><span class="main">`</span><span class="free">X</span><span class="main">)</span> <span class="free">s</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> rXa xX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">x</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> xX XA mono aA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>monotone_onE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> fixed_point_proof <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To avoid the usage of the axiom of choice, we carefully define derivations so that any derivable element
determines its lower set. This led to the following definition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">derivation</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> well_ordered_set <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="bound">x</span><span class="main">}</span> <span class="keyword1">in</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> extreme <span class="bound">Y</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">f</span> <span class="main">`</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivation <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> derivation_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> derivation_well_ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="free">P</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivation_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> derivation_cases<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> suc lim<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivation <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Y</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> extreme <span class="bound">Y</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">Y</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> derivation_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">derivable</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="bound">X</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivableI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> derivable <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivable_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> derivableE<span class="main">:</span> <span class="quoted"><span class="quoted">"derivable <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> derivation <span class="bound">P</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> derivable_A<span class="main">:</span> <span class="quoted"><span class="quoted">"derivable <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> derivableE <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>derivation_A<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> UN_derivations_eq_derivable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> derivation <span class="bound">P</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivable_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> antisymmetric <span class="keyword1"><span class="command">using</span></span> ord<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivation_lim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Pp<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">P</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"derivation <span class="main">(</span><span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> pP<span class="main">:</span> False
  <span class="keyword1"><span class="command">interpret</span></span> P<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_A<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> Pp <span class="keyword1"><span class="command">have</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bp<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="free">P</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> Pp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>extreme_bound_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xP Pp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> px <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xP PA pA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> xP pP
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="free">p</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> asympartpI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wr<span class="main">:</span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="main">(</span><span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> well_order_extend<span class="main"><span class="main">[</span></span><span class="operator">OF</span> P.well_ordered_set_axioms<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> pp bp pP 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> P fP Pp
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"derivation <span class="main">(</span><span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivation_def pA wr<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> 1 3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> derivation_infl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> derivation_f_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">x</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivation_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Pp<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">P</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"derivation <span class="main">(</span><span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> fpP<span class="main">:</span> False
  <span class="keyword1"><span class="command">interpret</span></span> P<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_A<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> Pp <span class="keyword1"><span class="command">have</span></span> pP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> fpA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> pP <span class="keyword1"><span class="command">have</span></span> pp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> derivation_infl<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> P pP pP pp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">p</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> xp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xP Pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> derivation_infl<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> P xP pP this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">p</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> Pfp <span class="main">=</span> this
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bfp<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="free">P</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> yP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> yfp <span class="main">=</span> Pfp<span class="main">[</span><span class="operator">OF</span> yP<span class="main">]</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> fpy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> yfp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yP PA pA fpA antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> yP fpP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> Pfp yP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="free">f</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> Pfp <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">p</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">p</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="free">f</span> <span class="free">p</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pfp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> wr<span class="main">:</span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="main">(</span><span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> well_order_extend<span class="main"><span class="main">[</span></span><span class="operator">OF</span> P.well_ordered_set_axioms singleton_well_ordered<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Pfp derivation_f_refl<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> P pP<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> P Pp
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"derivation <span class="main">(</span><span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivation_def wr<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> 1 2 fpA<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivable_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"derivable <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"derivable <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> derivableE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> PA <span class="main">=</span> derivation_A<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> P<span class="main">:</span> well_ordered_set <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> P.asympartp<span class="main">:</span> transitive <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊏)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P.asympartp_transitive<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Px</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Px</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> PxP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Px</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Pxx<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="skolem">Px</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xP PA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Px_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wr<span class="main">:</span> <span class="quoted"><span class="quoted">"well_ordered_set <span class="skolem">Px</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P.well_ordered_subset<span class="main">[</span><span class="operator">OF</span> PxP<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> zPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Px</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PxP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> yz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zPx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Px_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> P.asympartp.trans<span class="main">[</span><span class="operator">OF</span> yz zx yP zP xP<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">Px</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">Px</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="bound">z</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="bound">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Px_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> Px<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">Px</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PxP PA P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wr derivation_def 1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> derivation_suc<span class="main">[</span><span class="operator">OF</span> Px Pxx<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> derivableI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma is derived from Grall’s proof. We simplify the claim so that we
consider two elements from one derivation, instead of two derivations.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivation_useful<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> XA <span class="main">=</span> derivation_A<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xX yX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> xX <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> IHx <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">y</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> yX <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> IHy <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword1"><span class="command">have</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> X yX
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>derivation_cases<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">Z</span> <span class="skolem">z</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword1"><span class="command">have</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yfz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> xX zX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> X.comparable_three_cases<span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> xz<span class="main">:</span> less
              <span class="keyword1"><span class="command">with</span></span> IHy<span class="main">[</span><span class="operator">OF</span> zX zy<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> fxz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fxX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> derivation_infl<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> X fxX zX fxz<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> yfz<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> fxX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> eq
              <span class="keyword1"><span class="command">with</span></span> xX zX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> yX yfz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> zx<span class="main">:</span> greater
              <span class="keyword1"><span class="command">with</span></span> IHy<span class="main">[</span><span class="operator">OF</span> zX zy<span class="main">]</span> yfz xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lim <span class="skolem">Z</span><span class="main">)</span>
            <span class="keyword1"><span class="command">note</span></span> Z <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> fZ <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">Z</span>›</span></span>
            <span class="keyword1"><span class="command">from</span></span> xX xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> fZ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> X xX
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>derivation_cases<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">Z</span> <span class="skolem">z</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> XA <span class="keyword1"><span class="command">have</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xfz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> yX zX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> X.comparable_three_cases<span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> yz<span class="main">:</span> less
              <span class="keyword1"><span class="command">with</span></span> IHx<span class="main">[</span><span class="operator">OF</span> zX zx yX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> fyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fyX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> derivation_infl<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> X fyX zX fyz<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xfz<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> fyX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> eq
              <span class="keyword1"><span class="command">with</span></span> yX zX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> xX xfz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> greater
              <span class="keyword1"><span class="command">with</span></span> IHx<span class="main">[</span><span class="operator">OF</span> zX zx yX<span class="main">]</span> xfz yx <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lim <span class="skolem">Z</span><span class="main">)</span>
            <span class="keyword1"><span class="command">note</span></span> Z <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> fZ <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">Z</span>›</span></span>
            <span class="keyword1"><span class="command">from</span></span> yX yx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> fZ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next one is the main lemma of this section, stating that elements from two possibly different 
derivations are comparable, and moreover the lower one is in the derivation of the upper one. 
The latter claim, not found in Grall’s proof, is crucial in proving that the union of all 
derivations is well-related.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivations_cross_compare<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊏</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_ordered_set <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> X.asympartp<span class="main">:</span> transitive <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊏)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X.asympartp_transitive<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> Y<span class="main">:</span> well_ordered_set <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> Y<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_A<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xX <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> fxA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> YA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_A<span class="main">[</span><span class="operator">OF</span> Y<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yY <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> fyA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
      <span class="keyword3"><span class="command">assume</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Zx<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Z</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> IHx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊏</span> <span class="bound">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="skolem">Z</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊏</span> <span class="bound">z</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> zZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> zZ Z <span class="keyword1"><span class="command">have</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> IHx<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> zX zx<span class="main">]</span> yz <span class="keyword1"><span class="command">have</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> X.asympartp.trans<span class="main">[</span><span class="operator">OF</span> yz zx yX zX xX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> yX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">Z</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Z False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> IHx<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> zX zx<span class="main">]</span> X <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> yA Zx <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> lim_any <span class="main">=</span> this
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">Z</span>
      <span class="keyword3"><span class="command">assume</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Zz<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="skolem">Z</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">z</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xfz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> IHx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Zz Z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> IHx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE conjE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> zy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> derivation_useful<span class="main">[</span><span class="operator">OF</span> Y zY yY zy<span class="main">]</span> xfz <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> zy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> zy zX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> X.asympartp.trans<span class="main">[</span><span class="operator">OF</span> yz zx yX zX xX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> yX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> lim_any this
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> lim_any <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> suc_any <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> Y<span class="main">:</span> well_ordered_set <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> Y<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_A<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> YA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_A<span class="main">[</span><span class="operator">OF</span> Y<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> xX yY <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> xX <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> IHx <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> xX XA f <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fxA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> yY <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> IHy <span class="main">=</span> less<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> yY YA f <span class="keyword1"><span class="command">have</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fyA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> X xX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivation_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">Z</span> <span class="skolem">z</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> Z <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Zz <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme <span class="skolem">Z</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">z</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> xfz <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> IHz <span class="main">=</span> IHx<span class="main">[</span><span class="operator">OF</span> zX zx yY<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_any<span class="main">[</span><span class="operator">OF</span> X Y xX yY Z Zz xfz IHz<span class="main">]</span> IHy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Y yY <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivation_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">W</span> <span class="skolem">w</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> W <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">w</span></span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ww <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme <span class="skolem">W</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">w</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> yfw <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">w</span>›</span></span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊏</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> IHw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">x</span>  <span class="main">∨</span> <span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">w</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHy<span class="main">[</span><span class="operator">OF</span> wY wy<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_any<span class="main">[</span><span class="operator">OF</span> Y X yY xX W Ww yfw IHw<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> antisym xA yA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lim <span class="skolem">W</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> W <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">w</span></span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> fW <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">W</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Wy <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">W</span> <span class="skolem">y</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lim_any<span class="main">[</span><span class="operator">OF</span> Y X yY xX W fW Wy<span class="main">]</span> IHy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> antisym xA yA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lim <span class="skolem">Z</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> Z <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> fZ <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">Z</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Zx <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Z</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lim_any<span class="main">[</span><span class="operator">OF</span> X Y xX yY Z fZ Zx<span class="main">]</span> IHx<span class="main">[</span><span class="operator">OF</span> _ _ yY<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Y yY <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivation_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">W</span> <span class="skolem">w</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> W <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">w</span></span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ww <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme <span class="skolem">W</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">w</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> yfw <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">w</span>›</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊏</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> IHw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊏</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∨</span>  <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">x</span>  <span class="main">∨</span>  <span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">w</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHy<span class="main">[</span><span class="operator">OF</span> wY wy<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_any<span class="main">[</span><span class="operator">OF</span> Y X yY xX W Ww yfw IHw<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> antisym xA yA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lim <span class="skolem">W</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> W <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">w</span></span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊏</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> fW <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">W</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Wy <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">W</span> <span class="skolem">y</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊏</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lim_any<span class="main">[</span><span class="operator">OF</span> Y X yY xX W fW Wy<span class="main">]</span> IHy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> antisym xA yA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> derivable<span class="main">:</span> well_ordered_set <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> well_ordered_set.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"antisymmetric <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> derivable_A antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> UN_derivations_eq_derivable<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> closed_UN_well_related<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> derivation_well_ordered derivations_cross_compare well_ordered_set.axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> derivable_well_ordered <span class="main">=</span> derivable.well_ordered_set_axioms
<span class="keyword1"><span class="command">lemmas</span></span> derivable_total_ordered <span class="main">=</span> derivable.total_ordered_set_axioms
<span class="keyword1"><span class="command">lemmas</span></span> derivable_well_related <span class="main">=</span> derivable.well_related_set_axioms

<span class="keyword1"><span class="command">lemma</span></span> pred_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> derivable <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> derivable <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivations_cross_compare<span class="main">[</span><span class="operator">OF</span> X Y xX zY<span class="main">]</span> zx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊇</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> derivable <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The set of all derivable elements is itself a derivation.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivation_derivable<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> derivation_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> derivable_A derivable.well_ordered_set_axioms <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> derivableE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mem_Collect_eq pred_unique<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> derivation_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, if the set of all derivable elements admits a supremum, then it is a fixed point.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> sup_derivable_qfp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">∼</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sup_derivable_fp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym sympartpI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_derivable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> derivable_closed <span class="keyword1"><span class="command">have</span></span> fP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> derivation_lim<span class="main">[</span><span class="operator">OF</span> P fP<span class="main">]</span> p
  <span class="keyword1"><span class="command">have</span></span> pP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>derivableI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> fpp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> pfp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> derivation_infl<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> P<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> pP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fpp pfp p f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">"The assumptions are satisfied by monotone functions."</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_imp_derivation_infl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_ordered_set <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> XA <span class="main">=</span> derivation_A<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> xX yX xy <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> xX <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> yX <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> xX yX XA <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> X xX <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivation_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">Z</span> <span class="skolem">z</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zsx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xfz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> X.trans<span class="main">[</span><span class="operator">OF</span> zx xy zX xX yX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> zy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> zX XA <span class="keyword1"><span class="command">have</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> zy monotone_onD<span class="main">[</span><span class="operator">OF</span> mono<span class="main">]</span> zA yA xfz <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lim <span class="skolem">Z</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> Z <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Zx <span class="main">=</span> <span class="quoted"><span class="quoted">‹extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Z</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">from</span></span> f yA <span class="keyword1"><span class="command">have</span></span> fyA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">Z</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> zZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> Z xX <span class="keyword1"><span class="command">have</span></span> zsx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊏</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> X.trans<span class="main">[</span><span class="operator">OF</span> zx xy zX xX yX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> zy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> zX zsx yX<span class="main">]</span> zy <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> Zx fyA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_imp_derivation_f_refl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">x</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> well_ordered_set <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_well_ordered<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> XA <span class="main">=</span> derivation_A<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> xX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> monotone_onD<span class="main">[</span><span class="operator">OF</span> mono this<span class="main">]</span> xX XA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> mono_imp_sup_derivable_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_derivable_fp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mono_imp_derivation_infl mono_imp_derivation_f_refl p<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_imp_sup_derivable_lfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> extremeI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sup_derivable_fp<span class="main">[</span><span class="operator">OF</span> mono_imp_derivation_infl mono_imp_derivation_f_refl p<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> qA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fqq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> boundI <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>derivableE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"derivation <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> X <span class="keyword1"><span class="command">interpret</span></span> well_ordered_set <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> derivation_well_ordered<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> xX <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> xP <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> IH <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> X <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivation_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>suc <span class="skolem">Z</span> <span class="skolem">z</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> zq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> monotone_onD<span class="main">[</span><span class="operator">OF</span> mono zq<span class="main">]</span> zX qA derivation_A<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fqq suc<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> lim
        <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊏</span> <span class="skolem">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> lim qA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> p qA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_imp_ex_least_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">note</span></span> as <span class="main">=</span> antisymmetric_axioms
  <span class="keyword1"><span class="command">note</span></span> infl <span class="main">=</span> mono_imp_derivation_infl
  <span class="keyword1"><span class="command">note</span></span> refl <span class="main">=</span> mono_imp_derivation_f_refl
  <span class="keyword1"><span class="command">have</span></span> wr<span class="main">:</span> <span class="quoted"><span class="quoted">"well_related_set <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> derivable_well_related<span class="main">[</span><span class="operator">OF</span> infl refl<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="bound">p</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> derivable_A wr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> p mono_imp_sup_derivable_lfp<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> sup_derivable_qfp<span class="main">[</span><span class="operator">OF</span> infl refl p<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bourbaki-Witt Theorem on well-complete pseudo-ordered set:›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pseudo_ordered_set<span class="main">)</span> well_complete_infl_imp_ex_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> infl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> as <span class="main">=</span> antisymmetric_axioms
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> dinfl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>derivation_A<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">x</span><span class="main">.</span> derivation <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> derivation_A<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> derivable <span class="bound">x</span><span class="main">}</span> <span class="bound">p</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> completeD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> derivable_well_related<span class="main">[</span><span class="operator">OF</span> as dinfl drefl<span class="main">]</span> derivable_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> sup_derivable_fp<span class="main">[</span><span class="operator">OF</span> as dinfl drefl<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness of (Quasi-)Fixed Points›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove that, under attractivity, the set of quasi-fixed points is complete.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">setwise</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">setwise</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> setwiseI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> setwise_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> setwiseE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> setwise_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">elim_format</span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">context</span></span> fixed_point_proof <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">setwise_less_eq</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span></span> <span class="main">≡</span> setwise <span class="main"><span class="free">(⊑)</span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Least Quasi-Fixed Points for Attractive Relations.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> attract_mono_imp_least_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"attractive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> extreme <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">c</span> <span class="main">∼</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> attractive <span class="keyword1"><span class="command">using</span></span> attract <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> sym<span class="main">:</span> transitive <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∼)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sym_transitive<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ecl</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>∼</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≡</span> <span class="main">{</span><span class="main"><span class="skolem">[</span></span><span class="bound">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span> <span class="main">|.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> XQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xX <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> qA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">q</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> xqqx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∼</span> <span class="skolem">q</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X xX <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∼</span> <span class="skolem">q</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yX X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∼</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sym_order_trans xqqx xA qA yA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X qA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∼</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∼</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sym_order_trans xqqx xA qA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊇</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X xX <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> XQx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="bound">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> RSLE_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">⟹</span> <span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> XQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xX yY <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xp</span> <span class="skolem">yp</span> <span class="keyword3"><span class="command">assume</span></span> xpX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xp</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ypY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yp</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xpA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xp</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ypA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yp</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XA YA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xp</span> <span class="main">∼</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">xp</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xpX XQx xX XQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xpy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xp</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> attract<span class="main">[</span><span class="operator">OF</span> _ _ xy xpA xA yA<span class="main">]</span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yp</span> <span class="main">∼</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">yp</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ypY XQx yY YQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xp</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">yp</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual.attract<span class="main">[</span><span class="operator">OF</span> _ _ xpy ypA yA xpA<span class="main">]</span> xpy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQ YQ XA YA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> compQ<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="skolem">Q</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">XX</span> <span class="keyword3"><span class="command">assume</span></span> XXQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">XX</span> <span class="main">⊆</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XX<span class="main">:</span> <span class="quoted"><span class="quoted">"well_related_set <span class="skolem">XX</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">XX</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XXQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> XX <span class="keyword1"><span class="command">interpret</span></span> XX<span class="main">:</span> well_related_set <span class="quoted"><span class="skolem">XX</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> UXX<span class="main">:</span> semiattractive <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">XX</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> semiattractive_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BA<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_related_set <span class="main">(</span><span class="main">⋃</span><span class="skolem">XX</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> YXX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="skolem">XX</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="skolem">XX</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> YXX Y0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> XX.nonempty_imp_ex_extreme<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="skolem">XX</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> eE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme <span class="skolem">Y</span> <span class="main">(⊒)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> extremeI eX<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> xY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> YXX <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> XXX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">XX</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> xY E XXX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> eE xX <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> extreme <span class="skolem">Y</span> <span class="main">(⊒)</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> completeD<span class="main">[</span><span class="operator">OF</span> comp BA<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> extb<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">XX</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extreme_def bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extb extreme_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> XQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="skolem">[</span></span><span class="skolem">b</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_def bA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> bX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">b</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="skolem">Q</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span> <span class="skolem">XX</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">b</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> extreme_boundI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="skolem">[</span></span><span class="skolem">b</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQ<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> YXX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">XX</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> YQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XXQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">y</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">⋃</span><span class="skolem">XX</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yY YXX <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="main"><span class="skolem">[</span></span><span class="skolem">b</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSLE_eq<span class="main">[</span><span class="operator">OF</span> YQ XQ yY bX<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span> <span class="keyword3"><span class="command">assume</span></span> boundZ<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="skolem">XX</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span> <span class="skolem">Z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ZQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Zz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">z</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">⋃</span><span class="skolem">XX</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YXX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">XX</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> YA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XXQ Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> YXX boundZ bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yY zZ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="main">(</span><span class="main">⋃</span><span class="skolem">XX</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extb zA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="skolem">[</span></span><span class="skolem">b</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSLE_eq<span class="main">[</span><span class="operator">OF</span> XQ ZQ bX zZ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="skolem">Q</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span> <span class="skolem">XX</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> Q<span class="main">:</span> antisymmetric <span class="quoted"><span class="skolem">Q</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> qA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">q</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> qX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">p</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> YQ Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  XQ YQ YX qX pY <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQ YQ XY qX pY <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pq X pA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">p</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQ XQx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">X</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∼</span> <span class="free">f</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">have</span></span> XQFXQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="bound">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> XQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fxA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xA f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> FXA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f fxA X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="free">f</span> <span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> X<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> zFX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> yX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zfy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∼</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yX xA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> fyA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> zA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zFX FXA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∼</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X yX <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∼</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono xA yA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotone_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∼</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zfy sym.trans<span class="main">[</span><span class="operator">OF</span> _ _ zA fyA fxA<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> zA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main"><span class="skolem">[</span></span><span class="free">f</span> <span class="skolem">x</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xX F_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> FXA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def ecl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">`</span> <span class="skolem">Q</span> <span class="main">⊆</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> Q<span class="main">:</span> fixed_point_proof <span class="quoted"><span class="skolem">Q</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span>"</span></span> <span class="quoted"><span class="skolem">F</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> monoQ<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="skolem">Q</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span> <span class="skolem">F</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> monotone_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> XQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQ YQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XY xX yY <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fxfy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> monotone_on_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> xA yA mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fxgX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xX F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> fygY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yY F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">F</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSLE_eq<span class="main">[</span><span class="operator">OF</span> XQFXQ<span class="main"><span class="main">[</span></span><span class="operator">OF</span> XQ<span class="main"><span class="main">]</span></span> XQFXQ<span class="main"><span class="main">[</span></span><span class="operator">OF</span> YQ<span class="main"><span class="main">]</span></span> fxgX fygY fxfy<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> QdA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> Q.derivable <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q.derivable_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> asQ <span class="main">=</span> Q.antisymmetric_axioms
  <span class="keyword1"><span class="command">note</span></span> infl <span class="main">=</span> Q.mono_imp_derivation_infl<span class="main">[</span><span class="operator">OF</span> asQ monoQ<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> f_refl <span class="main">=</span> Q.mono_imp_derivation_f_refl<span class="main">[</span><span class="operator">OF</span> asQ monoQ<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> Q.mono_imp_ex_least_fp<span class="main">[</span><span class="operator">OF</span> asQ monoQ compQ<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">Q</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">q</span><span class="main">}</span> <span class="keyword1">(⊑<span class="hidden">⇧</span><sup>s</sup>)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> FPP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">P</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> PP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Pp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="skolem">p</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fpA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pA f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pP F_def fpA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">P</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="free">f</span> <span class="skolem">p</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQx XQFXQ<span class="main">[</span><span class="operator">OF</span> PQ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">p</span> <span class="main">∼</span> <span class="skolem">p</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pP FPP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ecl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PP pP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> fp <span class="keyword1"><span class="command">have</span></span> fpp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">p</span> <span class="main">∼</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> extremeI CollectI conjI pA fp<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> CollectE conjE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> qA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">q</span> <span class="main">∼</span> <span class="skolem">q</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">q</span> <span class="main">∼</span> <span class="bound">z</span><span class="main">}</span><span class="main">∪</span><span class="main">{</span><span class="skolem">q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> qZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ZQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z_def Q_def ecl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fqA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qA f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Z_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="free">f</span> <span class="skolem">q</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQx ZQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qZ fqA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="main"><span class="skolem">[</span></span><span class="free">f</span> <span class="skolem">q</span><span class="main"><span class="skolem">]<span class="hidden">⇩</span><sub>∼</sub></span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XQx XQFXQ<span class="main">[</span><span class="operator">OF</span> ZQ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="skolem">F</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P ZQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pP qZ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> fpp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹General Completeness›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> attract_mono_imp_fp_qfp_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"attractive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wr_CC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">C</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> well_related_set <span class="bound">C</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟶</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> extend<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">CC</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Y</span> <span class="main">∈</span> <span class="free">CC</span><span class="main">.</span> <span class="bound">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">P</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> completeI<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> attractive <span class="keyword1"><span class="command">using</span></span> attract<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> Xfix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XCC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">b</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fafs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono f aX sA as <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monotone_onE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fafs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∼</span> <span class="free">f</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P aX Xfix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fafs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f aA sA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> fBB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> compB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> complete_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> YS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YCC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> BA <span class="keyword1"><span class="command">have</span></span> YA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≡</span> <span class="skolem">X</span><span class="main">∪</span><span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XA YA C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_def YS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> CCC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extend XA YA XCC YCC C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">C</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> completeD<span class="main">[</span><span class="operator">OF</span> comp CA CCC<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI extreme_boundI<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sA B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s C_def <span class="keyword1"><span class="command">using</span></span> extremeD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> cS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">Y</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bound <span class="skolem">C</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s BA cS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> fBB <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> fixed_point_proof <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">from</span></span> BA <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> asB<span class="main">:</span> <span class="quoted"><span class="quoted">"attractive <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> attractive_subset<span class="main">[</span><span class="operator">OF</span> BA<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> monoB<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> monotone_on_cmono<span class="main">[</span><span class="operator">OF</span> BA<span class="main">]</span> mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_funD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> compB<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="skolem">B</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wr_CC compB BA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> B.attract_mono_imp_least_qfp<span class="main">[</span><span class="operator">OF</span> asB compB monoB<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span> <span class="main">∼</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">P</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">(⊒)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span>extreme_bound <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">P</span><span class="main">)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI extreme_boundI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l BA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"bound <span class="skolem">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cfix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> cfix l <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> attract_mono_imp_qfp_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"attractive <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">C</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> well_related_set <span class="bound">C</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟶</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">CC</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Y</span> <span class="main">∈</span> <span class="free">CC</span><span class="main">.</span> <span class="bound">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> attract_mono_imp_fp_qfp_complete<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> antisym_mono_imp_fp_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> anti<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymmetric <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wr_CC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">C</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> well_related_set <span class="bound">C</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟶</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> extend<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">CC</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Y</span> <span class="main">∈</span> <span class="free">CC</span><span class="main">.</span> <span class="bound">X</span> <span class="keyword1">⊑<span class="hidden">⇧</span><sup>s</sup></span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="free">CC</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> antisymmetric <span class="keyword1"><span class="command">using</span></span> anti<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> * attract_mono_imp_fp_qfp_complete<span class="main">[</span><span class="operator">OF</span> attractive_axioms comp wr_CC extend mono<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_Un_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instances›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Instances under attractivity›</span></span>

<span class="keyword1"><span class="command">context</span></span> attractive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Full completeness›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_qfp_UNIV_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> fixed_point_proof.attract_mono_imp_qfp_complete comp mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Connex completeness›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_qfp_connex_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> connex <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> connex <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> fixed_point_proof.attract_mono_imp_qfp_complete mono comp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> connex_union well_related_set.connex_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Directed completeness›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_qfp_directed_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> fixed_point_proof.attract_mono_imp_qfp_complete mono comp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> directed_extend <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> well_related_set.connex_axioms connex.directed<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Well Completeness›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_qfp_well_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_complete <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> fixed_point_proof.attract_mono_imp_qfp_complete mono comp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f well_related_extend<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Usual instances under antisymmetry ›</span></span>

<span class="keyword1"><span class="command">context</span></span> antisymmetric <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Knaster--Tarski›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_fp_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> antisym_mono_imp_fp_complete mono antisymmetric_axioms comp<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Markowsky 1976›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_fp_connex_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> connex <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> connex <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> antisym_mono_imp_fp_complete antisymmetric_axioms mono comp<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> connex_union well_related_set.connex_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pataraia›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_fp_directed_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> directed <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span><span class="main">}</span><span class="keyword1">-complete</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> antisym_mono_imp_fp_complete mono antisymmetric_axioms comp<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> directed_extend connex.directed well_related_set.connex_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bhatta \&amp; George 2011›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> mono_imp_fp_well_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"well_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_complete <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">p</span><span class="main">}</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> fixed_point_proof <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> antisym_mono_imp_fp_complete mono antisymmetric_axioms comp<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym well_related_extend<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Kleene_Fixed_Point">
<div class="head">
<h1>Theory Kleene_Fixed_Point</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Kleene_Fixed_Point
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Complete_Relations.html">Complete_Relations</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Iterative Fixed Point Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Kleene's fixed-point theorem states that,
for a pointed directed complete partial order $\tp{A,\SLE}$
and a Scott-continuous map $f: A \to A$,
the supremum of $\set{f^n(\bot) \mid n\in\Nat}$ exists in $A$ and is a least 
fixed point.
Mashburn \cite{mashburn83} generalized the result so that
$\tp{A,\SLE}$ is a $\omega$-complete partial order
and $f$ is $\omega$-continuous.

In this section we further generalize the result and show that
for $\omega$-complete relation $\tp{A,\SLE}$
and for every bottom element $\bot \in A$,
the set $\set{f^n(\bot) \mid n\in\Nat}$ has suprema (not necessarily unique, of 
course) and, 
they are quasi-fixed points.
Moreover, if $(\SLE)$ is attractive, then the suprema are precisely the least 
quasi-fixed points.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Scott Continuity, $\omega$-Completeness, $\omega$-Continuity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this Section, we formalize $\omega$-completeness, Scott continuity and $\omega$-continuity.
We then prove that a Scott continuous map is $\omega$-continuous and that an $\omega$-continuous 
map is ``nearly'' monotone.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">omega_continuous</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>
  <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span>
  range <span class="bound">c</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span>
  monotone <span class="main">(≤)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">c</span> <span class="main">⟶</span>
  extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span>range <span class="bound">c</span><span class="main">)</span> <span class="bound">b</span> <span class="main">⟶</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> range <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> omega_continuousI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">?</span></span><span class="main">]</span> <span class="main">=</span>
  omega_continuous_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> omega_continuousDdom <span class="main">=</span>
  omega_continuous_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> omega_continuousD <span class="main">=</span>
  omega_continuous_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> omega_continuousE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">=</span>
  omega_continuous_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">elim_format</span><span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> omega_continuous_imp_mono_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_continuous <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x y xx xy yy <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="skolem">c</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"monotone <span class="main">(≤)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monotoneI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span>range <span class="skolem">c</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy yy x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fboy<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> range <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c cont y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">scott_continuous</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>
  <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span> directed <span class="bound">X</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="bound">X</span> <span class="bound">s</span> <span class="main">⟶</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> scott_continuousI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">?</span></span><span class="main">]</span> <span class="main">=</span>
  scott_continuous_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> scott_continuousE <span class="main">=</span>
  scott_continuous_def<span class="main">[</span><span class="operator">unfolded</span> atomize_eq<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">elim_format</span><span class="main">,</span> <span class="operator">unfolded</span> conj_imp_eq_imp_imp<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> scott_continuous_imp_mono_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> scott<span class="main">:</span> <span class="quoted"><span class="quoted">"scott_continuous <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="free">⊑</span></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≡</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x y xy yy <span class="keyword1"><span class="command">have</span></span> dir_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"directed <span class="skolem">D</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> directedI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">D</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy yy x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fboy<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">D</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dir_D scott <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> scott_continuousE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scott_continuous_imp_omega_continuous<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> scott<span class="main">:</span> <span class="quoted"><span class="quoted">"scott_continuous <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"omega_continuous <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> scott <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> scott_continuousE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone <span class="main">(≤)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="skolem">c</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> monotone_directed_image<span class="main">[</span><span class="operator">OF</span> mono<span class="main"><span class="main">[</span></span><span class="operator">folded</span> monotone_on_UNIV<span class="main"><span class="main">]</span></span> order.directed<span class="main">]</span> scott c
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span>range <span class="skolem">c</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">⟹</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> range <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> scott_continuousE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of Iterative Fixed Points›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first part of Kleene's theorem demands to prove that the set 
$\set{f^n(\bot) \mid n \in \Nat}$ has a supremum and 
that all such are quasi-fixed points. We prove this claim without assuming 
anything on the relation $\SLE$ besides $\omega$-completeness and one bottom element.›</span></span>

<span class="comment1">(*
no_notation power (infixr "^" 80)
*)</span>
<span class="keyword1"><span class="command">notation</span></span> compower <span class="main">(</span><span class="quoted">"_<span class="keyword1">^</span>_"</span><span class="main">[</span>1000<span class="main">,</span>1000<span class="main">]</span>1000<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_funpow<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="free">r</span> <span class="free">r</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monotone_on <span class="free">A</span> <span class="free">r</span> <span class="free">r</span> <span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> monotone_on_id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> funpow_dom<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monotone_onI monotone_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mono<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>monotone_onE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">less_eq</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bot</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊥</span></span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_continuous <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">Fn</span> <span class="main">≡</span> <span class="main">{</span><span class="free">f</span><span class="main">^</span><span class="bound">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main">|.</span> <span class="bound">n</span> <span class="main">::</span> nat<span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> fn_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="free">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span><span class="main">^</span><span class="free">n</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fnA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="free">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">from</span></span> bot <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fnfn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> f fn omega_continuous_imp_mono_refl<span class="main">[</span><span class="operator">OF</span> cont fn fn fnfn fnfn fnfn<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> FnA<span class="main">:</span> <span class="quoted"><span class="quoted">"Fn <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fnA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> fn_monotone<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone <span class="main">(≤)</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">^</span><span class="bound">n</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> le_Suc_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bot fn_ref fnA omega_continuous_imp_mono_refl<span class="main">[</span><span class="operator">OF</span> cont<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span><span class="main">^</span><span class="skolem">m</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> m<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> Fn<span class="main">:</span> <span class="quoted"><span class="quoted">"Fn <span class="main">=</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">^</span><span class="bound">n</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> kleene_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> Fn <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">q</span> <span class="main">∼</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> fq<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> Fn<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Fn<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> omega_continuousD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cont<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> FnA fn_monotone q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Fn<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bot <span class="keyword1"><span class="command">have</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extreme_bound_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span> <span class="main">∈</span> Fn"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> Fn <span class="main">⊆</span> Fn"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> extreme_bound_mono<span class="main">[</span><span class="operator">OF</span> this fq q<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">q</span> <span class="main"><span class="free">⊑</span></span> <span class="free">q</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex_kleene_qfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> Fn <span class="bound">p</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> fn_monotone
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> comp<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> omega_complete_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> completeD<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> FnA<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Iterative Fixed Points are Least.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Kleene's theorem also states that the quasi-fixed point found this way is a least one.
Again, attractivity is needed to prove this statement.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> kleene_qfp_is_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> Fn <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">s</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> extremeI kleene_qfp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> q
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cqfp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span> <span class="main">∼</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> bot c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> attract cqfp c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> omega_continuous_imp_mono_refl<span class="main">[</span><span class="operator">OF</span> cont<span class="main">]</span> fn_ref fnA c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> attract cqfp c fnA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> kleene_qfp_iff_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">q</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dual_attract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∼</span> <span class="bound">q</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> Fn <span class="main">=</span> extreme <span class="main">{</span><span class="bound"><span class="bound">s</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span><span class="main">}</span> <span class="main">(⊒)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI kleene_qfp_is_least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> attract<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="main">{</span><span class="bound"><span class="bound">s</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span><span class="main">}</span> <span class="main">(⊒)</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> qA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> qq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> fqq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">q</span> <span class="main">∼</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ex_kleene_qfp<span class="main">[</span><span class="operator">OF</span> comp<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> Fn <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> qk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∼</span> <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> kleene_qfp<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> q k
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> kleene_qfp_is_least<span class="main">[</span><span class="operator">OF</span> _ k<span class="main">]</span> q attract
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> Fn <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> extreme_boundI<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">from</span></span> bot q <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> S<span class="main">:</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fnA f <span class="keyword1"><span class="command">have</span></span> fsnbA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> fnfn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fn_ref <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="skolem">n</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span> <span class="main"><span class="free">⊑</span></span> <span class="free">f</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> omega_continuous_imp_mono_refl<span class="main">[</span><span class="operator">OF</span> cont fnA qA S fnfn qq<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> fsnbA qA attract fqq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bound Fn <span class="main"><span class="free">(⊑)</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> kx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> dual_attract<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> _ _ x qk<span class="main">]</span> q k
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main"><span class="free">⊑</span></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> q <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> attractive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> less_eq_notations<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">theorem</span></span> kleene_qfp_is_dual_extreme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_complete <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_continuous <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="free">f</span><span class="main">^</span><span class="bound">n</span> <span class="free">b</span> <span class="main">|.</span> <span class="bound">n</span> <span class="main">::</span> nat<span class="main">}</span> <span class="main">=</span> extreme <span class="main">{</span><span class="bound"><span class="bound">s</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">s</span><span class="main">}</span> <span class="main">(⊒)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> kleene_qfp_iff_least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bA bot cont comp<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> cont<span class="main">[</span><span class="operator">THEN</span> omega_continuousDdom<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym_order_trans order_sym_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">corollary</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> antisymmetric<span class="main">)</span> kleene_fp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_continuous <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">b</span> <span class="main"><span class="free">⊑</span></span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"extreme_bound <span class="free">A</span> <span class="main"><span class="free">(⊑)</span></span> <span class="main">{</span><span class="free">f</span><span class="main">^</span><span class="bound">n</span> <span class="free">b</span> <span class="main">|.</span> <span class="bound">n</span> <span class="main">::</span> nat<span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> kleene_qfp<span class="main">[</span><span class="operator">OF</span> b cont<span class="main">]</span> p cont<span class="main">[</span><span class="operator">THEN</span> omega_continuousDdom<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 2 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>antisym<span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span> compower <span class="main">(</span><span class="quoted">"_<span class="keyword1">^</span>_"</span><span class="main">[</span>1000<span class="main">,</span>1000<span class="main">]</span>1000<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>