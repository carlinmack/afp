<div id="Calculus">
<div class="head">
<h1>Theory Calculus</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Calculi Based on a Redundancy Criterion
 *  Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2018-2020 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Calculi Based on a Redundancy Criterion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section introduces the most basic notions upon which the framework is
  built: consequence relations and inference systems. It also defines the notion
  of a family of consequence relations and of redundancy criteria. This
  corresponds to sections 2.1 and 2.2 of the report.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Calculus
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Ordered_Resolution_Prover/Lazy_List_Liminf.html">Ordered_Resolution_Prover.Lazy_List_Liminf</a>
    <a href="../Ordered_Resolution_Prover/Lazy_List_Chain.html">Ordered_Resolution_Prover.Lazy_List_Chain</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequence Relations›</span></span>

<span class="keyword1"><span class="command">locale</span></span> consequence_relation <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    bot_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bot</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_entails_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    subset_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">⊆</span> <span class="free">N1</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    all_formulas_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">N2</span><span class="main">.</span> <span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    entails_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N2</span> <span class="main">⟹</span> <span class="free">N2</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N3</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N3</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Calculus-entail_set_all_formulas"><span class="command">lemma</span></span> entail_set_all_formulas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N2</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">N2</span><span class="main">.</span> <span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all_formulas_entailed empty_subsetI insert_subset subset_entailed entails_trans<span class="main">)</span>

<span class="keyword1" id="Calculus-entail_union"><span class="command">lemma</span></span> entail_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N1</span> <span class="main">∧</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N2</span> <span class="main">⟷</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N1</span> <span class="main">∪</span> <span class="free">N2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> entail_set_all_formulas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">N1</span></span><span class="main">]</span> entail_set_all_formulas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">N2</span></span><span class="main">]</span>
    entail_set_all_formulas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">∪</span> <span class="free">N2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Calculus-entail_unions"><span class="command">lemma</span></span> entail_unions<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Ni</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Ni</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> entail_set_all_formulas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">Ni</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">]</span> entail_set_all_formulas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span>
    Complete_Lattices.UN_ball_bex_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ni</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1" id="Calculus-entail_all_bot"><span class="command">lemma</span></span> entail_all_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">B'</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">B'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bot_entails_all entails_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Calculus-entails_trans_strong"><span class="command">lemma</span></span> entails_trans_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N2</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="main">∪</span> <span class="free">N2</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N3</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> entail_union entails_trans order_refl subset_entailed<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Families of Consequence Relations›</span></span>

<span class="keyword1"><span class="command">locale</span></span> consequence_relation_family <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Q_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    q_cons_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> consequence_relation <span class="free">Bot</span> <span class="main">(</span><span class="free">entails_q</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Calculus-bot_not_empty"><span class="command">lemma</span></span> bot_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bot</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Q_nonempty consequence_relation.bot_not_empty consequence_relation_family.q_cons_rel
    consequence_relation_family_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entails</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨Q</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1"><span class="free">⊨Q</span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="free">entails_q</span> <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* lem:intersection-of-conseq-rel *)</span>
<span class="keyword1" id="Calculus-intersect_cons_rel_family"><span class="command">lemma</span></span> intersect_cons_rel_family<span class="main">:</span> <span class="quoted"><span class="quoted">"consequence_relation <span class="free">Bot</span> entails"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consequence_relation_def entails_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI bot_not_empty<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> consequence_relation_def q_cons_rel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inference Systems›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'f</span> inference <span class="main">=</span>
  Infer <span class="main">(</span><span class="free"><span class="entity">prems_of</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">concl_of</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span>"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> inference_system <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inf_from</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Inf_from</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inf_between</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Inf_between</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> Inf_from <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">-</span> Inf_from <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Calculus-Inf_if_Inf_from"><span class="command">lemma</span></span> Inf_if_Inf_from<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Inf_from <span class="free">N</span> <span class="main">⟹</span> <span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Calculus-Inf_if_Inf_between"><span class="command">lemma</span></span> Inf_if_Inf_between<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Inf_between <span class="free">N</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_between_def Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Calculus-Inf_between_alt"><span class="command">lemma</span></span> Inf_between_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Inf_between <span class="free">N</span> <span class="free">M</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> <span class="bound">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">∩</span> <span class="free">M</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def Inf_between_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Calculus-Inf_from_mono"><span class="command">lemma</span></span> Inf_from_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> Inf_from <span class="free">N</span> <span class="main">⊆</span> Inf_from <span class="free">N'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Calculus-Inf_between_mono"><span class="command">lemma</span></span> Inf_between_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">⊆</span> <span class="free">M'</span> <span class="main">⟹</span> Inf_between <span class="free">N</span> <span class="free">M</span> <span class="main">⊆</span> Inf_between <span class="free">N'</span> <span class="free">M'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_between_alt <span class="keyword1"><span class="command">using</span></span> Inf_from_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∪</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N'</span> <span class="main">∪</span> <span class="free">M'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Families of Inference Systems›</span></span>

<span class="keyword1"><span class="command">locale</span></span> inference_system_family <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Q_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inf_from_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Inf_from_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> inference_system.Inf_from <span class="main">(</span><span class="free">Inf_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inf_between_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Inf_between_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> inference_system.Inf_between <span class="main">(</span><span class="free">Inf_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Calculus-Inf_between_q_alt"><span class="command">lemma</span></span> Inf_between_q_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Inf_between_q <span class="free">q</span> <span class="free">N</span> <span class="free">M</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_q</span> <span class="free">q</span><span class="main">.</span> <span class="bound">ι</span> <span class="main">∈</span> Inf_from_q <span class="free">q</span> <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">∩</span> <span class="free">M</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_q_def Inf_between_q_def inference_system.Inf_between_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Calculi Based on a Single Redundancy Criterion›</span></span>

<span class="keyword1"><span class="command">locale</span></span> calculus <span class="main">=</span> inference_system <span class="quoted"><span class="free">Inf</span></span> <span class="main">+</span> consequence_relation <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">entails</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 50<span class="main">)</span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Red_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Red_I_to_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Inf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Red_F_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Red_F_of_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="free">Red_F</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="free">N'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Red_I_of_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="free">Red_I</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="free">N'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Red_F_of_Red_F_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N'</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">Red_F</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">N'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Red_I_of_Red_F_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N'</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">Red_I</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">N'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Red_I_of_Inf_to_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span> <span class="main">⟹</span> concl_of <span class="free">ι</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Calculus-Red_I_of_Inf_to_N_subset"><span class="command">lemma</span></span> Red_I_of_Inf_to_N_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> concl_of <span class="bound">ι</span> <span class="main">∈</span> <span class="free">N</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Red_I_of_Inf_to_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* lem:red-concl-implies-red-inf *)</span>
<span class="keyword1" id="Calculus-red_concl_to_red_inf"><span class="command">lemma</span></span> red_concl_to_red_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl<span class="main">:</span> <span class="quoted"><span class="quoted">"concl_of <span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span><span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_I_of_Inf_to_N i_in concl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in_Red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_I_of_Inf_to_N concl i_in<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> red_n_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_F_of_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">Red_F</span> <span class="free">N</span> <span class="main">-</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_of_Red_F_subset i_in_Red
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset subsetCE subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_cancel Diff_subset Un_Diff Un_Diff_cancel contra_subsetD
    calculus.Red_I_of_subset calculus_axioms sup_bot.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">saturated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">saturated</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⟷</span> Inf_from <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reduc_saturated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduc_saturated</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⟷</span> Inf_from <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span>"</span></span>

<span class="keyword1" id="Calculus-Red_I_without_red_F"><span class="command">lemma</span></span> Red_I_without_red_F<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Red_I_of_subset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> Red_I_of_Red_F_subset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Calculus-saturated_without_red_F"><span class="command">lemma</span></span> saturated_without_red_F<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> saturated<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"saturated <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> Inf_from <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> saturated <span class="keyword1"><span class="command">unfolding</span></span> saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_of_Red_F_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set llist <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fair</span> <span class="free"><span class="bound"><span class="entity">Ns</span></span></span> <span class="main">⟷</span> Inf_from <span class="main">(</span>Liminf_llist <span class="free"><span class="bound"><span class="entity">Ns</span></span></span><span class="main">)</span> <span class="main">⊆</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">Ns</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="quoted">"<span class="entity">derive</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊳</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  derive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main"><span class="free">⊳</span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span>"</span></span>

<span class="keyword1" id="Calculus-gt_Max_notin"><span class="command">lemma</span></span> gt_Max_notin<span class="main">:</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&gt;</span> Max <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Calculus-equiv_Sup_Liminf"><span class="command">lemma</span></span> equiv_Sup_Liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    in_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> Sup_llist <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    not_in_Liminf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∉</span> Liminf_llist <span class="free">Ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">.</span> <span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span> <span class="main">-</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> C_D_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> Sup_upto_llist <span class="free">Ns</span> <span class="main">(</span>enat <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_Sup_llist_imp_Sup_upto_llist in_Sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">i</span> <span class="main">∧</span> enat <span class="skolem">j</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">∉</span> lnth <span class="free">Ns</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_Liminf <span class="keyword1"><span class="command">unfolding</span></span> Sup_upto_llist_def chain_def Liminf_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_D_i
    <span class="keyword1"><span class="command">unfolding</span></span> Sup_upto_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> Max <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> k j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">l</span> <span class="main">≥</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_in<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">,</span> <span class="operator">OF</span> _ nempty<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">l</span> <span class="main">-</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j gt_Max_notin<span class="main">[</span><span class="operator">OF</span> _ nempty<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">l</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> l_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Suc_lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_prop j
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_leI dual_order.order_iff_strict enat_ord_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:nonpersistent-is-redundant *)</span>
<span class="keyword1" id="Calculus-Red_in_Sup"><span class="command">lemma</span></span> Red_in_Sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main">(⊳)</span> <span class="free">Ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="free">Ns</span> <span class="main">-</span> Liminf_llist <span class="free">Ns</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> C_in_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Sup_llist <span class="free">Ns</span> <span class="main">-</span> Liminf_llist <span class="free">Ns</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span>
      in_ith_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">i</span> <span class="main">-</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      i<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">i</span> <span class="main">⊳</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i deriv in_ith_elem chain_lnth_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_ith_elem derive.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_of_subset
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> contra_subsetD i lnth_subset_Sup_llist<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equiv_Sup_Liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span><span class="main">]</span> C_in_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:redundant-remains-redundant-during-run 1/2 *)</span>
<span class="keyword1" id="Calculus-Red_I_subset_Liminf"><span class="command">lemma</span></span> Red_I_subset_Liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="free">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i<span class="main">:</span> <span class="quoted"><span class="quoted">‹enat <span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Red_I</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> Sup_in_diff<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Red_I</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span> <span class="main">-</span> Liminf_llist <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_I_of_Red_F_subset<span class="main">[</span><span class="operator">OF</span> Red_in_Sup<span class="main">]</span> deriv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span> <span class="main">-</span> Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> Liminf_llist <span class="free">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Liminf_llist_subset_Sup_llist double_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Red_I_Sup_in_Liminf<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Red_I</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_in_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹lnth <span class="free">Ns</span> <span class="free">i</span> <span class="main">⊆</span> Sup_llist <span class="free">Ns</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_of_subset
    <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_Sup_in_Liminf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:redundant-remains-redundant-during-run 2/2 *)</span>
<span class="keyword1" id="Calculus-Red_F_subset_Liminf"><span class="command">lemma</span></span> Red_F_subset_Liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="free">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i<span class="main">:</span> <span class="quoted"><span class="quoted">‹enat <span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Red_F</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> Sup_in_diff<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span> <span class="main">-</span> Liminf_llist <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_F_of_Red_F_subset<span class="main">[</span><span class="operator">OF</span> Red_in_Sup<span class="main">]</span> deriv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span> <span class="main">-</span> Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> Liminf_llist <span class="free">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Liminf_llist_subset_Sup_llist double_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Red_F_Sup_in_Liminf<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_in_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹lnth <span class="free">Ns</span> <span class="free">i</span> <span class="main">⊆</span> Sup_llist <span class="free">Ns</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_of_subset
    <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_Sup_in_Liminf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:N-i-is-persistent-or-redundant *)</span>
<span class="keyword1" id="Calculus-i_in_Liminf_or_Red_F"><span class="command">lemma</span></span> i_in_Liminf_or_Red_F<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="free">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i<span class="main">:</span> <span class="quoted"><span class="quoted">‹enat <span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹lnth <span class="free">Ns</span> <span class="free">i</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">∪</span> Liminf_llist <span class="free">Ns</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="free">i</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C_not_Liminf<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∉</span> Liminf_llist <span class="free">Ns</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> Sup_llist <span class="free">Ns</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">using</span></span> C i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">j</span> <span class="main">-</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹enat <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_Sup_Liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="free">Ns</span></span><span class="main">]</span> C_not_Liminf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chain_lnth_rel contra_subsetD derive.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_subset_Liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span>"</span></span><span class="main">]</span> deriv j<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:fairness-implies-saturation *)</span>
<span class="keyword1" id="Calculus-fair_implies_Liminf_saturated"><span class="command">lemma</span></span> fair_implies_Liminf_saturated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="free">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fair<span class="main">:</span> <span class="quoted"><span class="quoted">‹fair <span class="free">Ns</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹saturated <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> saturated_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> ι<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="free">Ns</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> fair ι <span class="keyword1"><span class="command">unfolding</span></span> fair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">‹enat <span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv i_in_Liminf_or_Red_F<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> Red_I_subset_Liminf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> statically_complete_calculus <span class="main">=</span> calculus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> statically_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> saturated <span class="free">N</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Calculus-dynamically_complete_Liminf"><span class="command">lemma</span></span> dynamically_complete_Liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="free">Ns</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    bot_elem<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="free">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fair<span class="main">:</span> <span class="quoted"><span class="quoted">‹fair <span class="free">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unsat<span class="main">:</span> <span class="quoted"><span class="quoted">‹lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> Liminf_llist <span class="free">Ns</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> lhd_is <span class="main">=</span> lhd_conv_lnth<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> lnull <span class="free">Ns</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> chain_not_lnull<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> subs<span class="main">:</span> <span class="quoted"><span class="quoted">‹lhd <span class="free">Ns</span> <span class="main">⊆</span> Sup_llist <span class="free">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> lhd_subset_Sup_llist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span><span class="main">]</span> non_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lhd_conv_lnth<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> unsat subset_entailed<span class="main">[</span><span class="operator">OF</span> subs<span class="main">]</span> entails_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Sup_llist <span class="free">Ns</span>"</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">Ns</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Sup_no_Red<span class="main">:</span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> bot_elem Red_F_Bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Sup_no_Red_in_Liminf<span class="main">:</span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> Liminf_llist <span class="free">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv Red_in_Sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Liminf_entails_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">‹Liminf_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_no_Red subset_entailed<span class="main">[</span><span class="operator">OF</span> Sup_no_Red_in_Liminf<span class="main">]</span> entails_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹saturated <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv fair fair_implies_Liminf_saturated <span class="keyword1"><span class="command">unfolding</span></span> saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> bot_elem statically_complete Liminf_entails_Bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> dynamically_complete_calculus <span class="main">=</span> calculus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    dynamically_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> chain <span class="main">(⊳)</span> <span class="free">Ns</span> <span class="main">⟹</span> fair <span class="free">Ns</span> <span class="main">⟹</span> lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* lem:dynamic-ref-compl-implies-static *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> statically_complete_calculus
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    bot_elem<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    saturated_N<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    refut_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">=</span> LCons <span class="skolem">N</span> LNil"</span></span>
  <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> lnull <span class="skolem">Ns</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deriv_Ns<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="skolem">Ns</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain.chain_singleton Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> liminf_is_N<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="skolem">Ns</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def Liminf_llist_LCons<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> head_Ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> lhd <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="skolem">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">Red_I</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fair_Ns<span class="main">:</span> <span class="quoted"><span class="quoted">"fair <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> saturated_N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fair_def saturated_def liminf_is_N<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> B'_is_bot<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B'</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> B'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> lnth <span class="skolem">Ns</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="skolem">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> dynamically_complete<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">Ns</span></span><span class="main">]</span> bot_elem fair_Ns head_Ns saturated_N deriv_Ns refut_N
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ns_def enat_0_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> B'_is_bot B'_in <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> head_Ns<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Ns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* lem:static-ref-compl-implies-dynamic *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> statically_complete_calculus <span class="main">⊆</span> dynamically_complete_calculus
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">Ns</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="skolem">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">‹fair <span class="skolem">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">‹lhd <span class="skolem">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> Liminf_llist <span class="skolem">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dynamically_complete_Liminf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="skolem">Ns</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> lnth <span class="skolem">Ns</span> <span class="bound">i</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Intersection_Calculus">
<div class="head">
<h1>Theory Intersection_Calculus</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Calculi Based on the Intersection of Redundancy Criteria
 *  Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2018-2020 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Calculi Based on the Intersection of Redundancy Criteria›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, section 2.3 of the report is covered, on calculi
  equipped with a family of redundancy criteria.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Intersection_Calculus
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Calculus.html">Calculus</a>
    <a href="../Ordered_Resolution_Prover/Lazy_List_Liminf.html">Ordered_Resolution_Prover.Lazy_List_Liminf</a>
    <a href="../Ordered_Resolution_Prover/Lazy_List_Chain.html">Ordered_Resolution_Prover.Lazy_List_Chain</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Calculi with a Family of Redundancy Criteria›</span></span>

<span class="keyword1"><span class="command">locale</span></span> intersection_calculus <span class="main">=</span>
  inference_system <span class="quoted"><span class="free">Inf</span></span> <span class="main">+</span> consequence_relation_family <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">entails_q</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Red_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Q_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    all_red_crit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="main">(</span><span class="free">entails_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_F_q</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="free">Red_F_q</span> <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* lem:intersection-of-red-crit *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted">entails</span> <span class="quoted">Red_I</span> <span class="quoted">Red_F</span>
  <span class="keyword1"><span class="command">unfolding</span></span> calculus_def calculus_axioms_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"consequence_relation <span class="free">Bot</span> entails"</span></span>
  <span class="keyword1"><span class="command">using</span></span> intersect_cons_rel_family <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">.</span> Red_I <span class="bound">N</span> <span class="main">⊆</span> <span class="free">Inf</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Inf</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Inter_subset<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Red_Is</span>
      <span class="keyword3"><span class="command">assume</span></span> one_red_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Red_Is</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">`</span> <span class="free">Q</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Red_Is</span> <span class="main">⊆</span> <span class="free">Inf</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> one_red_inf all_red_crit calculus.Red_I_to_Inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">`</span> <span class="free">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Q_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟶</span> <span class="bound">N</span> <span class="keyword1">⊨Q</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">N</span> <span class="main">-</span> Red_F <span class="bound">N</span> <span class="keyword1">⊨Q</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
    <span class="keyword3"><span class="command">assume</span></span>
      B_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      N_unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1">⊨Q</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> Red_F <span class="skolem">N</span> <span class="keyword1">⊨Q</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> entails_def Red_F_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qi</span>
      <span class="keyword3"><span class="command">assume</span></span> qi_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">entails_qi</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨qi</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">entails_qi</span> <span class="main">=</span> <span class="free">entails_q</span> <span class="skolem">qi</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> cons_rel_qi<span class="main">:</span> <span class="quoted"><span class="quoted">"consequence_relation <span class="free">Bot</span> <span class="skolem">entails_qi</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> entails_qi_def <span class="keyword1"><span class="command">using</span></span> qi_in all_red_crit calculus.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Red_F_qi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Red_F_qi</span> <span class="main">=</span> <span class="free">Red_F_q</span> <span class="skolem">qi</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> red_qi_in<span class="main">:</span> <span class="quoted"><span class="quoted">"Red_F <span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">Red_F_qi</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def Red_F_qi_def <span class="keyword1"><span class="command">using</span></span> qi_in image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> <span class="skolem">Red_F_qi</span> <span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">N</span> <span class="main">-</span> Red_F <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> entails_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> Red_F <span class="skolem">N</span> <span class="keyword1"><span class="skolem">⊨qi</span></span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">Red_F_qi</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> qi_in all_red_crit
        <span class="keyword1"><span class="command">unfolding</span></span> calculus_def consequence_relation_def entails_qi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> N_unsat_qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1"><span class="skolem">⊨qi</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qi_in N_unsat <span class="keyword1"><span class="command">unfolding</span></span> entails_qi_def entails_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> N_unsat_qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> <span class="skolem">Red_F_qi</span> <span class="skolem">N</span> <span class="keyword1"><span class="skolem">⊨qi</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> qi_in all_red_crit Red_F_qi_def calculus.Red_F_Bot<span class="main">[</span><span class="operator">OF</span> _ B_in<span class="main">]</span> entails_qi_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="free">Red_F_q</span> <span class="bound">q</span> <span class="skolem">N</span><span class="main">)</span> <span class="keyword1"><span class="skolem">⊨qi</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> consequence_relation.entails_trans<span class="main">[</span><span class="operator">OF</span> cons_rel_qi entails_1 N_unsat_qi<span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N1</span> <span class="bound">N2</span><span class="main">.</span> <span class="bound">N1</span> <span class="main">⊆</span> <span class="bound">N2</span> <span class="main">⟶</span> Red_F <span class="bound">N1</span> <span class="main">⊆</span> Red_F <span class="bound">N2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">N2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      N1_in_N2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">⊆</span> <span class="skolem">N2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_F <span class="skolem">N1</span> <span class="main">⊆</span> Red_F <span class="skolem">N2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Red_F <span class="skolem">N1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="bound">qi</span> <span class="skolem">N1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="bound">qi</span> <span class="skolem">N2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> N1_in_N2 all_red_crit calculus.axioms<span class="main">(</span>2<span class="main">)</span> calculus.Red_F_of_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Red_F <span class="skolem">N2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N1</span> <span class="bound">N2</span><span class="main">.</span> <span class="bound">N1</span> <span class="main">⊆</span> <span class="bound">N2</span> <span class="main">⟶</span> Red_I <span class="bound">N1</span> <span class="main">⊆</span> Red_I <span class="bound">N2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">N2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      N1_in_N2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">⊆</span> <span class="skolem">N2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_I <span class="skolem">N1</span> <span class="main">⊆</span> Red_I <span class="skolem">N2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="skolem">N1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="bound">qi</span> <span class="skolem">N1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="bound">qi</span> <span class="skolem">N2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> N1_in_N2 all_red_crit calculus.axioms<span class="main">(</span>2<span class="main">)</span> calculus.Red_I_of_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="skolem">N2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N2</span> <span class="bound">N1</span><span class="main">.</span> <span class="bound">N2</span> <span class="main">⊆</span> Red_F <span class="bound">N1</span> <span class="main">⟶</span> Red_F <span class="bound">N1</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="bound">N1</span> <span class="main">-</span> <span class="bound">N2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N2</span> <span class="skolem">N1</span>
    <span class="keyword3"><span class="command">assume</span></span> N2_in_Red_N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N2</span> <span class="main">⊆</span> Red_F <span class="skolem">N1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_F <span class="skolem">N1</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="skolem">N1</span> <span class="main">-</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Red_F <span class="skolem">N1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="bound">qi</span> <span class="skolem">N1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">N2</span> <span class="main">⊆</span> <span class="free">Red_F_q</span> <span class="bound">qi</span> <span class="skolem">N1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N2_in_Red_N1 <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="bound">qi</span> <span class="main">(</span><span class="skolem">N1</span> <span class="main">-</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_red_crit calculus.axioms<span class="main">(</span>2<span class="main">)</span> calculus.Red_F_of_Red_F_subset
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Red_F <span class="main">(</span><span class="skolem">N1</span> <span class="main">-</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N2</span> <span class="bound">N1</span><span class="main">.</span> <span class="bound">N2</span> <span class="main">⊆</span> Red_F <span class="bound">N1</span> <span class="main">⟶</span> Red_I <span class="bound">N1</span> <span class="main">⊆</span> Red_I <span class="main">(</span><span class="bound">N1</span> <span class="main">-</span> <span class="bound">N2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N2</span> <span class="skolem">N1</span>
    <span class="keyword3"><span class="command">assume</span></span> N2_in_Red_N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N2</span> <span class="main">⊆</span> Red_F <span class="skolem">N1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_I <span class="skolem">N1</span> <span class="main">⊆</span> Red_I <span class="main">(</span><span class="skolem">N1</span> <span class="main">-</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="skolem">N1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="bound">qi</span> <span class="skolem">N1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">N2</span> <span class="main">⊆</span> <span class="free">Red_F_q</span> <span class="bound">qi</span> <span class="skolem">N1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N2_in_Red_N1 <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="bound">qi</span> <span class="main">(</span><span class="skolem">N1</span> <span class="main">-</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_red_crit calculus.axioms<span class="main">(</span>2<span class="main">)</span> calculus.Red_I_of_Red_F_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="main">(</span><span class="skolem">N1</span> <span class="main">-</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf</span> <span class="main">⟶</span> concl_of <span class="bound">ι</span> <span class="main">∈</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> Red_I <span class="bound">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span> <span class="skolem">N</span>
    <span class="keyword3"><span class="command">assume</span></span>
      i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      concl_in<span class="main">:</span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="bound">qi</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_red_crit calculus.axioms<span class="main">(</span>2<span class="main">)</span> calculus.Red_I_of_Inf_to_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:satur-wrt-intersection-of-red *)</span>
<span class="keyword1" id="Intersection_Calculus-sat_int_to_sat_q"><span class="command">lemma</span></span> sat_int_to_sat_q<span class="main">:</span> <span class="quoted"><span class="quoted">"calculus.saturated <span class="free">Inf</span> Red_I <span class="free">N</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> calculus.saturated <span class="free">Inf</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="bound">qi</span><span class="main">)</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">N</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span> inter_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"calculus.saturated <span class="free">Inf</span> Red_I <span class="skolem">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> calculus.saturated <span class="free">Inf</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="bound">qi</span><span class="main">)</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qi</span>
    <span class="keyword3"><span class="command">assume</span></span> qi_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> one<span class="main">:</span> calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="skolem">qi</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_red_crit<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one.saturated <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> qi_in inter_sat
      <span class="keyword1"><span class="command">unfolding</span></span> one.saturated_def saturated_def Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span> all_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> calculus.saturated <span class="free">Inf</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="bound">qi</span><span class="main">)</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> saturated_def Red_I_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
    <span class="keyword3"><span class="command">assume</span></span> ι_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Red_I_qi</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="main">`</span> <span class="free">Q</span><span class="main">.</span> <span class="skolem">ι</span> <span class="main">∈</span> <span class="bound">Red_I_qi</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Red_I_qi</span>
      <span class="keyword3"><span class="command">assume</span></span> red_inf_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Red_I_qi</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="main">`</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qi</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        qi_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        red_inf_qi_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Red_I_qi</span> <span class="main">=</span> <span class="free">Red_I_q</span> <span class="skolem">qi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> one<span class="main">:</span> calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="skolem">qi</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_red_crit<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one.saturated <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qi_in all_sat red_inf_qi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="skolem">Red_I_qi</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> one.saturated_def <span class="keyword1"><span class="command">using</span></span> ι_in red_inf_qi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:checking-static-ref-compl-for-intersections *)</span>
<span class="keyword1" id="Intersection_Calculus-stat_ref_comp_from_bot_in_sat"><span class="command">lemma</span></span> stat_ref_comp_from_bot_in_sat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">N</span><span class="main">.</span> calculus.saturated <span class="free">Inf</span> Red_I <span class="bound">N</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∉</span> <span class="bound">N</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="main">∃</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="main">¬</span> <span class="free">entails_q</span> <span class="bound">qi</span> <span class="bound">N</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> entails Red_I Red_F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span>
    N_saturated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span>calculus.saturated <span class="free">Inf</span> Red_I <span class="bound">N</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∉</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="main">∃</span><span class="bound">qi</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="main">¬</span> <span class="free">entails_q</span> <span class="bound">qi</span> <span class="bound">N</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_stat_ref_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="keyword1">(⊨Q)</span> Red_I Red_F"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1_in<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">∈</span> <span class="free">Bot</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N1_saturated<span class="main">:</span> <span class="quoted"><span class="quoted">"calculus.saturated <span class="free">Inf</span> Red_I <span class="skolem">N1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    N1_unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="keyword1">⊨Q</span> <span class="main">{</span><span class="skolem">B1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_B_in_N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∉</span> <span class="skolem">N1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_stat_ref_comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculus_axioms statically_complete_calculus.intro
        statically_complete_calculus_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">qi</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    qi_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">entails_q</span> <span class="skolem">qi</span> <span class="skolem">N1</span> <span class="main">{</span><span class="skolem">B2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_saturated N1_saturated no_B_in_N1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="keyword1">⊨Q</span> <span class="main">{</span><span class="skolem">B2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N1_unsat B1_in intersect_cons_rel_family
    <span class="keyword1"><span class="command">unfolding</span></span> consequence_relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="skolem">qi</span> <span class="skolem">N1</span> <span class="main">{</span><span class="skolem">B2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> entails_def <span class="keyword1"><span class="command">using</span></span> qi_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_qi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Calculus_Variations">
<div class="head">
<h1>Theory Calculus_Variations</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Variations on a Theme
 *  Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2018-2020 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Variations on a Theme›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, section 2.4 of the report is covered, demonstrating
  that various notions of redundancy are equivalent.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Calculus_Variations
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Calculus.html">Calculus</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> reduced_calculus <span class="main">=</span> calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted"><span class="free">Red_I</span></span> <span class="quoted"><span class="free">Red_F</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span>
 <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span>
   inf_in_red_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* lem:reduced-rc-implies-sat-equiv-reduced-sat *)</span>
<span class="keyword1" id="Calculus_Variations-sat_eq_reduc_sat"><span class="command">lemma</span></span> sat_eq_reduc_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">⟷</span> reduc_saturated <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_I_without_red_F saturated_without_red_F
    <span class="keyword1"><span class="command">unfolding</span></span> saturated_def reduc_saturated_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span> red_sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="skolem">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> saturated_def
    <span class="keyword1"><span class="command">using</span></span> red_sat_n inf_in_red_inf <span class="keyword1"><span class="command">unfolding</span></span> reduc_saturated_def Inf_from_def Inf_between_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> reducedly_statically_complete_calculus <span class="main">=</span> calculus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reducedly_statically_complete<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> reduc_saturated <span class="free">N</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> reducedly_statically_complete_reduced_calculus <span class="main">=</span> reduced_calculus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reducedly_statically_complete<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> reduc_saturated <span class="free">N</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> reducedly_statically_complete_calculus
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculus_axioms reducedly_statically_complete
    reducedly_statically_complete_calculus_axioms.intro
    reducedly_statically_complete_calculus_def<span class="main">)</span>

<span class="comment1">(* cor:reduced-rc-implies-st-ref-comp-equiv-reduced-st-ref-comp 1/2 *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> statically_complete_calculus
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    bot_elem<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    saturated_N<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    refut_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> reduc_saturated_N<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> saturated_N sat_eq_reduc_sat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reducedly_statically_complete<span class="main">[</span><span class="operator">OF</span> bot_elem reduc_saturated_N refut_N<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> reduced_calculus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* cor:reduced-rc-implies-st-ref-comp-equiv-reduced-st-ref-comp 2/2 *)</span>
<span class="keyword1" id="Calculus_Variations-stat_ref_comp_imp_red_stat_ref_comp"><span class="command">lemma</span></span> stat_ref_comp_imp_red_stat_ref_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">⟹</span>
   reducedly_statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    stat_ref_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="main"><span class="free">(⊨)</span></span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_elem<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    saturated_N<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    refut_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> reduc_saturated_N<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> saturated_N sat_eq_reduc_sat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> statically_complete_calculus.statically_complete<span class="main">[</span><span class="operator">OF</span> stat_ref_comp
      bot_elem reduc_saturated_N refut_N<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> calculus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_Red_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_Red_I</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Calculus_Variations-reduced_calc_is_calc"><span class="command">lemma</span></span> reduced_calc_is_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_Red_I <span class="skolem">N</span> <span class="main">⊆</span> <span class="free">Inf</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_Red_I_def Inf_between_def Inf_from_def <span class="keyword1"><span class="command">using</span></span> Red_I_to_Inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_entails<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_F_Bot b_in n_entails<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">N'</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="skolem">N</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="skolem">N'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_F_of_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">N'</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">(</span><span class="free">Red_F</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Inf_from <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">(</span><span class="free">Red_F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_F_of_subset<span class="main">[</span><span class="operator">OF</span> n_in<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="skolem">N'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Inf_between_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_Red_I <span class="skolem">N</span> <span class="main">⊆</span> Red_Red_I <span class="skolem">N'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_Red_I_def <span class="keyword1"><span class="command">using</span></span> Red_I_of_subset<span class="main">[</span><span class="operator">OF</span> n_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N'</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="skolem">N</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_F_of_Red_F_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> np_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N'</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="skolem">N</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_F_of_Red_F_subset np_subs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">(</span><span class="free">Red_F</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Inf_from <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">(</span><span class="free">Red_F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset Red_F_of_subset eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Inf_between_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_Red_I <span class="skolem">N</span> <span class="main">⊆</span> Red_Red_I <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_Red_I_def <span class="keyword1"><span class="command">using</span></span> Red_I_of_Red_F_subset<span class="main">[</span><span class="operator">OF</span> np_subs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span>
    <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_Red_I <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_I_of_Inf_to_N Red_Red_I_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Calculus_Variations-inf_subs_reduced_red_inf"><span class="command">lemma</span></span> inf_subs_reduced_red_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf_between UNIV <span class="main">(</span><span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> Red_Red_I <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* lem:red'-is-reduced-redcrit *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following is a lemma and not a sublocale as was previously used in similar cases.
  Here, a sublocale cannot be used because it would create an infinitely descending
  chain of sublocales. ›</span></span>
<span class="keyword1" id="Calculus_Variations-reduc_calc"><span class="command">lemma</span></span> reduc_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_subs_reduced_red_inf reduced_calc_is_calc
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reduced_calculus.intro reduced_calculus_axioms_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> reduc_calc<span class="main">:</span> reduced_calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted">Red_Red_I</span> <span class="quoted"><span class="free">Red_F</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> reduc_calc<span class="main">)</span>

<span class="comment1">(* lem:saturation-red-vs-red'-1 *)</span>
<span class="keyword1" id="Calculus_Variations-sat_imp_red_calc_sat"><span class="command">lemma</span></span> sat_imp_red_calc_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">⟹</span> reduc_calc.saturated <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> saturated_def reduc_calc.saturated_def Red_Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* lem:saturation-red-vs-red'-2 1/2 (i) ⟷ (ii) *)</span>
<span class="keyword1" id="Calculus_Variations-red_sat_eq_red_calc_sat"><span class="command">lemma</span></span> red_sat_eq_red_calc_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="free">N</span> <span class="main">⟷</span> reduc_calc.saturated <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> red_sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="free">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduc_calc.saturated <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reduc_calc.saturated_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
    <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="free">N</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_Red_I <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in red_sat_n
      <span class="keyword1"><span class="command">unfolding</span></span> reduc_saturated_def Inf_between_def Inf_from_def Red_Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> red_sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_calc.saturated <span class="free">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reduc_saturated_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
    <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in red_sat_n
      <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def reduc_calc.saturated_def Red_Red_I_def Inf_between_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:saturation-red-vs-red'-2 2/2 (i) ⟷ (iii) *)</span>
<span class="keyword1" id="Calculus_Variations-red_sat_eq_sat"><span class="command">lemma</span></span> red_sat_eq_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="free">N</span> <span class="main">⟷</span> saturated <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reduc_saturated_def saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_I_without_red_F<span class="main">)</span>

<span class="comment1">(* thm:reduced-stat-ref-compl 1/3 (i) ⟷ (iii) *)</span>
<span class="keyword1"><span class="command">theorem</span></span> stat_is_stat_red<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">⟷</span>
  statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    stat_ref1<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reduc_calc.calculus_axioms
    <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def statically_complete_calculus_axioms_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟶</span> reduc_calc.saturated <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
      <span class="keyword3"><span class="command">assume</span></span>
        b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        n_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_calc.saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        n_imp_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"saturated <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> red_sat_eq_red_calc_sat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span> red_sat_eq_sat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span> n_sat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_imp_b b_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reduc_calc.Red_F_Bot<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span><span class="main">∈</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> stat_ref1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffD1 b_in statically_complete_calculus.statically_complete<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    stat_ref3<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def statically_complete_calculus_axioms_def
    <span class="keyword1"><span class="command">using</span></span> calculus_axioms
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟶</span> saturated <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
      <span class="keyword3"><span class="command">assume</span></span>
        b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        n_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        n_imp_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span> <span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> stat_ref3 sat_imp_red_calc_sat<span class="main">[</span><span class="operator">OF</span> n_sat<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> statically_complete_calculus.statically_complete<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* thm:reduced-stat-ref-compl 2/3 (iv) ⟷ (iii) *)</span>
<span class="keyword1"><span class="command">theorem</span></span> red_stat_red_is_stat_red<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reducedly_statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span> <span class="main">⟷</span>
   statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reduc_calc.stat_ref_comp_imp_red_stat_ref_comp
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reduc_calc.sat_eq_reduc_sat reducedly_statically_complete_calculus.axioms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
    reducedly_statically_complete_calculus_axioms_def reduced_calc_is_calc
    statically_complete_calculus.intro statically_complete_calculus_axioms.intro<span class="main">)</span>

<span class="comment1">(* thm:reduced-stat-ref-compl 3/3 (ii) ⟷ (iii) *)</span>
<span class="keyword1"><span class="command">theorem</span></span> red_stat_is_stat_red<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reducedly_statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">⟷</span>
   statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reduc_calc.calculus_axioms calculus_axioms red_sat_eq_red_calc_sat
  <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def statically_complete_calculus_axioms_def
    reducedly_statically_complete_calculus_def reducedly_statically_complete_calculus_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Calculus_Variations-sup_red_f_in_red_liminf"><span class="command">lemma</span></span> sup_red_f_in_red_liminf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"chain derive <span class="free">Ns</span> <span class="main">⟹</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_F</span> <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain derive <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_in_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_F</span> <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i0</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i0</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">i0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_in_sup <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_llist_imp_exists_index llength_lmap lnth_lmap<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">i0</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_smaller <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv Red_F_subset_Liminf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Calculus_Variations-sup_red_inf_in_red_liminf"><span class="command">lemma</span></span> sup_red_inf_in_red_liminf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"chain derive <span class="free">Ns</span> <span class="main">⟹</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain derive <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_in_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i0</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i0</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">i0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_sup <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">i0</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_smaller <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv Red_I_subset_Liminf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reduc_fair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set llist <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduc_fair</span> <span class="free"><span class="bound"><span class="entity">Ns</span></span></span> <span class="main">⟷</span>
   Inf_from <span class="main">(</span>Liminf_llist <span class="free"><span class="bound"><span class="entity">Ns</span></span></span> <span class="main">-</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_F</span> <span class="free"><span class="bound"><span class="entity">Ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">Ns</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* lem:red-fairness-implies-red-saturation *)</span>
<span class="keyword1" id="Calculus_Variations-reduc_fair_imp_Liminf_reduc_sat"><span class="command">lemma</span></span> reduc_fair_imp_Liminf_reduc_sat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"chain derive <span class="free">Ns</span> <span class="main">⟹</span> reduc_fair <span class="free">Ns</span> <span class="main">⟹</span> reduc_saturated <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reduc_saturated_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ns</span>
  <span class="keyword3"><span class="command">assume</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain derive <span class="skolem">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    red_fair<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_fair <span class="skolem">Ns</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊆</span> Inf_from <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span> <span class="main">-</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_F</span> <span class="skolem">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_red_f_in_red_liminf<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="skolem">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> red_fair <span class="keyword1"><span class="command">unfolding</span></span> reduc_fair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_red_inf_in_red_liminf<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> reducedly_dynamically_complete_calculus <span class="main">=</span> calculus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    reducedly_dynamically_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> chain derive <span class="free">Ns</span> <span class="main">⟹</span> reduc_fair <span class="free">Ns</span> <span class="main">⟹</span>
      lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> reducedly_statically_complete_calculus
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    bot_elem<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    saturated_N<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    refut_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">=</span> LCons <span class="skolem">N</span> LNil"</span></span>
  <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> lnull <span class="skolem">Ns</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deriv_D<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="skolem">Ns</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain.chain_singleton Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> liminf_is_N<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="skolem">Ns</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def Liminf_llist_LCons<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> head_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> lhd <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="main">(</span>lmap <span class="free">Red_F</span> <span class="skolem">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">Red_F</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="main">(</span>lmap <span class="free">Red_I</span> <span class="skolem">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">Red_I</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> fair_D<span class="main">:</span> <span class="quoted"><span class="quoted">"reduc_fair <span class="skolem">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> saturated_N liminf_is_N <span class="keyword1"><span class="command">unfolding</span></span> reduc_fair_def reduc_saturated_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reduc_fair_def reduc_saturated_def liminf_is_N<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> B'_is_bot<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B'</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> B'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> lnth <span class="skolem">Ns</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="skolem">Ns</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> reducedly_dynamically_complete<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">Ns</span></span><span class="main">]</span> bot_elem fair_D head_D saturated_N deriv_D refut_N
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ns_def enat_0_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> B'_is_bot B'_in <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> head_D<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Ns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> reducedly_statically_complete_calculus <span class="main">⊆</span> reducedly_dynamically_complete_calculus
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">Ns</span>
  <span class="keyword3"><span class="command">assume</span></span>
    bot_elem<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">‹chain <span class="main">(⊳)</span> <span class="skolem">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fair<span class="main">:</span> <span class="quoted"><span class="quoted">‹reduc_fair <span class="skolem">Ns</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unsat<span class="main">:</span> <span class="quoted"><span class="quoted">‹lhd <span class="skolem">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> lnull <span class="skolem">Ns</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> chain_not_lnull<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> subs<span class="main">:</span> <span class="quoted"><span class="quoted">‹lhd <span class="skolem">Ns</span> <span class="main">⊆</span> Sup_llist <span class="skolem">Ns</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> lhd_subset_Sup_llist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ns</span></span><span class="main">]</span> non_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lhd_conv_lnth<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="skolem">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> unsat subset_entailed<span class="main">[</span><span class="operator">OF</span> subs<span class="main">]</span> entails_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Sup_llist <span class="skolem">Ns</span>"</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">Ns</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Sup_no_Red<span class="main">:</span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="skolem">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="skolem">Ns</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> bot_elem Red_F_Bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> Sup_no_Red_in_Liminf<span class="main">:</span> <span class="quoted"><span class="quoted">‹Sup_llist <span class="skolem">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="skolem">Ns</span><span class="main">)</span> <span class="main">⊆</span> Liminf_llist <span class="skolem">Ns</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv Red_in_Sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> Liminf_entails_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">‹Liminf_llist <span class="skolem">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Sup_no_Red subset_entailed<span class="main">[</span><span class="operator">OF</span> Sup_no_Red_in_Liminf<span class="main">]</span> entails_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹reduc_saturated <span class="main">(</span>Liminf_llist <span class="skolem">Ns</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv fair reduc_fair_imp_Liminf_reduc_sat <span class="keyword1"><span class="command">unfolding</span></span> reduc_saturated_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> Liminf_llist <span class="skolem">Ns</span>›</span></span>
     <span class="keyword1"><span class="command">using</span></span> bot_elem reducedly_statically_complete Liminf_entails_Bot
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="skolem">Ns</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span><span class="free">Bot</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> lnth <span class="skolem">Ns</span> <span class="bound">i</span>›</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> calculus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Calculus_Variations-dyn_equiv_stat"><span class="command">lemma</span></span> dyn_equiv_stat<span class="main">:</span> <span class="quoted"><span class="quoted">"dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">=</span>
  statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> dynamically_complete_calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted"><span class="free">Red_I</span></span> <span class="quoted"><span class="free">Red_F</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> statically_complete_calculus_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> statically_complete_calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted"><span class="free">Red_I</span></span> <span class="quoted"><span class="free">Red_F</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dynamically_complete_calculus_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Calculus_Variations-red_dyn_equiv_red_stat"><span class="command">lemma</span></span> red_dyn_equiv_red_stat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reducedly_dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">=</span>
   reducedly_statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"reducedly_dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> reducedly_dynamically_complete_calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted"><span class="free">Red_I</span></span> <span class="quoted"><span class="free">Red_F</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reducedly_statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reducedly_statically_complete_calculus_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"reducedly_statically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> reducedly_statically_complete_calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted"><span class="free">Red_I</span></span> <span class="quoted"><span class="free">Red_F</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reducedly_dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reducedly_dynamically_complete_calculus_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> reduc_calc<span class="main">:</span> reduced_calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">entails</span></span> <span class="quoted">Red_Red_I</span> <span class="quoted"><span class="free">Red_F</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> reduc_calc<span class="main">)</span>

<span class="comment1">(* thm:reduced-dyn-ref-compl 1/3 (v) ⟷ (vii) *)</span>
<span class="keyword1"><span class="command">theorem</span></span> dyn_ref_eq_dyn_ref_red<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">⟷</span>
   dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dyn_equiv_stat stat_is_stat_red reduc_calc.dyn_equiv_stat <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="comment1">(* thm:reduced-dyn-ref-compl 2/3 (viii) ⟷ (vii) *)</span>
<span class="keyword1"><span class="command">theorem</span></span> red_dyn_ref_red_eq_dyn_ref_red<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reducedly_dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span> <span class="main">⟷</span>
   dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> red_dyn_equiv_red_stat dyn_equiv_stat red_stat_red_is_stat_red
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reduc_calc.dyn_equiv_stat reduc_calc.red_dyn_equiv_red_stat<span class="main">)</span>

<span class="comment1">(* thm:reduced-dyn-ref-compl 3/3 (vi) ⟷ (vii) *)</span>
<span class="keyword1"><span class="command">theorem</span></span> red_dyn_ref_eq_dyn_ref_red<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reducedly_dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> <span class="free">Red_I</span> <span class="free">Red_F</span> <span class="main">⟷</span>
   dynamically_complete_calculus <span class="free">Bot</span> <span class="free">Inf</span> <span class="free">entails</span> Red_Red_I <span class="free">Red_F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> red_dyn_equiv_red_stat dyn_equiv_stat red_stat_is_stat_red
    reduc_calc.dyn_equiv_stat reduc_calc.red_dyn_equiv_red_stat
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lifting_to_Non_Ground_Calculi">
<div class="head">
<h1>Theory Lifting_to_Non_Ground_Calculi</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Lifting to Non-Ground Calculi
 *  Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2018-2020 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lifting to Non-ground Calculi›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The section 3.1 to 3.3 of the report are covered by the current section.
  Various forms of lifting are proven correct. These allow to obtain the dynamic
  refutational completeness of a non-ground calculus from the static refutational
  completeness of its ground counterpart.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lifting_to_Non_Ground_Calculi
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Intersection_Calculus.html">Intersection_Calculus</a>
    <a href="Calculus_Variations.html">Calculus_Variations</a>
    <a href="../Well_Quasi_Orders/Minimal_Elements.html">Well_Quasi_Orders.Minimal_Elements</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Standard Lifting›</span></span>

<span class="keyword1"><span class="command">locale</span></span> standard_lifting <span class="main">=</span> inference_system <span class="quoted"><span class="free">Inf_F</span></span> <span class="main">+</span>
  ground<span class="main">:</span> calculus <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="free">entails_G</span></span> <span class="quoted"><span class="free">Red_I_G</span></span> <span class="quoted"><span class="free">Red_F_G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_G</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨G</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Bot_F_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bot_F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bot_map_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span> <span class="main">⟹</span> <span class="free">𝒢_F</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bot_map<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span> <span class="main">⟹</span> <span class="free">𝒢_F</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">Bot_G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bot_cond<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">𝒢_F</span> <span class="free">C</span> <span class="main">∩</span> <span class="free">Bot_G</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="free">C</span> <span class="main">∈</span> <span class="free">Bot_F</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inf_map<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> <span class="free">𝒢_I</span> <span class="free">ι</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_Fset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_Fset</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-𝒢_subset"><span class="command">lemma</span></span> 𝒢_subset<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">N1</span> <span class="main">⊆</span> <span class="free">N2</span> <span class="main">⟹</span> 𝒢_Fset <span class="free">N1</span> <span class="main">⊆</span> 𝒢_Fset <span class="free">N2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">entails_𝒢</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨𝒢</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1"><span class="free">⊨𝒢</span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">≡</span> 𝒢_Fset <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1"><span class="free">⊨G</span></span> 𝒢_Fset <span class="free"><span class="bound"><span class="entity">N2</span></span></span>›</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-subs_Bot_G_entails"><span class="command">lemma</span></span> subs_Bot_G_entails<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">sB</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_bot<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">sB</span> <span class="main">⊆</span> <span class="free">Bot_G</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sB</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="free">N</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">sB</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">sB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r_trans<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ground.bot_entails_all in_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l_trans<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">sB</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> B_in ground.subset_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r_trans ground.entails_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">sB</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:derived-consequence-relation *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> consequence_relation <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted">entails_𝒢</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bot_F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bot_F_not_empty <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span><span class="main">∈</span><span class="free">Bot_F</span> <span class="main">⟹</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Bot_map ground.bot_entails_all<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="skolem">N</span>"</span></span><span class="main">]</span> subs_Bot_G_entails Bot_map_not_empty
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N1</span> <span class="skolem">N2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">N2</span> <span class="main">⊆</span> <span class="skolem">N1</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> 𝒢_subset ground.subset_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N1</span> <span class="skolem">N2</span>
  <span class="keyword3"><span class="command">assume</span></span>
    N1_entails_C<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="skolem">N2</span><span class="main">.</span> <span class="skolem">N1</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ground.all_formulas_entailed N1_entails_C
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> UN_E UN_I ground.entail_set_all_formulas singletonI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N1</span> <span class="skolem">N2</span> <span class="skolem">N3</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N2</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N3</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="keyword1">⊨𝒢</span> <span class="skolem">N3</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ground.entails_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_I_𝒢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Red_I_𝒢</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒢_I</span> <span class="bound">ι</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span>
  <span class="main">∨</span> <span class="main">(</span><span class="free">𝒢_I</span> <span class="bound">ι</span> <span class="main">=</span> None <span class="main">∧</span> <span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F_𝒢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Red_F_𝒢</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strong Standard Lifting›</span></span>

<span class="comment1">(* rmk:strong-standard-lifting *)</span>
<span class="keyword1"><span class="command">locale</span></span> strong_standard_lifting <span class="main">=</span> inference_system <span class="quoted"><span class="free">Inf_F</span></span> <span class="main">+</span>
  ground<span class="main">:</span> calculus <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="free">entails_G</span></span> <span class="quoted"><span class="free">Red_I_G</span></span> <span class="quoted"><span class="free">Red_F_G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_G</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set  <span class="main">⇒</span> <span class="tfree">'g</span> set  <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨G</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Bot_F_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bot_F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bot_map_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span> <span class="main">⟹</span> <span class="free">𝒢_F</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bot_map<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span> <span class="main">⟹</span> <span class="free">𝒢_F</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">Bot_G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bot_cond<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">𝒢_F</span> <span class="free">C</span> <span class="main">∩</span> <span class="free">Bot_G</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="free">C</span> <span class="main">∈</span> <span class="free">Bot_F</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    strong_inf_map<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> <span class="free">𝒢_I</span> <span class="free">ι</span> <span class="main">≠</span> None <span class="main">⟹</span> concl_of <span class="main">`</span> <span class="main">(</span>the <span class="main">(</span><span class="free">𝒢_I</span> <span class="free">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inf_map_in_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> <span class="free">𝒢_I</span> <span class="free">ι</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Inf_G</span>›</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> standard_lifting <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(⊨G)</span></span>"</span></span> <span class="quoted"><span class="free">Red_I_G</span></span> <span class="quoted"><span class="free">Red_F_G</span></span> <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">𝒢_F</span></span> <span class="quoted"><span class="free">𝒢_I</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bot_F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bot_F_not_empty <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
  <span class="keyword3"><span class="command">assume</span></span> b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F</span> <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bot_map_not_empty<span class="main">[</span><span class="operator">OF</span> b_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
  <span class="keyword3"><span class="command">assume</span></span> b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="free">Bot_G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bot_map<span class="main">[</span><span class="operator">OF</span> b_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="free">𝒢_F</span> <span class="bound">C</span> <span class="main">∩</span> <span class="free">Bot_G</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bot_cond <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    some_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I</span> <span class="skolem">ι</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ιG</span>
    <span class="keyword3"><span class="command">assume</span></span> ig_in1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ιG</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ig_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ιG</span> <span class="main">∈</span> <span class="free">Inf_G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_map_in_Inf<span class="main">[</span><span class="operator">OF</span> i_in some_g<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ιG</span> <span class="main">∈</span> <span class="free">Red_I_G</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strong_inf_map<span class="main">[</span><span class="operator">OF</span> i_in some_g<span class="main">]</span> ground.Red_I_of_Inf_to_N<span class="main">[</span><span class="operator">OF</span> ig_in2<span class="main">]</span>
        ig_in1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lifting with a Family of Tiebreaker Orderings›</span></span>

<span class="keyword1"><span class="command">locale</span></span> tiebreaker_lifting <span class="main">=</span>
  empty_ord<span class="main">?</span><span class="main">:</span> standard_lifting <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="free">entails_G</span></span> <span class="quoted"><span class="free">Red_I_G</span></span> <span class="quoted"><span class="free">Red_F_G</span></span> <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">𝒢_F</span></span> <span class="quoted"><span class="free">𝒢_I</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨G</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Prec_F_g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    all_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_element <span class="main">(</span><span class="free">Prec_F_g</span> <span class="free">g</span><span class="main">)</span> UNIV"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F_𝒢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Red_F_𝒢</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">D</span> <span class="bound">E</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span><span class="main">}</span>›</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Prec_trans"><span class="command">lemma</span></span> Prec_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="free">D</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="free">D</span> <span class="free">B</span> <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="free">D</span> <span class="free">A</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> minimal_element.po assms <span class="keyword1"><span class="command">unfolding</span></span> po_on_def transp_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> UNIV_I all_wf<span class="main">)</span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-prop_nested_in_set"><span class="command">lemma</span></span> prop_nested_in_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> <span class="free">P</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">P</span> <span class="bound">C</span><span class="main">.</span> <span class="free">A</span> <span class="bound">D</span> <span class="main">∨</span> <span class="free">B</span> <span class="bound">C</span> <span class="bound">D</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="free">D</span> <span class="main">∨</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* lem:wolog-C'-nonredundant *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_F_𝒢_equiv_def"><span class="command">lemma</span></span> Red_F_𝒢_equiv_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹Red_F_𝒢 <span class="free">N</span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Di</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">Di</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span><span class="main">)</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">Di</span> <span class="bound">E</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">Di</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">D</span>
  <span class="keyword3"><span class="command">assume</span></span>
    C_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> Red_F_𝒢 <span class="free">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    not_sec_case<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">⟶</span> <span class="skolem">D</span> <span class="main">∉</span> <span class="free">𝒢_F</span> <span class="bound">E</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> C_in_unfolded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Di</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">Di</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">Di</span> <span class="bound">E</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">Di</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C_in <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> neg_not_sec_case<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_sec_case <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">have</span></span> unfol_C_D<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> prop_nested_in_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">D</span></span> <span class="quoted"><span class="free">𝒢_F</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">y</span> <span class="bound">E</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> D_in C_in_unfolded<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> contrad<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∉</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> contrad unfol_C_D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">E</span></span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> B_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> minimal_element <span class="quoted"><span class="quoted">"<span class="free">Prec_F_g</span> <span class="skolem">D</span>"</span></span> <span class="quoted">UNIV</span> <span class="keyword1"><span class="command">using</span></span> all_wf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">D</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> min_elt <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> D_in_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">using</span></span> non_empty
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Sup_UNIV Sup_upper UNIV_I contra_subsetD empty_iff empty_subsetI mem_Collect_eq
        min_elt_mem unfol_C_D<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> F_prec<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="skolem">F</span> <span class="skolem">C</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> F min_elt_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span><span class="main">,</span> <span class="operator">OF</span> _ B_non_empty<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> F_not_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∉</span> Red_F_𝒢 <span class="free">N</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> F_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> Red_F_𝒢 <span class="free">N</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> unfol_F_D<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">G</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">G</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">G</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> F_in D_in_F <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">G</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">G</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">G</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> contrad D_in <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> G_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">∈</span> <span class="free">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_prec<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="skolem">G</span> <span class="skolem">F</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_map<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="skolem">G</span> <span class="skolem">C</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> G_prec F_prec Prec_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">using</span></span> G_in G_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹False›</span></span> <span class="keyword1"><span class="command">using</span></span> F G_prec min_elt_minimal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">,</span> <span class="operator">OF</span> _ B_non_empty<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_def B_non_empty mem_Collect_eq min_elt_mem top_greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> F_not_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹False›</span></span>
      <span class="keyword1"><span class="command">using</span></span> D_in_F neg_not_sec_case F_prec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> only_if<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">D</span><span class="main">∈</span><span class="free">𝒢_F</span> <span class="skolem">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> Red_F_𝒢 <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">using</span></span> only_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:lifting-main-technical *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-not_red_map_in_map_not_red"><span class="command">lemma</span></span> not_red_map_in_map_not_red<span class="main">:</span> <span class="quoted"><span class="quoted">‹𝒢_Fset <span class="free">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span>
  <span class="keyword3"><span class="command">assume</span></span>
    D_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> 𝒢_Fset <span class="free">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> minimal_element <span class="quoted"><span class="quoted">"<span class="free">Prec_F_g</span> <span class="skolem">D</span>"</span></span> <span class="quoted">UNIV</span> <span class="keyword1"><span class="command">using</span></span> all_wf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">D</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> D_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> 𝒢_Fset <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> D_hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>  D_not_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∉</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> D_hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> exist_C<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">C</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> D_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">C</span></span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">C</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> min_elt <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> C_in_N<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">N</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> exist_C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_def C empty_iff mem_Collect_eq min_elt_mem top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> D_in_C<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> exist_C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_def C empty_iff mem_Collect_eq min_elt_mem top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C_not_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∉</span> Red_F_𝒢 <span class="free">N</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> C_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> Red_F_𝒢 <span class="free">N</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> C_in D_in_C <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹False›</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹False›</span></span> <span class="keyword1"><span class="command">using</span></span> D_not_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="free">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹False›</span></span>
          <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> B_def UNIV_I empty_iff mem_Collect_eq
              min_elt_minimal top_greatest<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> 𝒢_Fset <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> D_in_C C_not_in C_in_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="comment1">(* lem:nonredundant-entails-redundant *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_F_Bot_F"><span class="command">lemma</span></span> Red_F_Bot_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span> <span class="main">⟹</span> <span class="free">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">-</span> Red_F_𝒢 <span class="free">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    N_entails<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> to_bot<span class="main">:</span> <span class="quoted"><span class="quoted">‹𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="free">𝒢_F</span> <span class="skolem">B</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ground.Red_F_Bot Bot_map
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cSup_singleton ground.entail_set_all_formulas image_insert image_is_empty subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> from_f<span class="main">:</span> <span class="quoted"><span class="quoted">‹𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span> <span class="keyword1"><span class="free">⊨G</span></span> 𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ground.subset_entailed<span class="main">[</span><span class="operator">OF</span> not_red_map_in_map_not_red<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="free">𝒢_F</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> to_bot ground.entails_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Bot_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:redundancy-monotonic-addition 1/2 *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_F_of_subset_F"><span class="command">lemma</span></span> Red_F_of_subset_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> Red_F_𝒢 <span class="free">N</span> <span class="main">⊆</span> Red_F_𝒢 <span class="free">N'</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> ground.Red_F_of_subset <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">meson</span> 𝒢_subset subsetD<span class="main">)</span>

<span class="comment1">(* lem:redundancy-monotonic-addition 2/2 *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_I_of_subset_F"><span class="command">lemma</span></span> Red_I_of_subset_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> Red_I_𝒢 <span class="free">N</span> <span class="main">⊆</span> Red_I_𝒢 <span class="free">N'</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> Collect_mono 𝒢_subset subset_iff ground.Red_I_of_subset <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> ground.Red_F_of_subset Un_iff<span class="main">)</span>

<span class="comment1">(* lem:redundancy-monotonic-deletion-forms *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_F_of_Red_F_subset_F"><span class="command">lemma</span></span> Red_F_of_Red_F_subset_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">N'</span> <span class="main">⊆</span> Red_F_𝒢 <span class="free">N</span> <span class="main">⟹</span> Red_F_𝒢 <span class="free">N</span> <span class="main">⊆</span> Red_F_𝒢 <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">N'</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span>
    N'_in_Red_F_N<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">⊆</span> Red_F_𝒢 <span class="skolem">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C_in_red_F_N<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> Red_F_𝒢 <span class="skolem">N</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> lem8<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_F_𝒢_equiv_def C_in_red_F_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> Red_F_𝒢 <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">C</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> lem8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ground.Red_F_of_Red_F_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="skolem">N</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ground.Red_F_of_subset<span class="main">[</span><span class="operator">OF</span> not_red_map_in_map_not_red<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> N'_in_Red_F_N 𝒢_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> DiffE DiffI ground.Red_F_of_subset subsetCE subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">E</span><span class="main">∈</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="bound">E</span> <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="bound">E</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        E_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span><span class="main">∈</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        E_prec_C<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">Prec_F_g</span> <span class="skolem">D</span> <span class="skolem">E</span> <span class="skolem">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        D_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">E</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> E_in N'_in_Red_F_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E_prec_C D_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:redundancy-monotonic-deletion-infs *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_I_of_Red_F_subset_F"><span class="command">lemma</span></span> Red_I_of_Red_F_subset_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">N'</span> <span class="main">⊆</span> Red_F_𝒢 <span class="free">N</span> <span class="main">⟹</span> Red_I_𝒢 <span class="free">N</span> <span class="main">⊆</span> Red_I_𝒢 <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">N'</span><span class="main">)</span> ›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span>
    N'_in_Red_F_N<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">⊆</span> Red_F_𝒢 <span class="skolem">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_in_Red_I_N<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="skolem">N</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> i_in_Red_I_N <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> not_none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I</span> <span class="skolem">ι</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">ι'</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="bound">ι'</span> <span class="main">∈</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_none i_in_Red_I_N <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">ι'</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="bound">ι'</span> <span class="main">∈</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_none ground.Red_I_of_Red_F_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ip_in_Red_I_G<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">ι'</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="bound">ι'</span> <span class="main">∈</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_none ground.Red_I_of_subset<span class="main">[</span><span class="operator">OF</span> not_red_map_in_map_not_red<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> not_none_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">ι'</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="bound">ι'</span> <span class="main">∈</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_none N'_in_Red_F_N
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_mono ground.Red_I_of_subset 𝒢_subset subset_iff subset_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">𝒢_I</span> <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I</span> <span class="skolem">ι</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ground_concl_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span> <span class="main">∪</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> none i_in_Red_I_N <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d_in_imp12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">∈</span> 𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">∨</span> <span class="free">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d_in_imp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> 𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">∈</span> 𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_red_map_in_map_not_red N'_in_Red_F_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d_in_imp_d_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ground.Red_F_of_Red_F_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="skolem">N</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g_subs1<span class="main">:</span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="skolem">N</span> <span class="main">-</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_red_map_in_map_not_red <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g_subs2<span class="main">:</span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N'_in_Red_F_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d_in_imp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">∈</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ground.Red_F_of_subset ground.Red_F_of_subset<span class="main">[</span><span class="operator">OF</span> g_subs1<span class="main">]</span>
        ground.Red_F_of_subset<span class="main">[</span><span class="operator">OF</span> g_subs2<span class="main">]</span> d_in_imp_d_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span> <span class="main">∪</span> <span class="free">Red_F_G</span> <span class="main">(</span>𝒢_Fset <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_in_imp12 d_in_imp1 d_in_imp2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> ground.Red_F_of_Red_F_subset ground.Red_F_of_subset UnCI UnE Un_Diff_cancel2
        ground_concl_subs g_subs1 g_subs2 subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:concl-contained-implies-red-inf *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-Red_I_of_Inf_to_N_F"><span class="command">lemma</span></span> Red_I_of_Inf_to_N_F<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    i_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl_i_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹concl_of <span class="free">ι</span> <span class="main">∈</span> <span class="free">N</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="free">N</span> ›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> <span class="free">𝒢_I</span> <span class="free">ι</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> inf_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Red_I_G</span> <span class="main">(</span><span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> concl_i_in ground.Red_I_of_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> <span class="free">𝒢_I</span> <span class="free">ι</span> <span class="main">=</span> None <span class="main">⟹</span> concl_of <span class="free">ι</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">𝒢_F</span> <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_in concl_i_in <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* thm:FRedsqsubset-is-red-crit and also thm:lifted-red-crit if ordering empty *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> calculus <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted">entails_𝒢</span> <span class="quoted">Red_I_𝒢</span> <span class="quoted">Red_F_𝒢</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span> <span class="skolem">N'</span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Red_I_𝒢 <span class="skolem">N</span> <span class="main">⊆</span> <span class="free">Inf_F</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span> <span class="main">⟹</span> <span class="skolem">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">N</span> <span class="main">-</span> Red_F_𝒢 <span class="skolem">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_Bot_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">N'</span> <span class="main">⟹</span> Red_F_𝒢 <span class="skolem">N</span> <span class="main">⊆</span> Red_F_𝒢 <span class="skolem">N'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_of_subset_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">N'</span> <span class="main">⟹</span> Red_I_𝒢 <span class="skolem">N</span> <span class="main">⊆</span> Red_I_𝒢 <span class="skolem">N'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_of_subset_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">⊆</span> Red_F_𝒢 <span class="skolem">N</span> <span class="main">⟹</span> Red_F_𝒢 <span class="skolem">N</span> <span class="main">⊆</span> Red_F_𝒢 <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_F_of_Red_F_subset_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">⊆</span> Red_F_𝒢 <span class="skolem">N</span> <span class="main">⟹</span> Red_I_𝒢 <span class="skolem">N</span> <span class="main">⊆</span> Red_I_𝒢 <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="skolem">N'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_of_Red_F_subset_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> concl_of <span class="skolem">ι</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Red_I_of_Inf_to_N_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-wf_empty_rel"><span class="command">lemma</span></span> wf_empty_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_element <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minimal_element.intro po_on_def transp_onI wfp_on_imp_irreflp_on<span class="main">)</span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-standard_empty_tiebreaker_equiv"><span class="command">lemma</span></span> standard_empty_tiebreaker_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_lifting <span class="free">Inf_F</span> <span class="free">Bot_G</span> <span class="free">Inf_G</span> <span class="free">entails_G</span> <span class="free">Red_I_G</span>
  <span class="free">Red_F_G</span> <span class="free">Bot_F</span> <span class="free">𝒢_F</span> <span class="free">𝒢_I</span> <span class="main">=</span> tiebreaker_lifting <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="free">Bot_G</span> <span class="free">entails_G</span> <span class="free">Inf_G</span> <span class="free">Red_I_G</span>
  <span class="free">Red_F_G</span> <span class="free">𝒢_F</span> <span class="free">𝒢_I</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">C</span> <span class="bound">C'</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tiebreaker_lifting_axioms <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">C</span> <span class="bound">C'</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tiebreaker_lifting_axioms_def <span class="keyword1"><span class="command">using</span></span> wf_empty_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> standard_lifting_def tiebreaker_lifting_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> standard_lifting
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">interpretation</span></span> empt_ord<span class="main">:</span> tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">entails_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="free">Red_I_G</span></span>
    <span class="quoted"><span class="free">Red_F_G</span></span> <span class="quoted"><span class="free">𝒢_F</span></span> <span class="quoted"><span class="free">𝒢_I</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">C</span> <span class="bound">C'</span><span class="main">.</span> False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> standard_empty_tiebreaker_equiv <span class="keyword1"><span class="command">using</span></span> standard_lifting_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1" id="Lifting_to_Non_Ground_Calculi-red_f_equiv"><span class="command">lemma</span></span> red_f_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"empt_ord.Red_F_𝒢 <span class="main">=</span> Red_F_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_def empt_ord.Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">sublocale</span></span> calc<span class="main">?</span><span class="main">:</span> calculus <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted">entails_𝒢</span> <span class="quoted">Red_I_𝒢</span> <span class="quoted">Red_F_𝒢</span>
    <span class="keyword1"><span class="command">using</span></span> empt_ord.calculus_axioms red_f_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1" id="Lifting_to_Non_Ground_Calculi-grounded_inf_in_ground_inf"><span class="command">lemma</span></span> grounded_inf_in_ground_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> <span class="free">𝒢_I</span> <span class="free">ι</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Inf_G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_map ground.Red_I_to_Inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ground_Inf_overapproximated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ground_Inf_overapproximated</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> ground.Inf_from <span class="main">(</span>𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>
      <span class="main">⊆</span> <span class="main">{</span><span class="bound">ι</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span><span class="main">∈</span> Inf_from <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="free">𝒢_I</span> <span class="bound">ι'</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="bound">ι</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="bound">ι'</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* abbreviation "saturated ≡ calc.saturated" *)</span>

  <span class="keyword1" id="Lifting_to_Non_Ground_Calculi-sat_inf_imp_ground_red"><span class="command">lemma</span></span> sat_inf_imp_ground_red<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span>
      <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">ι'</span> <span class="main">∈</span> Inf_from <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">𝒢_I</span> <span class="free">ι'</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">ι</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="free">ι'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Red_I_𝒢_def <span class="keyword1"><span class="command">unfolding</span></span> saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* lem:sat-wrt-finf *)</span>
  <span class="keyword1" id="Lifting_to_Non_Ground_Calculi-sat_imp_ground_sat"><span class="command">lemma</span></span> sat_imp_ground_sat<span class="main">:</span>
    <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">⟹</span> ground_Inf_overapproximated <span class="free">N</span> <span class="main">⟹</span> ground.saturated <span class="main">(</span>𝒢_Fset <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ground.saturated_def <span class="keyword1"><span class="command">using</span></span> sat_inf_imp_ground_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* thm:finf-complete *)</span>
  <span class="keyword1"><span class="command">theorem</span></span> stat_ref_comp_to_non_ground<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span>
      stat_ref_G<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_G</span> <span class="free">Inf_G</span> <span class="free">entails_G</span> <span class="free">Red_I_G</span> <span class="free">Red_F_G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      sat_n_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">N</span><span class="main">.</span> saturated <span class="bound">N</span> <span class="main">⟹</span> ground_Inf_overapproximated <span class="bound">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
      <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails_𝒢 Red_I_𝒢 Red_F_𝒢"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
    <span class="keyword3"><span class="command">assume</span></span>
      b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      n_entails_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ground_n_entails<span class="main">:</span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="skolem">N</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="free">𝒢_F</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n_entails_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">BG</span></span> <span class="keyword2"><span class="keyword">where</span></span> bg_in1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BG</span> <span class="main">∈</span> <span class="free">𝒢_F</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Bot_map_not_empty<span class="main">[</span><span class="operator">OF</span> b_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bg_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BG</span> <span class="main">∈</span> <span class="free">Bot_G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Bot_map<span class="main">[</span><span class="operator">OF</span> b_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> ground_n_entails_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"𝒢_Fset <span class="skolem">N</span> <span class="keyword1"><span class="free">⊨G</span></span> <span class="main">{</span><span class="skolem">BG</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ground_n_entails bg_in1 ground.entail_set_all_formulas <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground.Inf_from <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span>
      <span class="main">{</span><span class="bound">ι</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span><span class="main">∈</span> Inf_from <span class="skolem">N</span><span class="main">.</span> <span class="free">𝒢_I</span> <span class="bound">ι'</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="bound">ι</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I</span> <span class="bound">ι'</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sat_n_imp<span class="main">[</span><span class="operator">OF</span> sat_n<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground.saturated <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sat_imp_ground_sat<span class="main">[</span><span class="operator">OF</span> sat_n sat_n_imp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sat_n<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BG'</span><span class="main">∈</span><span class="free">Bot_G</span><span class="main">.</span> <span class="bound">BG'</span> <span class="main">∈</span> <span class="main">(</span>𝒢_Fset <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> stat_ref_G ground.calculus_axioms bg_in ground_n_entails_bot
      <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def statically_complete_calculus_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span> <span class="free">Bot_F</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bg_in Bot_cond Bot_map_not_empty Bot_cond
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> tiebreaker_lifting 
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="comment1">(* lem:saturation-indep-of-sqsubset *)</span>
  <span class="keyword1" id="Lifting_to_Non_Ground_Calculi-saturated_empty_order_equiv_saturated"><span class="command">lemma</span></span> saturated_empty_order_equiv_saturated<span class="main">:</span>
    <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">=</span> calc.saturated <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    
    <span class="comment1">(* lem:static-ref-compl-indep-of-sqsubset *)</span>
  <span class="keyword1" id="Lifting_to_Non_Ground_Calculi-static_empty_order_equiv_static"><span class="command">lemma</span></span> static_empty_order_equiv_static<span class="main">:</span>
    <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails_𝒢 Red_I_𝒢 Red_F_𝒢 <span class="main">=</span>
      statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails_𝒢 Red_I_𝒢 empty_ord.Red_F_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">standard</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* thm:FRedsqsubset-is-dyn-ref-compl *)</span>
  <span class="keyword1"><span class="command">theorem</span></span> static_to_dynamic<span class="main">:</span>
    <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails_𝒢 Red_I_𝒢 empty_ord.Red_F_𝒢 <span class="main">=</span>
      dynamically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails_𝒢 Red_I_𝒢 Red_F_𝒢"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dyn_equiv_stat static_empty_order_equiv_static
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lifting with a Family of Redundancy Criteria›</span></span>

<span class="keyword1"><span class="command">locale</span></span> lifting_intersection <span class="main">=</span> inference_system <span class="quoted"><span class="free">Inf_F</span></span> <span class="main">+</span>
  ground<span class="main">:</span> inference_system_family <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">Inf_G_q</span></span> <span class="main">+</span>
  ground<span class="main">:</span> consequence_relation_family <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">entails_q</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_F_g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    standard_lifting_family<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> tiebreaker_lifting <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">entails_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="bound">q</span><span class="main">)</span>
         <span class="main">(</span><span class="free">Red_F_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span><span class="main">)</span> <span class="free">Prec_F_g</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_Fset_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒢_Fset_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_I_𝒢_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I_𝒢_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span>
   <span class="main">∨</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι</span> <span class="main">=</span> None <span class="main">∧</span> <span class="free">𝒢_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>concl_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F_𝒢_empty_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F_𝒢_empty_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F_𝒢_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F_𝒢_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span>
   <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="free">Prec_F_g</span> <span class="bound">D</span> <span class="bound">E</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">𝒢_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">E</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">entails_𝒢_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">entails_𝒢_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">≡</span> <span class="free">entails_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-red_crit_lifting_family"><span class="command">lemma</span></span> red_crit_lifting_family<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="main">(</span>entails_𝒢_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Red_I_𝒢_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Red_F_𝒢_q <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> wf_lift<span class="main">:</span>
    tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="free">q</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="free">Prec_F_g</span></span>
    <span class="keyword1"><span class="command">using</span></span> standard_lifting_family q_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_I_𝒢_q <span class="free">q</span> <span class="main">=</span> wf_lift.Red_I_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def wf_lift.Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_F_𝒢_q <span class="free">q</span> <span class="main">=</span> wf_lift.Red_F_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_q_def wf_lift.Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_lift.calculus_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-red_crit_lifting_family_empty_ord"><span class="command">lemma</span></span> red_crit_lifting_family_empty_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="main">(</span>entails_𝒢_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Red_I_𝒢_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Red_F_𝒢_empty_q <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> wf_lift<span class="main">:</span>
    tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="free">q</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="free">Prec_F_g</span></span>
    <span class="keyword1"><span class="command">using</span></span> standard_lifting_family q_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_I_𝒢_q <span class="free">q</span> <span class="main">=</span> wf_lift.Red_I_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def wf_lift.Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_F_𝒢_empty_q <span class="free">q</span> <span class="main">=</span> wf_lift.empty_ord.Red_F_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_empty_q_def wf_lift.empty_ord.Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_lift.calc.calculus_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> consequence_relation_family <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted">entails_𝒢_q</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ground.Q_nonempty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qi</span>
  <span class="keyword3"><span class="command">assume</span></span> qi_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> lift<span class="main">:</span> tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="skolem">qi</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="skolem">qi</span>"</span></span> <span class="quoted"><span class="free">Prec_F_g</span></span>
    <span class="keyword1"><span class="command">using</span></span> qi_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> standard_lifting_family<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"consequence_relation <span class="free">Bot_F</span> <span class="main">(</span>entails_𝒢_q <span class="skolem">qi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> intersection_calculus <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted">entails_𝒢_q</span> <span class="quoted">Red_I_𝒢_q</span> <span class="quoted">Red_F_𝒢_q</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_nonempty red_crit_lifting_family<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">entails_𝒢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨∩𝒢</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(⊨∩𝒢)</span></span> <span class="main">≡</span> entails"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Red_I_𝒢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I_𝒢</span> <span class="main">≡</span> Red_I"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Red_F_𝒢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F_𝒢</span> <span class="main">≡</span> Red_F"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> entails_𝒢_def <span class="main">=</span> entails_def
<span class="keyword1"><span class="command">lemmas</span></span> Red_I_𝒢_def <span class="main">=</span> Red_I_def
<span class="keyword1"><span class="command">lemmas</span></span> Red_F_𝒢_def <span class="main">=</span> Red_F_def

<span class="keyword1"><span class="command">sublocale</span></span> empty_ord<span class="main">:</span> intersection_calculus <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted">entails_𝒢_q</span> <span class="quoted">Red_I_𝒢_q</span> <span class="quoted">Red_F_𝒢_empty_q</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_nonempty red_crit_lifting_family_empty_ord<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Red_F_𝒢_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F_𝒢_empty</span> <span class="main">≡</span> empty_ord.Red_F"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Red_F_𝒢_empty_def <span class="main">=</span> empty_ord.Red_F_def

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-sat_inf_imp_ground_red_fam_inter"><span class="command">lemma</span></span> sat_inf_imp_ground_red_fam_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι'</span> <span class="main">∈</span> Inf_from <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    grounding<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="free">q</span> <span class="free">ι'</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">ι</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free">q</span> <span class="free">ι'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Red_I_q</span> <span class="free">q</span> <span class="main">(</span>𝒢_Fset_q <span class="free">q</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι'</span> <span class="main">∈</span> Red_I_𝒢_q <span class="free">q</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sat_n i'_in q_in all_red_crit calculus.saturated_def sat_int_to_sat_q
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free">q</span> <span class="free">ι'</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="free">q</span> <span class="main">(</span>𝒢_Fset_q <span class="free">q</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_I_𝒢_q_def grounding<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grounding <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ground_Inf_overapproximated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground_Inf_overapproximated</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span>
   ground.Inf_from_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>
   <span class="main">⊆</span> <span class="main">{</span><span class="bound">ι</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span><span class="main">∈</span> Inf_from <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="free">𝒢_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι'</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="bound">ι</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι'</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">Red_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ground_saturated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground_saturated</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> ground.Inf_from_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-sat_imp_ground_sat_fam_inter"><span class="command">lemma</span></span> sat_imp_ground_sat_fam_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">⟹</span> ground_Inf_overapproximated <span class="free">q</span> <span class="free">N</span> <span class="main">⟹</span> ground_saturated <span class="free">q</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sat_inf_imp_ground_red_fam_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* thm:intersect-finf-complete *)</span>
<span class="keyword1"><span class="command">theorem</span></span> stat_ref_comp_to_non_ground_fam_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    stat_ref_G<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> statically_complete_calculus <span class="free">Bot_G</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">entails_q</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="bound">q</span><span class="main">)</span>
        <span class="main">(</span><span class="free">Red_F_q</span> <span class="bound">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    sat_n_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">N</span><span class="main">.</span> saturated <span class="bound">N</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> ground_Inf_overapproximated <span class="bound">q</span> <span class="bound">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails_𝒢 Red_I_𝒢 Red_F_𝒢_empty"</span></span>
    <span class="keyword1"><span class="command">using</span></span> empty_ord.calculus_axioms <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def
      statically_complete_calculus_axioms_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span>
    b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    entails_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1">⊨∩𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inf_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"ground.Inf_from_q <span class="skolem">q</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span>
      <span class="main">{</span><span class="bound">ι</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span><span class="main">∈</span> Inf_from <span class="skolem">N</span><span class="main">.</span> <span class="free">𝒢_I_q</span> <span class="skolem">q</span> <span class="bound">ι'</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="bound">ι</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q</span> <span class="bound">ι'</span><span class="main">)</span><span class="main">}</span>
      <span class="main">∪</span> <span class="free">Red_I_q</span> <span class="skolem">q</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sat_n_imp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> q_calc<span class="main">:</span> calculus <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="quoted">"entails_𝒢_q <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"Red_I_𝒢_q <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"Red_F_𝒢_q <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_red_crit<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> n_q_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"q_calc.saturated <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_in sat_int_to_sat_q sat_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> lifted_q_calc<span class="main">:</span>
    tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="skolem">q</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> standard_lifting_family<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> n_lift_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"lifted_q_calc.calc.saturated <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_q_sat <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def lifted_q_calc.Red_I_𝒢_def
      lifted_q_calc.saturated_def q_calc.saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ground_sat_n<span class="main">:</span> <span class="quoted"><span class="quoted">"lifted_q_calc.ground.saturated <span class="main">(</span>𝒢_Fset_q <span class="skolem">q</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lifted_q_calc.sat_imp_ground_sat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n_lift_sat<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">use</span> n_lift_sat inf_subs ground.Inf_from_q_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ground_n_entails_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"entails_𝒢_q <span class="skolem">q</span> <span class="skolem">N</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_in entails_bot <span class="keyword1"><span class="command">unfolding</span></span> entails_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> statically_complete_calculus <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="skolem">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stat_ref_G<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">BG</span></span> <span class="keyword2"><span class="keyword">where</span></span> bg_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BG</span> <span class="main">∈</span> <span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lifted_q_calc.Bot_map_not_empty<span class="main">[</span><span class="operator">OF</span> b_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">BG</span> <span class="main">∈</span> <span class="free">Bot_G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lifted_q_calc.Bot_map<span class="main">[</span><span class="operator">OF</span> b_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BG'</span><span class="main">∈</span><span class="free">Bot_G</span><span class="main">.</span> <span class="bound">BG'</span> <span class="main">∈</span> 𝒢_Fset_q <span class="skolem">q</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ground_sat_n ground_n_entails_bot statically_complete<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">BG</span></span><span class="main">,</span> <span class="operator">OF</span> _ ground_sat_n<span class="main">]</span>
      bg_in lifted_q_calc.ground.entail_set_all_formulas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝒢_Fset_q <span class="skolem">q</span> <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"𝒢_Fset_q <span class="skolem">q</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span><span class="main">∈</span> <span class="free">Bot_F</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lifted_q_calc.Bot_cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:intersect-saturation-indep-of-sqsubset *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-sat_eq_sat_empty_order"><span class="command">lemma</span></span> sat_eq_sat_empty_order<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">=</span> empty_ord.saturated <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>

<span class="comment1">(* lem:intersect-static-ref-compl-indep-of-sqsubset *)</span>
<span class="keyword1" id="Lifting_to_Non_Ground_Calculi-static_empty_ord_inter_equiv_static_inter"><span class="command">lemma</span></span> static_empty_ord_inter_equiv_static_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails Red_I Red_F <span class="main">=</span>
  statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails Red_I Red_F_𝒢_empty"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> statically_complete_calculus_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_ord.calculus_axioms calculus_axioms<span class="main">)</span>

<span class="comment1">(* thm:intersect-static-ref-compl-is-dyn-ref-compl-with-order *)</span>
<span class="keyword1"><span class="command">theorem</span></span> stat_eq_dyn_ref_comp_fam_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span>
    entails Red_I Red_F_𝒢_empty <span class="main">=</span>
  dynamically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> entails Red_I Red_F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dyn_equiv_stat static_empty_ord_inter_equiv_static_inter
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Labeled_Lifting_to_Non_Ground_Calculi">
<div class="head">
<h1>Theory Labeled_Lifting_to_Non_Ground_Calculi</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Labeled Lifting to Non-Ground Calculi
 *  Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2019-2020 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Labeled Lifting to Non-Ground Calculi›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section formalizes the extension of the lifting results to labeled
  calculi. This corresponds to section 3.4 of the report.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Labeled_Lifting_to_Non_Ground_Calculi
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Lifting_to_Non_Ground_Calculi.html">Lifting_to_Non_Ground_Calculi</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-po_on_empty_rel"><span class="command">lemma</span></span> po_on_empty_rel<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"po_on <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> po_on_def irreflp_on_def transp_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Labeled Lifting with a Family of Tiebreaker Orderings›</span></span>

<span class="keyword1"><span class="command">locale</span></span> labeled_tiebreaker_lifting <span class="main">=</span> no_labels<span class="main">:</span> tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span>
  <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">entails_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="free">Red_I_G</span></span> <span class="quoted"><span class="free">Red_F_G</span></span> <span class="quoted"><span class="free">𝒢_F</span></span> <span class="quoted"><span class="free">𝒢_I</span></span> <span class="quoted"><span class="free">Prec_F</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨G</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Inf_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Inf_F_to_Inf_FL<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> length <span class="main">(</span><span class="free">Ll</span> <span class="main">::</span> <span class="tfree">'l</span> list<span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">L0</span><span class="main">.</span> Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span><span class="main">)</span> <span class="free">Ll</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span><span class="main">,</span> <span class="bound">L0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Inf_FL</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Inf_FL_to_Inf_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∈</span> <span class="free">Inf_FL</span> <span class="main">⟹</span> Infer <span class="main">(</span>map fst <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>concl_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Inf_F</span>›</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference <span class="main">⇒</span> <span class="tfree">'f</span> inference›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">to_F</span> <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span> <span class="main">=</span> Infer <span class="main">(</span>map fst <span class="main">(</span>prems_of <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>concl_of <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Bot_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Bot_FL</span> <span class="main">≡</span> <span class="free">Bot_F</span> <span class="main">×</span> UNIV›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_F_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_F_L</span> <span class="free"><span class="bound"><span class="entity">CL</span></span></span> <span class="main">≡</span> <span class="free">𝒢_F</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">CL</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_I_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_I_L</span> <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span> <span class="main">≡</span> <span class="free">𝒢_I</span> <span class="main">(</span>to_F <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span><span class="main">)</span>›</span></span>

<span class="comment1">(* lem:labeled-grounding-function *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> standard_lifting <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Inf_G</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(⊨G)</span></span>"</span></span> <span class="quoted"><span class="free">Red_I_G</span></span> <span class="quoted"><span class="free">Red_F_G</span></span> <span class="quoted">Bot_FL</span> <span class="quoted">𝒢_F_L</span> <span class="quoted">𝒢_I_L</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Bot_FL <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_labels.Bot_F_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> Bot_FL <span class="main">⟹</span> 𝒢_F_L <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span>
    <span class="keyword1"><span class="command">using</span></span> no_labels.Bot_map_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> Bot_FL <span class="main">⟹</span> 𝒢_F_L <span class="skolem">B</span> <span class="main">⊆</span> <span class="free">Bot_G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span>
    <span class="keyword1"><span class="command">using</span></span> no_labels.Bot_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">CL</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒢_F_L <span class="skolem">CL</span> <span class="main">∩</span> <span class="free">Bot_G</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="skolem">CL</span> <span class="main">∈</span> Bot_FL"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_labels.Bot_cond <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE UNIV_I UNIV_Times_UNIV mem_Sigma_iff prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span>
    i_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ground_not_none<span class="main">:</span> <span class="quoted"><span class="quoted">‹𝒢_I_L <span class="skolem">ι</span> <span class="main">≠</span> None›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>𝒢_I_L <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_G</span> <span class="main">(</span>𝒢_F_L <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">using</span></span> no_labels.inf_map Inf_FL_to_Inf_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* sublocale tiebreaker_lifting Bot_FL Inf_FL Bot_G entails_G Inf_G Red_I_G Red_F_G 𝒢_F_L 𝒢_I_L
 *   "λg Cl Cl'. False"
 *   by unfold_locales simp+ *)</span>

<span class="keyword1"><span class="command">notation</span></span> entails_𝒢 <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨𝒢L</span>"</span> 50<span class="main">)</span>

<span class="comment1">(* lem:labeled-consequence *)</span>
<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-labeled_entailment_lifting"><span class="command">lemma</span></span> labeled_entailment_lifting<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">NL1</span> <span class="keyword1">⊨𝒢L</span> <span class="free">NL2</span> <span class="main">⟷</span> fst <span class="main">`</span> <span class="free">NL1</span> <span class="keyword1">⊨𝒢</span> fst <span class="main">`</span> <span class="free">NL2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-red_inf_impl"><span class="command">lemma</span></span> red_inf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="free">NL</span> <span class="main">⟹</span> to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def no_labels.Red_I_𝒢_def <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> to_F_def<span class="main">)</span>

<span class="comment1">(* lem:labeled-saturation *)</span>
<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-labeled_saturation_lifting"><span class="command">lemma</span></span> labeled_saturation_lifting<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">NL</span> <span class="main">⟹</span> no_labels.saturated <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> saturated_def no_labels.saturated_def Inf_from_def no_labels.Inf_from_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span>
    subs_Red_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span><span class="main">}</span> <span class="main">⊆</span> Red_I_𝒢 <span class="free">NL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="free">NL</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Lli</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Lli</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">NL</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">Lli</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">NL</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that i_prems <span class="keyword1"><span class="command">unfolding</span></span> Lli_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_mem someI_ex DomainE Domain_fst subset_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ll</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ll</span> <span class="main">=</span> map <span class="skolem">Lli</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ll_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">Ll</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> subs_NL<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="skolem">Ll</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ll_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>in_set_zip<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L0</span></span> <span class="keyword2"><span class="keyword">where</span></span> L0<span class="main">:</span> <span class="quoted"><span class="quoted">"Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="skolem">Ll</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">,</span> <span class="skolem">L0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Inf_F_to_Inf_FL<span class="main">[</span><span class="operator">OF</span> i_in Ll_length<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ι_FL</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι_FL</span> <span class="main">=</span> Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="skolem">Ll</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">,</span> <span class="skolem">L0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι_FL</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subs_NL <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι_FL</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ι_FL_def <span class="keyword1"><span class="command">using</span></span> L0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι_FL</span> <span class="main">∈</span> Red_I_𝒢 <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subs_Red_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">=</span> to_F <span class="skolem">ι_FL</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def ι_FL_def <span class="keyword1"><span class="command">using</span></span> Ll_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ι</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> red_inf_impl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:labeled-static-ref-compl *)</span>
<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-stat_ref_comp_to_labeled_sta_ref_comp"><span class="command">lemma</span></span> stat_ref_comp_to_labeled_sta_ref_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> static<span class="main">:</span>
    <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="keyword1">(⊨𝒢)</span> no_labels.Red_I_𝒢 no_labels.Red_F_𝒢"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"statically_complete_calculus Bot_FL <span class="free">Inf_FL</span> <span class="keyword1">(⊨𝒢L)</span> Red_I_𝒢 Red_F_𝒢"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Bl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Nl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    Bl_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Bl</span> <span class="main">∈</span> Bot_FL›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Nl_sat<span class="main">:</span> <span class="quoted"><span class="quoted">‹saturated <span class="skolem">Nl</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Nl_entails_Bl<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Nl</span> <span class="keyword1">⊨𝒢L</span> <span class="main">{</span><span class="skolem">Bl</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> fst <span class="skolem">Bl</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bl_in B_def SigmaE <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> fst <span class="main">`</span> <span class="skolem">Nl</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> N_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"no_labels.saturated <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_def Nl_sat labeled_saturation_lifting <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> N_entails_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1">⊨𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nl_entails_Bl <span class="keyword1"><span class="command">unfolding</span></span> labeled_entailment_lifting N_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span> <span class="main">∈</span> <span class="free">Bot_F</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_in N_sat N_entails_B
    <span class="keyword1"><span class="command">using</span></span> static<span class="main">[</span><span class="operator">unfolded</span> statically_complete_calculus_def
        statically_complete_calculus_axioms_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> in_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> fst <span class="main">`</span> Bot_FL"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Bl'</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_Nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Bl'</span> <span class="main">∈</span> <span class="skolem">Nl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fst_Bl'<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">Bl'</span> <span class="main">=</span> <span class="skolem">B'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_N <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Bl'</span> <span class="main">∈</span> Bot_FL"</span></span> <span class="keyword1"><span class="command">using</span></span> fst_Bl' in_Bot vimage_fst <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Bl'</span><span class="main">∈</span>Bot_FL<span class="main">.</span> <span class="bound">Bl'</span> <span class="main">∈</span> <span class="skolem">Nl</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> in_Nl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Labeled Lifting with a Family of Redundancy Criteria›</span></span>

<span class="keyword1"><span class="command">locale</span></span> labeled_lifting_intersection <span class="main">=</span> no_labels<span class="main">:</span> lifting_intersection <span class="quoted"><span class="free">Inf_F</span></span>
  <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">Inf_G_q</span></span> <span class="quoted"><span class="free">entails_q</span></span> <span class="quoted"><span class="free">Red_I_q</span></span> <span class="quoted"><span class="free">Red_F_q</span></span> <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">𝒢_F_q</span></span> <span class="quoted"><span class="free">𝒢_I_q</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Inf_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Inf_F_to_Inf_FL<span class="main">:</span>
      <span class="quoted"><span class="quoted">‹<span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> length <span class="main">(</span><span class="free">Ll</span> <span class="main">::</span> <span class="tfree">'l</span> list<span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound">L0</span><span class="main">.</span> Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span><span class="main">)</span> <span class="free">Ll</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub></span><span class="main">,</span> <span class="bound">L0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Inf_FL</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Inf_FL_to_Inf_F<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∈</span> <span class="free">Inf_FL</span> <span class="main">⟹</span> Infer <span class="main">(</span>map fst <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>concl_of <span class="free">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Inf_F</span>›</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference <span class="main">⇒</span> <span class="tfree">'f</span> inference›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">to_F</span> <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span> <span class="main">=</span> Infer <span class="main">(</span>map fst <span class="main">(</span>prems_of <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>concl_of <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Bot_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Bot_FL</span> <span class="main">≡</span> <span class="free">Bot_F</span> <span class="main">×</span> UNIV›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_F_L_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'q</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'g</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_F_L_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">CL</span></span></span> <span class="main">≡</span> <span class="free">𝒢_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">CL</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_I_L_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'q</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_I_L_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span> <span class="main">≡</span> <span class="free">𝒢_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>to_F <span class="free"><span class="bound"><span class="entity">ι<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>L</sub></span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_Fset_L_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒢_Fset_L_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span>𝒢_F_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_I_𝒢_L_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I_𝒢_L_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span>
   <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> <span class="main">(</span>𝒢_I_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span>𝒢_I_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span>𝒢_I_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">ι</span> <span class="main">=</span> None <span class="main">∧</span> 𝒢_F_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>concl_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Red_I_𝒢_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I_𝒢_L</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> Red_I_𝒢_L_q <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">entails_𝒢_L_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">entails_𝒢_L_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">≡</span> <span class="free">entails_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="main">(</span>𝒢_Fset_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-lifting_q"><span class="command">lemma</span></span> lifting_q<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"labeled_tiebreaker_lifting <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False<span class="main">)</span> <span class="free">Inf_FL</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms no_labels.standard_lifting_family Inf_F_to_Inf_FL Inf_FL_to_Inf_F
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> labeled_tiebreaker_lifting_axioms_def labeled_tiebreaker_lifting_def<span class="main">)</span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-lifted_q"><span class="command">lemma</span></span> lifted_q<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_lifting <span class="free">Inf_FL</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span>
    Bot_FL <span class="main">(</span>𝒢_F_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_I_L_q <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> q_lifting<span class="main">:</span> labeled_tiebreaker_lifting <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="free">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False"</span></span> <span class="quoted"><span class="free">Inf_FL</span></span>
    <span class="keyword1"><span class="command">using</span></span> lifting_q<span class="main">[</span><span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒢_I_L_q <span class="free">q</span> <span class="main">=</span> q_lifting.𝒢_I_L"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_F_def q_lifting.to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> q_lifting.standard_lifting_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-ord_fam_lifted_q"><span class="command">lemma</span></span> ord_fam_lifted_q<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tiebreaker_lifting Bot_FL <span class="free">Inf_FL</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_F_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_I_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> standard_q_lifting<span class="main">:</span> standard_lifting <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="free">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted">Bot_FL</span> <span class="quoted"><span class="quoted">"𝒢_F_L_q <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"𝒢_I_L_q <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lifted_q<span class="main">[</span><span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"minimal_element <span class="main">(</span><span class="main">λ</span><span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False<span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minimal_element.intro po_on_def transp_onI wfp_on_imp_irreflp_on<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> standard_q_lifting.standard_lifting_axioms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiebreaker_lifting_axioms_def tiebreaker_lifting_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F_𝒢_empty_L_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F_𝒢_empty_L_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">C</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">Red_F_q</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>𝒢_Fset_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> False <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F_L_q <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">E</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Red_F_𝒢_empty_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F_𝒢_empty_L</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> Red_F_𝒢_empty_L_q <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-all_lifted_red_crit"><span class="command">lemma</span></span> all_lifted_red_crit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"calculus Bot_FL <span class="free">Inf_FL</span> <span class="main">(</span>entails_𝒢_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Red_I_𝒢_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Red_F_𝒢_empty_L_q <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ord_q_lifting<span class="main">:</span> tiebreaker_lifting <span class="quoted">Bot_FL</span> <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="quoted">"<span class="free">entails_q</span> <span class="free">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Inf_G_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_I_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Red_F_q</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"𝒢_F_L_q <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"𝒢_I_L_q <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_fam_lifted_q<span class="main">[</span><span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_I_𝒢_L_q <span class="free">q</span> <span class="main">=</span> ord_q_lifting.Red_I_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_L_q_def ord_q_lifting.Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_F_𝒢_empty_L_q <span class="free">q</span> <span class="main">=</span> ord_q_lifting.Red_F_𝒢"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_empty_L_q_def ord_q_lifting.Red_F_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_q_lifting.calculus_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-all_lifted_cons_rel"><span class="command">lemma</span></span> all_lifted_cons_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consequence_relation Bot_FL <span class="main">(</span>entails_𝒢_L_q <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_lifted_red_crit calculus_def q_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">sublocale</span></span> consequence_relation_family <span class="quoted">Bot_FL</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted">entails_𝒢_L_q</span>
  <span class="keyword1"><span class="command">using</span></span> all_lifted_cons_rel <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consequence_relation_family.intro no_labels.Q_nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> intersection_calculus <span class="quoted">Bot_FL</span> <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted">entails_𝒢_L_q</span> <span class="quoted">Red_I_𝒢_L_q</span> <span class="quoted">Red_F_𝒢_empty_L_q</span>
  <span class="keyword1"><span class="command">using</span></span> intersection_calculus.intro<span class="main">[</span><span class="operator">OF</span> consequence_relation_family_axioms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_lifted_red_crit intersection_calculus_axioms_def no_labels.Q_nonempty<span class="main">)</span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-in_Inf_FL_imp_to_F_in_Inf_F"><span class="command">lemma</span></span> in_Inf_FL_imp_to_F_in_Inf_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span> <span class="main">⟹</span> to_F <span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_FL_to_Inf_F to_F_def<span class="main">)</span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-in_Inf_from_imp_to_F_in_Inf_from"><span class="command">lemma</span></span> in_Inf_from_imp_to_F_in_Inf_from<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Inf_from <span class="free">N</span> <span class="main">⟹</span> to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def no_labels.Inf_from_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_FL_to_Inf_F<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> no_labels.entails_𝒢 <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨∩𝒢</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">entails_𝒢_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨∩𝒢L</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(⊨∩𝒢L)</span></span> <span class="main">≡</span> entails"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> entails_𝒢_L_def <span class="main">=</span> entails_def

<span class="comment1">(* lem:labeled-consequence-intersection *)</span>
<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-labeled_entailment_lifting"><span class="command">lemma</span></span> labeled_entailment_lifting<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">NL1</span> <span class="keyword1">⊨∩𝒢L</span> <span class="free">NL2</span> <span class="main">⟷</span> fst <span class="main">`</span> <span class="free">NL1</span> <span class="keyword1">⊨∩𝒢</span> fst <span class="main">`</span> <span class="free">NL2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> no_labels.entails_𝒢_def entails_𝒢_L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-red_inf_impl"><span class="command">lemma</span></span> red_inf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I <span class="free">NL</span> <span class="main">⟹</span> to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_def Red_I_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Xa</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span>
    q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_in_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> Red_I_𝒢_L_q <span class="bound">q</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_in_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I_𝒢_L_q <span class="skolem">q</span> <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q_in i_in_inter image_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_L_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> to_F_in<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F<span class="main">[</span><span class="operator">OF</span> i_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> rephrase1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">CL</span><span class="main">∈</span><span class="free">NL</span><span class="main">.</span> <span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="main">(</span>fst <span class="bound">CL</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="main">`</span> fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rephrase2<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span> <span class="main">=</span> concl_of <span class="main">(</span>to_F <span class="free">ι</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> concl_of_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> subs_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>𝒢_I_L_q <span class="skolem">q</span> <span class="free">ι</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span>𝒢_I_L_q <span class="skolem">q</span> <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="skolem">q</span> <span class="main">(</span>𝒢_Fset_L_q <span class="skolem">q</span> <span class="free">NL</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span>𝒢_I_L_q <span class="skolem">q</span> <span class="free">ι</span> <span class="main">=</span> None <span class="main">∧</span> 𝒢_F_L_q <span class="skolem">q</span> <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset_L_q <span class="skolem">q</span> <span class="free">NL</span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="skolem">q</span> <span class="main">(</span>𝒢_Fset_L_q <span class="skolem">q</span> <span class="free">NL</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_q <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_L_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> to_F_subs_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q</span> <span class="main">(</span>to_F <span class="free">ι</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span>
      the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q</span> <span class="main">(</span>to_F <span class="free">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="skolem">q</span> <span class="main">(</span>no_labels.𝒢_Fset_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q</span> <span class="main">(</span>to_F <span class="free">ι</span><span class="main">)</span> <span class="main">=</span> None <span class="main">∧</span>
      <span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="main">(</span>concl_of <span class="main">(</span>to_F <span class="free">ι</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⊆</span> no_labels.𝒢_Fset_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="skolem">q</span> <span class="main">(</span>no_labels.𝒢_Fset_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rephrase1 rephrase2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> to_F_in <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:labeled-saturation-intersection *)</span>
<span class="keyword1" id="Labeled_Lifting_to_Non_Ground_Calculi-labeled_family_saturation_lifting"><span class="command">lemma</span></span> labeled_family_saturation_lifting<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">NL</span> <span class="main">⟹</span> no_labels.saturated <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> saturated_def no_labels.saturated_def Inf_from_def no_labels.Inf_from_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ιF</span>
  <span class="keyword3"><span class="command">assume</span></span>
    labeled_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span><span class="main">}</span> <span class="main">⊆</span> Red_I <span class="free">NL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    iF_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ιF</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    iF_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="free">NL</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Lli</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Lli</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">NL</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">Lli</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">NL</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that iF_prems nth_mem someI_ex <span class="keyword1"><span class="command">unfolding</span></span> Lli_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DomainE Domain_fst subset_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ll</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ll</span> <span class="main">=</span> map <span class="skolem">Lli</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ll_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">Ll</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> subs_NL<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span> <span class="skolem">Ll</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ll_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>in_set_zip<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L0</span></span> <span class="keyword2"><span class="keyword">where</span></span> L0<span class="main">:</span> <span class="quoted"><span class="quoted">"Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span> <span class="skolem">Ll</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ιF</span><span class="main">,</span> <span class="skolem">L0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Inf_F_to_Inf_FL<span class="main">[</span><span class="operator">OF</span> iF_in Ll_length<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ιFL</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ιFL</span> <span class="main">=</span> Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ιF</span><span class="main">)</span> <span class="skolem">Ll</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ιF</span><span class="main">,</span> <span class="skolem">L0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ιFL</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subs_NL <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ιFL</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">NL</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ιFL_def <span class="keyword1"><span class="command">using</span></span> L0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ιFL</span> <span class="main">∈</span> Red_I <span class="free">NL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> labeled_sat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ιF</span> <span class="main">=</span> to_F <span class="skolem">ιFL</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def ιFL_def <span class="keyword1"><span class="command">using</span></span> Ll_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ιF</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ιF</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">NL</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> red_inf_impl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* thm:labeled-static-ref-compl-intersection *)</span>
<span class="keyword1"><span class="command">theorem</span></span> labeled_static_ref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> calc<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="keyword1">(⊨∩𝒢)</span> no_labels.Red_I_𝒢
    no_labels.Red_F_𝒢_empty"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"statically_complete_calculus Bot_FL <span class="free">Inf_FL</span> <span class="keyword1">(⊨∩𝒢L)</span> Red_I Red_F"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Bl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Nl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    Bl_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Bl</span> <span class="main">∈</span> Bot_FL›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Nl_sat<span class="main">:</span> <span class="quoted"><span class="quoted">‹saturated <span class="skolem">Nl</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Nl_entails_Bl<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Nl</span> <span class="keyword1">⊨∩𝒢L</span> <span class="main">{</span><span class="skolem">Bl</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> fst <span class="skolem">Bl</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bl_in B_def SigmaE <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> fst <span class="main">`</span> <span class="skolem">Nl</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> N_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"no_labels.saturated <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_def Nl_sat labeled_family_saturation_lifting <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> N_entails_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1">⊨∩𝒢</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nl_entails_Bl <span class="keyword1"><span class="command">unfolding</span></span> labeled_entailment_lifting N_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B'</span> <span class="main">∈</span> <span class="free">Bot_F</span><span class="main">.</span> <span class="bound">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_in N_sat N_entails_B
      calc<span class="main">[</span><span class="operator">unfolded</span> statically_complete_calculus_def
        statically_complete_calculus_axioms_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> in_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> fst <span class="main">`</span> Bot_FL"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Bl'</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_Nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Bl'</span> <span class="main">∈</span> <span class="skolem">Nl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fst_Bl'<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">Bl'</span> <span class="main">=</span> <span class="skolem">B'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_N <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Bl'</span> <span class="main">∈</span> Bot_FL"</span></span> <span class="keyword1"><span class="command">using</span></span> fst_Bl' in_Bot vimage_fst <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Bl'</span><span class="main">∈</span>Bot_FL<span class="main">.</span> <span class="bound">Bl'</span> <span class="main">∈</span> <span class="skolem">Nl</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> in_Nl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Given_Clause_Architectures">
<div class="head">
<h1>Theory Given_Clause_Architectures</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Given Clause Prover Architectures
 *  Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2019-2020 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Given Clause Prover Architectures›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section covers all the results presented in the section 4 of the report.
  This is where abstract architectures of provers are defined and proven
  dynamically refutationally complete.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Given_Clause_Architectures
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Lambda_Free_RPOs/Lambda_Free_Util.html">Lambda_Free_RPOs.Lambda_Free_Util</a>
    <a href="Labeled_Lifting_to_Non_Ground_Calculi.html">Labeled_Lifting_to_Non_Ground_Calculi</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basis of the Given Clause Prover Architectures›</span></span>

<span class="keyword1"><span class="command">locale</span></span> given_clause_basis <span class="main">=</span> std<span class="main">?</span><span class="main">:</span> labeled_lifting_intersection <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Q</span></span>
  <span class="quoted"><span class="free">entails_q</span></span> <span class="quoted"><span class="free">Inf_G_q</span></span> <span class="quoted"><span class="free">Red_I_q</span></span> <span class="quoted"><span class="free">Red_F_q</span></span> <span class="quoted"><span class="free">𝒢_F_q</span></span> <span class="quoted"><span class="free">𝒢_I_q</span></span> <span class="quoted"><span class="free">Inf_FL</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Inf_G_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Red_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Red_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒢_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒢_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Inf_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set›</span></span>
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">Equiv_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≐</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≺⋅</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l</span> <span class="main">⇒</span> <span class="tfree">'l</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏L</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">active</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    equiv_equiv_F<span class="main">:</span> <span class="quoted"><span class="quoted">"equivp <span class="main"><span class="free">(≐)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf_prec_F<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_element <span class="main"><span class="free">(≺⋅)</span></span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf_prec_L<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_element <span class="keyword1"><span class="free">(⊏L)</span></span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    compat_equiv_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C1</span> <span class="main"><span class="free">≐</span></span> <span class="free">D1</span> <span class="main">⟹</span> <span class="free">C2</span> <span class="main"><span class="free">≐</span></span> <span class="free">D2</span> <span class="main">⟹</span> <span class="free">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C2</span> <span class="main">⟹</span> <span class="free">D1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">D2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    equiv_F_grounding<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">C1</span> <span class="main"><span class="free">≐</span></span> <span class="free">C2</span> <span class="main">⟹</span> <span class="free">𝒢_F_q</span> <span class="free">q</span> <span class="free">C1</span> <span class="main">⊆</span> <span class="free">𝒢_F_q</span> <span class="free">q</span> <span class="free">C2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    prec_F_grounding<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">C2</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C1</span> <span class="main">⟹</span> <span class="free">𝒢_F_q</span> <span class="free">q</span> <span class="free">C1</span> <span class="main">⊆</span> <span class="free">𝒢_F_q</span> <span class="free">q</span> <span class="free">C2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    active_minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l2</span> <span class="main">≠</span> <span class="free">active</span> <span class="main">⟹</span> <span class="free">active</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="free">l2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    at_least_two_labels<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l2</span><span class="main">.</span> <span class="free">active</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="bound">l2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inf_never_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span> <span class="main">⟹</span> snd <span class="main">(</span>concl_of <span class="free">ι</span><span class="main">)</span> <span class="main">≠</span> <span class="free">active</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    static_ref_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"statically_complete_calculus <span class="free">Bot_F</span> <span class="free">Inf_F</span> <span class="keyword1">(⊨∩𝒢)</span>
      no_labels.Red_I_𝒢 no_labels.Red_F_𝒢_empty"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Prec_eq_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼⋅</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">≼⋅</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">≐</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">≺⋅</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Prec_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Cl1</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">Cl2</span></span></span> <span class="main">⟷</span> fst <span class="free"><span class="bound"><span class="entity">Cl1</span></span></span> <span class="main"><span class="free">≺⋅</span></span> fst <span class="free"><span class="bound"><span class="entity">Cl2</span></span></span> <span class="main">∨</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">Cl1</span></span></span> <span class="main"><span class="free">≐</span></span> fst <span class="free"><span class="bound"><span class="entity">Cl2</span></span></span> <span class="main">∧</span> snd <span class="free"><span class="bound"><span class="entity">Cl1</span></span></span> <span class="keyword1"><span class="free">⊏L</span></span> snd <span class="free"><span class="bound"><span class="entity">Cl2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Given_Clause_Architectures-irrefl_prec_F"><span class="command">lemma</span></span> irrefl_prec_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">C</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minimal_element.po<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_prec_F<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> po_on_def irreflp_on_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Given_Clause_Architectures-trans_prec_F"><span class="command">lemma</span></span> trans_prec_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C2</span> <span class="main">⟹</span> <span class="free">C2</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C3</span> <span class="main">⟹</span> <span class="free">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> minimal_element.po<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_prec_F<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> po_on_def transp_on_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span>
        <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Given_Clause_Architectures-wf_prec_FL"><span class="command">lemma</span></span> wf_prec_FL<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_element <span class="main">(⊏)</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"po_on <span class="main">(⊏)</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> po_on_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreflp_on <span class="main">(⊏)</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> irreflp_on_def Prec_FL_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Cl</span>
      <span class="keyword3"><span class="command">assume</span></span> a_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>fst <span class="skolem">Cl</span> <span class="main"><span class="free">≺⋅</span></span> fst <span class="skolem">Cl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_prec_F minimal_element.min_elt_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>snd <span class="skolem">Cl</span> <span class="keyword1"><span class="free">⊏L</span></span> snd <span class="skolem">Cl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_prec_L minimal_element.min_elt_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>fst <span class="skolem">Cl</span> <span class="main"><span class="free">≺⋅</span></span> fst <span class="skolem">Cl</span> <span class="main">∨</span> fst <span class="skolem">Cl</span> <span class="main"><span class="free">≐</span></span> fst <span class="skolem">Cl</span> <span class="main">∧</span> snd <span class="skolem">Cl</span> <span class="keyword1"><span class="free">⊏L</span></span> snd <span class="skolem">Cl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp_on <span class="main">(⊏)</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> transp_on_def Prec_FL_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C1</span> <span class="skolem">l1</span> <span class="skolem">C2</span> <span class="skolem">l2</span> <span class="skolem">C3</span> <span class="skolem">l3</span>
      <span class="keyword3"><span class="command">assume</span></span> trans_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C2</span> <span class="main">∨</span> <span class="skolem">C1</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C2</span> <span class="main">∧</span> <span class="skolem">l1</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">C2</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C3</span> <span class="main">∨</span> <span class="skolem">C2</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C3</span> <span class="main">∧</span> <span class="skolem">l2</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">l3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C2</span> <span class="main">⟹</span> <span class="skolem">C2</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C3</span> <span class="main">⟹</span> <span class="skolem">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> compat_equiv_prec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equiv_equiv_F equivp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C2</span> <span class="main">⟹</span> <span class="skolem">C2</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C3</span> <span class="main">⟹</span> <span class="skolem">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> compat_equiv_prec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equiv_equiv_F equivp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">l2</span> <span class="main">⟹</span> <span class="skolem">l2</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">l3</span> <span class="main">⟹</span> <span class="skolem">l1</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">l3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wf_prec_L <span class="keyword1"><span class="command">unfolding</span></span> minimal_element_def po_on_def transp_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C2</span> <span class="main">⟹</span> <span class="skolem">C2</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C3</span> <span class="main">⟹</span> <span class="skolem">C1</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> equiv_equiv_F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> equivp_transp<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main"><span class="free">≺⋅</span></span> <span class="skolem">C3</span> <span class="main">∨</span> <span class="skolem">C1</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C3</span> <span class="main">∧</span> <span class="skolem">l1</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">l3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trans_hyp
        <span class="keyword1"><span class="command">using</span></span> trans_prec_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wfp_on <span class="main">(⊏)</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wfp_on_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⊏</span> <span class="bound">f</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⊏</span> <span class="skolem">f</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">Cl1</span><span class="main">,</span> <span class="bound">Cl2</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">Cl1</span> <span class="main"><span class="free">≺⋅</span></span> fst <span class="bound">Cl2</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">Cl1</span><span class="main">,</span> <span class="bound">Cl2</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">Cl1</span> <span class="main"><span class="free">≐</span></span> fst <span class="bound">Cl2</span> <span class="main">∧</span> snd <span class="bound">Cl1</span> <span class="keyword1"><span class="free">⊏L</span></span> snd <span class="bound">Cl2</span><span class="main">}</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_infinite_down_chain_compatible<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">R</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">using</span></span> wf_app<span class="main">[</span><span class="operator">OF</span> wf_prec_F<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> minimal_element_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span>
              <span class="operator">unfolded</span> wfp_on_UNIV wfP_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_suc <span class="keyword1"><span class="command">unfolding</span></span> R_def S_def Prec_FL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="keyword1">O</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> R_def S_def <span class="keyword1"><span class="command">using</span></span> compat_equiv_prec equiv_equiv_F equivp_reflp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> g_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> f_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> wf_s<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_app<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf_prec_L<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator">unfolded</span> minimal_element_def<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>
                <span class="operator">unfolded</span> wfp_on_UNIV wfP_def<span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">snd</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> g_chain<span class="main">[</span><span class="operator">unfolded</span> S_def<span class="main">]</span>
        wf_s<span class="main">[</span><span class="operator">unfolded</span> S_def<span class="main">,</span> <span class="operator">folded</span> wfP_def wfp_on_UNIV<span class="main">,</span> <span class="operator">unfolded</span> wfp_on_def<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">active_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">active_subset</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">CL</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> snd <span class="bound">CL</span> <span class="main">=</span> <span class="free">active</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">passive_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">passive_subset</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">CL</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> snd <span class="bound">CL</span> <span class="main">≠</span> <span class="free">active</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Given_Clause_Architectures-active_subset_insert"><span class="command">lemma</span></span> active_subset_insert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>insert <span class="free">Cl</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> snd <span class="free">Cl</span> <span class="main">=</span> <span class="free">active</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">Cl</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> active_subset <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Given_Clause_Architectures-active_subset_union"><span class="command">lemma</span></span> active_subset_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span><span class="free">M</span> <span class="main">∪</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> active_subset <span class="free">M</span> <span class="main">∪</span> active_subset <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Given_Clause_Architectures-passive_subset_insert"><span class="command">lemma</span></span> passive_subset_insert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>insert <span class="free">Cl</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> snd <span class="free">Cl</span> <span class="main">≠</span> <span class="free">active</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">Cl</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> passive_subset <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> passive_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Given_Clause_Architectures-passive_subset_union"><span class="command">lemma</span></span> passive_subset_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span><span class="free">M</span> <span class="main">∪</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> passive_subset <span class="free">M</span> <span class="main">∪</span> passive_subset <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> passive_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> std<span class="main">?</span><span class="main">:</span> statically_complete_calculus <span class="quoted">Bot_FL</span> <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊨∩𝒢L)</span>"</span></span> <span class="quoted">Red_I</span> <span class="quoted">Red_F</span>
  <span class="keyword1"><span class="command">using</span></span> labeled_static_ref<span class="main">[</span><span class="operator">OF</span> static_ref_comp<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Given_Clause_Architectures-labeled_tiebreaker_lifting"><span class="command">lemma</span></span> labeled_tiebreaker_lifting<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tiebreaker_lifting Bot_FL <span class="free">Inf_FL</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_F_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_I_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Prec_FL<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tiebreaker_lifting Bot_FL <span class="free">Inf_FL</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_F_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_I_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">Cl</span> <span class="bound">Cl'</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_fam_lifted_q<span class="main">[</span><span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_lifting <span class="free">Inf_FL</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span> Bot_FL <span class="main">(</span>𝒢_F_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_I_L_q <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lifted_q<span class="main">[</span><span class="operator">OF</span> q_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tiebreaker_lifting Bot_FL <span class="free">Inf_FL</span> <span class="free">Bot_G</span> <span class="main">(</span><span class="free">entails_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Inf_G_q</span> <span class="free">q</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Red_I_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">Red_F_q</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_F_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span>𝒢_I_L_q <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Prec_FL<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_prec_FL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiebreaker_lifting.intro tiebreaker_lifting_axioms.intro<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> lifting_intersection <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">Inf_G_q</span></span> <span class="quoted"><span class="free">entails_q</span></span> <span class="quoted"><span class="free">Red_I_q</span></span> <span class="quoted"><span class="free">Red_F_q</span></span>
  <span class="quoted">Bot_FL</span> <span class="quoted">𝒢_F_L_q</span> <span class="quoted">𝒢_I_L_q</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Prec_FL"</span></span>
  <span class="keyword1"><span class="command">using</span></span> labeled_tiebreaker_lifting <span class="keyword1"><span class="command">unfolding</span></span> lifting_intersection_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lifting_intersection_axioms.intro
      no_labels.ground.consequence_relation_family_axioms
      no_labels.ground.inference_system_family_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> derive <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊳L</span>"</span> 50<span class="main">)</span>

<span class="keyword1" id="Given_Clause_Architectures-std_Red_I_eq"><span class="command">lemma</span></span> std_Red_I_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"std.Red_I <span class="main">=</span> Red_I_𝒢"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def Red_I_𝒢_L_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Given_Clause_Architectures-std_Red_F_eq"><span class="command">lemma</span></span> std_Red_F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"std.Red_F <span class="main">=</span> Red_F_𝒢_empty"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_empty_q_def Red_F_𝒢_empty_L_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">sublocale</span></span> statically_complete_calculus <span class="quoted">Bot_FL</span> <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊨∩𝒢L)</span>"</span></span> <span class="quoted">Red_I</span> <span class="quoted">Red_F</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">use</span> statically_complete std_Red_I_eq <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* lem:redundant-labeled-inferences *)</span>
<span class="keyword1" id="Given_Clause_Architectures-labeled_red_inf_eq_red_inf"><span class="command">lemma</span></span> labeled_red_inf_eq_red_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span> <span class="main">⟷</span> to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> i_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> Red_I_𝒢_q <span class="main">`</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">ι</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X0</span> <span class="main">∈</span> Red_I_𝒢_q <span class="main">`</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> x0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X0</span> <span class="free">N</span> <span class="main">=</span> Red_I_𝒢_q <span class="skolem">q0</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y0</span></span> <span class="keyword2"><span class="keyword">where</span></span> y0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> to_F <span class="main">`</span> <span class="main">(</span><span class="skolem">X0</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span>  y0_is
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_F <span class="main">`</span> <span class="skolem">X0</span> <span class="free">N</span> <span class="main">⊆</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι0</span>
      <span class="keyword3"><span class="command">assume</span></span> i0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> to_F <span class="main">`</span> <span class="skolem">X0</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i0_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> to_F <span class="main">`</span> Red_I_𝒢_q <span class="skolem">q0</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x0_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι0_FL</span></span> <span class="keyword2"><span class="keyword">where</span></span> i0_FL_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0_FL</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i0_to_i0_FL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">=</span> to_F <span class="skolem">ι0_FL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        subs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span>
            the <span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="skolem">q0</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι0_FL</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∧</span>
            𝒢_F_L_q <span class="skolem">q0</span> <span class="main">(</span>concl_of <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="skolem">q0</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> concl_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>concl_of <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">=</span> concl_of <span class="skolem">ι0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> concl_of_def i0_to_i0_FL to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> i0_in3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i0_to_i0_FL Inf_FL_to_Inf_F<span class="main">[</span><span class="operator">OF</span> i0_FL_in<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span>
          not_none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="skolem">q0</span> <span class="skolem">ι0</span> <span class="main">≠</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q0</span> <span class="skolem">ι0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι1</span></span> <span class="keyword2"><span class="keyword">where</span></span> i1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q0</span> <span class="skolem">ι0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="skolem">q0</span> <span class="skolem">ι0</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="skolem">q0</span> <span class="main">(</span>no_labels.𝒢_Fset_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> subs1 i0_to_i0_FL not_none <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span>
          is_none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_I_q</span> <span class="skolem">q0</span> <span class="skolem">ι0</span> <span class="main">=</span> None"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="skolem">q0</span> <span class="main">(</span>concl_of <span class="skolem">ι0</span><span class="main">)</span> <span class="main">⊆</span> no_labels.𝒢_Fset_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>
            <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="skolem">q0</span> <span class="main">(</span>no_labels.𝒢_Fset_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> subs1 i0_to_i0_FL concl_swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">using</span></span> i0_in3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> to_F <span class="main">`</span> <span class="skolem">X0</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι0</span>
      <span class="keyword3"><span class="command">assume</span></span> i0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i0_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι0_FL</span></span> <span class="keyword2"><span class="keyword">where</span></span> i0_FL_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0_FL</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i0_to_i0_FL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">=</span> to_F <span class="skolem">ι0_FL</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Inf_F_to_Inf_FL<span class="main">[</span><span class="operator">OF</span> i0_in2<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ex_list_of_length fst_conv inference.exhaust_sel inference.inject map_fst_zip<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> concl_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>concl_of <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">=</span> concl_of <span class="skolem">ι0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> concl_of_def i0_to_i0_FL to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> subs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span>
           the <span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="skolem">q0</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι0_FL</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∧</span>
           𝒢_F_L_q <span class="skolem">q0</span> <span class="main">(</span>concl_of <span class="skolem">ι0_FL</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="skolem">q0</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i0_in i0_to_i0_FL concl_swap <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0_FL</span> <span class="main">∈</span> Red_I_𝒢_q <span class="skolem">q0</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i0_FL_in <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι0</span> <span class="main">∈</span> to_F <span class="main">`</span> <span class="skolem">X0</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x0_is i0_to_i0_FL i0_in2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="main">`</span> <span class="free">Q</span> <span class="main">⟹</span> to_F <span class="free">ι</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Y</span>
    <span class="keyword1"><span class="command">using</span></span> i_in2 no_labels.Red_I_def std_Red_I_eq red_inf_impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def no_labels.Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> to_F_in<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> imp_to_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="main">`</span> <span class="free">Q</span> <span class="main">⟹</span> to_F <span class="free">ι</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
    <span class="keyword1"><span class="command">using</span></span> to_F_in <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> to_F_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="free">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Red_I_𝒢_q <span class="skolem">q</span> <span class="free">N</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι0_FL</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> to_F <span class="bound">ι0_FL</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Red_I_𝒢_q <span class="skolem">q</span> <span class="free">N</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">ι0_FL</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> to_F <span class="bound">ι0_FL</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q0</span> <span class="skolem">ι1</span>
      <span class="keyword3"><span class="command">assume</span></span>
        i1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> Red_I_𝒢_q <span class="skolem">q0</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> i1_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1_in <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> to_F_i1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι1</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> concl_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>concl_of <span class="skolem">ι1</span><span class="main">)</span> <span class="main">=</span> concl_of <span class="main">(</span>to_F <span class="skolem">ι1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> concl_of_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i1_to_F_in<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι1</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1_in to_F_i1_in <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ι0_FL</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> to_F <span class="bound">ι0_FL</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1_in2 i1_to_F_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">ι0_FL</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> to_F <span class="bound">ι0_FL</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> Red_I_𝒢_q <span class="skolem">q</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q0</span> <span class="skolem">ι1</span>
      <span class="keyword3"><span class="command">assume</span></span>
        i1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ι0_FL</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> to_F <span class="bound">ι0_FL</span> <span class="main">∈</span> no_labels.Red_I_𝒢_q <span class="skolem">q0</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i1_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> to_F_i1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι1</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> concl_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>concl_of <span class="skolem">ι1</span><span class="main">)</span> <span class="main">=</span> concl_of <span class="main">(</span>to_F <span class="skolem">ι1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> concl_of_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι1</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι1</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="skolem">q0</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∨</span> <span class="main">(</span>𝒢_I_L_q <span class="skolem">q0</span> <span class="skolem">ι1</span> <span class="main">=</span> None <span class="main">∧</span>
          𝒢_F_L_q <span class="skolem">q0</span> <span class="main">(</span>concl_of <span class="skolem">ι1</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span> <span class="main">∪</span> <span class="free">Red_F_q</span> <span class="skolem">q0</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q0</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1_in <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι1</span> <span class="main">∈</span> Red_I_𝒢_q <span class="skolem">q0</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1_in2 <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I_𝒢_q <span class="skolem">q</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">using</span></span> that to_F_in2 i_in <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_q_def no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:redundant-labeled-formulas *)</span>
<span class="keyword1" id="Given_Clause_Architectures-red_labeled_clauses"><span class="command">lemma</span></span> red_labeled_clauses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">∈</span> no_labels.Red_F_𝒢_empty <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">C'</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">N</span><span class="main">.</span> <span class="bound">C'</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">C'</span><span class="main">,</span> <span class="bound">L'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">L'</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="free">L</span> <span class="main">∧</span> <span class="bound">C'</span> <span class="main">≼⋅</span> <span class="free">C</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F <span class="free">N</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">∈</span> no_labels.Red_F_𝒢_empty <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F <span class="free">N</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> no_labels.Red_F_𝒢_empty <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> no_labels.Red_F_𝒢_empty_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_F_𝒢_empty_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g_in_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Red_F_q</span> <span class="skolem">q</span> <span class="main">(</span>no_labels.𝒢_Fset_q <span class="skolem">q</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Red_F_𝒢_empty_q_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒢_F_L_q <span class="skolem">q</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F_q</span> <span class="skolem">q</span> <span class="main">(</span>𝒢_Fset_q <span class="skolem">q</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">using</span></span> that g_in_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def Red_F_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">C'</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">N</span><span class="main">.</span> <span class="bound">C'</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F <span class="free">N</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C'</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">N</span><span class="main">.</span> <span class="bound">C'</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_prec_c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'_l'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C'</span><span class="main">,</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c'_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c'_l'_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C'</span><span class="main">,</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">⊏</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c_prec_c' <span class="keyword1"><span class="command">unfolding</span></span> Prec_FL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c_in_c'_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="skolem">C'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">using</span></span> prec_F_grounding<span class="main">[</span><span class="operator">OF</span> that c_prec_c'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒢_F_L_q <span class="skolem">q</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">⊆</span> 𝒢_F_L_q <span class="skolem">q</span> <span class="main">(</span><span class="skolem">C'</span><span class="main">,</span> <span class="skolem">L'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F_𝒢_q <span class="skolem">q</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_q_def <span class="keyword1"><span class="command">using</span></span> that c'_l'_in c'_l'_prec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="main">(</span><span class="bound">C'</span><span class="main">,</span> <span class="bound">L'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">L'</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="free">L</span> <span class="main">∧</span> <span class="bound">C'</span> <span class="main">≼⋅</span> <span class="free">C</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F <span class="free">N</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">C'</span><span class="main">,</span> <span class="bound">L'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">L'</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="free">L</span> <span class="main">∧</span> <span class="bound">C'</span> <span class="main">≼⋅</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'_l'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C'</span><span class="main">,</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l'_sub_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'_sub_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">≼⋅</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main"><span class="free">≺⋅</span></span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that c'_l'_in ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> equiv_c_c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main"><span class="free">≐</span></span> <span class="skolem">C'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> equiv_c'_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main"><span class="free">≐</span></span> <span class="free">C</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> equiv_equiv_F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equivp_symp<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c'_l'_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C'</span><span class="main">,</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">⊏</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> l'_sub_l <span class="keyword1"><span class="command">unfolding</span></span> Prec_FL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="free">C</span> <span class="main">=</span> <span class="free">𝒢_F_q</span> <span class="skolem">q</span> <span class="skolem">C'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
        <span class="keyword1"><span class="command">using</span></span> that equiv_F_grounding equiv_c_c' equiv_c'_c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒢_F_L_q <span class="skolem">q</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> 𝒢_F_L_q <span class="skolem">q</span> <span class="main">(</span><span class="skolem">C'</span><span class="main">,</span> <span class="skolem">L'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> Red_F_𝒢_q <span class="skolem">q</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Red_F_𝒢_q_def <span class="keyword1"><span class="command">using</span></span> that c'_l'_in c'_l'_prec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c'_sub_c equiv_equiv_F equivp_symp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
  
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Given Clause Procedure›</span></span>

<span class="keyword1"><span class="command">locale</span></span> given_clause <span class="main">=</span> given_clause_basis <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">entails_q</span></span> <span class="quoted"><span class="free">Inf_G_q</span></span> <span class="quoted"><span class="free">Red_I_q</span></span>
  <span class="quoted"><span class="free">Red_F_q</span></span> <span class="quoted"><span class="free">𝒢_F_q</span></span> <span class="quoted"><span class="free">𝒢_I_q</span></span> <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Equiv_F</span></span> <span class="quoted"><span class="free">Prec_F</span></span> <span class="quoted"><span class="free">Prec_L</span></span> <span class="quoted"><span class="free">active</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Equiv_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≐</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≺⋅</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l</span> <span class="main">⇒</span> <span class="tfree">'l</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏L</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">active</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'l</span></span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    inf_have_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ιF</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> prems_of <span class="free">ιF</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="Given_Clause_Architectures-labeled_inf_have_prems"><span class="command">lemma</span></span> labeled_inf_have_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span> <span class="main">⟹</span> prems_of <span class="free">ι</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_have_prems Inf_FL_to_Inf_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↝GC</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  process<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M'</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M'</span></span></span><span class="main">)</span> <span class="main">⟹</span>
    active_subset <span class="free"><span class="bound"><span class="entity">M'</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1"><span class="free">↝GC</span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span>"</span></span>
<span class="main">|</span> infer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≠</span> <span class="free">active</span> <span class="main">⟹</span>
    active_subset <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
    no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">}</span>
    <span class="main">⊆</span> no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1"><span class="free">↝GC</span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span>"</span></span>
  
<span class="keyword1" id="Given_Clause_Architectures-one_step_equiv"><span class="command">lemma</span></span> one_step_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">↝GC</span> <span class="free">N2</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">N1</span></span> <span class="quoted"><span class="free">N2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> step.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">↝GC</span> <span class="free">N2</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="keyword1">↝GC</span> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">M</span> <span class="skolem">M'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    gc_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">↝GC</span> <span class="free">N2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n1_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    m_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    active_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="skolem">M'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1_is n2_is m_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> derive.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">L</span> <span class="skolem">M</span>
  <span class="keyword3"><span class="command">assume</span></span>
    gc_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">↝GC</span> <span class="free">N2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n1_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    not_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≠</span> <span class="free">active</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    active_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="skolem">M</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≼⋅</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equiv_equiv_F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equivp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">active</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> active_minimal<span class="main">[</span><span class="operator">OF</span> not_active<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> red_labeled_clauses <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n1_is n2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> std_Red_F_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> derive.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:gc-derivations-are-red-derivations *)</span>
<span class="keyword1" id="Given_Clause_Architectures-gc_to_red"><span class="command">lemma</span></span> gc_to_red<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="free">Ns</span> <span class="main">⟹</span> chain <span class="keyword1">(⊳L)</span> <span class="free">Ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_step_equiv Lazy_List_Chain.chain_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span>-<span class="main">)</span> all_ex_finite_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">j</span> <span class="bound">n1</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">j</span> <span class="bound">n2</span> <span class="main">⟶</span> <span class="bound">n1</span> <span class="main">=</span> <span class="bound">n2</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">m</span> <span class="free">P</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    allj_exn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    uniq_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n1</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n2</span> <span class="main">⟶</span> <span class="bound">n1</span> <span class="main">=</span> <span class="bound">n2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> imp_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_UN<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">∃!</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allj_exn uniq_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bounded_nat_set_is_finite lessI mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> imp_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:fair-gc-derivations *)</span>
<span class="keyword1" id="Given_Clause_Architectures-gc_fair"><span class="command">lemma</span></span> gc_fair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_state<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fair <span class="free">Ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fair_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> lhd_is <span class="main">=</span> lhd_conv_lnth<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> i_in_inf_fl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="free">Ns</span> <span class="main">=</span> active_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> final_state <span class="keyword1"><span class="command">unfolding</span></span> passive_subset_def active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m_def_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> i_in_F<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in Inf_FL_to_Inf_F <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_def_F <span class="keyword1"><span class="command">using</span></span> inf_have_prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> exist_nj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nj</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
      prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">nj</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">=</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in2 <span class="keyword1"><span class="command">unfolding</span></span> m_def Inf_from_def active_subset_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mem_eq Collect_mono_iff atLeastLessThan_iff nth_mem old.prod.exhaust snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> Liminf_llist <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j_in i_in <span class="keyword1"><span class="command">unfolding</span></span> m_def Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_is<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      c_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">using</span></span> init_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c_in3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> nj_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> init_state c_in2 nj_is
      <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def lhd_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_min_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_min</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">nj</span><span class="main">.</span> enat <span class="bound">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_allk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">nj_min</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c_in3 nj_is c_in2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> INT_E LeastI_ex mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> njm_smaller_D<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">nj_min</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_min_is
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> LeastI_ex <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">nj</span><span class="main">.</span> <span class="main">⟦</span>enat <span class="bound">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">;</span>
          <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_min</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_is c_in2 nj_pos nj_min_is lhd_is
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_empty_eq <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> Liminf_llist <span class="free">Ns</span>›</span></span>
          <span class="quoted"><span class="quoted">‹Liminf_llist <span class="free">Ns</span> <span class="main">=</span> active_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="skolem">nj_min</span><span class="main">.</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">k</span>›</span></span> active_subset_def init_state
          linorder_not_less mem_Collect_eq zero_enat_def chain_length_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">njm_prec</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_prec_is<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">njm_prec</span> <span class="main">=</span> <span class="skolem">nj_min</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0_conv_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> njm_prec_njm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">&lt;</span> <span class="skolem">nj_min</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> njm_prec_njm_enat<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">njm_prec</span> <span class="main">&lt;</span> enat <span class="skolem">nj_min</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> njm_prec_smaller_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">HOL.no_atp</span></span><span class="main">(</span>15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> njm_smaller_D njm_prec_njm_enat<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> njm_prec_all_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">njm_prec</span><span class="main">.</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_prec_is in_allk <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> notin_njm_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> absurd_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> prec_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">njm_prec</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nj_min_is nj_prec_is
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> LeastI_ex Suc_leD <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">nj</span><span class="main">.</span> <span class="main">⟦</span>enat <span class="bound">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">;</span>
            <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
            enat_ord_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_eq_less_or_eq le_less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
          <span class="keyword3"><span class="command">assume</span></span> k_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">∧</span> enat <span class="skolem">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">njm_prec</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> absurd_hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> nj_prec_is in_allk k_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">njm_prec</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prec_smaller <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> nj_min_is nj_prec_is Orderings.wellorder_class.not_less_Least njm_prec_njm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> notin_active_subs_njm_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nj</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">nj</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c_is njm_prec_all_suc njm_prec_smaller_d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
          active_subset_def mem_Collect_eq nj_prec_is njm_smaller_D snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nj_set</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_set</span> <span class="main">=</span> <span class="main">{</span><span class="bound">nj</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
      prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">nj</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nj_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_set</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> zero_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n0</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="main">0</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">n0</span><span class="main">.</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="main">0</span> <span class="main">∈</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exist_nj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">using</span></span> zero_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_set</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> nj_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">nj_set</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_ex_finite_set<span class="main">[</span><span class="operator">OF</span> exist_nj<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_ile_eq dual_order.strict_implies_order
        linorder_neqE_nat nj_set_def<span class="main">)</span>
      <span class="comment1">(* the n below in the n-1 from the pen-and-paper proof *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="skolem">nj_set</span><span class="main">.</span> <span class="main">∀</span><span class="bound">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nj_not_empty nj_finite <span class="keyword1"><span class="command">using</span></span> Max_ge Max_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_bigger<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j0</span></span> <span class="keyword2"><span class="keyword">where</span></span> j0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> suc_n_length<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    j0_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    j0_allin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">∈</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C0</span></span> <span class="keyword2"><span class="keyword">where</span></span> C0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j0_in
    <span class="keyword1"><span class="command">using</span></span> i_in2 <span class="keyword1"><span class="command">unfolding</span></span> m_def Inf_from_def active_subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mem_eq Collect_mono_iff atLeastLessThan_iff nth_mem old.prod.exhaust snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> C0_prems_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_conv_nth j0_in m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> C0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C0_is j0_allin suc_n_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_subset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C0_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C0_is j0_notin <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> step_n<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="keyword1">↝GC</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv chain_lnth_rel n_in <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">C</span> <span class="bound">L</span> <span class="bound">M</span><span class="main">.</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="bound">L</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
      lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span> <span class="bound">L</span> <span class="main">≠</span> <span class="free">active</span> <span class="main">∧</span> active_subset <span class="bound">M</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
      no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>
      <span class="main">⊆</span> no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> proc_or_infer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">N1</span> <span class="bound">N</span> <span class="bound">M</span> <span class="bound">N2</span> <span class="bound">M'</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">N1</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N2</span> <span class="main">∧</span> <span class="bound">N1</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span>
         <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="bound">M'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="bound">N</span> <span class="main">∪</span> <span class="bound">M'</span><span class="main">)</span> <span class="main">∧</span> active_subset <span class="bound">M'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∨</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">N1</span> <span class="bound">N</span> <span class="bound">C</span> <span class="bound">L</span> <span class="bound">N2</span> <span class="bound">M</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">N1</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N2</span> <span class="main">∧</span> <span class="bound">N1</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="bound">L</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
         <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span> <span class="bound">L</span> <span class="main">≠</span> <span class="free">active</span> <span class="main">∧</span> active_subset <span class="bound">M</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
         no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">⊆</span>
           no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> step_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> C0_in C0_notin proc_or_infer j0_in C0_is
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Un_iff active_subset_def mem_Collect_eq snd_conv sup_bot.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> inf_from_subs<span class="main">:</span>
    <span class="quoted"><span class="quoted">"no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">C0</span><span class="main">}</span>
     <span class="main">⊆</span> no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    nth_d_is<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    suc_nth_d_is<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    l_not_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≠</span> <span class="free">active</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C0_in C0_notin j0_in C0_is <span class="keyword1"><span class="command">using</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">⟹</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≠</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">⟹</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      j_not_j0<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≠</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_len<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      nj_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">nj</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      nj_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exist_nj j_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">using</span></span> j_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">nj</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C0_in C0_notin step.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> step_n
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Un_iff nth_d_is suc_nth_d_is l_not_active active_subset_def insertCI insertE lessI
            mem_Collect_eq nj_greater nj_prems snd_conv suc_n_length<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> j_not_j0 C0_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_bigger <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_greater n_in Suc_ile_eq dual_order.strict_implies_order <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nth_d_is l_not_active <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> active_subset <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C0_prems_i C0_is m_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff atLeast0LessThan in_set_conv_nth insertCI lessThan_iff subrelI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> active_subset <span class="skolem">N</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C0_prems_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_between <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_inf_fl <span class="keyword1"><span class="command">unfolding</span></span> Inf_between_def Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">C0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_F_def Inf_between_def Inf_from_def
      no_labels.Inf_between_def no_labels.Inf_from_def <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suc_nth_d_is inf_from_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span> <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span>
      the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span> <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">`</span> fst <span class="main">`</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span> <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span> <span class="main">=</span> None <span class="main">∧</span>
      <span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">(</span>concl_of <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">`</span> fst <span class="main">`</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
        <span class="free">Red_F_q</span> <span class="bound">q</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">`</span> fst <span class="main">`</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_F_def no_labels.Red_I_def no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_inf_fl <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">using</span></span> suc_n_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> gc_complete_Liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_state<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"no_labels.entails_𝒢 <span class="main">(</span>fst <span class="main">`</span> lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BL</span> <span class="main">∈</span> Bot_FL<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> Liminf_llist <span class="free">Ns</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> lhd_is <span class="main">=</span> lhd_conv_lnth<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> labeled_b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> Bot_FL"</span></span> <span class="keyword1"><span class="command">using</span></span> b_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> labeled_bot_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"entails_𝒢_L <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> labeled_entailment_lifting bot_entailed lhd_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> fair<span class="main">:</span> <span class="quoted"><span class="quoted">"fair <span class="free">Ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gc_fair<span class="main">[</span><span class="operator">OF</span> deriv init_state final_state<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dynamically_complete_Liminf<span class="main">[</span><span class="operator">OF</span> labeled_b_in gc_to_red<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span> fair
        labeled_bot_entailed<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* thm:gc-completeness *)</span>
<span class="keyword1"><span class="command">theorem</span></span> gc_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_state<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"no_labels.entails_𝒢 <span class="main">(</span>fst <span class="main">`</span> lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">BL</span> <span class="main">∈</span> Bot_FL<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> lnth <span class="free">Ns</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> lhd_is <span class="main">=</span> lhd_conv_lnth<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BL</span><span class="main">∈</span>Bot_FL<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> Liminf_llist <span class="free">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gc_complete_Liminf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lazy Given Clause Procedure›</span></span>

<span class="keyword1"><span class="command">locale</span></span> lazy_given_clause <span class="main">=</span> given_clause_basis <span class="quoted"><span class="free">Bot_F</span></span> <span class="quoted"><span class="free">Inf_F</span></span> <span class="quoted"><span class="free">Bot_G</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">entails_q</span></span> <span class="quoted"><span class="free">Inf_G_q</span></span> <span class="quoted"><span class="free">Red_I_q</span></span>
  <span class="quoted"><span class="free">Red_F_q</span></span> <span class="quoted"><span class="free">𝒢_F_q</span></span> <span class="quoted"><span class="free">𝒢_I_q</span></span> <span class="quoted"><span class="free">Inf_FL</span></span> <span class="quoted"><span class="free">Equiv_F</span></span> <span class="quoted"><span class="free">Prec_F</span></span> <span class="quoted"><span class="free">Prec_L</span></span> <span class="quoted"><span class="free">active</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Bot_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_G_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Red_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_F_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'g</span> set"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">𝒢_I_q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'q</span> <span class="main">⇒</span> <span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'g</span> inference set option"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Inf_FL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Equiv_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≐</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≺⋅</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Prec_L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l</span> <span class="main">⇒</span> <span class="tfree">'l</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏L</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">active</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'l</span></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference set <span class="main">×</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span>
  <span class="tfree">'f</span> inference set <span class="main">×</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↝LGC</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  process<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M'</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M'</span></span></span><span class="main">)</span> <span class="main">⟹</span>
    active_subset <span class="free"><span class="bound"><span class="entity">M'</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">↝LGC</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  schedule_infer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">T'</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≠</span> <span class="free">active</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">T'</span></span></span> <span class="main">=</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">}</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">↝LGC</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  compute_infer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">}</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟹</span> active_subset <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">∈</span> no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">↝LGC</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  delete_orphans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">T'</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">T'</span></span></span> <span class="main">∩</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">↝LGC</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Given_Clause_Architectures-premise_free_inf_always_from"><span class="command">lemma</span></span> premise_free_inf_always_from<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span> <span class="main">⟹</span> prems_of <span class="free">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Given_Clause_Architectures-one_step_equiv"><span class="command">lemma</span></span> one_step_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T1</span><span class="main">,</span> <span class="free">N1</span><span class="main">)</span> <span class="keyword1">↝LGC</span> <span class="main">(</span><span class="free">T2</span><span class="main">,</span> <span class="free">N2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T1</span><span class="main">,</span> <span class="free">N1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T2</span><span class="main">,</span> <span class="free">N2</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> step.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T1</span><span class="main">,</span> <span class="free">N1</span><span class="main">)</span> <span class="keyword1">↝LGC</span> <span class="main">(</span><span class="free">T2</span><span class="main">,</span> <span class="free">N2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T1</span><span class="main">,</span> <span class="free">N1</span><span class="main">)</span> <span class="keyword1">↝LGC</span> <span class="main">(</span><span class="free">T2</span><span class="main">,</span> <span class="free">N2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">M</span> <span class="skolem">M'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    n1_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    m_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1_is n2_is m_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> derive.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">L</span> <span class="skolem">M</span>
  <span class="keyword3"><span class="command">assume</span></span>
    n1_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    not_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≠</span> <span class="free">active</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≼⋅</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equivp_def equiv_equiv_F<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">active</span> <span class="keyword1"><span class="free">⊏L</span></span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> active_minimal<span class="main">[</span><span class="operator">OF</span> not_active<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> red_labeled_clauses <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> std_Red_F_eq <span class="keyword1"><span class="command">using</span></span> n1_is n2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> derive.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
  <span class="keyword3"><span class="command">assume</span></span>
    n2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">=</span> <span class="free">N1</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> derive.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">=</span> <span class="free">N1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">-</span> <span class="free">N2</span> <span class="main">⊆</span> Red_F <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊳L</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> derive.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lem:lgc-derivations-are-red-derivations *)</span>
<span class="keyword1" id="Given_Clause_Architectures-lgc_to_red"><span class="command">lemma</span></span> lgc_to_red<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝LGC)</span> <span class="free">Ns</span> <span class="main">⟹</span> chain <span class="keyword1">(⊳L)</span> <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_step_equiv Lazy_List_Chain.chain_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> chain_lmap prod.collapse<span class="main">)</span>

<span class="comment1">(* lem:fair-lgc-derivations *)</span>
<span class="keyword1" id="Given_Clause_Architectures-lgc_fair"><span class="command">lemma</span></span> lgc_fair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝LGC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_state<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_prems_init_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_schedule<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fair <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fair_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> lhd_is <span class="main">=</span> lhd_conv_lnth<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> i_in_inf_fl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> active_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> final_state <span class="keyword1"><span class="command">unfolding</span></span> passive_subset_def active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m_def_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> length <span class="main">(</span>prems_of <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> i_in_F<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in Inf_FL_to_Inf_F <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> exist_nj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nj</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
      prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">nj</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">=</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in2 <span class="keyword1"><span class="command">unfolding</span></span> m_def Inf_from_def active_subset_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mem_eq Collect_mono_iff atLeastLessThan_iff nth_mem old.prod.exhaust snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j_in i_in <span class="keyword1"><span class="command">unfolding</span></span> m_def Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_is<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      c_in2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">using</span></span> init_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c_in3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> nj_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> init_state c_in2 nj_is <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def lhd_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_min_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_min</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">nj</span><span class="main">.</span> enat <span class="bound">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_allk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">nj_min</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c_in3 nj_is c_in2 INT_E LeastI_ex
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> INT_iff INT_simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> c_is image_eqI mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> njm_smaller_D<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">nj_min</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_min_is
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> LeastI_ex <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">nj</span><span class="main">.</span> <span class="main">⟦</span>enat <span class="bound">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">;</span>
          <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_min</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_is c_in2 nj_pos nj_min_is lhd_is
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> active_subset_def emptyE in_allk init_state mem_Collect_eq
          not_less snd_conv zero_enat_def chain_length_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">njm_prec</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_prec_is<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">njm_prec</span> <span class="main">=</span> <span class="skolem">nj_min</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0_conv_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> njm_prec_njm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">&lt;</span> <span class="skolem">nj_min</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> njm_prec_njm_enat<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">njm_prec</span> <span class="main">&lt;</span> enat <span class="skolem">nj_min</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> njm_prec_smaller_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">HOL.no_atp</span></span><span class="main">(</span>15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> njm_smaller_D njm_prec_njm_enat<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> njm_prec_all_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">njm_prec</span><span class="main">.</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_prec_is in_allk <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> notin_njm_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> absurd_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> prec_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">njm_prec</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nj_min_is nj_prec_is
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> LeastI_ex Suc_leD <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">nj</span><span class="main">.</span> <span class="main">⟦</span>enat <span class="bound">nj</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">;</span>
            <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
            enat_ord_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_eq_less_or_eq le_less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
          <span class="keyword3"><span class="command">assume</span></span> k_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">∧</span> enat <span class="skolem">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">njm_prec</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> absurd_hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">njm_prec</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> nj_prec_is in_allk k_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">njm_prec</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">`</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">njm_prec</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prec_smaller <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> nj_min_is nj_prec_is Orderings.wellorder_class.not_less_Least njm_prec_njm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> notin_active_subs_njm_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">njm_prec</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nj</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">nj</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c_is njm_prec_all_suc njm_prec_smaller_d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
          active_subset_def mem_Collect_eq nj_prec_is njm_smaller_D snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nj_set</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_set</span> <span class="main">=</span> <span class="main">{</span><span class="bound">nj</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span>
      prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">nj</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> m_null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">0</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_prems_init_active i_in_F m_def_F zero_enat_def chain_length_pos<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lhd_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> m_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> nj_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_set</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> zero_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n0</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="main">0</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">n0</span><span class="main">.</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="main">0</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exist_nj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">using</span></span> zero_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj_set</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> nj_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">nj_set</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_ex_finite_set<span class="main">[</span><span class="operator">OF</span> exist_nj<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_ile_eq
          dual_order.strict_implies_order linorder_neqE_nat nj_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="skolem">nj_set</span><span class="main">.</span> <span class="main">∀</span><span class="bound">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nj_not_empty nj_finite <span class="keyword1"><span class="command">using</span></span> Max_ge Max_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_bigger<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span><span class="main">.</span> <span class="bound">nj</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j0</span></span> <span class="keyword2"><span class="keyword">where</span></span> j0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> suc_n_length<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      j0_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      j0_allin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
          prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C0</span></span> <span class="keyword2"><span class="keyword">where</span></span> C0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j0_in i_in2 <span class="keyword1"><span class="command">unfolding</span></span> m_def Inf_from_def active_subset_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mem_eq Collect_mono_iff atLeastLessThan_iff nth_mem old.prod.exhaust snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> C0_prems_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_conv_nth j0_in m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> C0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C0_is j0_allin suc_n_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_subset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> C0_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C0_is j0_notin <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> step_n<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="keyword1">↝LGC</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv chain_lnth_rel n_in <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> is_scheduled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T2</span> <span class="bound">T1</span> <span class="bound">T'</span> <span class="bound">N1</span> <span class="bound">N</span> <span class="bound">C</span> <span class="bound">L</span> <span class="bound">N2</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T1</span><span class="main">,</span> <span class="bound">N1</span><span class="main">)</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T2</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span> <span class="main">∧</span>
        <span class="bound">T2</span> <span class="main">=</span> <span class="bound">T1</span> <span class="main">∪</span> <span class="bound">T'</span> <span class="main">∧</span> <span class="bound">N1</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="bound">L</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">L</span> <span class="main">≠</span> <span class="free">active</span> <span class="main">∧</span>
        <span class="bound">T'</span> <span class="main">=</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="bound">N</span><span class="main">)</span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> step_n C0_in C0_notin
      <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">N2</span></span> <span class="keyword2"><span class="keyword">where</span></span> nth_d_is<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">T1</span><span class="main">,</span> <span class="skolem">N1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      suc_nth_d_is<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">T2</span><span class="main">,</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T2</span> <span class="main">=</span> <span class="skolem">T1</span> <span class="main">∪</span> <span class="skolem">T'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      n1_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N2</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      l_not_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≠</span> <span class="free">active</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      tp_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="skolem">N</span><span class="main">)</span> <span class="main">{</span><span class="skolem">C0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C0_in C0_notin j0_in C0_is <span class="keyword1"><span class="command">using</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">⟹</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≠</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span> <span class="main">⟹</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        j_not_j0<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≠</span> prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j0</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_len<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nj_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">nj</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nj_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
            prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exist_nj j_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">using</span></span> j_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">nj</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> C0_in C0_notin step.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> step_n
            active_subset_def is_scheduled nj_greater nj_prems suc_n_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> j_not_j0 C0_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_bigger <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nj_greater n_in Suc_ile_eq dual_order.strict_implies_order
        <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nth_d_is l_not_active n1_is <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prems_i_active<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> active_subset <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C0_prems_i C0_is m_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff atLeast0LessThan in_set_conv_nth insertCI lessThan_iff subrelI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> active_subset <span class="skolem">N</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C0_prems_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_between <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C0</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in_inf_fl prems_i_active <span class="keyword1"><span class="command">unfolding</span></span> Inf_between_def Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">C0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_F_def Inf_between_def Inf_from_def
        no_labels.Inf_between_def no_labels.Inf_from_def
      <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tp_is t2_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
        prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">j0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">j0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
          prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j0_allin <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">j0</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nj</span></span> <span class="keyword2"><span class="keyword">where</span></span> nj_len<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">nj</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nj_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">nj</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nj_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">nj</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
            prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exist_nj j_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nj</span> <span class="main">∈</span> <span class="skolem">nj_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nj_set_def <span class="keyword1"><span class="command">using</span></span> j_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
          prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nj_greater n_bigger <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> allj_allk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
        <span class="bound">c</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeast0LessThan in_set_conv_nth lessThan_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> snd <span class="bound">c</span> <span class="main">=</span> <span class="free">active</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prems_i_active <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ex_n_i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> snd <span class="bound">c</span> <span class="main">=</span> <span class="free">active</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
          <span class="bound">c</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> allj_allk i_in_t2 suc_nth_d_is fstI n_in nj_set_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> snd <span class="bound">c</span> <span class="main">=</span> <span class="free">active</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">⟶</span>
          enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> <span class="bound">c</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="skolem"><span class="skolem">N2</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_in_suc_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    all_prems_active_after<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">⟶</span> enat <span class="bound">k</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span>
                  <span class="bound">c</span> <span class="main">∈</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    suc_n_length<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> suc_nth_d_is<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">T2</span><span class="main">,</span> <span class="skolem">N2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_antisym old.prod.exhaust zero_less_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∉</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span>
      contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     to_F <span class="skolem">ι</span> <span class="main">∉</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">⟹</span> enat <span class="main">(</span>Suc <span class="skolem">p0</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟹</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
        to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p0</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">⟹</span> enat <span class="skolem">p0</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟹</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p0</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_induct_at_least<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> base
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_in_t2 suc_nth_d_is
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">p0</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> p_bigger_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">p0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        induct_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p0</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟹</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        sucsuc_smaller_d<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">p0</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> suc_p_bigger_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">p0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_bigger_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> suc_smaller_d<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p0</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sucsuc_smaller_d Suc_ile_eq dual_order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> induct_hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_in_suc<span class="main">[</span><span class="operator">OF</span> suc_p_bigger_n sucsuc_smaller_d<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_in_all_bigger_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">∧</span> enat <span class="bound">j</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llength <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="main">(</span>lnth <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> enat <span class="bound">j</span> <span class="main">&lt;</span> llength <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in_all_bigger_n <span class="keyword1"><span class="command">using</span></span> Suc_le_D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> Liminf_llist <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">using</span></span> suc_n_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> final_schedule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_greater_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_smaller_d<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_in_p<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_notin_suc_p<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∉</span> <span class="main">(</span>fst <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> p_neq_n<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_notin_suc_p i_in_suc_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> step_p<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="keyword1">↝LGC</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deriv p_smaller_d chain_lnth_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span> <span class="bound">ι</span> <span class="bound">N2</span> <span class="bound">N1</span> <span class="bound">M</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T1</span><span class="main">,</span> <span class="bound">N1</span><span class="main">)</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T2</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span> <span class="main">∧</span>
      <span class="bound">T1</span> <span class="main">=</span> <span class="bound">T2</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">ι</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span> active_subset <span class="bound">M</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
      <span class="bound">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> ci_or_do<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span> <span class="bound">ι</span> <span class="bound">N2</span> <span class="bound">N1</span> <span class="bound">M</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T1</span><span class="main">,</span> <span class="bound">N1</span><span class="main">)</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T2</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span> <span class="main">∧</span>
        <span class="bound">T1</span> <span class="main">=</span> <span class="bound">T2</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">ι</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span> active_subset <span class="bound">M</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
        <span class="bound">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span> <span class="bound">T'</span> <span class="bound">N</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T1</span><span class="main">,</span> <span class="bound">N</span><span class="main">)</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T2</span><span class="main">,</span> <span class="bound">N</span><span class="main">)</span> <span class="main">∧</span>
        <span class="bound">T1</span> <span class="main">=</span> <span class="bound">T2</span> <span class="main">∪</span> <span class="bound">T'</span> <span class="main">∧</span> <span class="bound">T'</span> <span class="main">∩</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">]</span> step_p i_in_p i_notin_suc_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p_greater_n_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> suc_nth_d_is p_greater_n i_in_t2 i_notin_suc_p le_eq_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">⟹</span> prems_of <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> fst <span class="main">`</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span>
        m_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_prems_active_after<span class="main">[</span><span class="operator">OF</span> m_pos<span class="main">]</span> p_smaller_d m_def p_greater_n p_neq_n
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc_ile_eq atLeastLessThan_iff dual_order.strict_implies_order nth_mem
            p_greater_n_strict<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>prems_of <span class="skolem">ι</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> fst <span class="main">`</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> fst <span class="main">`</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> to_F_def <span class="keyword1"><span class="command">using</span></span> j_in m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prems_i_active_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span>
        to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in_F <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Inf_from_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> atLeast0LessThan in_set_conv_nth lessThan_iff m_def_F mem_Collect_eq subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span> <span class="bound">ι</span> <span class="bound">N2</span> <span class="bound">N1</span> <span class="bound">M</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T1</span><span class="main">,</span> <span class="bound">N1</span><span class="main">)</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T2</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span> <span class="main">∧</span>
        <span class="bound">T1</span> <span class="main">=</span> <span class="bound">T2</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">ι</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span> active_subset <span class="bound">M</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
        <span class="bound">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ci_or_do premise_free_inf_always_from<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> active_subset <span class="main">_</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> i_in_F<span class="main">]</span>
        m_def i_in_p i_notin_suc_p m_def_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span> <span class="bound">ι</span> <span class="bound">N2</span> <span class="bound">N1</span> <span class="bound">M</span><span class="main">.</span> lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T1</span><span class="main">,</span> <span class="bound">N1</span><span class="main">)</span> <span class="main">∧</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T2</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span> <span class="main">∧</span>
        <span class="bound">T1</span> <span class="main">=</span> <span class="bound">T2</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">ι</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">=</span> <span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span> <span class="main">∧</span> active_subset <span class="bound">M</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
        <span class="bound">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="bound">N1</span> <span class="main">∪</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ci_or_do i_in_p i_notin_suc_p prems_i_active_p <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1p</span></span> <span class="skolem"><span class="skolem">T2p</span></span> <span class="skolem"><span class="skolem">N1p</span></span> <span class="skolem"><span class="skolem">N2p</span></span> <span class="skolem"><span class="skolem">Mp</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">T1p</span><span class="main">,</span> <span class="skolem">N1p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    suc_p_is<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">T2p</span><span class="main">,</span> <span class="skolem">N2p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T1p</span> <span class="main">=</span> <span class="skolem">T2p</span> <span class="main">∪</span> <span class="main">{</span>to_F <span class="skolem">ι</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T2p</span> <span class="main">∩</span> <span class="main">{</span>to_F <span class="skolem">ι</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n2p_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N2p</span> <span class="main">=</span> <span class="skolem">N1p</span> <span class="main">∪</span> <span class="skolem">Mp</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"active_subset <span class="skolem">Mp</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_in_red_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢
        <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="skolem">N1p</span> <span class="main">∪</span> <span class="skolem">Mp</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_p i_notin_suc_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_red_inf suc_p_is n2p_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span> <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span>
      the <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span> <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I_q</span> <span class="bound">q</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">`</span> fst <span class="main">`</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span><span class="free">𝒢_I_q</span> <span class="bound">q</span> <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span> <span class="main">=</span> None <span class="main">∧</span>
      <span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">(</span>concl_of <span class="main">(</span>to_F <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">`</span> fst <span class="main">`</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
        <span class="free">Red_F_q</span> <span class="bound">q</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">𝒢_F_q</span> <span class="bound">q</span> <span class="main">`</span> fst <span class="main">`</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_F_def no_labels.Red_I_def no_labels.Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_in_inf_fl <span class="keyword1"><span class="command">unfolding</span></span> Red_I_𝒢_def Red_I_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">using</span></span> suc_n_length p_smaller_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> lgc_complete_Liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝LGC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_state<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_prems_init_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_schedule<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"no_labels.entails_𝒢 <span class="main">(</span>fst <span class="main">`</span> snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BL</span> <span class="main">∈</span> Bot_FL<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> labeled_b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span> <span class="main">∈</span> Bot_FL"</span></span> <span class="keyword1"><span class="command">using</span></span> b_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> simp_snd_lmap<span class="main">:</span> <span class="quoted"><span class="quoted">"lhd <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> llist.map_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> labeled_bot_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"entails_𝒢_L <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> labeled_entailment_lifting bot_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fair <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lgc_fair<span class="main">[</span><span class="operator">OF</span> deriv init_state final_state no_prems_init_active final_schedule<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dynamically_complete_Liminf labeled_b_in lgc_to_red<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span>
      labeled_bot_entailed simp_snd_lmap std_Red_I_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* thm:lgc-completeness *)</span>
<span class="keyword1"><span class="command">theorem</span></span> lgc_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝LGC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_state<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_prems_init_active<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final_schedule<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap fst <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot_F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_entailed<span class="main">:</span> <span class="quoted"><span class="quoted">"no_labels.entails_𝒢 <span class="main">(</span>fst <span class="main">`</span> snd <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">BL</span> <span class="main">∈</span> Bot_FL<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> snd <span class="main">(</span>lnth <span class="free">Ns</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BL</span><span class="main">∈</span>Bot_FL<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> Liminf_llist <span class="main">(</span>lmap snd <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lgc_complete_Liminf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Liminf_llist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>