<div id="Wasm_Ast">
<div class="head">
<h1>Theory Wasm_Ast</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹WebAssembly Core AST›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Ast
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../../HOL/HOL/Main.html">Main</a>
    <span class="quoted">"<a href="../Native_Word/Uint8.html">Native_Word.Uint8</a>"</span>
    <span class="quoted">"<a href="../Word_Lib/Reversed_Bit_Lists.html">Word_Lib.Reversed_Bit_Lists</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="comment1">― ‹immediate›</span>
  i <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="comment1">― ‹static offset›</span>
  off <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="comment1">― ‹alignment exponent›</span>
  a <span class="main">=</span> <span class="quoted">nat</span>

<span class="comment1">― ‹primitive types›</span>
<span class="keyword1"><span class="command">typedecl</span></span> i32
<span class="keyword1"><span class="command">typedecl</span></span> i64
<span class="keyword1"><span class="command">typedecl</span></span> f32
<span class="keyword1"><span class="command">typedecl</span></span> f64

<span class="comment1">― ‹memory›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> byte <span class="main">=</span> <span class="quoted">uint8</span>

<span class="keyword1"><span class="command">typedef</span></span> bytes <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span>byte list<span class="main">)</span> set"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_bytes
<span class="keyword1"><span class="command">declare</span></span> Quotient_bytes<span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span>

<span class="keyword1"><span class="command">lift_definition</span></span> bytes_takefill <span class="main">::</span> <span class="quoted"><span class="quoted">"byte <span class="main">⇒</span> nat <span class="main">⇒</span> bytes <span class="main">⇒</span> bytes"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">n</span> <span class="bound">as</span><span class="main">.</span> takefill <span class="main">(</span>Abs_uint8 <span class="bound">a</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> bytes_replicate <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> byte <span class="main">⇒</span> bytes"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">b</span><span class="main">.</span> replicate <span class="bound">n</span> <span class="main">(</span>Abs_uint8 <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">msbyte</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bytes <span class="main">⇒</span> byte"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">msbyte</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> last <span class="main">(</span>Rep_bytes <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> mem <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span>byte list<span class="main">)</span> set"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_mem
<span class="keyword1"><span class="command">declare</span></span> Quotient_mem<span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span>

<span class="keyword1"><span class="command">lift_definition</span></span> read_bytes <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bytes"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">n</span> <span class="bound">l</span><span class="main">.</span> take <span class="bound">l</span> <span class="main">(</span>drop <span class="bound">n</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> write_bytes <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> bytes <span class="main">⇒</span> mem"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">n</span> <span class="bound">bs</span><span class="main">.</span> <span class="main">(</span>take <span class="bound">n</span> <span class="bound">m</span><span class="main">)</span> <span class="main">@</span> <span class="bound">bs</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> length <span class="bound">bs</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mem_append <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> bytes <span class="main">⇒</span> mem"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">append</span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">― ‹host›</span>
<span class="keyword1"><span class="command">typedecl</span></span> host
<span class="keyword1"><span class="command">typedecl</span></span> host_state

<span class="keyword1"><span class="command">datatype</span></span> <span class="comment1">― ‹value types›</span>
  t <span class="main">=</span> T_i32 <span class="main">|</span> T_i64 <span class="main">|</span> T_f32 <span class="main">|</span> T_f64

<span class="keyword1"><span class="command">datatype</span></span> <span class="comment1">― ‹packed types›</span>
  tp <span class="main">=</span> Tp_i8 <span class="main">|</span> Tp_i16 <span class="main">|</span> Tp_i32

<span class="keyword1"><span class="command">datatype</span></span> <span class="comment1">― ‹mutability›</span>
  mut <span class="main">=</span> T_immut <span class="main">|</span> T_mut

<span class="keyword1"><span class="command">record</span></span> tg <span class="main">=</span> <span class="comment1">― ‹global types›</span>
  tg_mut <span class="main">::</span> <span class="quoted">mut</span>
  tg_t <span class="main">::</span> <span class="quoted">t</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="comment1">― ‹function types›</span>
  tf <span class="main">=</span> Tf <span class="quoted"><span class="quoted">"t list"</span></span> <span class="quoted"><span class="quoted">"t list"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'_&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> 60<span class="main">)</span>

<span class="comment1">(* TYPING *)</span>
<span class="keyword1"><span class="command">record</span></span> t_context <span class="main">=</span>
  types_t <span class="main">::</span> <span class="quoted"><span class="quoted">"tf list"</span></span>
  func_t <span class="main">::</span> <span class="quoted"><span class="quoted">"tf list"</span></span>
  global <span class="main">::</span> <span class="quoted"><span class="quoted">"tg list"</span></span>
  table <span class="main">::</span> <span class="quoted"><span class="quoted">"nat option"</span></span>
  memory <span class="main">::</span> <span class="quoted"><span class="quoted">"nat option"</span></span>
  local <span class="main">::</span> <span class="quoted"><span class="quoted">"t list"</span></span>
  label <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>t list<span class="main">)</span> list"</span></span>
  return <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>t list<span class="main">)</span> option"</span></span>

<span class="keyword1"><span class="command">record</span></span> s_context <span class="main">=</span>
  s_inst <span class="main">::</span> <span class="quoted"><span class="quoted">"t_context list"</span></span>
  s_funcs <span class="main">::</span> <span class="quoted"><span class="quoted">"tf list"</span></span>
  s_tab  <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
  s_mem  <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
  s_globs <span class="main">::</span> <span class="quoted"><span class="quoted">"tg list"</span></span>

<span class="keyword1"><span class="command">datatype</span></span>
  sx <span class="main">=</span> S <span class="main">|</span> U

<span class="keyword1"><span class="command">datatype</span></span>
  unop_i <span class="main">=</span> Clz <span class="main">|</span> Ctz <span class="main">|</span> Popcnt

<span class="keyword1"><span class="command">datatype</span></span>
  unop_f <span class="main">=</span> Neg <span class="main">|</span> Abs <span class="main">|</span> Ceil <span class="main">|</span> Floor <span class="main">|</span> Trunc <span class="main">|</span> Nearest <span class="main">|</span> Sqrt

<span class="keyword1"><span class="command">datatype</span></span>
  binop_i <span class="main">=</span> Add <span class="main">|</span> Sub <span class="main">|</span> Mul <span class="main">|</span> Div <span class="quoted">sx</span> <span class="main">|</span> Rem <span class="quoted">sx</span> <span class="main">|</span> And <span class="main">|</span> Or <span class="main">|</span> Xor <span class="main">|</span> Shl <span class="main">|</span> Shr <span class="quoted">sx</span> <span class="main">|</span> Rotl <span class="main">|</span> Rotr

<span class="keyword1"><span class="command">datatype</span></span>
  binop_f <span class="main">=</span> Addf <span class="main">|</span> Subf <span class="main">|</span> Mulf <span class="main">|</span> Divf <span class="main">|</span> Min <span class="main">|</span> Max <span class="main">|</span> Copysign
  
<span class="keyword1"><span class="command">datatype</span></span>
  testop <span class="main">=</span> Eqz
  
<span class="keyword1"><span class="command">datatype</span></span>
  relop_i <span class="main">=</span> Eq <span class="main">|</span> Ne <span class="main">|</span> Lt <span class="quoted">sx</span> <span class="main">|</span> Gt <span class="quoted">sx</span> <span class="main">|</span> Le <span class="quoted">sx</span> <span class="main">|</span> Ge <span class="quoted">sx</span>
  
<span class="keyword1"><span class="command">datatype</span></span>
  relop_f <span class="main">=</span> Eqf <span class="main">|</span> Nef <span class="main">|</span> Ltf <span class="main">|</span> Gtf <span class="main">|</span> Lef <span class="main">|</span> Gef
  
<span class="keyword1"><span class="command">datatype</span></span>
  cvtop <span class="main">=</span> Convert <span class="main">|</span> Reinterpret

<span class="keyword1"><span class="command">datatype</span></span> <span class="comment1">― ‹values›</span>
  v <span class="main">=</span>
    ConstInt32 <span class="quoted">i32</span>
    <span class="main">|</span> ConstInt64 <span class="quoted">i64</span>
    <span class="main">|</span> ConstFloat32 <span class="quoted">f32</span>
    <span class="main">|</span> ConstFloat64 <span class="quoted">f64</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="comment1">― ‹basic instructions›</span>
  b_e <span class="main">=</span>
    Unreachable
    <span class="main">|</span> Nop
    <span class="main">|</span> Drop
    <span class="main">|</span> Select
    <span class="main">|</span> Block <span class="quoted">tf</span> <span class="quoted"><span class="quoted">"b_e list"</span></span>
    <span class="main">|</span> Loop <span class="quoted">tf</span> <span class="quoted"><span class="quoted">"b_e list"</span></span>
    <span class="main">|</span> If <span class="quoted">tf</span> <span class="quoted"><span class="quoted">"b_e list"</span></span> <span class="quoted"><span class="quoted">"b_e list"</span></span>
    <span class="main">|</span> Br <span class="quoted">i</span>
    <span class="main">|</span> Br_if <span class="quoted">i</span>
    <span class="main">|</span> Br_table <span class="quoted"><span class="quoted">"i list"</span></span> <span class="quoted">i</span>
    <span class="main">|</span> Return
    <span class="main">|</span> Call <span class="quoted">i</span>
    <span class="main">|</span> Call_indirect <span class="quoted">i</span>
    <span class="main">|</span> Get_local <span class="quoted">i</span>
    <span class="main">|</span> Set_local <span class="quoted">i</span>
    <span class="main">|</span> Tee_local <span class="quoted">i</span>
    <span class="main">|</span> Get_global <span class="quoted">i</span>
    <span class="main">|</span> Set_global <span class="quoted">i</span>
    <span class="main">|</span> Load <span class="quoted">t</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tp <span class="main">×</span> sx<span class="main">)</span> option"</span></span> <span class="quoted">a</span> <span class="quoted">off</span>
    <span class="main">|</span> Store <span class="quoted">t</span> <span class="quoted"><span class="quoted">"tp option"</span></span> <span class="quoted">a</span> <span class="quoted">off</span>
    <span class="main">|</span> Current_memory
    <span class="main">|</span> Grow_memory
    <span class="main">|</span> EConst <span class="quoted">v</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">C</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> 60<span class="main">)</span>
    <span class="main">|</span> Unop_i <span class="quoted">t</span> <span class="quoted">unop_i</span>
    <span class="main">|</span> Unop_f <span class="quoted">t</span> <span class="quoted">unop_f</span>
    <span class="main">|</span> Binop_i <span class="quoted">t</span> <span class="quoted">binop_i</span>
    <span class="main">|</span> Binop_f <span class="quoted">t</span> <span class="quoted">binop_f</span>
    <span class="main">|</span> Testop <span class="quoted">t</span> <span class="quoted">testop</span>
    <span class="main">|</span> Relop_i <span class="quoted">t</span> <span class="quoted">relop_i</span>
    <span class="main">|</span> Relop_f <span class="quoted">t</span> <span class="quoted">relop_f</span>
    <span class="main">|</span> Cvtop <span class="quoted">t</span> <span class="quoted">cvtop</span> <span class="quoted">t</span> <span class="quoted"><span class="quoted">"sx option"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> cl <span class="main">=</span> <span class="comment1">― ‹function closures›</span>
  Func_native <span class="quoted">i</span> <span class="quoted">tf</span> <span class="quoted"><span class="quoted">"t list"</span></span> <span class="quoted"><span class="quoted">"b_e list"</span></span>
<span class="main">|</span> Func_host <span class="quoted">tf</span> <span class="quoted">host</span>

<span class="keyword1"><span class="command">record</span></span> inst <span class="main">=</span> <span class="comment1">― ‹instances›</span>
  types <span class="main">::</span> <span class="quoted"><span class="quoted">"tf list"</span></span>
  funcs <span class="main">::</span> <span class="quoted"><span class="quoted">"i list"</span></span>
  tab <span class="main">::</span> <span class="quoted"><span class="quoted">"i option"</span></span>
  mem <span class="main">::</span> <span class="quoted"><span class="quoted">"i option"</span></span>
  globs <span class="main">::</span> <span class="quoted"><span class="quoted">"i list"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> tabinst <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl option<span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">record</span></span> global <span class="main">=</span>
  g_mut <span class="main">::</span> <span class="quoted">mut</span>
  g_val <span class="main">::</span> <span class="quoted">v</span>

<span class="keyword1"><span class="command">record</span></span> s <span class="main">=</span> <span class="comment1">― ‹store›</span>
  inst <span class="main">::</span> <span class="quoted"><span class="quoted">"inst list"</span></span>
  funcs <span class="main">::</span> <span class="quoted"><span class="quoted">"cl list"</span></span>
  tab <span class="main">::</span> <span class="quoted"><span class="quoted">"tabinst list"</span></span>
  mem <span class="main">::</span> <span class="quoted"><span class="quoted">"mem list"</span></span>
  globs <span class="main">::</span> <span class="quoted"><span class="quoted">"global list"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> e <span class="main">=</span> <span class="comment1">― ‹administrative instruction›</span>
  Basic <span class="quoted">b_e</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">$</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> 60<span class="main">)</span>
  <span class="main">|</span> Trap
  <span class="main">|</span> Callcl <span class="quoted">cl</span>
  <span class="main">|</span> Label <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"e list"</span></span> <span class="quoted"><span class="quoted">"e list"</span></span>
  <span class="main">|</span> Local <span class="quoted">nat</span> <span class="quoted">i</span> <span class="quoted"><span class="quoted">"v list"</span></span> <span class="quoted"><span class="quoted">"e list"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> Lholed <span class="main">=</span>
    <span class="comment1">― ‹L0 = v* [&lt;hole&gt;] e*›</span>
    LBase <span class="quoted"><span class="quoted">"e list"</span></span> <span class="quoted"><span class="quoted">"e list"</span></span>
    <span class="comment1">― ‹L(i+1) = v* (label n {e* } Li) e*›</span>
  <span class="main">|</span> LRec <span class="quoted"><span class="quoted">"e list"</span></span> <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"e list"</span></span> <span class="quoted">Lholed</span> <span class="quoted"><span class="quoted">"e list"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Type_Abs">
<div class="head">
<h1>Theory Wasm_Type_Abs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Syntactic Typeclasses›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Type_Abs <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> wasm_base <span class="main">=</span> zero

<span class="keyword1"><span class="command">class</span></span> wasm_int <span class="main">=</span> wasm_base <span class="main">+</span>
  <span class="comment1">(* unops*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_clz</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_ctz</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_popcnt</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="comment1">(* binops *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_add</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_sub</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_mul</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_div_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_div_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_rem_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_rem_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_and</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_or</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_xor</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_shl</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_shr_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_shr_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_rotl</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_rotr</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="comment1">(* testops *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_eqz</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="comment1">(* relops *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_eq</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_lt_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_lt_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_gt_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_gt_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_le_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_le_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_ge_u</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_ge_s</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="comment1">(* value conversions *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">int_of_nat</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">nat_of_int</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">int_ne</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">int_ne</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span>int_eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> wasm_float <span class="main">=</span> wasm_base <span class="main">+</span>
  <span class="comment1">(* unops *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_neg</span></span></span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_abs</span></span></span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_ceil</span></span></span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_floor</span></span></span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_trunc</span></span></span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_nearest</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_sqrt</span></span></span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="comment1">(* binops *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_add</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_sub</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_mul</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_div</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_min</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_max</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_copysign</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="comment1">(* relops *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_eq</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_lt</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_gt</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_le</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">float_ge</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">float_ne</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">float_ne</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span>float_eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Base_Defs">
<div class="head">
<h1>Theory Wasm_Base_Defs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹WebAssembly Base Definitions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Base_Defs <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Ast.html">Wasm_Ast</a> <a href="Wasm_Type_Abs.html">Wasm_Type_Abs</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> i32 <span class="main">::</span> <span class="quoted">wasm_int</span> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> i64 <span class="main">::</span> <span class="quoted">wasm_int</span> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> f32 <span class="main">::</span> <span class="quoted">wasm_float</span> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> f64 <span class="main">::</span> <span class="quoted">wasm_float</span> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  <span class="comment1">(* inter-type conversions *)</span>
  <span class="comment1">(* float to i32 *)</span>
  ui32_trunc_f32 <span class="main">::</span> <span class="quoted"><span class="quoted">"f32 <span class="main">⇒</span> i32 option"</span></span>
  si32_trunc_f32 <span class="main">::</span> <span class="quoted"><span class="quoted">"f32 <span class="main">⇒</span> i32 option"</span></span>
  ui32_trunc_f64 <span class="main">::</span> <span class="quoted"><span class="quoted">"f64 <span class="main">⇒</span> i32 option"</span></span>
  si32_trunc_f64 <span class="main">::</span> <span class="quoted"><span class="quoted">"f64 <span class="main">⇒</span> i32 option"</span></span>
  <span class="comment1">(* float to i64 *)</span>
  ui64_trunc_f32 <span class="main">::</span> <span class="quoted"><span class="quoted">"f32 <span class="main">⇒</span> i64 option"</span></span>
  si64_trunc_f32 <span class="main">::</span> <span class="quoted"><span class="quoted">"f32 <span class="main">⇒</span> i64 option"</span></span>
  ui64_trunc_f64 <span class="main">::</span> <span class="quoted"><span class="quoted">"f64 <span class="main">⇒</span> i64 option"</span></span>
  si64_trunc_f64 <span class="main">::</span> <span class="quoted"><span class="quoted">"f64 <span class="main">⇒</span> i64 option"</span></span>
  <span class="comment1">(* int to f32 *)</span>
  f32_convert_ui32 <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> f32"</span></span>
  f32_convert_si32 <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> f32"</span></span>
  f32_convert_ui64 <span class="main">::</span> <span class="quoted"><span class="quoted">"i64 <span class="main">⇒</span> f32"</span></span>
  f32_convert_si64 <span class="main">::</span> <span class="quoted"><span class="quoted">"i64 <span class="main">⇒</span> f32"</span></span>
  <span class="comment1">(* int to f64 *)</span>
  f64_convert_ui32 <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> f64"</span></span>
  f64_convert_si32 <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> f64"</span></span>
  f64_convert_ui64 <span class="main">::</span> <span class="quoted"><span class="quoted">"i64 <span class="main">⇒</span> f64"</span></span>
  f64_convert_si64 <span class="main">::</span> <span class="quoted"><span class="quoted">"i64 <span class="main">⇒</span> f64"</span></span>
  <span class="comment1">(* intra-{int/float} conversions *)</span>
  wasm_wrap <span class="main">::</span> <span class="quoted"><span class="quoted">"i64 <span class="main">⇒</span> i32"</span></span>
  wasm_extend_u <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> i64"</span></span>
  wasm_extend_s <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> i64"</span></span>
  wasm_demote <span class="main">::</span> <span class="quoted"><span class="quoted">"f64 <span class="main">⇒</span> f32"</span></span>
  wasm_promote <span class="main">::</span> <span class="quoted"><span class="quoted">"f32 <span class="main">⇒</span> f64"</span></span>
  <span class="comment1">(* boolean encoding *)</span>
  serialise_i32 <span class="main">::</span> <span class="quoted"><span class="quoted">"i32 <span class="main">⇒</span> bytes"</span></span>
  serialise_i64 <span class="main">::</span> <span class="quoted"><span class="quoted">"i64 <span class="main">⇒</span> bytes"</span></span>
  serialise_f32 <span class="main">::</span> <span class="quoted"><span class="quoted">"f32 <span class="main">⇒</span> bytes"</span></span>
  serialise_f64 <span class="main">::</span> <span class="quoted"><span class="quoted">"f64 <span class="main">⇒</span> bytes"</span></span>
  wasm_bool <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> i32"</span></span>
  int32_minus_one <span class="main">::</span> <span class="quoted">i32</span>

  <span class="comment1">(* memory *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mem_size</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mem_size</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> length <span class="main">(</span>Rep_mem <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mem_grow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> mem"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mem_grow</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> mem_append <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>bytes_replicate <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> <span class="numeral">64000</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">load</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> off <span class="main">⇒</span> nat <span class="main">⇒</span> bytes option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">load</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>mem_size <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≥</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>
                       <span class="keyword1">then</span> Some <span class="main">(</span>read_bytes <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>
                       <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sx <span class="main">⇒</span> nat <span class="main">⇒</span> bytes <span class="main">⇒</span> bytes"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sign_extend</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">bytes</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">msb</span> <span class="main">=</span> msb <span class="main">(</span>msbyte <span class="free"><span class="bound"><span class="entity">bytes</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
                          <span class="keyword1">let</span> <span class="bound">byte</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span> U <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> S <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">msb</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">in</span>
                          bytes_takefill <span class="bound">byte</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">bytes</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">load_packed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sx <span class="main">⇒</span> mem <span class="main">⇒</span> nat <span class="main">⇒</span> off <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bytes option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">load_packed</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="free"><span class="bound"><span class="entity">lp</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> map_option <span class="main">(</span>sign_extend <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span>load <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="free"><span class="bound"><span class="entity">lp</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">store</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> off <span class="main">⇒</span> bytes <span class="main">⇒</span> nat <span class="main">⇒</span> mem option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">store</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>mem_size <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≥</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>
                          <span class="keyword1">then</span> Some <span class="main">(</span>write_bytes <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span> <span class="main">(</span>bytes_takefill <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span>
                          <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">store_packed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> off <span class="main">⇒</span> bytes <span class="main">⇒</span> nat <span class="main">⇒</span> mem option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">store_packed</span> <span class="main">=</span> store"</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  wasm_deserialise <span class="main">::</span> <span class="quoted"><span class="quoted">"bytes <span class="main">⇒</span> t <span class="main">⇒</span> v"</span></span>
  <span class="comment1">(* host *)</span>
  host_apply <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> tf <span class="main">⇒</span> host <span class="main">⇒</span> v list <span class="main">⇒</span> host_state <span class="main">⇒</span> <span class="main">(</span>s <span class="main">×</span> v list<span class="main">)</span> option"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">typeof</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" v <span class="main">⇒</span> t"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">typeof</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
                 ConstInt32 <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_i32
               <span class="main">|</span> ConstInt64 <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_i64
               <span class="main">|</span> ConstFloat32 <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_f32
               <span class="main">|</span> ConstFloat64 <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_f64<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">option_projl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> option <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">option_projl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> map_option fst <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">option_projr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> option <span class="main">⇒</span> <span class="tfree">'b</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">option_projr</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> map_option snd <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">t_length</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span>
                  T_i32 <span class="main">⇒</span> <span class="numeral">4</span>
                <span class="main">|</span> T_i64 <span class="main">⇒</span> <span class="numeral">8</span>
                <span class="main">|</span> T_f32 <span class="main">⇒</span> <span class="numeral">4</span>
                <span class="main">|</span> T_f64 <span class="main">⇒</span> <span class="numeral">8</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tp_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tp <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">tp_length</span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="keyword1">of</span>
                 Tp_i8 <span class="main">⇒</span> <span class="main">1</span>
               <span class="main">|</span> Tp_i16 <span class="main">⇒</span> <span class="numeral">2</span>
               <span class="main">|</span> Tp_i32 <span class="main">⇒</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_int_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">is_int_t</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span>
                  T_i32 <span class="main">⇒</span> True
                <span class="main">|</span> T_i64 <span class="main">⇒</span> True
                <span class="main">|</span> T_f32 <span class="main">⇒</span> False
                <span class="main">|</span> T_f64 <span class="main">⇒</span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_float_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">is_float_t</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span>
                    T_i32 <span class="main">⇒</span> False
                  <span class="main">|</span> T_i64 <span class="main">⇒</span> False
                  <span class="main">|</span> T_f32 <span class="main">⇒</span> True
                  <span class="main">|</span> T_f64 <span class="main">⇒</span> True<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_mut</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_mut</span> <span class="free"><span class="bound"><span class="entity">tg</span></span></span> <span class="main">=</span> <span class="main">(</span>tg_mut <span class="free"><span class="bound"><span class="entity">tg</span></span></span> <span class="main">=</span> T_mut<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_unop_i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unop_i <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_unop_i</span> <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="keyword1">of</span>
     Ctz <span class="main">⇒</span> int_ctz <span class="free"><span class="bound"><span class="entity">c</span></span></span>
   <span class="main">|</span> Clz <span class="main">⇒</span> int_clz <span class="free"><span class="bound"><span class="entity">c</span></span></span>
   <span class="main">|</span> Popcnt <span class="main">⇒</span> int_popcnt <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_unop_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unop_f <span class="main">⇒</span> <span class="tfree">'f</span><span class="main">::</span>wasm_float <span class="main">⇒</span> <span class="tfree">'f</span><span class="main">::</span>wasm_float"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_unop_f</span> <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="keyword1">of</span>
                    Neg <span class="main">⇒</span> float_neg <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                  <span class="main">|</span> Abs <span class="main">⇒</span> float_abs <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                  <span class="main">|</span> Ceil <span class="main">⇒</span> float_ceil <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                  <span class="main">|</span> Floor <span class="main">⇒</span> float_floor <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                  <span class="main">|</span> Trunc <span class="main">⇒</span> float_trunc <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                  <span class="main">|</span> Nearest <span class="main">⇒</span> float_nearest <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                  <span class="main">|</span> Sqrt <span class="main">⇒</span> float_sqrt <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_binop_i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"binop_i <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>wasm_int<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_binop_i</span> <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="keyword1">of</span>
                              Add <span class="main">⇒</span> Some <span class="main">(</span>int_add <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Sub <span class="main">⇒</span> Some <span class="main">(</span>int_sub <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Mul <span class="main">⇒</span> Some <span class="main">(</span>int_mul <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Div U <span class="main">⇒</span> int_div_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Div S <span class="main">⇒</span> int_div_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Rem U <span class="main">⇒</span> int_rem_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Rem S <span class="main">⇒</span> int_rem_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> And <span class="main">⇒</span> Some <span class="main">(</span>int_and <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Or <span class="main">⇒</span> Some <span class="main">(</span>int_or <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Xor <span class="main">⇒</span> Some <span class="main">(</span>int_xor <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Shl <span class="main">⇒</span> Some <span class="main">(</span>int_shl <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Shr U <span class="main">⇒</span> Some <span class="main">(</span>int_shr_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Shr S <span class="main">⇒</span> Some <span class="main">(</span>int_shr_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Rotl <span class="main">⇒</span> Some <span class="main">(</span>int_rotl <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Rotr <span class="main">⇒</span> Some <span class="main">(</span>int_rotr <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_binop_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"binop_f <span class="main">⇒</span> <span class="tfree">'f</span><span class="main">::</span>wasm_float <span class="main">⇒</span> <span class="tfree">'f</span><span class="main">::</span>wasm_float <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>wasm_float<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_binop_f</span> <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="keyword1">of</span>
                              Addf <span class="main">⇒</span> Some <span class="main">(</span>float_add <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Subf <span class="main">⇒</span> Some <span class="main">(</span>float_sub <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Mulf <span class="main">⇒</span> Some <span class="main">(</span>float_mul <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Divf <span class="main">⇒</span> Some <span class="main">(</span>float_div <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Min <span class="main">⇒</span> Some <span class="main">(</span>float_min <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Max <span class="main">⇒</span> Some <span class="main">(</span>float_max <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                            <span class="main">|</span> Copysign <span class="main">⇒</span> Some <span class="main">(</span>float_copysign <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_testop_i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"testop <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_testop_i</span> <span class="free"><span class="bound"><span class="entity">testop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">testop</span></span></span> <span class="keyword1">of</span> Eqz <span class="main">⇒</span> int_eqz <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_relop_i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"relop_i <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>wasm_int <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_relop_i</span> <span class="free"><span class="bound"><span class="entity">rop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">rop</span></span></span> <span class="keyword1">of</span>
                              Eq <span class="main">⇒</span> int_eq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Ne <span class="main">⇒</span> int_ne <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Lt U <span class="main">⇒</span> int_lt_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Lt S <span class="main">⇒</span> int_lt_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Gt U <span class="main">⇒</span> int_gt_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Gt S <span class="main">⇒</span> int_gt_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Le U <span class="main">⇒</span> int_le_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Le S <span class="main">⇒</span> int_le_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Ge U <span class="main">⇒</span> int_ge_u <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Ge S <span class="main">⇒</span> int_ge_s <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_relop_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"relop_f <span class="main">⇒</span> <span class="tfree">'f</span><span class="main">::</span>wasm_float <span class="main">⇒</span> <span class="tfree">'f</span><span class="main">::</span>wasm_float <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_relop_f</span> <span class="free"><span class="bound"><span class="entity">rop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">rop</span></span></span> <span class="keyword1">of</span>
                              Eqf <span class="main">⇒</span> float_eq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Nef <span class="main">⇒</span> float_ne <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Ltf <span class="main">⇒</span> float_lt <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Gtf <span class="main">⇒</span> float_gt <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Lef <span class="main">⇒</span> float_le <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>
                            <span class="main">|</span> Gef <span class="main">⇒</span> float_ge <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">types_agree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> v <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">types_agree</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>typeof <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cl_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cl <span class="main">⇒</span> tf"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cl_type</span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="keyword1">of</span> Func_native <span class="main"><span class="bound">_</span></span> <span class="bound">tf</span> <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">tf</span> <span class="main">|</span> Func_host <span class="bound">tf</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">tf</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rglob_is_mut</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"global <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rglob_is_mut</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span>g_mut <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> T_mut<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stypes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> tf"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stypes</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>types <span class="main">(</span><span class="main">(</span>inst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sfunc_ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sfunc_ind</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>inst.funcs <span class="main">(</span><span class="main">(</span>inst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sfunc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> cl"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sfunc</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span>funcs <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sfunc_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sglob_ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sglob_ind</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>inst.globs <span class="main">(</span><span class="main">(</span>inst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sglob</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> global"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sglob</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span>globs <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sglob_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sglob_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> v"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sglob_val</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> g_val <span class="main">(</span>sglob <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">smem_ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">smem_ind</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stab_s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> cl option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stab_s</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">stabinst</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>tab <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="keyword1">in</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span><span class="bound">stabinst</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">stabinst</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stab</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> cl option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stab</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>inst.tab <span class="main">(</span><span class="main">(</span>inst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> Some <span class="bound">k</span> <span class="main">=&gt;</span> stab_s <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">|</span> None <span class="main">=&gt;</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supdate_glob_s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> v <span class="main">⇒</span> s"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">supdate_glob_s</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>globs <span class="main">:=</span> <span class="main">(</span>globs <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">:=</span><span class="main">(</span><span class="main">(</span>globs <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">⦇</span>g_val <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⦈</span><span class="main">]</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supdate_glob</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> v <span class="main">⇒</span> s"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">supdate_glob</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">k</span> <span class="main">=</span> sglob_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">in</span> supdate_glob_s <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_const</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"e <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_const</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span> Basic <span class="main">(</span><span class="keyword1">C</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">const_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"e list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">const_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> list_all is_const <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">store_extension</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> s <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">insts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">insts'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">fs'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">tclss</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tclss'</span></span></span><span class="main">;</span> list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">bs</span> <span class="bound">bs'</span><span class="main">.</span> mem_size <span class="bound">bs</span> <span class="main">≤</span> mem_size <span class="bound">bs'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bss</span></span></span> <span class="free"><span class="bound"><span class="entity">bss'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gs'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">store_extension</span> <span class="main">⦇</span>s.inst <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">insts</span></span></span><span class="main">,</span> s.funcs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">,</span> s.tab <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tclss</span></span></span><span class="main">,</span> s.mem <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bss</span></span></span><span class="main">,</span> s.globs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">⦈</span>
                    <span class="main">⦇</span>s.inst <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">insts'</span></span></span><span class="main">,</span> s.funcs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">fs'</span></span></span><span class="main">,</span> s.tab <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tclss'</span></span></span><span class="main">,</span> s.mem <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bss'</span></span></span><span class="main">,</span> s.globs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gs'</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">to_e_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"b_e list <span class="main">⇒</span> e list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">$*</span> _"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_e_list</span> <span class="free"><span class="bound"><span class="entity">b_es</span></span></span> <span class="main">≡</span> map Basic <span class="free"><span class="bound"><span class="entity">b_es</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">v_to_e_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"v list <span class="main">⇒</span> e list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">$$*</span> _"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">v_to_e_list</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">v</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span>"</span></span>

  <span class="comment1">(* Lfilled depth thing-to-fill fill-with result *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Lfilled</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> Lholed <span class="main">⇒</span> e list <span class="main">⇒</span> e list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">(* "Lfill (LBase vs es') es = vs @ es @ es'" *)</span>
  L0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">=</span> <span class="main">(</span>LBase <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Lfilled</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">(* "Lfill (LRec vs ts es' l es'') es = vs @ [Label ts es' (Lfill l es)] @ es''" *)</span>
<span class="main">|</span> LN<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">=</span> <span class="main">(</span>LRec <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">es''</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free">Lfilled</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">lfilledk</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Lfilled</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span> <span class="free"><span class="bound"><span class="entity">lfilledk</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">es''</span></span></span><span class="main">)</span>"</span></span>

  <span class="comment1">(* Lfilled depth thing-to-fill fill-with result *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Lfilled_exact</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> Lholed <span class="main">⇒</span> e list <span class="main">⇒</span> e list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">(* "Lfill (LBase vs es') es = vs @ es @ es'" *)</span>
  L0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">=</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Lfilled_exact</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>
  <span class="comment1">(* "Lfill (LRec vs ts es' l es'') es = vs @ [Label ts es' (Lfill l es)] @ es''" *)</span>
<span class="main">|</span> LN<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">=</span> <span class="main">(</span>LRec <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">es''</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free">Lfilled_exact</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">lfilledk</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Lfilled_exact</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span> <span class="free"><span class="bound"><span class="entity">lfilledk</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">es''</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">load_store_t_bounds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"a <span class="main">⇒</span> tp option <span class="main">⇒</span> t <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">load_store_t_bounds</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="keyword1">of</span>
                                   None <span class="main">⇒</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                 <span class="main">|</span> Some <span class="bound">tp</span> <span class="main">⇒</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> tp_length <span class="bound">tp</span> <span class="main">∧</span> tp_length <span class="bound">tp</span> <span class="main">&lt;</span> t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span>  is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cvt_i32</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sx option <span class="main">⇒</span> v <span class="main">⇒</span> i32 option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cvt_i32</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
                   ConstInt32 <span class="bound">c</span> <span class="main">⇒</span> None
                 <span class="main">|</span> ConstInt64 <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>wasm_wrap <span class="bound">c</span><span class="main">)</span>
                 <span class="main">|</span> ConstFloat32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                        Some U <span class="main">⇒</span> ui32_trunc_f32 <span class="bound">c</span>
                                      <span class="main">|</span> Some S <span class="main">⇒</span> si32_trunc_f32 <span class="bound">c</span>
                                      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstFloat64 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                        Some U <span class="main">⇒</span> ui32_trunc_f64 <span class="bound">c</span>
                                      <span class="main">|</span> Some S <span class="main">⇒</span> si32_trunc_f64 <span class="bound">c</span>
                                      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cvt_i64</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sx option <span class="main">⇒</span> v <span class="main">⇒</span> i64 option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cvt_i64</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
                   ConstInt32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                        Some U <span class="main">⇒</span> Some <span class="main">(</span>wasm_extend_u <span class="bound">c</span><span class="main">)</span>
                                      <span class="main">|</span> Some S <span class="main">⇒</span> Some <span class="main">(</span>wasm_extend_s <span class="bound">c</span><span class="main">)</span>
                                      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstInt64 <span class="bound">c</span> <span class="main">⇒</span> None
                 <span class="main">|</span> ConstFloat32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                        Some U <span class="main">⇒</span> ui64_trunc_f32 <span class="bound">c</span>
                                      <span class="main">|</span> Some S <span class="main">⇒</span> si64_trunc_f32 <span class="bound">c</span>
                                      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstFloat64 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                        Some U <span class="main">⇒</span> ui64_trunc_f64 <span class="bound">c</span>
                                      <span class="main">|</span> Some S <span class="main">⇒</span> si64_trunc_f64 <span class="bound">c</span>
                                      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cvt_f32</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sx option <span class="main">⇒</span> v <span class="main">⇒</span> f32 option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cvt_f32</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
                   ConstInt32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                      Some U <span class="main">⇒</span> Some <span class="main">(</span>f32_convert_ui32 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> Some S <span class="main">⇒</span> Some <span class="main">(</span>f32_convert_si32 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstInt64 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                      Some U <span class="main">⇒</span> Some <span class="main">(</span>f32_convert_ui64 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> Some S <span class="main">⇒</span> Some <span class="main">(</span>f32_convert_si64 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstFloat32 <span class="bound">c</span> <span class="main">⇒</span> None
                 <span class="main">|</span> ConstFloat64 <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>wasm_demote <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cvt_f64</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sx option <span class="main">⇒</span> v <span class="main">⇒</span> f64 option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cvt_f64</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
                   ConstInt32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                      Some U <span class="main">⇒</span> Some <span class="main">(</span>f64_convert_ui32 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> Some S <span class="main">⇒</span> Some <span class="main">(</span>f64_convert_si32 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstInt64 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="keyword1">of</span>
                                      Some U <span class="main">⇒</span> Some <span class="main">(</span>f64_convert_ui64 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> Some S <span class="main">⇒</span> Some <span class="main">(</span>f64_convert_si64 <span class="bound">c</span><span class="main">)</span>
                                    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>
                 <span class="main">|</span> ConstFloat32 <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>wasm_promote <span class="bound">c</span><span class="main">)</span>
                 <span class="main">|</span> ConstFloat64 <span class="bound">c</span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cvt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> sx option <span class="main">⇒</span> v <span class="main">⇒</span> v option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cvt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span>
                 T_i32 <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>cvt_i32 <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">of</span> Some <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span> <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span>
               <span class="main">|</span> T_i64 <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>cvt_i64 <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">of</span> Some <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>ConstInt64 <span class="bound">c</span><span class="main">)</span> <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span> 
               <span class="main">|</span> T_f32 <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>cvt_f32 <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">of</span> Some <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>ConstFloat32 <span class="bound">c</span><span class="main">)</span> <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span>
               <span class="main">|</span> T_f64 <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>cvt_f64 <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">of</span> Some <span class="bound">c</span> <span class="main">⇒</span> Some <span class="main">(</span>ConstFloat64 <span class="bound">c</span><span class="main">)</span> <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bits</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"v <span class="main">⇒</span> bytes"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bits</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
               ConstInt32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span>serialise_i32 <span class="bound">c</span><span class="main">)</span>
             <span class="main">|</span> ConstInt64 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span>serialise_i64 <span class="bound">c</span><span class="main">)</span>
             <span class="main">|</span> ConstFloat32 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span>serialise_f32 <span class="bound">c</span><span class="main">)</span>
             <span class="main">|</span> ConstFloat64 <span class="bound">c</span> <span class="main">⇒</span> <span class="main">(</span>serialise_f64 <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bitzero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> v"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bitzero</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span>
                T_i32 <span class="main">⇒</span> ConstInt32 <span class="main">0</span>
              <span class="main">|</span> T_i64 <span class="main">⇒</span> ConstInt64 <span class="main">0</span>
              <span class="main">|</span> T_f32 <span class="main">⇒</span> ConstFloat32 <span class="main">0</span>
              <span class="main">|</span> T_f64 <span class="main">⇒</span> ConstFloat64 <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">n_zeros</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t list <span class="main">⇒</span> v list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n_zeros</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> bitzero <span class="bound">t</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Base_Defs-is_int_t_exists"><span class="command">lemma</span></span> is_int_t_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_int_t <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> T_i32 <span class="main">∨</span> <span class="free">t</span> <span class="main">=</span> T_i64"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_int_t_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Base_Defs-is_float_t_exists"><span class="command">lemma</span></span> is_float_t_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_float_t <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> T_f32 <span class="main">∨</span> <span class="free">t</span> <span class="main">=</span> T_f64"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_float_t_def<span class="main">)</span>


<span class="keyword1" id="Wasm_Base_Defs-int_float_disjoint"><span class="command">lemma</span></span> int_float_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"is_int_t <span class="free">t</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>is_float_t <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> is_float_t_def is_int_t_def t.exhaust t.simps<span class="main"><span class="main">(</span></span>13-16<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Wasm_Base_Defs-stab_unfold"><span class="command">lemma</span></span> stab_unfold<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> Some <span class="free">cl</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> inst.tab <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">k</span> <span class="main">∧</span> length <span class="main">(</span><span class="main">(</span>tab <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">j</span> <span class="main">∧</span><span class="main">(</span><span class="main">(</span>tab <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span><span class="main">!</span><span class="free">j</span> <span class="main">=</span> Some <span class="free">cl</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> have_k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>inst.tab <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> stab_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> s_o<span class="main">:</span><span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> stab_s <span class="free">s</span> <span class="skolem">k</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> stab_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">stabinst</span></span> <span class="keyword2"><span class="keyword">where</span></span> stabinst_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">stabinst</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>tab <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"stab_s <span class="free">s</span> <span class="skolem">k</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">stabinst</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>length <span class="skolem">stabinst</span> <span class="main">&gt;</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms s_o
    <span class="keyword1"><span class="command">unfolding</span></span> stab_s_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">stabinst</span> <span class="main">&gt;</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> have_k stabinst_def assms s_o
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Base_Defs-inj_basic"><span class="command">lemma</span></span> inj_basic<span class="main">:</span> <span class="quoted"><span class="quoted">"inj Basic"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> e.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> injI<span class="main">)</span>

<span class="keyword1" id="Wasm_Base_Defs-inj_basic_econst"><span class="command">lemma</span></span> inj_basic_econst<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> b_e.inject<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> e.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> injI<span class="main">)</span>

<span class="keyword1" id="Wasm_Base_Defs-to_e_list_1"><span class="command">lemma</span></span> to_e_list_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span> <span class="free">a</span><span class="main">]</span> <span class="main">=</span> <span class="main">$*</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Base_Defs-to_e_list_2"><span class="command">lemma</span></span> to_e_list_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span> <span class="free">a</span><span class="main">,</span> <span class="main">$</span> <span class="free">b</span><span class="main">]</span> <span class="main">=</span> <span class="main">$*</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Base_Defs-to_e_list_3"><span class="command">lemma</span></span> to_e_list_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span> <span class="free">a</span><span class="main">,</span> <span class="main">$</span> <span class="free">b</span><span class="main">,</span> <span class="main">$</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">$*</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Base_Defs-v_exists_b_e"><span class="command">lemma</span></span> v_exists_b_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ves</span><span class="main">.</span> <span class="main">(</span><span class="main">$$*</span><span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$*</span><span class="bound">ves</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Base_Defs-Lfilled_exact_imp_Lfilled"><span class="command">lemma</span></span> Lfilled_exact_imp_Lfilled<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled_exact <span class="free">n</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">n</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled_exact.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">lholed</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_def Lfilled.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">es</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Base_Defs-Lfilled_exact_app_imp_exists_Lfilled"><span class="command">lemma</span></span> Lfilled_exact_app_imp_exists_Lfilled<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
          <span class="quoted"><span class="quoted">"Lfilled_exact <span class="free">n</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">ves</span><span class="main">@</span><span class="free">es</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="free">n</span> <span class="bound">lholed'</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ves</span><span class="main">@</span><span class="free">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled_exact.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">lholed</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Base_Defs-Lfilled_imp_exists_Lfilled_exact"><span class="command">lemma</span></span> Lfilled_imp_exists_Lfilled_exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">n</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span> <span class="bound">ves</span> <span class="bound">es_c</span><span class="main">.</span> const_list <span class="bound">ves</span> <span class="main">∧</span> Lfilled_exact <span class="free">n</span> <span class="bound">lholed'</span> <span class="main">(</span><span class="bound">ves</span><span class="main">@</span><span class="free">es</span><span class="main">@</span><span class="bound">es_c</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Lfilled_exact.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Wasm_Base_Defs-n_zeros_typeof"><span class="command">lemma</span></span> n_zeros_typeof<span class="main">:</span>
  <span class="quoted"><span class="quoted">"n_zeros <span class="free">ts</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> map typeof <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_zeros_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">t</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"n_zeros <span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_zeros_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>bitzero <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def bitzero_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons
    <span class="keyword1"><span class="command">unfolding</span></span> n_zeros_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm">
<div class="head">
<h1>Theory Wasm</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Wasm <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Base_Defs.html">Wasm_Base_Defs</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TYPING RELATION *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">b_e_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>t_context<span class="main">,</span> b_e list<span class="main">,</span> tf<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _ <span class="keyword1">:</span> _"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>num ops›</span></span>›</span>
  const<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span>         <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span>    <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>typeof <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> unop_i<span class="main">:</span><span class="quoted"><span class="quoted">"is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Unop_i <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span>  <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>   <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> unop_f<span class="main">:</span><span class="quoted"><span class="quoted">"is_float_t <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Unop_f <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span>  <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>   <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> binop_i<span class="main">:</span><span class="quoted"><span class="quoted">"is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Binop_i <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> binop_f<span class="main">:</span><span class="quoted"><span class="quoted">"is_float_t <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Binop_f <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> testop<span class="main">:</span><span class="quoted"><span class="quoted">"is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Testop <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span>  <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>   <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> relop_i<span class="main">:</span><span class="quoted"><span class="quoted">"is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Relop_i <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> relop_f<span class="main">:</span><span class="quoted"><span class="quoted">"is_float_t <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Relop_f <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>convert›</span></span>›</span>
<span class="main">|</span> convert<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>is_float_t <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">∧</span> is_float_t <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>is_int_t <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">∧</span> is_int_t <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">∧</span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">&lt;</span> t_length <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Cvtop <span class="free"><span class="bound"><span class="entity">t1</span></span></span> Convert <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reinterpret›</span></span>›</span>
<span class="main">|</span> reinterpret<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">;</span> t_length <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">=</span> t_length <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Cvtop <span class="free"><span class="bound"><span class="entity">t1</span></span></span> Reinterpret <span class="free"><span class="bound"><span class="entity">t2</span></span></span> None<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>unreachable, nop, drop, select›</span></span>›</span>
<span class="main">|</span> unreachable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Unreachable<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> nop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Nop<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> drop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Drop<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> select<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Select<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>block›</span></span>›</span>
<span class="main">|</span> block<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Block <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>loop›</span></span>›</span>
<span class="main">|</span> loop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Loop <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>if then else›</span></span>›</span>
<span class="main">|</span> if_wasm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es1</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es2</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>If <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">es1</span></span></span> <span class="free"><span class="bound"><span class="entity">es2</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>br›</span></span>›</span>
<span class="main">|</span> br<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Br <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>br_if›</span></span>›</span>
<span class="main">|</span> br_if<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Br_if <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>br_table›</span></span>›</span>
<span class="main">|</span> br_table<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Br_table <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>return›</span></span>›</span>
<span class="main">|</span> return<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span>return <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Return<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>call›</span></span>›</span>
<span class="main">|</span> call<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>func_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>func_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Call <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>call_indirect›</span></span>›</span>
<span class="main">|</span> call_indirect<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>types_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>types_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>table <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">≠</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Call_indirect <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>get_local›</span></span>›</span>
<span class="main">|</span> get_local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Get_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>set_local›</span></span>›</span>
<span class="main">|</span> set_local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Set_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>tee_local›</span></span>›</span>
<span class="main">|</span> tee_local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Tee_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>get_global›</span></span>›</span>
<span class="main">|</span> get_global<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> tg_t <span class="main">(</span><span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Get_global <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>set_global›</span></span>›</span>
<span class="main">|</span> set_global<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length<span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">;</span> tg_t <span class="main">(</span><span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> is_mut <span class="main">(</span><span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Set_global <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>load›</span></span>›</span>
<span class="main">|</span> load<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> load_store_t_bounds <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>option_projl <span class="free"><span class="bound"><span class="entity">tp_sx</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Load <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">tp_sx</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>store›</span></span>›</span>
<span class="main">|</span> store<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> load_store_t_bounds <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Store <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span>T_i32<span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>current_memory›</span></span>›</span>
<span class="main">|</span> current_memory<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Current_memory<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Grow_memory›</span></span>›</span>
<span class="main">|</span> grow_memory<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Grow_memory<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>empty program›</span></span>›</span>
<span class="main">|</span> empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>composition›</span></span>›</span>
<span class="main">|</span> composition<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t3s</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t3s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>weakening›</span></span>›</span>
<span class="main">|</span> weakening<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">cl_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>s_context<span class="main">,</span> cl<span class="main">,</span> tf<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">,</span> label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">cl_typing</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="main">(</span>Func_native <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">cl_typing</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="main">(</span>Func_host <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span>"</span></span>

<span class="comment1">(* lifting the b_e_typing relation to the administrative operators *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">e_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>s_context<span class="main">,</span> t_context<span class="main">,</span> e list<span class="main">,</span> tf<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">∙</span>_ <span class="keyword1">⊢</span> _ <span class="keyword1">:</span> _"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span>       <span class="entity">s_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>s_context<span class="main">,</span> <span class="main">(</span>t list<span class="main">)</span> option<span class="main">,</span> nat<span class="main">,</span> v list<span class="main">,</span> e list<span class="main">,</span> t list<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">∙</span>_ <span class="keyword1">⊩'_</span> _ _<span class="keyword1">;</span>_ <span class="keyword1">:</span> _"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* section: e_typing *)</span>
  <span class="comment1">(* lifting *)</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">b_es</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">$*</span><span class="free"><span class="bound"><span class="entity">b_es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span>"</span></span>
  <span class="comment1">(* composition *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t3s</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t3s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">(* weakening *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="main">⟹</span><span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">(* trap *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span>"</span></span>
  <span class="comment1">(* local *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span>Some <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="free">⊩_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">(* callcl *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>cl_typing <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span>  <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Callcl <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span>"</span></span>
  <span class="comment1">(* label *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e0s</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">e0s</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span>"</span></span>
<span class="comment1">(* section: s_typing *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span>s_inst <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">tvs</span></span></span> <span class="main">=</span> map typeof <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span><span class="main">(</span><span class="main">(</span>s_inst <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">tvs</span></span></span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">⦈</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main"><span class="free">∙</span></span><span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="main"><span class="free">⊩_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">globi_agree</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">memi_agree</span> <span class="free"><span class="bound"><span class="entity">sm</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">j'</span> <span class="bound">m'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> Some <span class="bound">j'</span> <span class="main">∧</span> <span class="bound">j'</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">sm</span></span></span> <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> Some <span class="bound">m'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">sm</span></span></span><span class="main">!</span><span class="bound">j'</span> <span class="main">=</span> <span class="bound">m'</span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> None <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">funci_agree</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">inst_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>s_context<span class="main">,</span> inst<span class="main">,</span> t_context<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>list_all2 <span class="main">(</span>funci_agree <span class="main">(</span>s_funcs <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">tfs</span></span></span><span class="main">;</span> list_all2 <span class="main">(</span>globi_agree <span class="main">(</span>s_globs <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="free"><span class="bound"><span class="entity">tgs</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>s_tab <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>s_tab <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="main">=</span> <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> None <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> None<span class="main">)</span><span class="main">;</span> memi_agree <span class="main">(</span>s_mem <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">inst_typing</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="main">⦇</span>types <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">,</span> funcs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">,</span> tab <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> mem <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span> globs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">⦈</span> <span class="main">⦇</span>types_t <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">,</span> func_t <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tfs</span></span></span><span class="main">,</span> global <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tgs</span></span></span><span class="main">,</span> table <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> memory <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> local <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> label <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> return <span class="main">=</span> None<span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">glob_agree</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">tg</span></span></span> <span class="main">=</span> <span class="main">(</span>tg_mut <span class="free"><span class="bound"><span class="entity">tg</span></span></span> <span class="main">=</span> g_mut <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> tg_t <span class="free"><span class="bound"><span class="entity">tg</span></span></span> <span class="main">=</span> typeof <span class="main">(</span>g_val <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tab_agree</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="free"><span class="bound"><span class="entity">tcl</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">tcl</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> True <span class="main">|</span> Some <span class="bound">cl</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">tf</span><span class="main">.</span> cl_typing <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="bound">cl</span> <span class="bound">tf</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem_agree</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">store_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>s<span class="main">,</span> s_context<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="main">=</span> <span class="main">⦇</span>s_inst <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒞s</span></span></span><span class="main">,</span> s_funcs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tfs</span></span></span><span class="main">,</span> s_tab <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">,</span> s_mem <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">,</span> s_globs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tgs</span></span></span><span class="main">⦈</span><span class="main">;</span> list_all2 <span class="main">(</span>inst_typing <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">insts</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞s</span></span></span><span class="main">;</span> list_all2 <span class="main">(</span>cl_typing <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">tfs</span></span></span><span class="main">;</span> list_all <span class="main">(</span>tab_agree <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">)</span> <span class="main">(</span>concat <span class="free"><span class="bound"><span class="entity">tclss</span></span></span><span class="main">)</span><span class="main">;</span> list_all2 <span class="main">(</span><span class="main">λ</span> <span class="bound">tcls</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="bound">tcls</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tclss</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">;</span> list_all2 mem_agree <span class="free"><span class="bound"><span class="entity">bss</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">;</span> list_all2 glob_agree <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="free"><span class="bound"><span class="entity">tgs</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">store_typing</span> <span class="main">⦇</span>s.inst <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">insts</span></span></span><span class="main">,</span> s.funcs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">,</span> s.tab <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tclss</span></span></span><span class="main">,</span> s.mem <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bss</span></span></span><span class="main">,</span> s.globs <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">⦈</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">config_typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span> s<span class="main">,</span> v list<span class="main">,</span> e list<span class="main">,</span> t list<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢'_</span> _ _<span class="keyword1">;</span>_<span class="keyword1">;</span>_ <span class="keyword1">:</span> _"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>store_typing <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="comment1">(* REDUCTION RELATION *)</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reduce_simple</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>e list<span class="main">,</span> e list<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⦇</span>_<span class="keyword1">⦈</span> <span class="keyword1">↝</span> <span class="keyword1">⦇</span>_<span class="keyword1">⦈</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>integer unary ops›</span></span>›</span>
  unop_i32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Unop_i T_i32 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>app_unop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> unop_i64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Unop_i T_i64 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="main">(</span>app_unop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>float unary ops›</span></span>›</span>
<span class="main">|</span> unop_f32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Unop_f T_f32 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="main">(</span>app_unop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> unop_f64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Unop_f T_f64 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="main">(</span>app_unop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>int32 binary ops›</span></span>›</span>
<span class="main">|</span> binop_i32_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_i T_i32 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> binop_i32_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_i T_i32 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>int64 binary ops›</span></span>›</span>
<span class="main">|</span> binop_i64_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_i T_i64 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> binop_i64_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_i T_i64 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>float32 binary ops›</span></span>›</span>
<span class="main">|</span> binop_f32_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_f T_f32 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> binop_f32_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_f T_f32 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>float64 binary ops›</span></span>›</span>
<span class="main">|</span> binop_f64_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_f T_f64 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> binop_f64_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>app_binop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Binop_f T_f64 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>testops›</span></span>›</span>
<span class="main">|</span> testop_i32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Testop T_i32 <span class="free"><span class="bound"><span class="entity">testop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_testop_i <span class="free"><span class="bound"><span class="entity">testop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> testop_i64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Testop T_i64 <span class="free"><span class="bound"><span class="entity">testop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_testop_i <span class="free"><span class="bound"><span class="entity">testop</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>int relops›</span></span>›</span>
<span class="main">|</span> relop_i32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Relop_i T_i32 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> relop_i64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt64 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Relop_i T_i64 <span class="free"><span class="bound"><span class="entity">iop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_i <span class="free"><span class="bound"><span class="entity">iop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>float relops›</span></span>›</span>
<span class="main">|</span> relop_f32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat32 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Relop_f T_f32 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> relop_f64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstFloat64 <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Relop_f T_f64 <span class="free"><span class="bound"><span class="entity">fop</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_f <span class="free"><span class="bound"><span class="entity">fop</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>convert›</span></span>›</span>
<span class="main">|</span> convert_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>types_agree <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> cvt <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Cvtop <span class="free"><span class="bound"><span class="entity">t2</span></span></span> Convert <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> convert_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>types_agree <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> cvt <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Cvtop <span class="free"><span class="bound"><span class="entity">t2</span></span></span> Convert <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reinterpret›</span></span>›</span>
<span class="main">|</span> reinterpret<span class="main">:</span><span class="quoted"><span class="quoted">"types_agree <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Cvtop <span class="free"><span class="bound"><span class="entity">t2</span></span></span> Reinterpret <span class="free"><span class="bound"><span class="entity">t1</span></span></span> None<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="main">(</span>wasm_deserialise <span class="main">(</span>bits <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>unreachable›</span></span>›</span>
<span class="main">|</span> unreachable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span> Unreachable<span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>nop›</span></span>›</span>
<span class="main">|</span> nop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span> Nop<span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>drop›</span></span>›</span>
<span class="main">|</span> drop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">$</span> Drop<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>select›</span></span>›</span>
<span class="main">|</span> select_false<span class="main">:</span><span class="quoted"><span class="quoted">"int_eq <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">$</span> Select<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> select_true<span class="main">:</span><span class="quoted"><span class="quoted">"int_ne <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">$</span> Select<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>block›</span></span>›</span>
<span class="main">|</span> block<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>loop›</span></span>›</span>
<span class="main">|</span> loop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Loop <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Loop <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>if›</span></span>›</span>
<span class="main">|</span> if_false<span class="main">:</span><span class="quoted"><span class="quoted">"int_eq <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">e1s</span></span></span> <span class="free"><span class="bound"><span class="entity">e2s</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">e2s</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> if_true<span class="main">:</span><span class="quoted"><span class="quoted">"int_ne <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">e1s</span></span></span> <span class="free"><span class="bound"><span class="entity">e2s</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="free"><span class="bound"><span class="entity">tf</span></span></span> <span class="free"><span class="bound"><span class="entity">e1s</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>label›</span></span>›</span>
<span class="main">|</span> label_const<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> label_trap<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">[</span>Trap<span class="main">]</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>br›</span></span>›</span>
<span class="main">|</span> br<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> Lfilled <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Br <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LI</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Label <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">LI</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>br_if›</span></span>›</span>
<span class="main">|</span> br_if_false<span class="main">:</span><span class="quoted"><span class="quoted">"int_eq <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Br_if <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> br_if_true<span class="main">:</span><span class="quoted"><span class="quoted">"int_ne <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Br_if <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Br <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>br_table›</span></span>›</span>
<span class="main">|</span> br_table<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>length <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="main">&gt;</span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Br_table <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Br <span class="main">(</span><span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">!</span><span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> br_table_length<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>length <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="main">≤</span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Br_table <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Br <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>local›</span></span>›</span>
<span class="main">|</span> local_const<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> local_trap<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">[</span>Trap<span class="main">]</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>return›</span></span>›</span>
<span class="main">|</span> return<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>const_list <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> Lfilled <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vls</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>tee_local›</span></span>›</span>
<span class="main">|</span> tee_local<span class="main">:</span><span class="quoted"><span class="quoted">"is_const <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Tee_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Set_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> trap<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span><span class="main">;</span> Lfilled <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="main">[</span>Trap<span class="main">]</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝</span></span> <span class="main"><span class="free">⦇</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>

<span class="comment1">(* full reduction rule *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reduce</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>s<span class="main">,</span> v list<span class="main">,</span> e list<span class="main">,</span> nat<span class="main">,</span> s<span class="main">,</span> v list<span class="main">,</span> e list<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⦇</span>_<span class="keyword1">;</span>_<span class="keyword1">;</span>_<span class="keyword1">⦈</span> <span class="keyword1">↝'_</span> _ <span class="keyword1">⦇</span>_<span class="keyword1">;</span>_<span class="keyword1">;</span>_<span class="keyword1">⦈</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>lifting basic reduction›</span></span>›</span>
  basic<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">⦈</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>call›</span></span>›</span>
<span class="main">|</span> call<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Callcl <span class="main">(</span>sfunc <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>call_indirect›</span></span>›</span>
<span class="main">|</span> call_indirect_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>stab <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">;</span> stypes <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span><span class="main">;</span> cl_type <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tf</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Call_indirect <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Callcl <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> call_indirect_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span>stab <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">∧</span> stypes <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> cl_type <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">∨</span> stab <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Call_indirect <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>call›</span></span>›</span>
<span class="main">|</span> callcl_native<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">=</span> Func_native <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">$$*</span> <span class="free"><span class="bound"><span class="entity">vcs</span></span></span><span class="main">)</span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vcs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> <span class="main">(</span>n_zeros <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vcs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> callcl_host_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">=</span> Func_host <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">$$*</span> <span class="free"><span class="bound"><span class="entity">vcs</span></span></span><span class="main">)</span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vcs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> host_apply <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">vcs</span></span></span> <span class="free"><span class="bound"><span class="entity">hs</span></span></span> <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vcs'</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="main">$$*</span> <span class="free"><span class="bound"><span class="entity">vcs'</span></span></span><span class="main">)</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> callcl_host_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">=</span> Func_host <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">t2s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">$$*</span> <span class="free"><span class="bound"><span class="entity">vcs</span></span></span><span class="main">)</span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">vcs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t1s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> length <span class="free"><span class="bound"><span class="entity">t2s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>get_local›</span></span>›</span>
<span class="main">|</span> get_local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>length <span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Get_local <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>set_local›</span></span>›</span>
<span class="main">|</span> set_local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>length <span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Set_local <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>get_global›</span></span>›</span>
<span class="main">|</span> get_global<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Get_global <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span><span class="main">(</span>sglob_val <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>set_global›</span></span>›</span>
<span class="main">|</span> set_global<span class="main">:</span><span class="quoted"><span class="quoted">"supdate_glob <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Set_global <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>load›</span></span>›</span>
<span class="main">|</span> load_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> load <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">t</span></span></span> None <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>wasm_deserialise <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> load_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> load <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">t</span></span></span> None <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>load packed›</span></span>›</span>
<span class="main">|</span> load_packed_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> load_packed <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>tp_length <span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">)</span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>wasm_deserialise <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> load_packed_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> load_packed <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>tp_length <span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">)</span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>store›</span></span>›</span>
<span class="main">|</span> store_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>types_agree <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> store <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>bits <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Store <span class="free"><span class="bound"><span class="entity">t</span></span></span> None <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>mem<span class="main">:=</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> store_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>types_agree <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> store <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>bits <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Store <span class="free"><span class="bound"><span class="entity">t</span></span></span> None <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>store packed›</span></span>›</span> <span class="comment1">(* take only (tp_length tp) lower order bytes *)</span>
<span class="main">|</span> store_packed_Some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>types_agree <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> store_packed <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>bits <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span>tp_length <span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Store <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>mem<span class="main">:=</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
<span class="main">|</span> store_packed_None<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>types_agree <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> store_packed <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">off</span></span></span> <span class="main">(</span>bits <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span>tp_length <span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Store <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">tp</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Trap<span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>current_memory›</span></span>›</span>
<span class="main">|</span> current_memory<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> mem_size <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span> <span class="main">$</span><span class="main">(</span>Current_memory<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>int_of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>grow_memory›</span></span>›</span>
<span class="main">|</span> grow_memory<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> mem_size <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> mem_grow <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>nat_of_int <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">$</span><span class="main">(</span>Grow_memory<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>mem<span class="main">:=</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="main">(</span>int_of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>grow_memory fail›</span></span>›</span>
<span class="main">|</span> grow_memory_fail<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">;</span> mem_size <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">$</span><span class="main">(</span>Grow_memory<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 int32_minus_one<span class="main">)</span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">(* The bad ones. *)</span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>inductive label reduction›</span></span>›</span>
<span class="main">|</span> label<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es'</span></span></span><span class="main"><span class="free">⦈</span></span><span class="main">;</span> Lfilled <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">les</span></span></span><span class="main">;</span> Lfilled <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">lholed</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span> <span class="free"><span class="bound"><span class="entity">les'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">les</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">les'</span></span></span><span class="main"><span class="free">⦈</span></span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>inductive local reduction›</span></span>›</span>
<span class="main">|</span> local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">vs'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">es'</span></span></span><span class="main"><span class="free">⦈</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">v0s</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span> <span class="main"><span class="free">↝_</span></span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">;</span></span><span class="free"><span class="bound"><span class="entity">v0s</span></span></span><span class="main"><span class="free">;</span></span><span class="main">[</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="free"><span class="bound"><span class="entity">es'</span></span></span><span class="main">]</span><span class="main"><span class="free">⦈</span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Axioms">
<div class="head">
<h1>Theory Wasm_Axioms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Host Properties›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Axioms <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm.html">Wasm</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* these were originally axioms, but memory now has a concrete representation in the model *)</span>
<span class="keyword1" id="Wasm_Axioms-mem_grow_size"><span class="command">lemma</span></span> mem_grow_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mem_grow <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem_size <span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">64000</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mem_size <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Abs_mem_inverse Abs_bytes_inverse
  <span class="keyword1"><span class="command">unfolding</span></span> mem_grow_def mem_size_def mem_append_def bytes_replicate_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Axioms-load_size"><span class="command">lemma</span></span> load_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>load <span class="free">m</span> <span class="free">n</span> <span class="free">off</span> <span class="free">l</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem_size <span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">off</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> load_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">off</span> <span class="main">+</span> <span class="free">l</span> <span class="main">≤</span> mem_size <span class="free">m</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Axioms-load_packed_size"><span class="command">lemma</span></span> load_packed_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>load_packed <span class="free">sx</span> <span class="free">m</span> <span class="free">n</span> <span class="free">off</span> <span class="free">lp</span> <span class="free">l</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem_size <span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">off</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span> <span class="free">lp</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> load_size
  <span class="keyword1"><span class="command">unfolding</span></span> load_packed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">off</span> <span class="main">+</span> <span class="free">l</span> <span class="main">≤</span> mem_size <span class="free">m</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>  

<span class="keyword1" id="Wasm_Axioms-store_size1"><span class="command">lemma</span></span> store_size1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>store <span class="free">m</span> <span class="free">n</span> <span class="free">off</span> <span class="free">v</span> <span class="free">l</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem_size <span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">off</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> store_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">off</span> <span class="main">+</span> <span class="free">l</span> <span class="main">≤</span> mem_size <span class="free">m</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Axioms-store_size"><span class="command">lemma</span></span> store_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>store <span class="free">m</span> <span class="free">n</span> <span class="free">off</span> <span class="free">v</span> <span class="free">l</span> <span class="main">=</span> Some <span class="free">m'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mem_size <span class="free">m</span> <span class="main">=</span> mem_size <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Abs_mem_inverse Abs_bytes_inverse
  <span class="keyword1"><span class="command">unfolding</span></span> store_def write_bytes_def bytes_takefill_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">off</span> <span class="main">+</span> <span class="free">l</span> <span class="main">≤</span> mem_size <span class="free">m</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_size_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Axioms-store_packed_size1"><span class="command">lemma</span></span> store_packed_size1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>store_packed <span class="free">m</span> <span class="free">n</span> <span class="free">off</span> <span class="free">v</span> <span class="free">l</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem_size <span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">off</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> store_size1
  <span class="keyword1"><span class="command">unfolding</span></span> store_packed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Axioms-store_packed_size"><span class="command">lemma</span></span> store_packed_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>store_packed <span class="free">m</span> <span class="free">n</span> <span class="free">off</span> <span class="free">v</span> <span class="free">l</span> <span class="main">=</span> Some <span class="free">m'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mem_size <span class="free">m</span> <span class="main">=</span> mem_size <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms store_size
  <span class="keyword1"><span class="command">unfolding</span></span> store_packed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  wasm_deserialise_type<span class="main">:</span><span class="quoted"><span class="quoted">"typeof <span class="main">(</span>wasm_deserialise <span class="free">bs</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    host_apply_preserve_store<span class="main">:</span><span class="quoted"><span class="quoted">" list_all2 types_agree <span class="free">t1s</span> <span class="free">vs</span> <span class="main">⟹</span> host_apply <span class="free">s</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">f</span> <span class="free">vs</span> <span class="free">hs</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span> <span class="main">⟹</span> store_extension <span class="free">s</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> host_apply_respect_type<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 types_agree <span class="free">t1s</span> <span class="free">vs</span> <span class="main">⟹</span> host_apply <span class="free">s</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">f</span> <span class="free">vs</span> <span class="free">hs</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span> <span class="main">⟹</span> list_all2 types_agree <span class="free">t2s</span> <span class="free">vs'</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Properties_Aux">
<div class="head">
<h1>Theory Wasm_Properties_Aux</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary Type System Properties›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Properties_Aux <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Axioms.html">Wasm_Axioms</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-typeof_i32"><span class="command">lemma</span></span> typeof_i32<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> T_i32"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> ConstInt32 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-typeof_i64"><span class="command">lemma</span></span> typeof_i64<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> T_i64"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> ConstInt64 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-typeof_f32"><span class="command">lemma</span></span> typeof_f32<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> T_f32"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> ConstFloat32 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-typeof_f64"><span class="command">lemma</span></span> typeof_f64<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> T_f64"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> ConstFloat64 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-exists_v_typeof"><span class="command">lemma</span></span> exists_v_typeof<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="bound">v</span><span class="main">.</span> typeof <span class="bound">v</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> T_i32
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>ConstInt32 <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_i32
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> T_i32
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> T_i64
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>ConstInt64 <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_i64
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> T_i64
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> T_f32
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>ConstFloat32 <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_f32
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> T_f32
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> T_f64
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>ConstFloat64 <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_f64
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> T_f64
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-lfilled_collapse1"><span class="command">lemma</span></span> lfilled_collapse1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">n</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">es</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">≥</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="free">n</span> <span class="bound">lholed'</span> <span class="main">(</span><span class="main">(</span>drop <span class="main">(</span>length <span class="free">vs</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">@</span><span class="free">es</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">es</span>"</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs'</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">vs1</span><span class="main">@</span><span class="skolem">vs2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id diff_diff_cancel length_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="skolem">vs'</span><span class="main">@</span><span class="skolem">vs1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L0<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span><span class="main">@</span><span class="skolem">vs1</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">es'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span><span class="main">@</span><span class="free">es</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-lfilled_collapse2"><span class="command">lemma</span></span> lfilled_collapse2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">n</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="free">es'</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span> <span class="bound">vs'</span><span class="main">.</span> Lfilled <span class="free">n</span> <span class="bound">lholed'</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">es</span><span class="main">@</span><span class="free">es'</span>"</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-lfilled_collapse3"><span class="command">lemma</span></span> lfilled_collapse3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="main">[</span>Label <span class="free">n</span> <span class="free">les</span> <span class="free">es</span><span class="main">]</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="bound">lholed'</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Label <span class="free">n</span> <span class="free">les</span> <span class="free">es</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">0</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="free">es</span> <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.left_neutral append_Nil2 list_all_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span> L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Wasm_Properties_Aux-unlift_b_e"><span class="command">lemma</span></span> unlift_b_e<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">$*</span><span class="free">b_es</span> <span class="main">:</span> <span class="free">tf</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">b_es</span> <span class="main">:</span> <span class="free">tf</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$*</span><span class="free">b_es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tf</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b_es</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">tf</span> <span class="skolem">𝒮</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_basic map_injective
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">es'</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e'</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">b_es</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snoc_eq_iff_butlast<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.composition
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>                            
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.weakening
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_inst_length_eq"><span class="command">lemma</span></span> store_typing_imp_inst_length_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_func_length_eq"><span class="command">lemma</span></span> store_typing_imp_func_length_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>funcs <span class="free">s</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_mem_length_eq"><span class="command">lemma</span></span> store_typing_imp_mem_length_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>s.mem <span class="free">s</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_glob_length_eq"><span class="command">lemma</span></span> store_typing_imp_glob_length_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>globs <span class="free">s</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_inst_typing"><span class="command">lemma</span></span> store_typing_imp_inst_typing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inst_typing <span class="free">𝒮</span> <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> list_all2_conv_all_nth store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties_Aux-stab_typed_some_imp_member"><span class="command">lemma</span></span> stab_typed_some_imp_member<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="free">c</span> <span class="main">=</span> Some <span class="free">cl</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Some <span class="free">cl</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"inst.tab <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">k'</span>"</span></span>
                       <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">k'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span>
                       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">k'</span><span class="main">)</span><span class="main">!</span><span class="free">c</span> <span class="main">=</span> Some <span class="free">cl</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stab_unfold assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Some <span class="free">cl</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">k'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_mem
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inst_typing <span class="free">𝒮</span> <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> store_typing_imp_inst_typing
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> length <span class="main">(</span>s_tab <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> inst_typing.simps stypes_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> length <span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> list_all2_lengthD
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> k_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-stab_typed_some_imp_cl_typed"><span class="command">lemma</span></span> stab_typed_some_imp_cl_typed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="free">c</span> <span class="main">=</span> Some <span class="free">cl</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tf</span><span class="main">.</span> cl_typing <span class="free">𝒮</span> <span class="free">cl</span> <span class="bound">tf</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Some <span class="free">cl</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms stab_typed_some_imp_member
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span>tab_agree <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span>concat <span class="main">(</span>s.tab <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> in_set_conv_nth list_all_length tab_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_empty1"><span class="command">lemma</span></span> b_e_type_empty1<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main">::</span><span class="main">(</span>b_e list<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_empty"><span class="command">lemma</span></span> b_e_type_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.empty b_e_typing.weakening
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_value"><span class="command">lemma</span></span> b_e_type_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="keyword1">C</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="main">[</span>typeof <span class="free">v</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_load"><span class="command">lemma</span></span> b_e_type_load<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Load <span class="free">t</span> <span class="free">tp_sx</span> <span class="free">a</span> <span class="free">off</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">sec</span> <span class="bound">n</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span>memory <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"load_store_t_bounds <span class="free">a</span> <span class="main">(</span>option_projl <span class="free">tp_sx</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_store"><span class="command">lemma</span></span> b_e_type_store<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Store <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">,</span> <span class="free">t</span><span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">sec</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>memory <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"load_store_t_bounds <span class="free">a</span> <span class="free">tp</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_current_memory"><span class="command">lemma</span></span> b_e_type_current_memory<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Current_memory"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">sec</span> <span class="bound">n</span><span class="main">.</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">∧</span> <span class="main">(</span>memory <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_grow_memory"><span class="command">lemma</span></span> b_e_type_grow_memory<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Grow_memory"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">∧</span> <span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>memory <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_nop"><span class="command">lemma</span></span> b_e_type_nop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Nop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arity_2_result</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"b_e <span class="main">⇒</span> t"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arity_2_result</span> <span class="free"><span class="bound"><span class="entity">op2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">op2</span></span></span> <span class="keyword1">of</span>
                           Binop_i <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">t</span>
                         <span class="main">|</span> Binop_f <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">t</span>
                         <span class="main">|</span> Relop_i <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_i32
                         <span class="main">|</span> Relop_f <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_i32<span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_binop_relop"><span class="command">lemma</span></span> b_e_type_binop_relop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span>arity_2_result<span class="main">(</span><span class="free">e</span><span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> arity_2_result_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_testop_drop_cvt0"><span class="command">lemma</span></span> b_e_type_testop_drop_cvt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Testop <span class="free">t</span> <span class="free">testop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Drop <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Cvtop <span class="free">t1</span> <span class="free">cvtop</span> <span class="free">t2</span> <span class="free">sx</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arity_1_result</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"b_e <span class="main">⇒</span> t"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arity_1_result</span> <span class="free"><span class="bound"><span class="entity">op1</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">op1</span></span></span> <span class="keyword1">of</span>
                           Unop_i <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">t</span>
                         <span class="main">|</span> Unop_f <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">t</span>
                         <span class="main">|</span> Testop <span class="bound">t</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> T_i32
                         <span class="main">|</span> Cvtop <span class="bound">t1</span> Convert <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">t1</span>
                         <span class="main">|</span> Cvtop <span class="bound">t1</span> Reinterpret <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">t1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_unop_testop"><span class="command">lemma</span></span> b_e_type_unop_testop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Unop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Unop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Testop <span class="free">t</span> <span class="free">testop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Unop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms int_float_disjoint
  <span class="keyword1"><span class="command">unfolding</span></span> arity_1_result_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_cvtop"><span class="command">lemma</span></span> b_e_type_cvtop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Cvtop <span class="free">t1</span> <span class="free">cvtop</span> <span class="free">t</span> <span class="free">sx</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">cvtop</span> <span class="main">=</span> Convert <span class="main">⟹</span> <span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">sx</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>is_float_t <span class="free">t1</span> <span class="main">∧</span> is_float_t <span class="free">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>is_int_t <span class="free">t1</span> <span class="main">∧</span> is_int_t <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span>t_length <span class="free">t1</span> <span class="main">&lt;</span> t_length <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">cvtop</span> <span class="main">=</span> Reinterpret <span class="main">⟹</span> <span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> t_length <span class="free">t1</span> <span class="main">=</span> t_length <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> arity_1_result_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_drop"><span class="command">lemma</span></span> b_e_type_drop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Drop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms b_e_type_testop_drop_cvt0
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_select"><span class="command">lemma</span></span> b_e_type_select<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Select"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">t</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">,</span><span class="bound">t</span><span class="main">,</span>T_i32<span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_call"><span class="command">lemma</span></span> b_e_type_call<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Call <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>func_t <span class="free">𝒞</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">tf1</span> <span class="bound">tf2</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tf1</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tf2</span> <span class="main">∧</span> <span class="main">(</span>func_t <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="bound">tf1</span> <span class="main">_&gt;</span> <span class="bound">tf2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_call_indirect"><span class="command">lemma</span></span> b_e_type_call_indirect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Call_indirect <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>types_t <span class="free">𝒞</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">tf1</span> <span class="bound">tf2</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tf1</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tf2</span> <span class="main">∧</span> <span class="main">(</span>types_t <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="bound">tf1</span> <span class="main">_&gt;</span> <span class="bound">tf2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_get_local"><span class="command">lemma</span></span> b_e_type_get_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Get_local <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="bound">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_set_local"><span class="command">lemma</span></span> b_e_type_set_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Set_local <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="bound">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_tee_local"><span class="command">lemma</span></span> b_e_type_tee_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Tee_local <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">t</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="bound">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_get_global"><span class="command">lemma</span></span> b_e_type_get_global<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Get_global <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span> <span class="main">∧</span> tg_t<span class="main">(</span><span class="main">(</span>global <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>global <span class="free">𝒞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_set_global"><span class="command">lemma</span></span> b_e_type_set_global<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Set_global <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span>global <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">⦇</span>tg_mut <span class="main">=</span> T_mut<span class="main">,</span> tg_t <span class="main">=</span> <span class="bound">t</span><span class="main">⦈</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>global <span class="free">𝒞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_mut_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_block"><span class="command">lemma</span></span> b_e_type_block<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Block <span class="free">tf</span> <span class="free">es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">tfn</span> <span class="bound">tfm</span><span class="main">.</span> <span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="bound">tfn</span> <span class="main">_&gt;</span> <span class="bound">tfm</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tfn</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tfm</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span>  <span class="main">[</span><span class="bound">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="free">tf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_loop"><span class="command">lemma</span></span> b_e_type_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Loop <span class="free">tf</span> <span class="free">es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">tfn</span> <span class="bound">tfm</span><span class="main">.</span> <span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="bound">tfn</span> <span class="main">_&gt;</span> <span class="bound">tfm</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tfn</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tfm</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span>  <span class="main">[</span><span class="bound">tfn</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="free">tf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_if"><span class="command">lemma</span></span> b_e_type_if<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> If <span class="free">tf</span> <span class="free">es1</span> <span class="free">es2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span> <span class="bound">tfn</span> <span class="bound">tfm</span><span class="main">.</span> <span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="bound">tfn</span> <span class="main">_&gt;</span> <span class="bound">tfm</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tfn</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">@</span><span class="bound">tfm</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="bound">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es1</span> <span class="main">:</span> <span class="free">tf</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="bound">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es2</span> <span class="main">:</span> <span class="free">tf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_br"><span class="command">lemma</span></span> b_e_type_br<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Br <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span> <span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">ts''</span> <span class="main">∧</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="bound">ts''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_br_if"><span class="command">lemma</span></span> b_e_type_br_if<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Br_if <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span> <span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">ts''</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">ts''</span> <span class="main">∧</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="bound">ts''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_br_table"><span class="command">lemma</span></span> b_e_type_br_table<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Br_table <span class="free">is</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span> <span class="bound">ts''</span><span class="main">.</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="bound">ts''</span><span class="main">)</span> <span class="main">(</span><span class="free">is</span><span class="main">@</span><span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">ts''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_return"><span class="command">lemma</span></span> b_e_type_return<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Return"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span> <span class="bound">ts''</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">ts''</span> <span class="main">∧</span> <span class="main">(</span>return <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">ts''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_comp"><span class="command">lemma</span></span> b_e_type_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t4s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts'</span> <span class="main">_&gt;</span> <span class="free">t4s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms b_e_typing.empty b_e_typing.weakening
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">es'</span> <span class="skolem">e'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms snoc b_e_typing.weakening
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t4s</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="free">t4s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Two special cases - useful for inductions over reduce. *)</span>
<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_comp2_unlift"><span class="command">lemma</span></span> b_e_type_comp2_unlift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="free">e1</span><span class="main">,</span> <span class="main">$</span><span class="free">e2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts'</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
        unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">e1</span><span class="main">,</span> <span class="free">e2</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span><span class="main">]</span>
        b_e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">e2</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="free">t2s</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_comp2_relift"><span class="command">lemma</span></span> b_e_type_comp2_relift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="free">e1</span><span class="main">,</span> <span class="main">$</span><span class="free">e2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="free">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
        b_e_typing.composition<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
        e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e1</span><span class="main">,</span> <span class="free">e2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span><span class="main">]</span>
        e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">$</span><span class="free">e1</span><span class="main">,</span><span class="main">$</span><span class="free">e2</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="free">t2s</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_value2"><span class="command">lemma</span></span> b_e_type_value2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2s</span> <span class="main">=</span> <span class="free">t1s</span> <span class="main">@</span> <span class="main">[</span>typeof <span class="free">v1</span><span class="main">,</span> typeof <span class="free">v2</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last_ConsL last_ConsR list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="free">t1s</span> <span class="main">@</span> <span class="main">[</span>typeof <span class="free">v1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value ts'_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value ts'_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Lifting the previous results to all expressions. *)</span>
<span class="keyword1" id="Wasm_Properties_Aux-e_type_comp"><span class="command">lemma</span></span> e_type_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts'</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil b_e_type_empty list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">es'</span> <span class="skolem">e'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms snoc
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="free">t3s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">𝒮</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">es''</span></span> <span class="skolem"><span class="skolem">e''</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_e_defs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$*</span> <span class="main">(</span><span class="skolem">es''</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">b_es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_map_conv append_is_Nil_conv not_Cons_self2 rev_exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$*</span><span class="skolem">es''</span><span class="main">)</span> <span class="main">=</span> <span class="free">es</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span><span class="skolem">e''</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> inj_basic map_injective
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">es''</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e''</span><span class="main">]</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t3s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> inj_basic map_injective b_e_defs
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">e''</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t2s</span> <span class="main">_&gt;</span> <span class="skolem">t3s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_type_comp
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_comp_conc"><span class="command">lemma</span></span> e_type_comp_conc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">t2s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t3s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2s</span> <span class="main">=</span> <span class="skolem">t3s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">t2s</span></span> <span class="quoted"><span class="skolem">t3s</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil assms<span class="main">(</span>1<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="skolem">xs</span> <span class="main">:</span> <span class="main">(</span><span class="free">t2s</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="skolem">t3s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts'</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">@</span> <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="skolem">ts'</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">t3s</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* This isn't needed here, but we unlift for convenience. *)</span>
<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_comp_conc"><span class="command">lemma</span></span> b_e_type_comp_conc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">t2s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒮</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">$*</span><span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">$*</span><span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">t2s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  unlift_b_e<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_comp_conc1"><span class="command">lemma</span></span> e_type_comp_conc1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="bound">ts''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ts'</span></span> <span class="quoted"><span class="skolem">ts'</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">@</span> <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">ts</span></span> <span class="quoted"><span class="skolem">ts'</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">ts'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_comp_conc2"><span class="command">lemma</span></span> e_type_comp_conc2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="free">es'</span><span class="main">@</span><span class="free">es''</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts'</span> <span class="bound">ts''</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts'</span> <span class="main">_&gt;</span> <span class="bound">ts''</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es''</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts''</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span><span class="main">@</span><span class="free">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> e_type_comp_conc1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_type_value_list"><span class="command">lemma</span></span> b_e_type_value_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span> <span class="main">=</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span> <span class="main">@</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span> <span class="main">=</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">@</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_label"><span class="command">lemma</span></span> e_type_label<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="free">n</span> <span class="free">es0</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tls</span> <span class="bound">t2s</span><span class="main">.</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> length <span class="bound">tls</span> <span class="main">=</span> <span class="free">n</span>
                <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es0</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tls</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="bound">tls</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Label <span class="free">n</span> <span class="free">es0</span> <span class="free">es</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">𝒮</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_eq_Cons_conv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_self_conv2 b_e_type_empty last_snoc list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> unlift_b_e<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">t2s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_callcl_native"><span class="command">lemma</span></span> e_type_callcl_native<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s'</span> <span class="main">_&gt;</span> <span class="free">t2s'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cl</span> <span class="main">=</span> Func_native <span class="free">i</span> <span class="free">tf</span> <span class="free">ts</span> <span class="free">es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1s</span> <span class="bound">t2s</span> <span class="bound">ts_c</span><span class="main">.</span> <span class="main">(</span><span class="free">t1s'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">t1s</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="main">(</span><span class="free">t2s'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">t2s</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="bound">t1s</span> <span class="main">@</span> <span class="free">ts</span><span class="main">,</span> label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="bound">t2s</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="bound">t2s</span><span class="main">⦈</span>  <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s'</span> <span class="main">_&gt;</span> <span class="free">t2s'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1s'</span></span> <span class="quoted"><span class="free">t2s'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">𝒮</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_map_conv append_Nil butlast_snoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_callcl_host"><span class="command">lemma</span></span> e_type_callcl_host<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s'</span> <span class="main">_&gt;</span> <span class="free">t2s'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cl</span> <span class="main">=</span> Func_host <span class="free">tf</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1s</span> <span class="bound">t2s</span> <span class="bound">ts_c</span><span class="main">.</span> <span class="main">(</span><span class="free">t1s'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">t1s</span><span class="main">)</span>
                        <span class="main">∧</span> <span class="main">(</span><span class="free">t2s'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">t2s</span><span class="main">)</span>
                        <span class="main">∧</span> <span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s'</span> <span class="main">_&gt;</span> <span class="free">t2s'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1s'</span></span> <span class="quoted"><span class="free">t2s'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">𝒮</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_map_conv append_Nil butlast_snoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_callcl"><span class="command">lemma</span></span> e_type_callcl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s'</span> <span class="main">_&gt;</span> <span class="free">t2s'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1s</span> <span class="bound">t2s</span> <span class="bound">ts_c</span><span class="main">.</span> <span class="main">(</span><span class="free">t1s'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">t1s</span><span class="main">)</span>
                        <span class="main">∧</span> <span class="main">(</span><span class="free">t2s'</span> <span class="main">=</span> <span class="bound">ts_c</span> <span class="main">@</span> <span class="bound">t2s</span><span class="main">)</span>
                        <span class="main">∧</span> cl_type <span class="free">cl</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">cl</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_native <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="skolem">x13</span> <span class="skolem">x14</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_callcl_native<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x12</span></span><span class="main">)</span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_host <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_callcl_host<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-s_type_unfold"><span class="command">lemma</span></span> s_type_unfold<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">rs</span> <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rs</span> <span class="main">=</span> Some <span class="free">ts</span><span class="main">)</span> <span class="main">∨</span> <span class="free">rs</span> <span class="main">=</span> None"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> <span class="free">rs</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_local"><span class="command">lemma</span></span> e_type_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vs</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tls</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>
               <span class="main">∧</span> length <span class="bound">tls</span> <span class="main">=</span> <span class="free">n</span>
               <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="bound">tls</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">tls</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="bound">tls</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vs</span> <span class="free">es</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es'</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1s</span> <span class="main">=</span> <span class="skolem">t2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unlift_b_e s_typing.simps<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_local_shallow"><span class="command">lemma</span></span> e_type_local_shallow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vs</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tls</span><span class="main">.</span> length <span class="bound">tls</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="bound">tls</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span>Some <span class="bound">tls</span><span class="main">)</span> <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="bound">tls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vs</span> <span class="free">es</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">𝒮</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e.distinct<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> map_eq_Cons_D<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> append_Nil append_eq_append_conv e_type_comp_conc e_type_local<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="comment1">(* Some proofs treat (lists of) consts as an opaque (typed) arrangement. *)</span>
<span class="keyword1" id="Wasm_Properties_Aux-e_type_const_unwrap"><span class="command">lemma</span></span> e_type_const_unwrap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_const <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="free">e</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EConst <span class="skolem">x23</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Basic e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-is_const_list1"><span class="command">lemma</span></span> is_const_list1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> map <span class="main">(</span>Basic <span class="main">∘</span> EConst<span class="main">)</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ves'</span> <span class="main">=</span> map <span class="main">(</span>Basic <span class="main">∘</span> EConst<span class="main">)</span> <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_const <span class="main">(</span><span class="main">(</span>Basic <span class="main">∘</span> EConst<span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="comment1">(* WHYYYYYY *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-is_const_list"><span class="command">lemma</span></span> is_const_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> <span class="main">$$*</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_const_list1
  <span class="keyword1"><span class="command">unfolding</span></span> comp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-const_list_cons_last"><span class="command">lemma</span></span> const_list_cons_last<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span>
        <span class="quoted"><span class="quoted">"is_const <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all_append<span class="main">[</span><span class="operator">of</span> <span class="quoted">is_const</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_const1"><span class="command">lemma</span></span> e_type_const1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_const <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EConst <span class="skolem">x23</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">x1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>typeof <span class="skolem">x23</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_e_typing.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Basic e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 to_e_list_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_const"><span class="command">lemma</span></span> e_type_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_const <span class="free">e</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="bound">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EConst <span class="skolem">x23</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="main">[</span>typeof <span class="skolem">x23</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Basic assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> b_e_type_value list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> unlift_b_e<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>typeof <span class="skolem">x23</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Basic EConst b_e_typing.intros<span class="main">(</span>1<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-const_typeof"><span class="command">lemma</span></span> const_typeof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_const_list"><span class="command">lemma</span></span> e_type_const_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tvs</span><span class="main">.</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="bound">tvs</span> <span class="main">∧</span> length <span class="free">vs</span> <span class="main">=</span> length <span class="bound">tvs</span> <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">tvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 b_e_type_empty list.map<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> unlift_b_e<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> v_lists<span class="main">:</span><span class="quoted"><span class="quoted">"list_all is_const <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"is_const <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="skolem">xs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>3<span class="main">)</span> e_type_comp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_b_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">ts_b</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ts_b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="skolem">xs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>1<span class="main">)</span> v_lists<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">ts_b</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const v_lists<span class="main">(</span>2<span class="main">)</span> ts''_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ts_b</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_b_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_b</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_b_def<span class="main">(</span>3<span class="main">)</span> t_def e_typing_s_typing.intros<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_const_list_snoc"><span class="command">lemma</span></span> e_type_const_list_snoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs1</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="bound">vs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="bound">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∧</span> <span class="main">(</span><span class="free">vs</span> <span class="main">=</span> <span class="bound">vs1</span><span class="main">@</span><span class="main">[</span><span class="bound">v2</span><span class="main">]</span><span class="main">)</span>
                   <span class="main">∧</span> const_list <span class="bound">vs1</span>
                   <span class="main">∧</span> is_const <span class="bound">v2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">vs'</span><span class="main">@</span><span class="main">[</span><span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil append_eq_append_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> snoc_eq_iff_butlast<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> consts_def<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"is_const <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vs_def assms<span class="main">(</span>2<span class="main">)</span> e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_unwrap consts_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts'_def<span class="main">(</span>2<span class="main">)</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">c</span><span class="main">]</span>"</span></span><span class="main">]</span> b_e_type_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ts'_def vs_def consts_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Wasm_Properties_Aux-e_type_const_list_cons"><span class="command">lemma</span></span> e_type_const_list_cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">(</span><span class="free">ts1</span><span class="main">@</span><span class="free">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs1</span> <span class="bound">vs2</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="bound">vs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts1</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="bound">vs2</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts1</span> <span class="main">_&gt;</span> <span class="main">(</span><span class="free">ts1</span><span class="main">@</span><span class="free">ts2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∧</span> <span class="free">vs</span> <span class="main">=</span> <span class="bound">vs1</span><span class="main">@</span><span class="bound">vs2</span>
                   <span class="main">∧</span> const_list <span class="bound">vs1</span>
                   <span class="main">∧</span> const_list <span class="bound">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">ts1</span><span class="main">@</span><span class="free">ts2</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">ts1</span></span> <span class="quoted"><span class="free">ts2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">t</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> snoc_outer <span class="main">=</span> snoc
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts1</span> <span class="main">_&gt;</span> <span class="skolem">ts1</span> <span class="main">@</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.empty b_e_typing.weakening e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> Nil
      <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ts2'</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2'</span> <span class="main">_&gt;</span> <span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2'</span> <span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs1</span><span class="main">@</span><span class="main">[</span><span class="skolem">v2</span><span class="main">]</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs1</span>"</span></span>
                                <span class="quoted"><span class="quoted">"is_const <span class="skolem">v2</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_type_const_list_snoc<span class="main">[</span><span class="operator">OF</span> snoc_outer<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts1</span><span class="main">@</span><span class="skolem">ts2'</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span>
            snoc_outer<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> snoc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc_outer<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> vs1_def<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> snoc_outer<span class="main">(</span>2<span class="main">)</span> vs1_def<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span>
            e_typing_s_typing.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ vs1_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ts1</span></span><span class="main">]</span>
            snoc
      <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-e_type_const_conv_vs"><span class="command">lemma</span></span> e_type_const_conv_vs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> <span class="free">ves</span> <span class="main">=</span> <span class="main">$$*</span> <span class="bound">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ves</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> e_type_const_unwrap
  <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> list.pred_inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-types_exist_lfilled"><span class="command">lemma</span></span> types_exist_lfilled<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">lfilled</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">lfilled</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1s</span> <span class="bound">t2s</span> <span class="bound">𝒞'</span> <span class="bound">arb_label</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_label</span><span class="main">@</span><span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> label <span class="skolem">𝒞</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">es</span> <span class="main">@</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">es</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk</span><span class="main">]</span>  <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="keyword2"><span class="keyword">where</span></span> test<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">ts</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">lfilledk</span>  <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> test<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> append.assoc append_Cons append_Nil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-types_exist_lfilled_weak"><span class="command">lemma</span></span> types_exist_lfilled_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">lfilled</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">lfilled</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1s</span> <span class="bound">t2s</span> <span class="bound">𝒞'</span> <span class="bound">arb_label</span> <span class="bound">arb_return</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_label</span><span class="main">,</span> return <span class="main">:=</span> <span class="bound">arb_return</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1s</span> <span class="bound">t2s</span> <span class="bound">𝒞'</span> <span class="bound">arb_label</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_label</span><span class="main">,</span> return <span class="main">:=</span> <span class="main">(</span>return <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> types_exist_lfilled<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_func_agree"><span class="command">lemma</span></span> store_typing_imp_func_agree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>func_t <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sfunc_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"cl_typing <span class="free">𝒮</span> <span class="main">(</span>sfunc <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sfunc_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sfunc_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>func_t <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> funcs_agree<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>cl_typing <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span>funcs <span class="free">s</span><span class="main">)</span> <span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>funci_agree <span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inst.funcs <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>func_t <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> store_typing_imp_inst_length_eq store_typing_imp_inst_typing
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inst_typing.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"funci_agree <span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>inst.funcs <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>func_t <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> list_all2_nthD2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sfunc_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sfunc_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>func_t <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> funci_agree_def sfunc_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cl_typing <span class="free">𝒮</span> <span class="main">(</span>sfunc <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_funcs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sfunc_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> funcs_agree list_all2_nthD2
    <span class="keyword1"><span class="command">unfolding</span></span> sfunc_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_glob_agree"><span class="command">lemma</span></span> store_typing_imp_glob_agree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sglob_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"glob_agree <span class="main">(</span>sglob <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sglob_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sglob_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>global <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> globs_agree<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 glob_agree <span class="main">(</span>globs <span class="free">s</span><span class="main">)</span> <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>globi_agree <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inst.globs <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>global <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> store_typing_imp_inst_length_eq store_typing_imp_inst_typing
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inst_typing.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"globi_agree <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>inst.globs <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>global <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> list_all2_nthD2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sglob_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sglob_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>global <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> globi_agree_def sglob_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"glob_agree <span class="main">(</span>sglob <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>sglob_ind <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> globs_agree list_all2_nthD2
    <span class="keyword1"><span class="command">unfolding</span></span> sglob_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_mem_agree_Some"><span class="command">lemma</span></span> store_typing_imp_mem_agree_Some<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"mem_agree <span class="main">(</span><span class="main">(</span>mem <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mems_agree<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 mem_agree <span class="main">(</span>mem <span class="free">s</span><span class="main">)</span> <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"memi_agree <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> store_typing_imp_inst_length_eq store_typing_imp_inst_typing
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inst_typing.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> memi_agree_def smem_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mem_agree <span class="main">(</span><span class="main">(</span>mem <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mems_agree list_all2_nthD2
    <span class="keyword1"><span class="command">unfolding</span></span> sglob_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_typing_imp_mem_agree_None"><span class="command">lemma</span></span> store_typing_imp_mem_agree_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> None"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mems_agree<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 mem_agree <span class="main">(</span>mem <span class="free">s</span><span class="main">)</span> <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"memi_agree <span class="main">(</span>s_mem <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> store_typing_imp_inst_length_eq store_typing_imp_inst_typing
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inst_typing.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> memi_agree_def smem_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_mem_exists"><span class="command">lemma</span></span> store_mem_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Option.is_none <span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span>memory <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> inst_typ<span class="main">:</span><span class="quoted"><span class="quoted">"inst_typing <span class="free">𝒮</span> <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps list_all2_conv_all_nth
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inst_typing.simps memi_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_preserved_mem"><span class="command">lemma</span></span> store_preserved_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">⦇</span>s.mem <span class="main">:=</span> <span class="main">(</span>s.mem <span class="free">s</span><span class="main">)</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">mem'</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"mem_size <span class="free">mem'</span> <span class="main">≥</span> mem_size <span class="free">orig_mem</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>s.mem <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">orig_mem</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s'</span> <span class="free">𝒮</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts</span></span> <span class="skolem"><span class="skolem">fs</span></span> <span class="skolem"><span class="skolem">clss</span></span> <span class="skolem"><span class="skolem">bss</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">⦇</span>inst <span class="main">=</span> <span class="skolem">insts</span><span class="main">,</span> funcs <span class="main">=</span> <span class="skolem">fs</span><span class="main">,</span> tab <span class="main">=</span> <span class="skolem">clss</span><span class="main">,</span> mem <span class="main">=</span> <span class="skolem">bss</span><span class="main">,</span> globs <span class="main">=</span> <span class="skolem">gs</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts'</span></span> <span class="skolem"><span class="skolem">fs'</span></span> <span class="skolem"><span class="skolem">clss'</span></span> <span class="skolem"><span class="skolem">bss'</span></span> <span class="skolem"><span class="skolem">gs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> <span class="main">⦇</span>inst <span class="main">=</span> <span class="skolem">insts'</span><span class="main">,</span> funcs <span class="main">=</span> <span class="skolem">fs'</span><span class="main">,</span> tab <span class="main">=</span> <span class="skolem">clss'</span><span class="main">,</span> mem <span class="main">=</span> <span class="skolem">bss'</span><span class="main">,</span> globs <span class="main">=</span> <span class="skolem">gs'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞s</span></span> <span class="skolem"><span class="skolem">tfs</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="skolem"><span class="skolem">tgs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span> <span class="main">=</span> <span class="main">⦇</span>s_inst <span class="main">=</span> <span class="skolem">𝒞s</span><span class="main">,</span> s_funcs <span class="main">=</span> <span class="skolem">tfs</span><span class="main">,</span> s_tab <span class="main">=</span> <span class="skolem">ns</span><span class="main">,</span> s_mem <span class="main">=</span> <span class="skolem">ms</span><span class="main">,</span> s_globs <span class="main">=</span> <span class="skolem">tgs</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s_context.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> s_S_defs <span class="main">=</span> calculation
  <span class="keyword1"><span class="command">hence</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">insts</span> <span class="main">=</span> <span class="skolem">insts'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">fs</span> <span class="main">=</span> <span class="skolem">fs'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">clss</span> <span class="main">=</span> <span class="skolem">clss'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">gs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>inst_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">insts'</span> <span class="skolem">𝒞s</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>cl_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">fs'</span> <span class="skolem">tfs</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all <span class="main">(</span>tab_agree <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span>concat <span class="skolem">clss'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">cls</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="bound">cls</span><span class="main">)</span> <span class="skolem">clss'</span> <span class="skolem">ns</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 glob_agree <span class="skolem">gs'</span> <span class="skolem">tgs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s_S_defs assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="skolem">bss'</span> <span class="skolem">ms</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">bss</span> <span class="main">=</span> length <span class="skolem">bss'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>  s_S_defs
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="comment1">(* Memory correct before execution. *)</span>
    <span class="keyword1"><span class="command">have</span></span> initial_mem<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="skolem">bss</span> <span class="skolem">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> s_S_defs
      <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps mem_agree_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="skolem">bss</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bss'</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">bss</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞_m</span></span> <span class="keyword2"><span class="keyword">where</span></span> cmdef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞_m</span> <span class="main">=</span> <span class="skolem">𝒞s</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bss</span><span class="main">!</span><span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> initial_mem local_assms
        <span class="keyword1"><span class="command">unfolding</span></span> list_all2_conv_all_nth
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bss'</span><span class="main">!</span><span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> s_S_defs local_assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="free">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> initial_mem list_all2_all_nthI list_all2_lengthD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps mem_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-types_agree_imp_e_typing"><span class="command">lemma</span></span> types_agree_imp_e_typing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"types_agree <span class="free">t</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> b_e_typing.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties_Aux-list_types_agree_imp_e_typing"><span class="command">lemma</span></span> list_types_agree_imp_e_typing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="free">ts</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">$$*</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_all2_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.empty e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">t</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> types_agree_imp_e_typing
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span><span class="main">]</span> e_type_comp_conc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-b_e_typing_imp_list_types_agree"><span class="command">lemma</span></span> b_e_typing_imp_list_types_agree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">C</span> <span class="bound">v</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">@</span><span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="free">ts</span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">C</span> <span class="bound">v</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts'</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">@</span><span class="free">ts</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>composition <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> es_e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">=</span> map EConst <span class="skolem">vs1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">=</span> map EConst <span class="skolem">vs2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span><span class="main">@</span><span class="skolem">vs2</span><span class="main">=</span><span class="skolem">vs</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> last_map list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> map_butlast snoc_eq_iff_butlast<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$*</span><span class="skolem">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> es_e_def<span class="main">(</span>1<span class="main">)</span> is_const_list1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2s</span> <span class="main">=</span> <span class="skolem">t1s</span><span class="main">@</span><span class="skolem">tvs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> composition<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$*</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> es_e_def<span class="main">(</span>2<span class="main">)</span> is_const_list1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1s</span> <span class="main">@</span> <span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">t2s</span> <span class="main">@</span> <span class="skolem">tvs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> composition<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> es_e_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_appendI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> types_agree_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties_Aux-e_typing_imp_list_types_agree"><span class="command">lemma</span></span> e_typing_imp_list_types_agree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">$$*</span> <span class="free">vs</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts'</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">@</span><span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="free">ts</span> <span class="free">vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$$*</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">$*</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">C</span> <span class="bound">v</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms unlift_b_e b_e_typing_imp_list_types_agree
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-store_extension_imp_store_typing"><span class="command">lemma</span></span> store_extension_imp_store_typing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"store_extension <span class="free">s</span> <span class="free">s'</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s'</span> <span class="free">𝒮</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts</span></span> <span class="skolem"><span class="skolem">fs</span></span> <span class="skolem"><span class="skolem">clss</span></span> <span class="skolem"><span class="skolem">bss</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">⦇</span>inst <span class="main">=</span> <span class="skolem">insts</span><span class="main">,</span> funcs <span class="main">=</span> <span class="skolem">fs</span><span class="main">,</span> tab <span class="main">=</span> <span class="skolem">clss</span><span class="main">,</span> mem <span class="main">=</span> <span class="skolem">bss</span><span class="main">,</span> globs <span class="main">=</span> <span class="skolem">gs</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts'</span></span> <span class="skolem"><span class="skolem">fs'</span></span> <span class="skolem"><span class="skolem">clss'</span></span> <span class="skolem"><span class="skolem">bss'</span></span> <span class="skolem"><span class="skolem">gs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> <span class="main">⦇</span>inst <span class="main">=</span> <span class="skolem">insts'</span><span class="main">,</span> funcs <span class="main">=</span> <span class="skolem">fs'</span><span class="main">,</span> tab <span class="main">=</span> <span class="skolem">clss'</span><span class="main">,</span> mem <span class="main">=</span> <span class="skolem">bss'</span><span class="main">,</span> globs <span class="main">=</span> <span class="skolem">gs'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞s</span></span> <span class="skolem"><span class="skolem">tfs</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="skolem"><span class="skolem">tgs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span> <span class="main">=</span> <span class="main">⦇</span>s_inst <span class="main">=</span> <span class="skolem">𝒞s</span><span class="main">,</span> s_funcs <span class="main">=</span> <span class="skolem">tfs</span><span class="main">,</span> s_tab <span class="main">=</span> <span class="skolem">ns</span><span class="main">,</span> s_mem <span class="main">=</span> <span class="skolem">ms</span><span class="main">,</span> s_globs <span class="main">=</span> <span class="skolem">tgs</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s_context.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> s_S_defs <span class="main">=</span> calculation
  <span class="keyword1"><span class="command">hence</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">insts</span> <span class="main">=</span> <span class="skolem">insts'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">fs</span> <span class="main">=</span> <span class="skolem">fs'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">clss</span> <span class="main">=</span> <span class="skolem">clss'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">gs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_extension.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>inst_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">insts'</span> <span class="skolem">𝒞s</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>cl_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">fs'</span> <span class="skolem">tfs</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all <span class="main">(</span>tab_agree <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span>concat <span class="skolem">clss'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">cls</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="bound">cls</span><span class="main">)</span> <span class="skolem">clss'</span> <span class="skolem">ns</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 glob_agree <span class="skolem">gs'</span> <span class="skolem">tgs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s_S_defs assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span> <span class="bound">bs</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> mem_size <span class="bound">bs</span><span class="main">)</span> <span class="skolem">bss</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s_S_defs<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps mem_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"list_all2 mem_agree <span class="skolem">bss'</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> s_S_defs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_extension.simps list_all2_conv_all_nth mem_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_typing.intros
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties_Aux-lfilled_deterministic"><span class="command">lemma</span></span> lfilled_deterministic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lfilled</span> <span class="free">es</span> <span class="free">les</span>"</span></span>
          <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lfilled</span> <span class="free">es</span> <span class="free">les'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">les</span> <span class="main">=</span> <span class="free">les'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">les'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lfilled.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">es</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Properties">
<div class="head">
<h1>Theory Wasm_Properties</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for Soundness Proof›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Properties <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Properties_Aux.html">Wasm_Properties_Aux</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preservation›</span></span>

<span class="keyword1" id="Wasm_Properties-t_cvt"><span class="command">lemma</span></span> t_cvt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cvt <span class="free">t</span> <span class="free">sx</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> typeof <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> cvt_def typeof_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> option.discI option.inject v.simps<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> option.discI option.inject v.simps<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> option.discI option.inject v.simps<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> option.discI option.inject v.simps<span class="main"><span class="main">(</span></span>20<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Wasm_Properties-store_preserved1"><span class="command">lemma</span></span> store_preserved1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vs</span><span class="main">)</span><span class="main">,</span> label <span class="main">:=</span> <span class="free">arb_label</span><span class="main">,</span> return <span class="main">:=</span> <span class="free">arb_return</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s'</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">arb_label</span></span> <span class="quoted"><span class="free">arb_return</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_host_Some <span class="skolem">cl</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">f</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">hs</span> <span class="skolem">s'</span> <span class="skolem">vcs'</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">ves</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="skolem">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> callcl_host_Some<span class="main">(</span>8<span class="main">)</span> e_type_comp
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> ves_c<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="skolem">ves</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_const_list<span class="main">[</span><span class="operator">OF</span> callcl_host_Some<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> tvs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">tvs</span>"</span></span>
                                <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">=</span> length <span class="skolem">tvs</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">ves</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ves</span></span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span> callcl_host_Some
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">t1s</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">t2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_callcl_host<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> callcl_host_Some<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="skolem">t1s</span> <span class="skolem">vcs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_imp_list_types_agree<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?ts'</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> callcl_host_Some<span class="main">(</span>2<span class="main">)</span> tvs_def<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_extension_imp_store_typing
          host_apply_preserve_store<span class="main">[</span><span class="operator">OF</span> _ callcl_host_Some<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> callcl_host_Some<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>set_global <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">v</span> <span class="skolem">s'</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts</span></span> <span class="skolem"><span class="skolem">fs</span></span> <span class="skolem"><span class="skolem">clss</span></span> <span class="skolem"><span class="skolem">bss</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">⦇</span>inst <span class="main">=</span> <span class="skolem">insts</span><span class="main">,</span> funcs <span class="main">=</span> <span class="skolem">fs</span><span class="main">,</span> tab <span class="main">=</span> <span class="skolem">clss</span><span class="main">,</span> mem <span class="main">=</span> <span class="skolem">bss</span><span class="main">,</span> globs <span class="main">=</span> <span class="skolem">gs</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts'</span></span> <span class="skolem"><span class="skolem">fs'</span></span> <span class="skolem"><span class="skolem">clss'</span></span> <span class="skolem"><span class="skolem">bss'</span></span> <span class="skolem"><span class="skolem">gs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="main">⦇</span>inst <span class="main">=</span> <span class="skolem">insts'</span><span class="main">,</span> funcs <span class="main">=</span> <span class="skolem">fs'</span><span class="main">,</span> tab <span class="main">=</span> <span class="skolem">clss'</span><span class="main">,</span> mem <span class="main">=</span> <span class="skolem">bss'</span><span class="main">,</span> globs <span class="main">=</span> <span class="skolem">gs'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞s</span></span> <span class="skolem"><span class="skolem">tfs</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="skolem"><span class="skolem">tgs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span> <span class="main">=</span> <span class="main">⦇</span>s_inst <span class="main">=</span> <span class="skolem">𝒞s</span><span class="main">,</span> s_funcs <span class="main">=</span> <span class="skolem">tfs</span><span class="main">,</span> s_tab <span class="main">=</span> <span class="skolem">ns</span><span class="main">,</span> s_mem <span class="main">=</span> <span class="skolem">ms</span><span class="main">,</span> s_globs <span class="main">=</span> <span class="skolem">tgs</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s_context.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  
  <span class="keyword1"><span class="command">note</span></span> s_S_defs <span class="main">=</span> calculation

  <span class="comment1">(* Prove that inst, tab and mem are not altered. *)</span>
  <span class="keyword1"><span class="command">have</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">insts</span> <span class="main">=</span> <span class="skolem">insts'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">fs</span> <span class="main">=</span> <span class="skolem">fs'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">clss</span> <span class="main">=</span> <span class="skolem">clss'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">bss</span> <span class="main">=</span> <span class="skolem">bss'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_global<span class="main">(</span>1<span class="main">)</span> s_S_defs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> supdate_glob_def supdate_glob_s_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> s.ext_inject s.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>inst_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">insts'</span> <span class="skolem">𝒞s</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>cl_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">fs'</span> <span class="skolem">tfs</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all <span class="main">(</span>tab_agree <span class="free">𝒮</span><span class="main">)</span> <span class="main">(</span>concat <span class="skolem">clss'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">cls</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="bound">cls</span><span class="main">)</span> <span class="skolem">clss'</span> <span class="skolem">ns</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_all2 mem_agree <span class="skolem">bss'</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_global<span class="main">(</span>2<span class="main">)</span> s_S_defs
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 glob_agree <span class="skolem">gs'</span> <span class="skolem">tgs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> gs_agree<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 glob_agree <span class="skolem">gs</span> <span class="skolem">tgs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_global<span class="main">(</span>2<span class="main">)</span> s_S_defs
      <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">gs</span> <span class="main">=</span> length <span class="skolem">gs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s_S_defs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> set_global<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> supdate_glob_def supdate_glob_s_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_list_update s.select_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> s.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>sglob_ind <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">j'</span> <span class="main">≠</span> <span class="skolem">k</span><span class="main">;</span> <span class="bound">j'</span> <span class="main">&lt;</span> length <span class="skolem">gs</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">gs</span><span class="main">!</span><span class="bound">j'</span> <span class="main">=</span> <span class="skolem">gs'</span><span class="main">!</span><span class="bound">j'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s_S_defs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> set_global<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> supdate_glob_def supdate_glob_s_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">j'</span> <span class="main">≠</span> <span class="skolem">k</span><span class="main">;</span> <span class="bound">j'</span> <span class="main">&lt;</span> length <span class="skolem">gs</span><span class="main">⟧</span> <span class="main">⟹</span> glob_agree <span class="main">(</span><span class="skolem">gs'</span><span class="main">!</span><span class="bound">j'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tgs</span><span class="main">!</span><span class="bound">j'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gs_agree
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_all2_conv_all_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"glob_agree <span class="main">(</span><span class="skolem">gs'</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tgs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Set_global <span class="skolem">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b_e_type_comp2_unlift set_global.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b_es<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts</span><span class="main">@</span><span class="main">[</span>typeof <span class="skolem">v</span><span class="main">]</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">ts'</span>"</span></span>
                <span class="quoted"><span class="quoted">"global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">⦇</span>tg_mut <span class="main">=</span> T_mut<span class="main">,</span> tg_t <span class="main">=</span> typeof <span class="skolem">v</span><span class="main">⦈</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> b_e_type_set_global<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_global<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> globs_agree<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="main">(</span>s_globs <span class="free">𝒮</span><span class="main">)</span>"</span></span>
                        <span class="quoted"><span class="quoted">"glob_agree <span class="main">(</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tgs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tgs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> store_typing_imp_glob_agree<span class="main">[</span><span class="operator">OF</span> set_global<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>5<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> b_es<span class="main">(</span>4<span class="main">)</span> s_S_defs<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> k_def set_global<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> sglob_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"g_mut <span class="main">(</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> T_mut"</span></span>
            <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>g_val <span class="main">(</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> typeof <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_es<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> glob_agree_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"g_mut <span class="main">(</span><span class="skolem">gs'</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> T_mut"</span></span>
            <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>g_val <span class="main">(</span><span class="skolem">gs'</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> typeof <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_global<span class="main">(</span>1<span class="main">)</span> k_def globs_agree<span class="main">(</span>1<span class="main">)</span> store_typing_imp_glob_length_eq<span class="main">[</span><span class="operator">OF</span> set_global<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> s_S_defs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> supdate_glob_def supdate_glob_s_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> globs_agree<span class="main">(</span>3<span class="main">)</span> b_es<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> glob_agree_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gs_agree
      <span class="keyword1"><span class="command">unfolding</span></span> list_all2_conv_all_nth
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_typing.intros
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* The following are all special cases of store_preserved_mem. *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store_Some <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">mem'</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_preserved_mem<span class="main">[</span><span class="operator">OF</span> store_Some<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ _ store_Some<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> store_size<span class="main">[</span><span class="operator">OF</span> store_Some<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store_packed_Some <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">tp</span> <span class="skolem">mem'</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_preserved_mem<span class="main">[</span><span class="operator">OF</span> store_packed_Some<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ _ store_packed_Some<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> store_packed_size<span class="main">[</span><span class="operator">OF</span> store_packed_Some<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>grow_memory <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">n</span> <span class="skolem">mem</span> <span class="skolem">c</span> <span class="skolem">mem'</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_preserved_mem<span class="main">[</span><span class="operator">OF</span> grow_memory<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span>_ _ grow_memory<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> mem_grow_size<span class="main">[</span><span class="operator">OF</span> grow_memory<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="skolem"><span class="skolem">arb_label'</span></span> <span class="skolem"><span class="skolem">arb_return'</span></span> <span class="keyword2"><span class="keyword">where</span></span> es_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="skolem">arb_label'</span><span class="main">,</span> return <span class="main">:=</span> <span class="skolem">arb_return'</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> types_exist_lfilled_weak<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> es_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ label<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">]</span> label<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>local <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">v0s</span> <span class="skolem">n</span> <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_local<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="skolem">tls</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span><span class="main">)</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">tls</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_local<span class="main">[</span><span class="operator">OF</span> local<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> local<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> t_local<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ t_local<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Some <span class="skolem">tls</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"label <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Properties-store_preserved"><span class="command">lemma</span></span> store_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s'</span> <span class="free">𝒮</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> store_preserved1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted">None</span> <span class="quoted"><span class="quoted">"label <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
          s_type_unfold<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>3<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-typeof_unop_testop"><span class="command">lemma</span></span> typeof_unop_testop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_i <span class="free">t</span> <span class="free">iop</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_f <span class="free">t</span> <span class="free">fop</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Testop <span class="free">t</span> <span class="free">testop</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_f <span class="free">t</span> <span class="free">fop</span><span class="main">)</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_f <span class="free">t</span> <span class="free">fop</span><span class="main">)</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> b_e_type_unop_testop<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-typeof_cvtop"><span class="command">lemma</span></span> typeof_cvtop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Cvtop <span class="free">t1</span> <span class="free">cvtop</span> <span class="free">t</span> <span class="free">sx</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">cvtop</span> <span class="main">=</span> Convert <span class="main">⟹</span> <span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">sx</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>is_float_t <span class="free">t1</span> <span class="main">∧</span> is_float_t <span class="free">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>is_int_t <span class="free">t1</span> <span class="main">∧</span> is_int_t <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span>t_length <span class="free">t1</span> <span class="main">&lt;</span> t_length <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">cvtop</span> <span class="main">=</span> Reinterpret <span class="main">⟹</span> <span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> t_length <span class="free">t1</span> <span class="main">=</span> t_length <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">cvtop</span> <span class="main">=</span> Convert <span class="main">⟹</span> <span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">sx</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>is_float_t <span class="free">t1</span> <span class="main">∧</span> is_float_t <span class="free">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>is_int_t <span class="free">t1</span> <span class="main">∧</span> is_int_t <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span>t_length <span class="free">t1</span> <span class="main">&lt;</span> t_length <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">cvtop</span> <span class="main">=</span> Reinterpret <span class="main">⟹</span> <span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> t_length <span class="free">t1</span> <span class="main">=</span> t_length <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> b_e_type_cvtop<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_unop_testop_cvtop"><span class="command">lemma</span></span> types_preserved_unop_testop_cvtop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_i <span class="free">t</span> <span class="free">iop</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_f <span class="free">t</span> <span class="free">fop</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Testop <span class="free">t</span> <span class="free">testop</span><span class="main">)</span><span class="main">)</span>  <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Cvtop <span class="free">t2</span> <span class="free">cvtop</span> <span class="free">t</span> <span class="free">sx</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">@</span><span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>typeof <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> b_e_type_unop_testop<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
          b_e_type_cvtop<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast_snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> last_snoc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arity_1_result <span class="free">e</span> <span class="main">=</span> typeof <span class="main">(</span><span class="free">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.cases<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arity_1_result_def wasm_deserialise_type t_cvt<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeof_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.const
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
          b_e_typing.weakening<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-typeof_binop_relop"><span class="command">lemma</span></span> typeof_binop_relop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v1</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
        <span class="quoted"><span class="quoted">"typeof <span class="free">v2</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_id</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_id_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts_id</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">ts''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_id</span> <span class="main">@</span> <span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_e_type_binop_relop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts''</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ts'</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v1</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
       <span class="quoted"><span class="quoted">"typeof <span class="free">v2</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span> <span class="main">⟹</span> is_float_t <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def b_e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> <span class="free">v2</span>"</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span> b_e_type_value2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_binop_relop"><span class="command">lemma</span></span> types_preserved_binop_relop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_id</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_id_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts_id</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">ts''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_id</span> <span class="main">@</span> <span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> b_e_type_binop_relop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts''</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ts'</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts_id</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def b_e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> <span class="free">v2</span>"</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span> b_e_type_value
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">@</span><span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value ts_id_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arity_2_result <span class="free">e</span> <span class="main">=</span> typeof <span class="main">(</span><span class="free">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arity_2_result_def typeof_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.const
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
          b_e_typing.weakening<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_drop"><span class="command">lemma</span></span> types_preserved_drop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Drop<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span>typeof <span class="free">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def assms<span class="main">(</span>3<span class="main">)</span> b_e_type_drop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_select"><span class="command">lemma</span></span> types_preserved_select<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">vn</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v3</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">vn</span><span class="main">,</span> <span class="main">$</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> Select<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v3</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">vn</span><span class="main">,</span> <span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1s_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">vn</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?e</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">vn</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t2s_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1s</span> <span class="main">=</span> <span class="skolem">t2s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t</span><span class="main">,</span> <span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">t2s</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_select<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="skolem">t1s</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">,</span> <span class="keyword1">C</span> <span class="free">v2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t1s_def t2s_def b_e_type_value_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="keyword1"><span class="keyword1">C</span></span> <span class="free"><span class="free">v1</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">C</span></span> <span class="free"><span class="free">v2</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">vn</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ts</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t2s</span></span><span class="main"><span class="main">@</span></span><span class="main"><span class="main">[</span></span><span class="skolem"><span class="skolem">t</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> v2_t_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v2</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t1s_def t2s_def b_e_type_value_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="keyword1"><span class="keyword1">C</span></span> <span class="free"><span class="free">v1</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">v2</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ts</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t2s</span></span><span class="main"><span class="main">@</span></span><span class="main"><span class="main">[</span></span><span class="skolem"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> v1_t_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">t2s</span>"</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v1</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v3</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> v2_t_def<span class="main">(</span>2<span class="main">)</span> v1_t_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v3</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.const b_e_typing.weakening t2s_def<span class="main">(</span>2<span class="main">)</span> v1_t_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_block"><span class="command">lemma</span></span> types_preserved_block<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span>Label <span class="free">m</span> <span class="main">[]</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">tn</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">tm</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="free">m</span> <span class="main">[]</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="free">tm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>Block <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="free">es</span>"</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Block <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">tfn</span></span> <span class="skolem"><span class="skolem">tfm</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tfn</span> <span class="main">_&gt;</span> <span class="skolem">tfm</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span><span class="main">@</span><span class="skolem">tfn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span><span class="main">@</span><span class="skolem">tfm</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_block<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"Block <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="free">es</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">es</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> tfn_l<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">tfn</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tvs'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="skolem">tvs'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tvs'</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> ts''_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tn</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="main">$*</span><span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_c_def tvs'_def tfn_l ts''_def c_def e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">tm</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
          e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?b_es</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
          e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="free">tm</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
          ts_c_def tvs'_def assms<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span> c_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_if"><span class="command">lemma</span></span> types_preserved_if<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">,</span> <span class="main">$</span>If <span class="free">tf</span> <span class="free">e1s</span> <span class="free">e2s</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span><span class="main">$</span>Block <span class="free">tf</span> <span class="free">es'</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">,</span> <span class="main">$</span>If <span class="free">tf</span> <span class="free">e1s</span> <span class="free">e2s</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Block <span class="free">tf</span> <span class="free">es'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">,</span> If <span class="free">tf</span> <span class="free">e1s</span> <span class="free">e2s</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_i</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_i_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts_i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>If <span class="free">tf</span> <span class="free">e1s</span> <span class="free">e2s</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_i</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">tfn</span></span> <span class="skolem"><span class="skolem">tfm</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tfn</span> <span class="main">_&gt;</span> <span class="skolem">tfm</span><span class="main">)</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="skolem">ts_i</span> <span class="main">=</span> <span class="skolem">ts''</span><span class="main">@</span><span class="skolem">tfn</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts''</span><span class="main">@</span><span class="skolem">tfm</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">e1s</span> <span class="main">:</span> <span class="free">tf</span><span class="main">)</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">e2s</span> <span class="main">:</span> <span class="free">tf</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_if<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tf</span> <span class="free">e1s</span> <span class="free">e2s</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts_i</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_i_def<span class="main">(</span>1<span class="main">)</span> b_e_type_value
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tfm</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tfn</span> <span class="main">_&gt;</span> <span class="skolem">tfm</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ts_def<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> ts_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Block <span class="free">tf</span> <span class="free">es'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tfn</span> <span class="main">_&gt;</span> <span class="skolem">tfm</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_def<span class="main">(</span>1<span class="main">)</span> b_e_typing.block<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tf</span></span> <span class="quoted"><span class="skolem">tfn</span></span> <span class="quoted"><span class="skolem">tfm</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">es'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_tee_local"><span class="command">lemma</span></span> types_preserved_tee_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="free">v</span><span class="main">,</span> <span class="main">$</span>Tee_local <span class="free">i</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span><span class="free">v</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span>Set_local <span class="free">i</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">v</span><span class="main">,</span> <span class="main">$</span>Tee_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"is_const <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">v</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span>Set_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bv</span></span> <span class="keyword2"><span class="keyword">where</span></span> bv_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> <span class="skolem">bv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_unwrap assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">,</span> Tee_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Tee_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"Tee_local <span class="free">i</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_tee_local<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Tee_local <span class="free"><span class="free">i</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts''</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ts'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> t_bv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> typeof <span class="skolem">bv</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">ts_c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value ts''_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Set_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_c_def<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> b_e_typing.set_local<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span>
          b_e_typing.weakening<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Set_local <span class="free">i</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t_bv b_e_typing.const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">bv</span></span><span class="main">]</span>  b_e_typing.weakening<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">,</span> <span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t_bv b_e_typing.const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">bv</span></span><span class="main">]</span>  b_e_typing.composition<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">,</span> <span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">,</span> Set_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.composition b_e_typing.weakening<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">,</span> <span class="keyword1">C</span> <span class="skolem">bv</span><span class="main">,</span> Set_local <span class="free">i</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> t_bv<span class="main">(</span>2<span class="main">)</span> ts_c_def<span class="main">(</span>2<span class="main">)</span> bv_def e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_loop"><span class="command">lemma</span></span> types_preserved_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span>Label <span class="free">n</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">t1s</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">t2s</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="free">n</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> e_type_comp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">tfn</span></span> <span class="skolem"><span class="skolem">tfm</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_loop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tfn</span> <span class="main">_&gt;</span> <span class="skolem">tfm</span><span class="main">)</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span><span class="main">@</span><span class="skolem">tfn</span><span class="main">)</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span><span class="main">@</span><span class="skolem">tfm</span><span class="main">)</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="free">t1s</span><span class="main">]</span> <span class="main">@</span> label <span class="free">𝒞</span><span class="main">⦈</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tfn</span> <span class="main">_&gt;</span> <span class="skolem">tfm</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_loop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> tvs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="skolem">tvs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="skolem">tvs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list assms<span class="main">(</span>3<span class="main">)</span> ts''_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tvs_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tvs</span> <span class="main">=</span> <span class="free">t1s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tfn</span> <span class="main">=</span> <span class="free">t1s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> t_loop<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t_loop b_e_typing.loop e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="main">$*</span><span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t_loop e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span><span class="free">es</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tvs_eq tvs_def<span class="main">(</span>3<span class="main">)</span> e_type_comp_conc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="free">n</span> <span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Loop <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="free">t2s</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="free">es</span><span class="main">)</span>"</span></span><span class="main">]</span>
          t_loop<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> t_loop e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span> tvs_def<span class="main">(</span>1<span class="main">)</span> tvs_eq<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_label_value"><span class="command">lemma</span></span> types_preserved_label_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span>Label <span class="free">n</span> <span class="free">es0</span> <span class="free">vs</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">vs</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="free">n</span> <span class="free">es0</span> <span class="free">vs</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> t2s_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="skolem">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es0</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tls</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_label
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">t2s</span></span><span class="main">]</span>
          assms<span class="main">(</span>3<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_br_if"><span class="command">lemma</span></span> types_preserved_br_if<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">,</span> <span class="main">$</span>Br_if <span class="free">i</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">e</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">,</span> <span class="main">$</span>Br_if <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span>Br <span class="free">i</span><span class="main">]</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">,</span> Br_if <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Br_if <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">n</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"Br_if <span class="free">i</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">ts_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_bc_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">ts_b</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">ts_b</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="skolem">ts_b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_br_if<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Br_if <span class="free"><span class="free">i</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts''</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ts'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">ts_b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def<span class="main">(</span>1<span class="main">)</span> b_e_type_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span>Br <span class="free">i</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ts_def e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span> b_e_typing.br ts_bc_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ts_def b_e_type_empty ts_bc_def<span class="main">(</span>3<span class="main">)</span>
      e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_br_table"><span class="command">lemma</span></span> types_preserved_br_table<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">,</span> <span class="main">$</span>Br_table <span class="free">is</span> <span class="free">i</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">[</span><span class="main">$</span>Br <span class="free">i'</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">,</span> <span class="main">$</span>Br_table <span class="free">is</span> <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i'</span> <span class="main">=</span> <span class="main">(</span><span class="free">is</span> <span class="main">!</span> nat_of_int <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">is</span> <span class="main">&gt;</span> nat_of_int <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="free">i'</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Br <span class="free">i'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">,</span> Br_table <span class="free">is</span> <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Br_table <span class="free">is</span> <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"Br_table <span class="free">is</span> <span class="free">i</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_l</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_c_def<span class="main">:</span><span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">ts_l</span><span class="main">)</span> <span class="main">(</span><span class="free">is</span><span class="main">@</span><span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
                                       <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">ts_l</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_br_table<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"Br_table <span class="free">is</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">ts_l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def<span class="main">(</span>1<span class="main">)</span> b_e_type_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Br <span class="free">i'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> ts_c_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> b_e_typing.br<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i'</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">ts_l</span></span> <span class="quoted"><span class="skolem">ts_c</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span> ts_def
    <span class="keyword1"><span class="command">unfolding</span></span> list_all_length
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Suc_eq nth_append<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_local_const"><span class="command">lemma</span></span> types_preserved_local_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vs</span> <span class="free">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vs</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span><span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="skolem">tls</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span><span class="main">)</span>"</span></span>
                   <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="skolem">tls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_local<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-typing_map_typeof"><span class="command">lemma</span></span> typing_map_typeof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> <span class="main">$$*</span> <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">tvs</span> <span class="main">=</span> map typeof <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ves</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">tvs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">a</span> <span class="skolem">ves</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ves</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">=</span> <span class="main">$$*</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">@</span><span class="main">[</span><span class="skolem">v'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span><span class="main">@</span><span class="main">[</span><span class="skolem">v'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_map_conv append_is_Nil_conv list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tvs'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="skolem">ves</span><span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tvs'</span> <span class="main">_&gt;</span> <span class="skolem">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>3<span class="main">)</span> e_type_comp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tvs'</span> <span class="main">=</span> map typeof <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>1<span class="main">)</span> vs'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_const <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vs'_def
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tvs</span> <span class="main">=</span> <span class="skolem">tvs'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tvs'_def<span class="main">(</span>2<span class="main">)</span>  e_type_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="skolem">tvs'</span></span> <span class="quoted"><span class="skolem">tvs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vs'_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> typeof <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t_def unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">]</span> b_e_type_value<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> vs'_def t_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_call_indirect_Some"><span class="command">lemma</span></span> types_preserved_call_indirect_Some<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">,</span> <span class="main">$</span>Call_indirect <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i'</span> <span class="main">(</span>nat_of_int <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">cl</span>"</span></span>
          <span class="quoted"><span class="quoted">"stypes <span class="free">s</span> <span class="free">i'</span> <span class="free">j</span> <span class="main">=</span> <span class="free">tf</span>"</span></span>
          <span class="quoted"><span class="quoted">"cl_type <span class="free">cl</span> <span class="main">=</span> <span class="free">tf</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i'</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">=</span> <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="free">i'</span><span class="main">)</span> <span class="main">⦇</span>local <span class="main">:=</span> local <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="free">i'</span><span class="main">)</span> <span class="main">@</span> <span class="free">tvs</span><span class="main">,</span> label <span class="main">:=</span> <span class="free">arb_labs</span><span class="main">,</span> return <span class="main">:=</span> <span class="free">arb_return</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tf</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Call_indirect <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>Call_indirect <span class="free">j</span>"</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span>
          assms<span class="main">(</span>1<span class="main">)</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span>"</span></span><span class="main">]</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Call_indirect <span class="free">j</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i'</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> store_typing_imp_inst_length_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> stypes_eq<span class="main">:</span><span class="quoted"><span class="quoted">"types_t <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="free">i'</span><span class="main">)</span> <span class="main">=</span> types <span class="main">(</span>inst <span class="free">s</span> <span class="main">!</span> <span class="free">i'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> store_typing_imp_inst_typing<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> store_typing_imp_inst_length_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> inst_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''a</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''a_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>types_t <span class="free">𝒞</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts''a</span> <span class="main">@</span> <span class="skolem">t1s</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts''a</span> <span class="main">@</span> <span class="skolem">t2s</span>"</span></span>
                               <span class="quoted"><span class="quoted">"types_t <span class="free">𝒞</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_call_indirect<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">j</span></span></span></span><span class="main">]</span> tf_def assms<span class="main">(</span>3<span class="main">,</span>7<span class="main">)</span> stypes_eq
    <span class="keyword1"><span class="command">unfolding</span></span> stypes_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf'_def<span class="main">:</span><span class="quoted"><span class="quoted">"cl_typing <span class="free">𝒮</span> <span class="free">cl</span> <span class="skolem">tf'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> stab_typed_some_imp_cl_typed
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cl_typing <span class="free">𝒮</span> <span class="free">cl</span> <span class="free">tf</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_typing.simps cl_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="free">tf</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>6<span class="main">)</span> assms<span class="main">(</span>6<span class="main">,</span>7<span class="main">)</span> ts''a_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_call_indirect_None"><span class="command">lemma</span></span> types_preserved_call_indirect_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">,</span> <span class="main">$</span>Call_indirect <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Properties-types_preserved_callcl_native"><span class="command">lemma</span></span> types_preserved_callcl_native<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cl</span> <span class="main">=</span> Func_native <span class="free">i</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">tfs</span> <span class="free">es</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> <span class="main">$$*</span> <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">tfs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">t1s</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">t2s</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
          <span class="quoted"><span class="quoted">"n_zeros <span class="free">tfs</span> <span class="main">=</span> <span class="free">zs</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Local <span class="free">m</span> <span class="free">i</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> e_type_comp
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> ves_c<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> tvs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="skolem">tvs</span>"</span></span>
                                <span class="quoted"><span class="quoted">"length <span class="free">t1s</span> <span class="main">=</span> length <span class="skolem">tvs</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ves</span></span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="free">t1s</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">𝒞'</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="skolem">𝒞'</span><span class="main">)</span> <span class="main">@</span> <span class="free">t1s</span> <span class="main">@</span> <span class="free">tfs</span><span class="main">,</span> label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free">t2s</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="free">t2s</span><span class="main">⦈</span>  <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_callcl_native<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inst_typing <span class="free">𝒮</span> <span class="main">(</span>inst <span class="free">s</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> store_typing_imp_inst_length_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> store_typing_imp_inst_typing<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
          ts_c_def<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞''</span></span> <span class="keyword2"><span class="keyword">where</span></span> c''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞''</span> <span class="main">=</span> <span class="skolem">𝒞'</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="skolem">𝒞'</span><span class="main">)</span> <span class="main">@</span> <span class="free">t1s</span> <span class="main">@</span> <span class="free">tfs</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="free">t2s</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞''</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free">t2s</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞''</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>  <span class="main">=</span> <span class="skolem">𝒞'</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="skolem">𝒞'</span><span class="main">)</span> <span class="main">@</span> <span class="free">t1s</span> <span class="main">@</span> <span class="free">tfs</span><span class="main">,</span> label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free">t2s</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="free">t2s</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞''</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_c_def b_e_typing.block<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2s</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">es</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> t_eqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">ts_c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1s</span> <span class="main">=</span> <span class="skolem">tvs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tvs_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> ts_c_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tfs</span> <span class="main">=</span> map typeof <span class="free">zs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_zeros_typeof assms<span class="main">(</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1s</span> <span class="main">=</span> map typeof <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typing_map_typeof assms<span class="main">(</span>3<span class="main">)</span> tvs_def t_eqs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1s</span> <span class="main">@</span> <span class="free">tfs</span><span class="main">)</span> <span class="main">=</span> map typeof <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>Some <span class="free">t2s</span> <span class="main">⊩_</span><span class="free">i</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">es</span><span class="main">]</span><span class="main">)</span> <span class="main">:</span> <span class="free">t2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>8<span class="main">)</span> ts_c_def c''_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> ts_c_def t_eqs<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">,</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_callcl_host_some"><span class="command">lemma</span></span> types_preserved_callcl_host_some<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cl</span> <span class="main">=</span> Func_host <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">f</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> <span class="main">$$*</span> <span class="free">vcs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vcs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">t1s</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">t2s</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
          <span class="quoted"><span class="quoted">"host_apply <span class="free">s</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span> <span class="free">f</span> <span class="free">vcs</span> <span class="free">hs</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vcs'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">$$*</span> <span class="free">vcs'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="free">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> e_type_comp
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> ves_c<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> tvs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="skolem">tvs</span>"</span></span>
                                <span class="quoted"><span class="quoted">"length <span class="free">t1s</span> <span class="main">=</span> length <span class="skolem">tvs</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ves</span></span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="free">t1s</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="free">t2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_callcl_host<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="free">t1s</span> <span class="free">vcs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_imp_list_types_agree<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?ts'</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> tvs_def<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">$$*</span> <span class="free">vcs'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_types_agree_imp_e_typing host_apply_respect_type<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_imp_concat"><span class="command">lemma</span></span> types_imp_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tes</span> <span class="bound">tes'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tes</span> <span class="main">_&gt;</span> <span class="bound">tes'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tes</span> <span class="main">_&gt;</span> <span class="bound">tes'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">@</span> <span class="main">[</span><span class="free">e'</span><span class="main">]</span> <span class="main">@</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">es'</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">es'</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> e_type_comp_conc<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span>
                   e_type_comp_conc<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">@</span> <span class="main">[</span><span class="free">e'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-type_const_return"><span class="command">lemma</span></span> type_const_return<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">i</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>return <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tcs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">tcs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">LI</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tcs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">lholed</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quoted"><span class="free">𝒞'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">es'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LI</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">es'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">LI</span></span><span class="main">]</span> 0<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">es'</span></span><span class="main">]</span> 0<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_b_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts_b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_b</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts_b</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="free">tcs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>return <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tcs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0<span class="main">(</span>2<span class="main">)</span> b_e_type_return<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">𝒞</span></span><span class="main">]</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Return<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts_b</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tcs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts_b</span> <span class="main">=</span> <span class="skolem">ts''</span> <span class="main">@</span> <span class="skolem">tcs'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="skolem">tcs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tcs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_b_def<span class="main">(</span>1<span class="main">)</span> e_type_const_list 0<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 0<span class="main">(</span>3<span class="main">)</span> ts_c_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">les</span></span> <span class="skolem"><span class="skolem">les'</span></span> <span class="skolem"><span class="skolem">LK</span></span> <span class="keyword2"><span class="keyword">where</span></span> es_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">lholed</span> <span class="main">=</span> <span class="main">(</span>LRec <span class="skolem">vs'</span> <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">l</span> <span class="skolem">les'</span><span class="main">)</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"Lfilled <span class="skolem">i</span> <span class="skolem">l</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="skolem">LK</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"<span class="skolem">LI</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">LK</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">les'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">LI</span></span><span class="main">]</span> Suc<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">LK</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">LK</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">les'</span></span><span class="main">]</span> Suc<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span>
       <span class="quoted"><span class="quoted">"<span class="skolem">ts'''</span> <span class="main">=</span> <span class="skolem">ts''</span> <span class="main">@</span> <span class="skolem">t2s</span>"</span></span>
       <span class="quoted"><span class="quoted">"length <span class="skolem">tls</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">les</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tls</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">LK</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"return <span class="main">(</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tcs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">les</span></span> <span class="quoted"><span class="skolem">LK</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span> Suc<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> es_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_return"><span class="command">lemma</span></span> types_preserved_return<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vls</span> <span class="free">LI</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">ves</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">vls</span> <span class="free">LI</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">ves</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">ves</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">ves</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vls</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="skolem">tls</span><span class="main">⦈</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">LI</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">@</span> <span class="skolem">tls</span>"</span></span>
                        <span class="quoted"><span class="quoted">"length <span class="skolem">tls</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_local<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">ves</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> type_const_return<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ _ l_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3-5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span> l_def<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-type_const_br"><span class="command">lemma</span></span> type_const_br<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">i</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="free">tcs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">tcs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">LI</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tcs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">lholed</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quoted"><span class="free">𝒞'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">es'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LI</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">es'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">LI</span></span><span class="main">]</span> 0<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">es'</span></span><span class="main">]</span> 0<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_b_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts_b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_b</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts_b</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="free">tcs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">k</span> <span class="main">=</span> <span class="free">tcs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0<span class="main">(</span>3<span class="main">)</span> b_e_type_br<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Br <span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main">]</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Br <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts_b</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tcs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts_b</span> <span class="main">=</span> <span class="skolem">ts''</span> <span class="main">@</span> <span class="skolem">tcs'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="skolem">tcs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tcs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_b_def<span class="main">(</span>1<span class="main">)</span> e_type_const_list 0<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 0<span class="main">(</span>4<span class="main">)</span> ts_c_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="skolem">k</span> <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">lholed</span> <span class="skolem">𝒞</span> <span class="skolem">LI</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">les</span></span> <span class="skolem"><span class="skolem">les'</span></span> <span class="skolem"><span class="skolem">LK</span></span> <span class="keyword2"><span class="keyword">where</span></span> es_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">lholed</span> <span class="main">=</span> <span class="main">(</span>LRec <span class="skolem">vs'</span> <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">l</span> <span class="skolem">les'</span><span class="main">)</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"Lfilled <span class="skolem">i</span> <span class="skolem">l</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">LK</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"<span class="skolem">LI</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">LK</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">les'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">LI</span></span><span class="main">]</span> Suc<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">LK</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">LK</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">les'</span></span><span class="main">]</span> Suc<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lts</span></span> <span class="skolem"><span class="skolem">𝒞''</span></span> <span class="skolem"><span class="skolem">ts''''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞''</span> <span class="main">⊢</span> <span class="skolem">LK</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts''''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞''</span> <span class="main">=</span> <span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">lts</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                             <span class="quoted"><span class="quoted">"length <span class="main">(</span>label <span class="skolem">𝒞''</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="main">(</span>label <span class="skolem">𝒞''</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">tcs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">les</span></span> <span class="quoted"><span class="skolem">LK</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span> Suc<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span> es_def<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_br"><span class="command">lemma</span></span> types_preserved_br<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span>Label <span class="free">n</span> <span class="free">es0</span> <span class="free">LI</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">vs</span> <span class="main">@</span> <span class="free">es0</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="free">n</span> <span class="free">es0</span> <span class="free">LI</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"Lfilled <span class="free">i</span> <span class="free">lholed</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">es0</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="skolem">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es0</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tls</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                            <span class="quoted"><span class="quoted">"length <span class="main">(</span>label <span class="skolem">𝒞'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">(</span>label <span class="skolem">𝒞'</span><span class="main">)</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="skolem">tls</span>"</span></span>
                            <span class="quoted"><span class="quoted">"length <span class="skolem">tls</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="free">LI</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">es0</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-5<span class="main">)</span> type_const_br<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">lholed</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">LI</span></span> <span class="quoted"><span class="skolem">𝒞'</span></span> <span class="quoted"><span class="skolem">tls</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> l_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> e_type_comp_conc e_typing_s_typing.intros<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-store_local_label_empty"><span class="command">lemma</span></span> store_local_label_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"label <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">insts</span></span> <span class="keyword2"><span class="keyword">where</span></span> inst_typ<span class="main">:</span><span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span>inst_typing <span class="free">𝒮</span><span class="main">)</span> <span class="skolem">insts</span> <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"label <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> inst_typing.simps List.list_all2_conv_all_nth
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inst_typ
    <span class="keyword1"><span class="command">unfolding</span></span> inst_typing.simps List.list_all2_conv_all_nth
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_b_e1"><span class="command">lemma</span></span> types_preserved_b_e1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unop_i32 <span class="skolem">c</span> <span class="skolem">iop</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unop_i64 <span class="skolem">c</span> <span class="skolem">iop</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unop_f32 <span class="skolem">c</span> <span class="skolem">fop</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unop_f64 <span class="skolem">c</span> <span class="skolem">fop</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_i32_Some <span class="skolem">iop</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_i32_None <span class="skolem">iop</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_i64_Some <span class="skolem">iop</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_i64_None <span class="skolem">iop</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_f32_Some <span class="skolem">fop</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_f32_None <span class="skolem">fop</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_f64_Some <span class="skolem">fop</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_f64_None <span class="skolem">fop</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>testop_i32 <span class="skolem">c</span> <span class="skolem">testop</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>testop_i64 <span class="skolem">c</span> <span class="skolem">testop</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>relop_i32 <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">iop</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>relop_i64 <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">iop</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>relop_f32 <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">fop</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>relop_f64 <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">fop</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_binop_relop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>convert_Some <span class="skolem">t1</span> <span class="skolem">v</span> <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>convert_None <span class="skolem">t1</span> <span class="skolem">v</span> <span class="skolem">t2</span> <span class="skolem">sx</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>reinterpret <span class="skolem">t1</span> <span class="skolem">v</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_unop_testop_cvtop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> unreachable
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> nop
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Nop<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> nop b_e_typing.empty e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Nop<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>drop <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_drop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>select_false <span class="skolem">v1</span> <span class="skolem">v2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_select
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>select_true <span class="skolem">n</span> <span class="skolem">v1</span> <span class="skolem">v2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_select
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>block <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">m</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_block
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>loop <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">m</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_loop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_false <span class="skolem">tf</span> <span class="skolem">e1s</span> <span class="skolem">e2s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_if
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_true <span class="skolem">n</span> <span class="skolem">tf</span> <span class="skolem">e1s</span> <span class="skolem">e2s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_if
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label_const <span class="skolem">ts</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_label_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label_trap <span class="skolem">ts</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">lholed</span> <span class="skolem">LI</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_br
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_if_false <span class="skolem">n</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_br_if
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_if_true <span class="skolem">n</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_br_if
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_table <span class="skolem">is'</span> <span class="skolem">c</span> <span class="skolem">i'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_br_table
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_table_length <span class="skolem">is'</span> <span class="skolem">c</span> <span class="skolem">i'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_br_table
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>local_const <span class="skolem">i</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_local_const
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>local_trap <span class="skolem">i</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>return <span class="skolem">n</span> <span class="skolem">j</span> <span class="skolem">lholed</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">vls</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_return
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tee_local <span class="skolem">v</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> types_preserved_tee_local
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trap <span class="skolem">lholed</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_b_e"><span class="command">lemma</span></span> types_preserved_b_e<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es'</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> s_typing.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs</span></span> <span class="skolem"><span class="skolem">𝒞</span></span> <span class="keyword2"><span class="keyword">where</span></span> defs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tvs</span> <span class="main">=</span> map typeof <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tvs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> None<span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> s_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> defs<span class="main">(</span>3<span class="main">)</span> types_preserved_b_e1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> defs
    <span class="keyword1"><span class="command">unfolding</span></span> s_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_store"><span class="command">lemma</span></span> types_preserved_store<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">k</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span>Store <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"types_agree <span class="free">t</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">k</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Store <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_comp_conc2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">k</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Store <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> ConstInt32 <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">,</span> <span class="main">(</span>typeof <span class="free">v</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_def<span class="main">(</span>2<span class="main">)</span> b_e_type_value<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span> <span class="quoted"><span class="quoted">"types_agree <span class="free">t</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts_def<span class="main">(</span>3<span class="main">)</span> b_e_type_store<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Store <span class="free"><span class="free"><span class="free">t</span></span></span> <span class="free"><span class="free"><span class="free">tp</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="free"><span class="free"><span class="free">off</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts'''</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ts'</span></span></span></span></span></span><span class="main">]</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Store <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"types_agree <span class="free">t</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span>"</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_current_memory"><span class="command">lemma</span></span> types_preserved_current_memory<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Current_memory<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms b_e_type_current_memory unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Current_memory<span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"ConstInt32 <span class="free">c</span>"</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_grow_memory"><span class="command">lemma</span></span> types_preserved_grow_memory<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">,</span> <span class="main">$</span>Grow_memory<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> 
                             <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Grow_memory<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last.simps list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">C</span> ConstInt32 <span class="free">c</span>"</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">c</span><span class="main">]</span>"</span></span><span class="main">]</span> ts''_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ts''_def b_e_type_grow_memory<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="free">ts'</span></span><span class="main">]</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Grow_memory<span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">c'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
          b_e_typing.const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"ConstInt32 <span class="free">c'</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_set_global"><span class="command">lemma</span></span> types_preserved_set_global<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span>Set_global <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"tg_t <span class="main">(</span>global <span class="free">𝒞</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> typeof <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> 
                             <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Set_global <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last.simps list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span>typeof <span class="free">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span> <span class="quoted"><span class="quoted">"tg_t <span class="main">(</span>global <span class="free">𝒞</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> typeof <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_set_global ts''_def<span class="main">(</span>2<span class="main">)</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Set_global <span class="free">j</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tg_t <span class="main">(</span>global <span class="free">𝒞</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> typeof <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span>"</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_load"><span class="command">lemma</span></span> types_preserved_load<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">k</span><span class="main">,</span> <span class="main">$</span>Load <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="free">k</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> 
                             <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Load <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last.simps list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> ConstInt32 <span class="free">k</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"load_store_t_bounds <span class="free">a</span> <span class="main">(</span>option_projl <span class="free">tp</span><span class="main">)</span> <span class="free">t</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ts''_def<span class="main">(</span>2<span class="main">)</span> b_e_type_load unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Load <span class="free">t</span> <span class="free">tp</span> <span class="free">a</span> <span class="free">off</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_e_typing.const b_e_typing.weakening
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_get_local"><span class="command">lemma</span></span> types_preserved_get_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Get_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vi</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> map typeof <span class="main">(</span><span class="free">vi</span> <span class="main">@</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> typeof <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> append_Cons length_map list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> map_append nth_append_length<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span>typeof <span class="free">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Get_local <span class="free">i</span><span class="main">]</span>"</span></span><span class="main">]</span> b_e_type_get_local
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.const e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_set_local"><span class="command">lemma</span></span> types_preserved_set_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">,</span> <span class="main">$</span>Set_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">vi</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> map typeof <span class="main">(</span><span class="free">vi</span> <span class="main">@</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> map typeof <span class="main">(</span><span class="free">vi</span> <span class="main">@</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> map typeof <span class="main">(</span><span class="free">vi</span> <span class="main">@</span> <span class="main">[</span><span class="free">v'</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> v_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> typeof <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> append_Cons length_map list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> map_append nth_append_length<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> 
                             <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Set_local <span class="free">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last.simps list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span>typeof <span class="free">v'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_value unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="free">v'</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"typeof <span class="free">v</span> <span class="main">=</span> typeof <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_type b_e_type_set_local<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Set_local <span class="free"><span class="free">i</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts''</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ts'</span></span></span></span><span class="main">]</span> ts''_def<span class="main">(</span>2<span class="main">)</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Set_local <span class="free">i</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span>"</span></span><span class="main">]</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_get_global"><span class="command">lemma</span></span> types_preserved_get_global<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>sglob_val <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> tg_t <span class="main">(</span>global <span class="free">𝒞</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Get_global <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> sglob_val <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span><span class="main">@</span><span class="main">[</span>tg_t <span class="main">(</span>global <span class="free">𝒞</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_get_global assms<span class="main">(</span>2<span class="main">)</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Get_global <span class="free">j</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"sglob_val <span class="free">s</span> <span class="free">i</span> <span class="free">j</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-lholed_same_type"><span class="command">lemma</span></span> lholed_same_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">les</span>"</span></span>
          <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="free">es'</span> <span class="free">les'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">les</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">arb_labs</span> <span class="bound">ts</span> <span class="bound">ts'</span><span class="main">.</span>
           <span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_labs</span><span class="main">@</span><span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span>
             <span class="main">⟹</span> <span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span><span class="free">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_labs</span><span class="main">@</span><span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">les'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">es'</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">les'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span> <span class="skolem">es</span> <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">es''</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2 L0<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L0<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">es''</span> <span class="main">@</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> L0<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="skolem">es''</span></span> <span class="quoted"><span class="skolem">les'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">es</span> <span class="skolem">lfilledk</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">es'''</span> <span class="skolem">𝒞</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lfilledk'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l'_def<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">k</span> <span class="skolem">l</span> <span class="skolem">es'''</span> <span class="skolem">lfilledk'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">les'</span> <span class="main">=</span> <span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">es''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LN Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="skolem">es'''</span></span> <span class="quoted"><span class="skolem">les'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> lab_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">𝒞_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> int_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts'</span> <span class="main">@</span> <span class="skolem">ts_c</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"length <span class="skolem">tls</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tls</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="skolem">𝒞_int</span> <span class="main">=</span> <span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞_int</span> <span class="main">⊢</span> <span class="skolem">lfilledk</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">OF</span> lab_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">𝒞'</span> <span class="bound">arb_labs'</span> <span class="bound">ts</span> <span class="bound">ts'</span><span class="main">.</span>
        <span class="bound">𝒞'</span> <span class="main">=</span> <span class="skolem">𝒞_int</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_labs'</span> <span class="main">@</span> label <span class="skolem">𝒞_int</span><span class="main">⦈</span> <span class="main">⟹</span>
        <span class="free">𝒮</span><span class="main">∙</span><span class="bound">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="bound">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es'''</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒞''</span> <span class="skolem">arb_labs''</span> <span class="skolem">tts</span> <span class="skolem">tts'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞''</span> <span class="main">=</span> <span class="skolem">𝒞_int</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="skolem">arb_labs''</span> <span class="main">@</span> label <span class="skolem">𝒞_int</span><span class="main">⦈</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞''</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tts</span> <span class="main">_&gt;</span> <span class="skolem">tts'</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞''</span> <span class="main">⊢</span> <span class="skolem">es'''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tts</span> <span class="main">_&gt;</span> <span class="skolem">tts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">arb_labs''</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">tls</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">tts</span></span> <span class="quoted"><span class="skolem">tts'</span></span><span class="main">]</span> int_def<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞_int</span> <span class="main">⊢</span> <span class="skolem">lfilledk'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> l'_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> int_def<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> int_def e_typing_s_typing.intros<span class="main">(</span>3<span class="main">,</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lab_def e_type_comp_conc l'_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_e1"><span class="command">lemma</span></span> types_preserved_e1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tvs</span> <span class="main">=</span> map typeof <span class="free">vs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">@</span> <span class="free">tvs</span><span class="main">)</span><span class="main">,</span> label <span class="main">:=</span> <span class="free">arb_labs</span><span class="main">,</span> return <span class="main">:=</span> <span class="free">arb_return</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>map typeof <span class="free">vs</span> <span class="main">=</span> map typeof <span class="free">vs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">tvs</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">arb_labs</span></span> <span class="quoted"><span class="free">arb_return</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_b_e1<span class="main">[</span><span class="operator">OF</span> basic<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>call <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">tf1</span></span> <span class="skolem"><span class="skolem">tf2</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_func_t<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>func_t <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">j</span>"</span></span>
                                       <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">ts''</span><span class="main">@</span><span class="skolem">tf1</span>"</span></span>
                                       <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts''</span><span class="main">@</span><span class="skolem">tf2</span>"</span></span>
                                       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>func_t <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tf1</span> <span class="main">_&gt;</span> <span class="skolem">tf2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_call<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Call <span class="skolem"><span class="skolem">j</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">j</span></span></span></span><span class="main">]</span> call<span class="main">(</span>5<span class="main">)</span>
          unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Call <span class="skolem">j</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> call<span class="main">(</span>3<span class="main">)</span> store_typing_imp_inst_length_eq<span class="main">[</span><span class="operator">OF</span> call<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>func_t <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l_func_t<span class="main">(</span>1<span class="main">)</span> call<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl_typing <span class="free">𝒮</span> <span class="main">(</span>sfunc <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tf1</span> <span class="main">_&gt;</span> <span class="skolem">tf2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> store_typing_imp_func_agree<span class="main">[</span><span class="operator">OF</span> call<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> l_func_t<span class="main">(</span>4<span class="main">)</span> call<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">,</span>6<span class="main">)</span> l_func_t
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>call_indirect_Some <span class="skolem">s</span> <span class="skolem">i'</span> <span class="skolem">c</span> <span class="skolem">cl</span> <span class="skolem">j</span> <span class="skolem">tf</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_call_indirect_Some<span class="main">[</span><span class="operator">OF</span> call_indirect_Some<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          call_indirect_Some<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>call_indirect_None <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">c</span> <span class="skolem">cl</span> <span class="skolem">j</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_native <span class="skolem">cl</span> <span class="skolem">j</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span> <span class="skolem">es</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">k</span> <span class="skolem">m</span> <span class="skolem">zs</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_callcl_native
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_host_Some <span class="skolem">cl</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">f</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">hs</span> <span class="skolem">s'</span> <span class="skolem">vcs'</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_callcl_host_some
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_host_None <span class="skolem">cl</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">f</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">hs</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>get_local <span class="skolem">vi</span> <span class="skolem">j</span> <span class="skolem">s</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_all2_conv_all_nth store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local <span class="skolem">𝒞</span> <span class="main">=</span> <span class="skolem">tvs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> store_local_label_empty assms<span class="main">(</span>2<span class="main">)</span> get_local
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_get_local get_local
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>set_local <span class="skolem">vi</span> <span class="skolem">j</span> <span class="skolem">s</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">v'</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_all2_conv_all_nth store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"local <span class="skolem">𝒞</span> <span class="main">=</span> <span class="skolem">tvs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> store_local_label_empty assms<span class="main">(</span>2<span class="main">)</span> set_local
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> set_local types_preserved_set_local
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>get_global <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_get_global get_global<span class="main">(</span>5<span class="main">)</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Get_global <span class="skolem">j</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"glob_agree <span class="main">(</span>sglob <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_global<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> store_typing_imp_glob_agree<span class="main">[</span><span class="operator">OF</span> get_global<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> store_typing_imp_inst_length_eq<span class="main">[</span><span class="operator">OF</span> get_global<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"typeof <span class="main">(</span>g_val <span class="main">(</span>sglob <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> tg_t <span class="main">(</span>global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> glob_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> get_global<span class="main">(</span>5<span class="main">)</span> types_preserved_get_global
    <span class="keyword1"><span class="command">unfolding</span></span> glob_agree_def sglob_val_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>set_global <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">v</span> <span class="skolem">s'</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_set_global
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>load_Some <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">t</span> <span class="skolem">bs</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_load<span class="main">(</span>1<span class="main">)</span> wasm_deserialise_type
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>load_None <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">t</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>load_packed_Some <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">sx</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">tp</span> <span class="skolem">bs</span> <span class="skolem">vs</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_load<span class="main">(</span>1<span class="main">)</span> wasm_deserialise_type
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>load_packed_None <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">sx</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">tp</span> <span class="skolem">vs</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store_Some <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">mem'</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_store
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store_None <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store_packed_Some <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">tp</span> <span class="skolem">mem'</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_store
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store_packed_None <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="skolem">off</span> <span class="skolem">tp</span> <span class="skolem">vs</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>current_memory <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_current_memory
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>grow_memory <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">c</span> <span class="skolem">mem'</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_grow_memory
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>grow_memory_fail <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">vs</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_grow_memory
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒞'</span> <span class="skolem">arb_labs'</span> <span class="skolem">ts</span> <span class="skolem">ts'</span>
    <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="skolem">arb_labs'</span><span class="main">@</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> <span class="main">(</span>return <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> map typeof <span class="skolem">vs</span> <span class="main">=</span> map typeof <span class="skolem">vs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span> label<span class="main">(</span>8<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="skolem">arb_labs'</span><span class="main">@</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span>
               <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="skolem">arb_labs'</span><span class="main">@</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     map typeof <span class="skolem">vs</span> <span class="main">=</span> map typeof <span class="skolem">vs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local_assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">arb_labs'</span> <span class="bound">ts</span> <span class="bound">ts'</span><span class="main">.</span> <span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_labs'</span><span class="main">@</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span>
                              <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="bound">arb_labs'</span><span class="main">@</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="bound">ts</span> <span class="main">_&gt;</span> <span class="bound">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"map typeof <span class="skolem">vs</span> <span class="main">=</span> map typeof <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> types_exist_lfilled<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lholed_same_type<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>local <span class="skolem">s</span> <span class="skolem">vls</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="keyword2"><span class="keyword">where</span></span> es_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"length <span class="skolem">tls</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⦇</span>local <span class="main">:=</span> local<span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">@</span> map typeof <span class="skolem">vls</span><span class="main">,</span> label <span class="main">:=</span> label <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="skolem">tls</span><span class="main">⦈</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">tls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_local<span class="main">[</span><span class="operator">OF</span> local<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts</span><span class="main">@</span><span class="skolem">ts''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span>Some <span class="skolem">ts''</span><span class="main">)</span> <span class="main">⊩_</span><span class="skolem">i</span> <span class="skolem">vls</span><span class="main">;</span><span class="skolem">es</span> <span class="main">:</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_local_shallow local<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inst_typing <span class="free">𝒮</span> <span class="main">(</span><span class="main">(</span>inst <span class="skolem">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local es_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> store_typing.simps list_all2_conv_all_nth
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tls</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"map typeof <span class="skolem">vls</span> <span class="main">=</span> map typeof <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> local<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ _ _ es_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"map typeof <span class="skolem">vls</span>"</span></span> <span class="quoted"><span class="quoted">"Some <span class="skolem">tls</span>"</span></span> <span class="quoted"><span class="quoted">"label <span class="main">(</span>s_inst <span class="free">𝒮</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="main">(</span>Some <span class="skolem">tls</span><span class="main">)</span> <span class="main">⊩_</span> <span class="skolem">i</span> <span class="skolem">vs'</span><span class="main">;</span><span class="skolem">es'</span> <span class="main">:</span> <span class="skolem">tls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>8<span class="main">)</span> es_def<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> e_typing_s_typing.intros<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> es_def<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-types_preserved_e"><span class="command">lemma</span></span> types_preserved_e<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs'</span><span class="main">;</span><span class="free">es'</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> s_typing.cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> i_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>inst <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_all2_conv_all_nth store_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tvs</span></span> <span class="skolem"><span class="skolem">𝒞</span></span> <span class="keyword2"><span class="keyword">where</span></span> defs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tvs</span> <span class="main">=</span> map typeof <span class="free">vs</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tvs</span><span class="main">)</span><span class="main">,</span> label <span class="main">:=</span> <span class="main">(</span>label <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> None<span class="main">⦈</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> s_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">es'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>map typeof <span class="free">vs</span> <span class="main">=</span> map typeof <span class="free">vs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> types_preserved_e1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> defs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i_bound defs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> defs
    <span class="keyword1"><span class="command">unfolding</span></span> s_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Progress›</span></span>

<span class="keyword1" id="Wasm_Properties-const_list_no_progress"><span class="command">lemma</span></span> const_list_no_progress<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trap <span class="skolem">es</span> <span class="skolem">lholed</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> trap<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> trap<span class="main">(</span>3<span class="main">)</span> list_all_append const_list_cons_last<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted">Trap</span><span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_list_cons_last<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_const_def const_list_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> list_all_append
          <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_list_cons_last<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_const_def const_list_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-empty_no_progress"><span class="command">lemma</span></span> empty_no_progress<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trap <span class="skolem">es</span> <span class="skolem">lholed</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Trap<span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">es</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="skolem">es</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1" id="Wasm_Properties-trap_no_progress"><span class="command">lemma</span></span> trap_no_progress<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> L0<span class="main">(</span>2<span class="main">)</span> label<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> empty_no_progress
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons_eq_append_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k'</span> <span class="skolem">lfilledk</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>2<span class="main">)</span> label<span class="main">(</span>5<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons_eq_append_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-terminal_no_progress"><span class="command">lemma</span></span> terminal_no_progress<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span> <span class="main">∨</span> <span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> const_list_no_progress trap_no_progress assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Properties-progress_L0"><span class="command">lemma</span></span> progress_L0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="free">es</span><span class="main">@</span><span class="free">es_c</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="free">es'</span><span class="main">@</span><span class="free">es_c</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span><span class="main">.</span> Lfilled <span class="main">0</span> <span class="main">(</span>LBase <span class="free">cs</span> <span class="free">es_c</span><span class="main">)</span> <span class="bound">es</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="bound">es</span><span class="main">@</span><span class="free">es_c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cs</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LBase <span class="free">cs</span> <span class="free">es_c</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">es_c</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>23<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_L0_left"><span class="command">lemma</span></span> progress_L0_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms progress_L0<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?es_c</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Properties-progress_L0_trap"><span class="command">lemma</span></span> progress_L0_trap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">es</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">@</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">@</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main">@</span> <span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_eq_Cons_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> reduce_simple.trap
          Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_LN"><span class="command">lemma</span></span> progress_LN<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="free">tvs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span> <span class="bound">vs</span> <span class="bound">𝒞'</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="free">j</span> <span class="bound">lholed'</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="free">es</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="bound">𝒞'</span> <span class="main">⊢</span> <span class="bound">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> const_list <span class="bound">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">k</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="free">tvs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_br<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">𝒞</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Br <span class="skolem"><span class="skolem">k</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ts''</span></span></span></span><span class="main">]</span> L0<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> ts_def<span class="main">(</span>2<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs2</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_c</span> <span class="main">_&gt;</span> <span class="main">(</span><span class="skolem">ts_c</span><span class="main">@</span><span class="free">tvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs1</span><span class="main">@</span><span class="skolem">vs2</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs1</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ts_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs2</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> vs_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">es'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Br <span class="skolem">k</span><span class="main">]</span>"</span></span><span class="main">]</span> vs_def<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">j</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t2s</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="skolem"><span class="skolem">ts_l</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_l_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">ts'</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">lfilledk</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">OF</span> ts_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> lfilledk_def<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">j</span> <span class="skolem">lholed'</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">lfilledk</span>"</span></span>
                                          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span>"</span></span>
                                          <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ ts_l_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> LN<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ lfilledk_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_LN_return"><span class="command">lemma</span></span> progress_LN_return<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>return <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tvs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span> <span class="bound">vs</span> <span class="bound">𝒞'</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="free">j</span> <span class="bound">lholed'</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="free">es</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="bound">𝒞'</span> <span class="main">⊢</span> <span class="bound">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> const_list <span class="bound">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Return<span class="main">]</span>"</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="free">tvs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_return<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"Return"</span></span> <span class="quoted"><span class="skolem">ts'</span></span> <span class="quoted"><span class="skolem">ts''</span></span><span class="main">]</span> L0<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> ts_def<span class="main">(</span>2<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs2</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_c</span> <span class="main">_&gt;</span> <span class="main">(</span><span class="skolem">ts_c</span><span class="main">@</span><span class="free">tvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs1</span><span class="main">@</span><span class="skolem">vs2</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs1</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ts_def<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs2</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> vs_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">es'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Return<span class="main">]</span>"</span></span><span class="main">]</span> vs_def<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">j</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t2s</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="skolem"><span class="skolem">ts_l</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_l_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">ts'</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">lfilledk</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">OF</span> ts_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> lfilledk_def<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">j</span> <span class="skolem">lholed'</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="skolem">lfilledk</span>"</span></span>
                                          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">tvs</span><span class="main">)</span>"</span></span>
                                          <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ts_l_def<span class="main">]</span> LN<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ lfilledk_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_LN1"><span class="command">lemma</span></span> progress_LN1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>label <span class="free">𝒞</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">k</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'''</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es'</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts'''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_br<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Br <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="skolem">ts''</span></span> <span class="quoted"><span class="skolem">ts'''</span></span><span class="main">]</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k'</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts</span> <span class="main">_&gt;</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">lfilledk</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es''</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t2s</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="skolem"><span class="skolem">ts_l</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_l_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">ts''</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="skolem">lfilledk</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_label<span class="main">[</span><span class="operator">OF</span> ts_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="skolem">k</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_LN2"><span class="command">lemma</span></span> progress_LN2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="free">e1s</span> <span class="free">lfilled</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lfilled'</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="free">e2s</span> <span class="bound">lfilled'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">es</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-const_of_const_list"><span class="command">lemma</span></span> const_of_const_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="bound">v</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_type_const_unwrap assms
  <span class="keyword1"><span class="command">unfolding</span></span> const_list_def list_all_length
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id append_self_conv2 gr_zeroI last_conv_nth length_butlast
            length_greater_0_conv less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> zero_less_diff<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties-const_of_i32"><span class="command">lemma</span></span> const_of_i32<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list assms<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">=</span> ConstInt32 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>T_i32<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-const_of_i64"><span class="command">lemma</span></span> const_of_i64<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>T_i64<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt64 <span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list assms<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>T_i64<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">=</span> ConstInt64 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>T_i64<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-const_of_f32"><span class="command">lemma</span></span> const_of_f32<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_f32<span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat32 <span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list assms<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_f32<span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">=</span> ConstFloat32 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_f32<span class="main">]</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-const_of_f64"><span class="command">lemma</span></span> const_of_f64<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_f64<span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat64 <span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list assms<span class="main">(</span>1<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_f64<span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> unlift_b_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">=</span> ConstFloat64 <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_f64<span class="main">]</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> typeof_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_unop_testop_i"><span class="command">lemma</span></span> progress_unop_testop_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"is_int_t <span class="free">t</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Unop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Testop <span class="free">t</span> <span class="free">testop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">[</span><span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> T_i32
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>  const_of_i32<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span>
          reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> T_i64
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i64<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span>
          reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_int_t_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties-progress_unop_f"><span class="command">lemma</span></span> progress_unop_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"is_float_t <span class="free">t</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Unop_f <span class="free">t</span> <span class="free">iop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">[</span><span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> T_f32
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>  const_of_f32<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span>
          reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> T_f64
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_f64<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span>
          reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_float_t_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties-const_list_split_2"><span class="command">lemma</span></span> const_list_split_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span> <span class="free">t2</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t2</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">c1</span><span class="main">,</span> <span class="bound">c2</span><span class="main">]</span>
                 <span class="main">∧</span> const_list <span class="main">[</span><span class="bound">c1</span><span class="main">]</span>
                 <span class="main">∧</span> const_list <span class="main">[</span><span class="bound">c2</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> l_cs<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_const_conv_vs typing_map_typeof
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">c2</span></span><span class="main">]</span> e_type_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c2</span></span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-const_list_split_3"><span class="command">lemma</span></span> const_list_split_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span> <span class="free">t2</span><span class="main">,</span> <span class="free">t3</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">c3</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t2</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="bound">c3</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">c1</span><span class="main">,</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">c3</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> l_cs<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_const_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span><span class="main">!</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">c3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c3</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_const_conv_vs typing_map_typeof
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_type_comp_conc2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c3</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">t3</span><span class="main">]</span>"</span></span><span class="main">]</span>
          e_type_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c1</span></span><span class="main">]</span> e_type_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c2</span></span><span class="main">]</span> e_type_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c3</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_binop_relop_i"><span class="command">lemma</span></span> progress_binop_relop_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">,</span> <span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"is_int_t <span class="free">t</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">[</span><span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>T_i32<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="bound">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="bound">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_split_2<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> const_of_i32
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c2</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_i <span class="free">iop</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_i32 True append_Cons append_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_i32 True append_Cons append_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple.intros<span class="main">(</span>15<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> cs_def T_i32
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>T_i64<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt64 <span class="bound">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstInt64 <span class="bound">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_split_2<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> const_of_i64
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt64 <span class="skolem">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstInt64 <span class="skolem">c2</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_i <span class="free">iop</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_i64 True append_Cons append_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_i64 True append_Cons append_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple.intros<span class="main">(</span>16<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> cs_def T_i64
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_int_t_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties-progress_binop_relop_f"><span class="command">lemma</span></span> progress_binop_relop_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="free">t</span><span class="main">,</span> <span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"is_float_t <span class="free">t</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">[</span><span class="main">$</span><span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> T_f32
  <span class="keyword1"><span class="command">hence</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat32 <span class="bound">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat32 <span class="bound">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_split_2<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> const_of_f32
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat32 <span class="skolem">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat32 <span class="skolem">c2</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_f <span class="free">fop</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_f32 True append_Cons append_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_f32 True append_Cons append_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple.intros<span class="main">(</span>17<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> cs_def T_f32
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> T_f64
  <span class="keyword1"><span class="command">hence</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat64 <span class="bound">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat64 <span class="bound">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_split_2<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> const_of_f64
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat64 <span class="skolem">c1</span><span class="main">,</span><span class="main">$</span><span class="keyword1">C</span> ConstFloat64 <span class="skolem">c2</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_f <span class="free">fop</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_f64 True append_Cons append_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T_f64 True append_Cons append_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce_simple.intros<span class="main">(</span>18<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> cs_def T_f64
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_float_t_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Properties-progress_b_e"><span class="command">lemma</span></span> progress_b_e<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">b_es</span> <span class="main">:</span> <span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>Lfilled <span class="main">0</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span><span class="free">b_es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>Lfilled <span class="main">0</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span><span class="free">b_es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"const_list <span class="free">cs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="main">(</span><span class="main">$*</span> <span class="free">b_es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="main">(</span>local <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>memory <span class="free">𝒞</span><span class="main">)</span> <span class="main">=</span> Option.is_none <span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span><span class="free">b_es</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b_es</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const <span class="skolem">𝒞</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unop_i <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">uu</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_unop_testop_i<span class="main">[</span><span class="operator">OF</span> unop_i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unop_f <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">uv</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_unop_f<span class="main">[</span><span class="operator">OF</span> unop_f<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_i <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">uw</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_binop_relop_i<span class="main">[</span><span class="operator">OF</span> binop_i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binop_f <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">ux</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_binop_relop_f<span class="main">[</span><span class="operator">OF</span> binop_f<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>testop <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">uy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_unop_testop_i<span class="main">[</span><span class="operator">OF</span> testop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>relop_i <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">uz</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_binop_relop_i<span class="main">[</span><span class="operator">OF</span> relop_i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>relop_f <span class="skolem">t</span> <span class="skolem">𝒞</span> <span class="skolem">va</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_binop_relop_f<span class="main">[</span><span class="operator">OF</span> relop_f<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>convert <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"typeof <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_typeof const_of_const_list<span class="main">[</span><span class="operator">OF</span> _ convert<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> convert<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cvt <span class="skolem">t1</span> <span class="skolem">sx</span> <span class="skolem">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.convert_None<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ None<span class="main"><span class="main">]</span></span><span class="main">]</span> cs_def
      <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.convert_Some<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Some<span class="main"><span class="main">]</span></span><span class="main">]</span> cs_def
      <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>reinterpret <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"typeof <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_typeof const_of_const_list<span class="main">[</span><span class="operator">OF</span> _ reinterpret<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> reinterpret<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.reinterpret<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unreachable <span class="skolem">𝒞</span> <span class="skolem">ts</span> <span class="skolem">ts'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.unreachable<span class="main">]</span> progress_L0<span class="main">[</span><span class="operator">OF</span> _ unreachable<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nop <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.nop<span class="main">]</span> progress_L0<span class="main">[</span><span class="operator">OF</span> _ nop<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>drop <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list drop<span class="main">(</span>4<span class="main">)</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> drop<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.drop<span class="main">]</span> progress_L0<span class="main">[</span><span class="operator">OF</span> _ drop<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>select <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v3</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
                               <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v2</span><span class="main">,</span> <span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v3</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_split_3<span class="main">[</span><span class="operator">OF</span> select<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> select<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_all_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> e_type_const_unwrap<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> ConstInt32 <span class="skolem">c3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cs_def select<span class="main">(</span>4<span class="main">)</span> const_of_i32<span class="main">[</span><span class="operator">OF</span> _ cs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v1</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v2</span><span class="main">,</span> <span class="main">$</span> <span class="keyword1">C</span> ConstInt32 <span class="skolem">c3</span><span class="main">,</span> <span class="main">$</span>Select<span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">c3</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.select_false<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.select_true<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def cs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>block <span class="skolem">tf</span> <span class="skolem">tn</span> <span class="skolem">tm</span> <span class="skolem">𝒞</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple.block<span class="main">[</span><span class="operator">OF</span> block<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">tn</span></span> <span class="quoted"><span class="skolem">tm</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">es</span></span><span class="main">]</span>
          e_type_const_list<span class="main">[</span><span class="operator">OF</span> block<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> block<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>loop <span class="skolem">tf</span> <span class="skolem">tn</span> <span class="skolem">tm</span> <span class="skolem">𝒞</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple.loop<span class="main">[</span><span class="operator">OF</span> loop<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">tn</span></span> <span class="quoted"><span class="skolem">tm</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">es</span></span><span class="main">]</span>
          e_type_const_list<span class="main">[</span><span class="operator">OF</span> loop<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> loop<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_wasm <span class="skolem">tf</span> <span class="skolem">tn</span> <span class="skolem">tm</span> <span class="skolem">𝒞</span> <span class="skolem">es1</span> <span class="skolem">es2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1s</span></span> <span class="skolem"><span class="skolem">c2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">c1s</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">tn</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">c2s</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">c1s</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">c2s</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">c1s</span> <span class="main">@</span> <span class="skolem">c2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> if_wasm<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2s</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="skolem">c</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i32 cs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span> <span class="main">(</span>ConstInt32 <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="main">$</span> If <span class="skolem">tf</span> <span class="skolem">es1</span> <span class="skolem">es2</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">c</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.if_false<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.if_true<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def cs_def progress_L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br <span class="skolem">i</span> <span class="skolem">𝒞</span> <span class="skolem">ts</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> br<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_if <span class="skolem">j</span> <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs1</span></span> <span class="skolem"><span class="skolem">cs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs2</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs1</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs2</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">cs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> br_if<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs2</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i32<span class="main">[</span><span class="operator">OF</span> cs_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="skolem">cs2</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span> <span class="main">[</span>Br_if <span class="skolem">j</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">c</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c_def reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.br_if_false<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c_def reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.br_if_true<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cs_def<span class="main">(</span>5<span class="main">)</span> progress_L0<span class="main">[</span><span class="operator">OF</span> _ cs_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="main">[</span>Br_if <span class="skolem">j</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_table <span class="skolem">𝒞</span> <span class="skolem">ts</span> <span class="quoted">"<span class="skolem">is</span>"</span> <span class="skolem">i'</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs1</span></span> <span class="skolem"><span class="skolem">cs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span><span class="main">_&gt;</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">@</span> <span class="skolem">ts</span><span class="main">)</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs2</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs1</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs2</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">cs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> br_table<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1s</span> <span class="main">@</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>T_i32<span class="main">]</span>"</span></span><span class="main">]</span>
          e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1s</span> <span class="main">@</span> <span class="skolem">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1s</span> <span class="main">@</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span>"</span></span><span class="main">]</span>
          br_table<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs2</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i32<span class="main">[</span><span class="operator">OF</span> cs_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">,</span> <span class="main">$</span>Br_table <span class="skolem">is</span> <span class="skolem">i'</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">is</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.br_table<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">is</span> <span class="main">≤</span> nat_of_int <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.br_table_length<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def cs_def progress_L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>return <span class="skolem">𝒞</span> <span class="skolem">ts</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> return<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Return<span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>call <span class="skolem">j</span> <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> call<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>call_indirect <span class="skolem">j</span> <span class="skolem">𝒞</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs1</span></span> <span class="skolem"><span class="skolem">cs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span><span class="main">_&gt;</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs2</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs1</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs2</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">cs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> call_indirect<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">t1s</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>T_i32<span class="main">]</span>"</span></span><span class="main">]</span>
          e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">t1s</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1s</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span>"</span></span><span class="main">]</span>
          call_indirect<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs2</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cs_def<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> const_of_i32
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">consider</span></span> 
    <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cl</span> <span class="bound">tf</span><span class="main">.</span> stab <span class="free">s</span> <span class="free">i</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">cl</span> <span class="main">∧</span> stypes <span class="free">s</span> <span class="free">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="bound">tf</span> <span class="main">∧</span> cl_type <span class="bound">cl</span> <span class="main">=</span> <span class="bound">tf</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cl</span><span class="main">.</span> stab <span class="free">s</span> <span class="free">i</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">cl</span> <span class="main">∧</span> stypes <span class="free">s</span> <span class="free">i</span> <span class="skolem">j</span> <span class="main">≠</span> cl_type <span class="bound">cl</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">,</span> <span class="main">$</span>Call_indirect <span class="skolem">j</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def cs_def progress_L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>get_local <span class="skolem">j</span> <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">vj</span></span> <span class="skolem"><span class="skolem">vj'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vj</span> <span class="main">=</span> <span class="main">(</span>take <span class="skolem">j</span> <span class="free">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vj'</span> <span class="main">=</span> <span class="main">(</span>drop <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> j_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_local<span class="main">(</span>1<span class="main">,</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> vj_len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">vj</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">vj</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">vj'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_def id_take_nth_drop j_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> vj_len<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">vj'</span></span><span class="main"><span class="main">]</span></span> get_local<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>set_local <span class="skolem">j</span> <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">vj</span></span> <span class="skolem"><span class="skolem">vj'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vj</span> <span class="main">=</span> <span class="main">(</span>take <span class="skolem">j</span> <span class="free">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vj'</span> <span class="main">=</span> <span class="main">(</span>drop <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list set_local<span class="main">(</span>3<span class="main">,</span>6<span class="main">)</span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> j_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_local<span class="main">(</span>1<span class="main">,</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> vj_len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">vj</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">vj</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">vj'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_def id_take_nth_drop j_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>9<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> vj_len<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">vj'</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> cs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tee_local <span class="skolem">i</span> <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list tee_local<span class="main">(</span>3<span class="main">,</span>6<span class="main">)</span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.tee_local<span class="main">]</span> tee_local<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>get_global <span class="skolem">j</span> <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>10<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> progress_L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>set_global <span class="skolem">j</span> <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_const_list set_global<span class="main">(</span>4<span class="main">,</span>7<span class="main">)</span> e_type_const_list
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>11<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="main">_</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>load <span class="skolem">𝒞</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">tp_sx</span> <span class="skolem">t</span> <span class="skolem">off</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i32 load<span class="main">(</span>3<span class="main">,</span>6<span class="main">)</span> e_type_const_unwrap
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem_some<span class="main">:</span><span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> load<span class="main">(</span>1<span class="main">,</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> smem_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a'</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">,</span> <span class="main">$</span>Load <span class="skolem">t</span> <span class="skolem">tp_sx</span> <span class="skolem">a</span> <span class="skolem">off</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp_sx</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">note</span></span> tp_none <span class="main">=</span> None
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"load <span class="main">(</span><span class="main">(</span>mem <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="skolem">off</span> <span class="main">(</span>t_length <span class="skolem">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>13<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem_some _ None<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> tp_none load<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>12<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem_some _ Some<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> tp_none load<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tp</span></span> <span class="skolem"><span class="skolem">sx</span></span> <span class="keyword2"><span class="keyword">where</span></span> tp_some<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tp_sx</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">tp</span><span class="main">,</span> <span class="skolem">sx</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Some
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"load_packed <span class="skolem">sx</span> <span class="main">(</span><span class="main">(</span>mem <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="skolem">off</span> <span class="main">(</span>tp_length <span class="skolem">tp</span><span class="main">)</span> <span class="main">(</span>t_length <span class="skolem">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem_some _ None<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> tp_some load<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>14<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem_some _ Some<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> tp_some load<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def progress_L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>store <span class="skolem">𝒞</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">tp</span> <span class="skolem">t</span> <span class="skolem">off</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs'</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">cs'</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">cs'</span><span class="main">,</span><span class="main">$</span> <span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_list_split_2<span class="main">[</span><span class="operator">OF</span> store<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_const_unwrap
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> t_def<span class="main">:</span><span class="quoted"><span class="quoted">"typeof <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cs_def<span class="main">(</span>2<span class="main">)</span> b_e_type_value<span class="main">[</span><span class="operator">OF</span> unlift_b_e<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem_some<span class="main">:</span><span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> store<span class="main">(</span>1<span class="main">,</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> smem_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs'</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i32<span class="main">[</span><span class="operator">OF</span> _ cs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> cs_def<span class="main">(</span>3<span class="main">)</span> store<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a'</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">,</span> <span class="main">$</span>Store <span class="skolem">t</span> <span class="skolem">tp</span> <span class="skolem">a</span> <span class="skolem">off</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">note</span></span> tp_none <span class="main">=</span> None
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"store <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="skolem">off</span> <span class="main">(</span>bits <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>t_length <span class="skolem">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>17<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ mem_some _ None<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> t_def tp_none store<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>16<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ mem_some _ Some<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> t_def tp_none store<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> tp_some <span class="main">=</span> Some
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"store_packed <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span> <span class="skolem">off</span> <span class="main">(</span>bits <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>tp_length <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>19<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ mem_some _ None<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> t_def tp_some store<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>18<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ mem_some _ Some<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> t_def tp_some store<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> types_agree_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def cs_def progress_L0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>current_memory <span class="skolem">𝒞</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem_some<span class="main">:</span><span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> current_memory<span class="main">(</span>1<span class="main">,</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> smem_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>20<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> mem_some<span class="main"><span class="main">]</span></span> current_memory<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>grow_memory <span class="skolem">𝒞</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_of_i32 grow_memory<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem_some<span class="main">:</span><span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> grow_memory<span class="main">(</span>1<span class="main">,</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> smem_ind_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>22<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem_some<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span><span class="main">]</span> c_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>empty <span class="skolem">𝒞</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>composition <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="main">(</span><span class="main">$*</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="main">0</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="main">0</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lholed</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">0</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="main">0</span> <span class="bound">lholed'</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span><span class="main">@</span> <span class="main">(</span><span class="main">$*</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Return<span class="main">]</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc map_append<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">lholed</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">0</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="main">0</span> <span class="bound">lholed'</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span><span class="main">@</span> <span class="main">(</span><span class="main">$*</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc map_append<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>7<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> composition<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ _ composition<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> 1 composition<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">,</span></span>12<span class="main"><span class="main">)</span></span><span class="main">]</span> progress_L0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$*</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>8<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>5<span class="main">)</span> e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> composition<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_comp_conc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> composition<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 2<span class="main">(</span>2<span class="main">)</span> composition<span class="main">(</span>6<span class="main">,</span>7<span class="main">)</span> composition<span class="main">(</span>10-<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>weakening <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs1</span></span> <span class="skolem"><span class="skolem">cs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs2</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">cs2</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs1</span>"</span></span>
                              <span class="quoted"><span class="quoted">"const_list <span class="skolem">cs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> weakening<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">@</span> <span class="skolem">t1s</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="main">0</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="main">0</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lholed</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">0</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="main">0</span> <span class="bound">lholed'</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">vs</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Return<span class="main">]</span>"</span></span><span class="main">]</span> cs_def<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> weakening<span class="main">(</span>4<span class="main">)</span> cs_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">lholed</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">0</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="main">0</span> <span class="bound">lholed'</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs1</span> <span class="main">@</span> <span class="skolem">vs</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span>"</span></span><span class="main">]</span> cs_def<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> weakening<span class="main">(</span>5<span class="main">)</span> cs_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="skolem">cs2</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span><span class="skolem">es</span><span class="main">)</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> weakening<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cs_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ _ cs_def<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> weakening<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span> weakening<span class="main">(</span>8-<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> _ cs_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs2</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> cs_def<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_e"><span class="command">lemma</span></span> progress_e<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span> <span class="main">:</span> <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">cs_es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">]</span> <span class="free">cs_es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cs_es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="main">(</span><span class="free">cs_es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒞</span> <span class="skolem">cs</span> <span class="skolem">es</span> <span class="skolem">ts_c</span>
  <span class="keyword1"><span class="command">have</span></span> prems1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_c</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">cs_es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">cs_es</span> <span class="main">=</span> <span class="skolem">cs</span><span class="main">@</span><span class="skolem">es</span> <span class="main">⟹</span>
       const_list <span class="skolem">cs</span> <span class="main">⟹</span>
       <span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⋀</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">cs_es</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">]</span> <span class="free">cs_es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">cs_es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main">⟹</span>
       <span class="main">¬</span> const_list <span class="main">(</span><span class="free">cs_es</span><span class="main">)</span> <span class="main">⟹</span>
       store_typing <span class="free">s</span> <span class="free">𝒮</span> <span class="main">⟹</span>
       <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span> <span class="main">⟹</span>
       length <span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>memory <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">=</span> Option.is_none <span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span>
         <span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">cs_es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">cs_es'</span><span class="main">⦈</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> prems2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span> <span class="main">:</span> <span class="free">ts'</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⋀</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">cs_es</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">]</span> <span class="free">cs_es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">cs_es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main">⟹</span>
       <span class="main">¬</span> const_list <span class="main">(</span><span class="free">cs_es</span><span class="main">)</span> <span class="main">⟹</span>
       store_typing <span class="free">s</span> <span class="free">𝒮</span> <span class="main">⟹</span>
         <span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">cs_es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">cs_es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="skolem">ts_c</span></span> <span class="quoted"><span class="free">ts'</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">cs_es</span></span> <span class="quoted"><span class="skolem">cs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> e_typing_s_typing.inducts<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">b_es</span> <span class="skolem">tf</span> <span class="skolem">𝒮</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">b_es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_c</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">cs</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$*</span> <span class="skolem">b_es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span>"</span></span><span class="main">]</span> unlift_b_e
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_type_const_conv_vs typing_map_typeof<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> progress_b_e<span class="main">[</span><span class="operator">OF</span> _ 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ _ 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> 1<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> list_all_append 1
      <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"const_list <span class="skolem">es</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>7<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">ts''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc e_type_comp_conc1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ _ _ 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">,</span></span>12<span class="main"><span class="main">,</span></span>13<span class="main"><span class="main">,</span></span>14<span class="main"><span class="main">,</span></span>15<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">es</span><span class="main">)</span>"</span></span><span class="main">]</span> 2<span class="main">(</span>6<span class="main">,</span>16<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">ts''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc e_type_comp_conc1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span> Lfilled <span class="skolem">k</span> <span class="bound">lholed'</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lholed'</span> <span class="main">=</span> LBase <span class="skolem">vs</span> <span class="main">(</span><span class="skolem">es'</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> L0
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Lfilled.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append.assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">ts</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lholed'</span> <span class="main">=</span> LRec <span class="skolem">vs</span> <span class="skolem">ts</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">es''</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> LN
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Lfilled.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append.assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>6<span class="main">,</span>9<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span>  Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span>  Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lholed'</span><span class="main">.</span>  Lfilled <span class="skolem">k</span> <span class="bound">lholed'</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lholed'</span> <span class="main">=</span> LBase <span class="skolem">vs</span> <span class="main">(</span><span class="skolem">es'</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> L0 local_assms<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Lfilled.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append.assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">ts</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lholed'</span> <span class="main">=</span> LRec <span class="skolem">vs</span> <span class="skolem">ts</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">es''</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> LN local_assms<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Lfilled.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append.assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>6<span class="main">,</span>10<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span>  Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> preds <span class="main">=</span> calculation
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> reduce_simple.trap<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">]</span>
                Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"LBase <span class="main">[]</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span>"</span></span><span class="main">]</span>
                reduce.intros<span class="main">(</span>1<span class="main">)</span> 2<span class="main">(</span>6<span class="main">,</span>11<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc append_Nil list.pred_inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ _ 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">)</span></span> _ _ _ _  2<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">,</span></span>14<span class="main"><span class="main">,</span></span>15<span class="main"><span class="main">)</span></span><span class="main">]</span> preds 2<span class="main">(</span>6<span class="main">,</span>16<span class="main">)</span>
                progress_L0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc append_Nil list.pred_inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cs_es_def<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="main">0</span> <span class="main">(</span>LBase <span class="skolem">cs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="skolem">cs_es</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main">]</span> 4<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reduce_simple.trap<span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> cs_es_def<span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">𝒮</span> <span class="skolem">ts</span> <span class="skolem">j</span> <span class="skolem">vls</span> <span class="skolem">es</span> <span class="skolem">n</span> <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">lholed</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="skolem">es</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="skolem">es</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"const_list <span class="skolem">es</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_le_imp_less
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vls</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">j</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs''</span><span class="main">;</span><span class="skolem">a</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> 5<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main">]</span> 1<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>24<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> temp1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> progress_L0<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?cs</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">,</span> <span class="operator">OF</span> _ 5<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> 5<span class="main">(</span>5<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> lholed'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed'</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
                                                   <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
                                                   <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_LN_return<span class="main">[</span><span class="operator">OF</span> local_assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">𝒮</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">ts</span></span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> s_type_unfold<span class="main">[</span><span class="operator">OF</span> 5<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="main">[</span>Local <span class="skolem">n</span> <span class="skolem">j</span> <span class="skolem">vls</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="skolem">vs'</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce_simple.return<span class="main">[</span><span class="operator">OF</span> lholed'_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
              e_type_const_list<span class="main">[</span><span class="operator">OF</span> lholed'_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 5<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> temp1 progress_L0<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 5<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> 5<span class="main">(</span>5<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"const_list <span class="skolem">es</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">[</span>Local <span class="skolem">n</span> <span class="skolem">j</span> <span class="skolem">vls</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">es</span> <span class="main">=</span> length <span class="skolem">ts</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> s_type_unfold<span class="main">[</span><span class="operator">OF</span> 5<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> e_type_const_list<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> reduce_simple.local_const<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> reduce.intros<span class="main">(</span>1<span class="main">)</span> 5<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> reduce_simple.local_trap reduce.intros<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?cs</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">,</span> <span class="operator">OF</span> _ 5<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> 5<span class="main">(</span>5<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">k'</span> <span class="skolem">lholed'</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="skolem">k'</span><span class="main">+</span><span class="skolem">i'</span><span class="main">)</span><span class="main">]</span> <span class="skolem">es</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> le_Suc_ex
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="skolem">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="skolem">𝒮</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="skolem">vls</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> Some <span class="skolem">ts</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span>  es_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="skolem">𝒮</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>1<span class="main">)</span> s_type_unfold
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>label <span class="skolem">𝒞'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c_def store_local_label_empty 5<span class="main">(</span>12<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> progress_LN1<span class="main">[</span><span class="operator">OF</span> temp1 es_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">𝒮</span> <span class="skolem">cl</span> <span class="skolem">tf</span> <span class="skolem">𝒞</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">cs</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Callcl <span class="skolem">cl</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts''</span> <span class="main">_&gt;</span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> e_type_comp_conc1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_c</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> cl_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"cl_type <span class="skolem">cl</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_type_callcl<span class="main">[</span><span class="operator">OF</span> ts''_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs1</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">vs2</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">ts_c</span> <span class="main">_&gt;</span> <span class="skolem">ts_c</span> <span class="main">@</span> <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">vs1</span> <span class="main">@</span> <span class="skolem">vs2</span>"</span></span>
                                <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs1</span>"</span></span>
                                <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_type_const_list_cons<span class="main">[</span><span class="operator">OF</span> 6<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> ts''_def<span class="main">(</span>1<span class="main">)</span> cl_def<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">vs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_type_const_list vs_def<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cl</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_native <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="skolem">x13</span> <span class="skolem">x14</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> func_native_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cl</span> <span class="main">=</span> Func_native <span class="skolem">x11</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">x13</span> <span class="skolem">x14</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cl_def<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">a'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">vs2</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="skolem">cl</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="bound">a</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> func_native_def<span class="main">]</span> e_type_const_conv_vs<span class="main">[</span><span class="operator">OF</span> vs_def<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> l
        <span class="keyword1"><span class="command">unfolding</span></span> n_zeros_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_L0 vs_def<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> 6<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_host <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> func_host_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cl</span> <span class="main">=</span> Func_host <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">x22</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cl_def<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vcs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vcs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">=</span> <span class="main">$$*</span> <span class="skolem">vcs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> e_type_const_conv_vs<span class="main">[</span><span class="operator">OF</span> vs_def<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hs</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span> <span class="bound">a</span> <span class="bound">a'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">vs2</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="skolem">cl</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="bound">a</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"host_apply <span class="free">s</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">x22</span> <span class="skolem">vcs</span> <span class="skolem">hs</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> None
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> func_host_def<span class="main">]</span> l vcs_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">vcs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ha_def<span class="main">:</span><span class="quoted"><span class="quoted">"host_apply <span class="free">s</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">x22</span> <span class="skolem">vcs</span> <span class="skolem">hs</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">s'</span><span class="main">,</span> <span class="skolem">vcs'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="skolem">t1s</span> <span class="skolem">vcs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> e_typing_imp_list_types_agree vs_def<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> vcs_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> func_host_def _ _ _ _ ha_def<span class="main">]</span> l vcs_def
                host_apply_respect_type<span class="main">[</span><span class="operator">OF</span> _ ha_def<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> vs_def<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> 6<span class="main">(</span>3<span class="main">)</span> progress_L0
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">𝒮</span> <span class="skolem">𝒞</span> <span class="skolem">e0s</span> <span class="skolem">ts</span> <span class="skolem">t2s</span> <span class="skolem">es</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">lholed</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="skolem">es</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="skolem">es</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"const_list <span class="skolem">es</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">k</span>"</span></span>
           <span class="main">|</span> <span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">i</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> linorder_neqE_nat
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">@</span> <span class="skolem">es</span>"</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> temp2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">[</span><span class="skolem">ts</span><span class="main">]</span> <span class="main">@</span> label <span class="skolem">𝒞</span><span class="main">⦈</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_e_typing.empty e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">a</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 7<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> temp1 temp2 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> 7<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">,</span></span>15<span class="main"><span class="main">)</span></span><span class="main">]</span>
              1<span class="main">(</span>2<span class="main">)</span> 7<span class="main">(</span>16<span class="main">,</span>17<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> red_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="skolem">a</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> temp4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span><span class="main">.</span> Lfilled <span class="main">0</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="bound">es</span> <span class="bound">es</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> temp5<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="main">1</span> <span class="main">(</span>LRec <span class="skolem">cs</span> <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="skolem">es</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">es</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cs</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LRec <span class="skolem">cs</span> <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">e0s</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">es</span></span> <span class="quoted"><span class="skolem">es</span></span><span class="main">]</span> 7<span class="main">(</span>8<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> temp6<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="main">1</span> <span class="main">(</span>LRec <span class="skolem">cs</span> <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> temp4 Lfilled.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cs</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LRec <span class="skolem">cs</span> <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">e0s</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> 7<span class="main">(</span>8<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>23<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ temp5 temp6<span class="main">]</span> 7<span class="main">(</span>7<span class="main">)</span> red_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>LRec <span class="skolem">cs</span> <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">lholed</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">es</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span> 7<span class="main">(</span>8<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>10<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> 7<span class="main">(</span>7<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">hence</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce_simple.label_const reduce_simple.label_trap reduce.intros<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> _ 7<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">]</span> 7<span class="main">(</span>7<span class="main">)</span> temp1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> lholed_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">0</span><span class="main">)</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lholed'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">𝒞'</span></span> <span class="keyword2"><span class="keyword">where</span></span> lholed'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed'</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
                                                   <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span><span class="skolem">𝒞'</span> <span class="main">⊢</span> <span class="skolem">vs'</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
                                                   <span class="quoted"><span class="quoted">"const_list <span class="skolem">vs'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_LN<span class="main">[</span><span class="operator">OF</span> lholed_def 7<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">es'</span> <span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="skolem">vs'</span><span class="main">@</span><span class="skolem">e0s</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce_simple.br<span class="main">[</span><span class="operator">OF</span> lholed'_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ lholed'_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> 7<span class="main">(</span>3<span class="main">)</span>
              e_type_const_list<span class="main">[</span><span class="operator">OF</span> lholed'_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">es'</span> <span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_L0 7<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 5
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> lholed_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_imp_add_positive
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> k1_def<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>LRec <span class="skolem">cs</span> <span class="skolem">n</span> <span class="skolem">e0s</span> <span class="skolem">lholed</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">i</span><span class="main">]</span> <span class="skolem">cs_es</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>7<span class="main">)</span> Lfilled.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 7<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> _ lholed_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">e0s</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>11<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> k1_def<span class="main">]</span> lholed_def<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">i</span> <span class="skolem">𝒮</span> <span class="skolem">tvs</span> <span class="skolem">vs</span> <span class="skolem">𝒞</span> <span class="skolem">rs</span> <span class="skolem">es</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 8<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> store_local_label_empty<span class="main">[</span><span class="operator">OF</span> 8<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>11<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>memory <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">=</span> Option.is_none <span class="main">(</span>inst.mem <span class="main">(</span><span class="main">(</span>inst <span class="free">s</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> store_mem_exists<span class="main">[</span><span class="operator">OF</span> 8<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">)</span></span><span class="main">]</span> 8<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 8<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 8<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> _ _ _ 8<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
            e_typing_s_typing.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> b_e_typing.empty<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">𝒞</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> prems2<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_e1"><span class="command">lemma</span></span> progress_e1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
                   <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> None<span class="main">⦈</span>"</span></span>
                   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms s_type_unfold
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> return <span class="skolem">𝒞</span> <span class="main">=</span> Some <span class="bound">rs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local_assms c_def<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Return<span class="main">]</span>"</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> L0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> unlift_b_e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Return<span class="main">]</span>"</span></span><span class="main">]</span> b_e_type_return
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">tls</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> e_type_comp_conc2<span class="main">[</span><span class="operator">OF</span> LN<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> e_type_label<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒮</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="skolem">tls</span></span> <span class="quoted"><span class="skolem">es'</span></span> <span class="quoted"><span class="skolem">lfilledk</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> c_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_e2"><span class="command">lemma</span></span> progress_e2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="free">j</span><span class="main">)</span><span class="main">]</span> <span class="free">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">]</span> <span class="free">es</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">lholed</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">]</span> <span class="free">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_add<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒞</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span>"</span></span>
                   <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">⦇</span>local <span class="main">:=</span> <span class="main">(</span>local <span class="main">(</span><span class="main">(</span>s_inst <span class="free">𝒮</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map typeof <span class="free">vs</span><span class="main">)</span><span class="main">,</span> return <span class="main">:=</span> None<span class="main">⦈</span>"</span></span>
                   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒮</span><span class="main">∙</span><span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms s_type_unfold
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> progress_LN1<span class="main">[</span><span class="operator">OF</span> local_assms c_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> store_local_label_empty<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> c_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> c_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">lholed</span><span class="main">.</span> <span class="main">(</span>Lfilled <span class="bound">k</span> <span class="bound">lholed</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">]</span> <span class="free">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Properties-progress_e3"><span class="command">lemma</span></span> progress_e3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span> <span class="main">:</span> <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">cs_es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> const_list <span class="main">(</span><span class="free">cs_es</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="free">𝒮</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">cs_es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms progress_e progress_e1 progress_e2
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Soundness">
<div class="head">
<h1>Theory Wasm_Soundness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness Theorems›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Soundness <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="Wasm_Properties.html">Wasm_Properties</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> preservation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢_</span><span class="free">i</span> <span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢_</span><span class="free">i</span> <span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒮</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="skolem">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> config_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s'</span> <span class="skolem">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs'</span><span class="main">;</span><span class="free">es'</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> store_preserved types_preserved_e
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> config_typing.intros
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> progress<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢_</span><span class="free">i</span> <span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span> <span class="main">∨</span> <span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">s'</span> <span class="bound">vs'</span> <span class="bound">es'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="bound">s'</span><span class="main">;</span><span class="bound">vs'</span><span class="main">;</span><span class="bound">es'</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒮</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"store_typing <span class="free">s</span> <span class="skolem">𝒮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒮</span><span class="main">∙</span>None <span class="main">⊩_</span><span class="free">i</span> <span class="free">vs</span><span class="main">;</span><span class="free">es</span> <span class="main">:</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms config_typing.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> progress_e3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Checker_Types">
<div class="head">
<h1>Theory Wasm_Checker_Types</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Augmented Type Syntax for Concrete Checker›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Checker_Types <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm.html">Wasm</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> ct <span class="main">=</span>
    TAny
  <span class="main">|</span> TSome <span class="quoted">t</span>

<span class="keyword1"><span class="command">datatype</span></span> checker_type <span class="main">=</span>
    TopType <span class="quoted"><span class="quoted">"ct list"</span></span>
  <span class="main">|</span> Type <span class="quoted"><span class="quoted">"t list"</span></span>
  <span class="main">|</span> Bot

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_ct_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t list <span class="main">⇒</span> ct list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_ct_list</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> map TSome <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ct_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct <span class="main">⇒</span> ct <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ct_eq</span> <span class="main">(</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span>TSome <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ct_eq</span> TAny <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ct_eq</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> TAny <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ct_list_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ct_list_eq</span> <span class="free"><span class="bound"><span class="entity">ct1s</span></span></span> <span class="free"><span class="bound"><span class="entity">ct2s</span></span></span> <span class="main">=</span> list_all2 ct_eq <span class="free"><span class="bound"><span class="entity">ct1s</span></span></span> <span class="free"><span class="bound"><span class="entity">ct2s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ct_prefix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ct_prefix</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="bound">as</span><span class="main">@</span><span class="bound">bs</span> <span class="main">∧</span> ct_list_eq <span class="bound">as</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ct_suffix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ct_suffix</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="bound">as</span><span class="main">@</span><span class="bound">bs</span> <span class="main">∧</span> ct_list_eq <span class="bound">bs</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_eq_commute"><span class="command">lemma</span></span> ct_eq_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ct_eq.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_eq_flip"><span class="command">lemma</span></span> ct_eq_flip<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_eq<span class="main">¯¯</span> <span class="main">=</span> ct_eq"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_eq_commute
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_eq_common_tsome"><span class="command">lemma</span></span> ct_eq_common_tsome<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_eq <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> ct_eq <span class="free">x</span> <span class="main">(</span>TSome <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> ct_eq <span class="main">(</span>TSome <span class="bound">t</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ct_eq.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_commute"><span class="command">lemma</span></span> ct_list_eq_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">ys</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_eq_commute List.List.list.rel_flip ct_eq_flip
  <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_refl"><span class="command">lemma</span></span> ct_list_eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ct_eq.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list_all2_refl<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_length"><span class="command">lemma</span></span> ct_list_eq_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_concat"><span class="command">lemma</span></span> ct_list_eq_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">ys</span>"</span></span>
          <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs'</span> <span class="free">ys'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">ys'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_appendI<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_ts_conv_eq"><span class="command">lemma</span></span> ct_list_eq_ts_conv_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">ts'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
            list_all2_map1 list_all2_map2
            ct_eq.simps<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_eq<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_exists"><span class="command">lemma</span></span> ct_list_eq_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> ct_list_eq <span class="free">xs</span> <span class="main">(</span>to_ct_list <span class="bound">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ct_eq_commute list.rel_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.rel_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_common_tsome_list"><span class="command">lemma</span></span> ct_list_eq_common_tsome_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">zs</span><span class="main">.</span> ct_list_eq <span class="free">xs</span> <span class="main">(</span>to_ct_list <span class="bound">zs</span><span class="main">)</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="bound">zs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x'</span><span class="main">#</span><span class="skolem">xs'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ct_list_eq_def list_all2_Cons2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs_def<span class="main">:</span><span class="quoted"><span class="quoted">"ct_eq <span class="skolem">x'</span> <span class="skolem">a</span>"</span></span>
                                <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">xs'</span> <span class="main">(</span>to_ct_list <span class="skolem">zs</span><span class="main">)</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">zs</span><span class="main">)</span> <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs'</span></span><span class="main">]</span> assms list_all2_Cons
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">x'</span> <span class="main">(</span>TSome <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="main">(</span>TSome <span class="skolem">z</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ct_eq_common_tsome<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x'</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> zs_def<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span><span class="skolem">x'</span><span class="main">#</span><span class="skolem">xs'</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zs_def<span class="main">(</span>2<span class="main">)</span> list_all2_Cons
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">zs</span><span class="main">.</span> ct_list_eq <span class="skolem">xs</span> <span class="main">(</span>to_ct_list <span class="bound">zs</span><span class="main">)</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="bound">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">xs</span> <span class="main">(</span>to_ct_list <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="skolem"><span class="skolem">zs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x'</span><span class="main">#</span><span class="skolem">xs'</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z'</span><span class="main">#</span><span class="skolem">zs'</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">xs'</span> <span class="main">(</span>to_ct_list <span class="skolem">zs'</span><span class="main">)</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">zs'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> list_all2_Cons2
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def list_all2_map1 list_all2_map2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Cons ct_list_eq_def to_ct_list_def ct_eq_common_tsome
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> list_all2_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_cons_ct_list"><span class="command">lemma</span></span> ct_list_eq_cons_ct_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs</span> <span class="bound">bs'</span><span class="main">.</span> <span class="free">as</span> <span class="main">=</span> <span class="bound">bs</span> <span class="main">@</span> <span class="bound">bs'</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="bound">bs</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="bound">bs'</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil ct_list_eq_ts_conv_eq list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> to_ct_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def list_all2_map1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> list_all2_append2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_cons_ct_list1"><span class="command">lemma</span></span> ct_list_eq_cons_ct_list1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">(</span>to_ct_list <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> <span class="free">as</span> <span class="main">=</span> <span class="bound">bs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="bound">bs</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_list_eq_cons_ct_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> ct_list_eq_ts_conv_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_shared"><span class="command">lemma</span></span> ct_list_eq_shared<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="main">(</span>to_ct_list <span class="free">as</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">ys</span> <span class="main">(</span>to_ct_list <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ct_list_eq_common_tsome_list ct_list_eq_commute<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_list_eq_take"><span class="command">lemma</span></span> ct_list_eq_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_takeI
  <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_prefixI"><span class="command">lemma</span></span> ct_prefixI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="free">zs</span>"</span></span>
          <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">as</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_prefixE"><span class="command">lemma</span></span> ct_prefixE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">as</span> <span class="free">zs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="free">zs</span>"</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">as</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_prefix_snoc"><span class="command">lemma</span></span> ct_prefix_snoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ct_list_eq <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∨</span> ct_prefix <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ct_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def ct_list_eq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast_append butlast_snoc ct_eq_flip list.rel_flip<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_list_eq_commute ct_prefixI
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_assoc
    <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_prefix_nil"><span class="command">lemma</span></span> ct_prefix_nil<span class="main">:</span><span class="quoted"><span class="quoted">"ct_prefix <span class="main">[]</span> <span class="free">xs</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_prefix_def ct_list_eq_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-Cons_ct_prefix_Cons"><span class="command">lemma</span></span> Cons_ct_prefix_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>ct_eq <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> ct_prefix <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def ct_list_eq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq_commute hd_append2 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list_all2_Cons2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def ct_list_eq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.rel_distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list_all2_Cons2 tl_append2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_prefix_def ct_list_eq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> append_Cons ct_list_eq_commute ct_list_eq_def list.rel_inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_prefix_code"><span class="command">lemma</span></span> ct_prefix_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ct_prefix <span class="main">[]</span> <span class="free">xs</span> <span class="main">=</span> True"</span></span>
  <span class="quoted"><span class="quoted">"ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
  <span class="quoted"><span class="quoted">"ct_prefix <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>ct_eq <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> ct_prefix <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_prefix_nil<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_to_ct_prefix"><span class="command">lemma</span></span> ct_suffix_to_ct_prefix <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> ct_prefix <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def ct_prefix_def ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_all2_rev1 rev_append rev_rev_ident<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-inj_TSome"><span class="command">lemma</span></span> inj_TSome<span class="main">:</span> <span class="quoted"><span class="quoted">"inj TSome"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ct.inject injI<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-to_ct_list_append"><span class="command">lemma</span></span> to_ct_list_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="free">ts</span> <span class="main">=</span> <span class="free">as</span><span class="main">@</span><span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as'</span><span class="main">.</span> to_ct_list <span class="bound">as'</span> <span class="main">=</span> <span class="free">as</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs'</span><span class="main">.</span> to_ct_list <span class="bound">bs'</span> <span class="main">=</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="skolem">ts</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">@</span> <span class="free">bs</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as'</span><span class="main">.</span> to_ct_list <span class="bound">as'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs'</span><span class="main">.</span> to_ct_list <span class="bound">bs'</span> <span class="main">=</span> <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span>
  <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"to_ct_list <span class="skolem">ts</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">@</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">#</span><span class="skolem">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as'</span><span class="main">.</span> to_ct_list <span class="bound">as'</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as'</span><span class="main">.</span> to_ct_list <span class="bound">as'</span> <span class="main">=</span> <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons local_assms
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffixI"><span class="command">lemma</span></span> ct_suffixI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="free">zs</span>"</span></span>
          <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">zs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffixE"><span class="command">lemma</span></span> ct_suffixE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">as</span> <span class="free">zs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="free">zs</span>"</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">zs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_nil"><span class="command">lemma</span></span> ct_suffix_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[]</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">using</span></span> ct_list_eq_refl
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_refl"><span class="command">lemma</span></span> ct_suffix_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">using</span></span> ct_list_eq_refl
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_length"><span class="command">lemma</span></span> ct_suffix_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">≤</span> length <span class="free">ts'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_take"><span class="command">lemma</span></span> ct_suffix_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free">ts'</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">ts'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_list_eq_take append_eq_conv_conj
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">as</span> <span class="main">@</span> <span class="bound">bs</span> <span class="main">∧</span> ct_list_eq <span class="bound">bs</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ccs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ccsa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="skolem">ccs</span> <span class="main">@</span> <span class="skolem">ccsa</span> <span class="main">∧</span> ct_list_eq <span class="skolem">ccsa</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ccsa</span> <span class="main">=</span> length <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ct_list_eq_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ct_list_eq <span class="main">(</span>take <span class="bound">n</span> <span class="skolem">ccsa</span><span class="main">)</span> <span class="main">(</span>take <span class="bound">n</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ct_list_eq_take<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cs</span> <span class="bound">csa</span><span class="main">.</span> take <span class="main">(</span>length <span class="free">ts'</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">ts'</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">@</span> <span class="bound">csa</span> <span class="main">∧</span> ct_list_eq <span class="bound">csa</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_ts_conv_suffix"><span class="command">lemma</span></span> ct_suffix_ts_conv_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">ts'</span><span class="main">)</span> <span class="main">=</span> suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="free">ts'</span> <span class="main">=</span> <span class="main">(</span>to_ct_list <span class="skolem">as</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> to_ct_list_append
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_list_eq_ts_conv_eq
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def to_ct_list_def suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">ts'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_list_eq_ts_conv_eq
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def to_ct_list_def suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_exists"><span class="command">lemma</span></span> ct_suffix_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span><span class="main">.</span> ct_suffix <span class="free">x1</span> <span class="main">(</span>to_ct_list <span class="bound">ts_c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_list_eq_commute ct_list_eq_exists ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_ct_list_eq_exists"><span class="command">lemma</span></span> ct_suffix_ct_list_eq_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">x1</span> <span class="free">x2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span><span class="main">.</span> ct_suffix <span class="free">x1</span> <span class="main">(</span>to_ct_list <span class="bound">ts_c</span><span class="main">)</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="bound">ts_c</span><span class="main">)</span> <span class="free">x2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> x2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">x1</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ct_list_eq_commute
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_as</span></span> <span class="skolem"><span class="skolem">ts_bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">as</span> <span class="main">(</span>to_ct_list <span class="skolem">ts_as</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">x1</span> <span class="main">(</span>to_ct_list <span class="skolem">ts_bs</span><span class="main">)</span>"</span></span>
                                <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">ts_bs</span><span class="main">)</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_list_eq_common_tsome_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x1</span></span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">]</span> ct_list_eq_exists
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> x2_def ct_list_eq_commute
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_list_eq_def list_all2_appendI map_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_cons_ct_list"><span class="command">lemma</span></span> ct_suffix_cons_ct_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="free">zs</span> <span class="main">=</span> <span class="bound">as</span><span class="main">@</span><span class="bound">bs</span> <span class="main">∧</span> ct_list_eq <span class="free">ys</span> <span class="main">(</span>to_ct_list <span class="bound">bs</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="free">xs</span> <span class="main">(</span>to_ct_list <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="free">zs</span> <span class="main">=</span> <span class="main">(</span>to_ct_list <span class="skolem">as</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms to_ct_list_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">zs</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ct_list_eq_cons_ct_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc ct_list_eq_commute ct_list_eq_ts_conv_eq map_append to_ct_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_cons_ct_list1"><span class="command">lemma</span></span> ct_suffix_cons_ct_list1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">(</span>to_ct_list <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="free">zs</span> <span class="main">=</span> <span class="bound">as</span><span class="main">@</span><span class="free">ys</span> <span class="main">∧</span> ct_suffix <span class="free">xs</span> <span class="main">(</span>to_ct_list <span class="bound">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_suffix_cons_ct_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> ct_list_eq_ts_conv_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_cons2"><span class="command">lemma</span></span> ct_suffix_cons2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">zs</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">zs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs</span> <span class="free">zs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv ct_list_eq_commute ct_list_eq_def ct_suffix_def list_all2_lengthD<span class="main">)</span>
    
<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_imp_ct_list_eq"><span class="command">lemma</span></span> ct_suffix_imp_ct_list_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>drop <span class="main">(</span>length <span class="free">ys</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_list_eq_def list_all2_lengthD
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_extend_ct_list_eq"><span class="command">lemma</span></span> ct_suffix_extend_ct_list_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
          <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">xs'</span> <span class="free">ys'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">ys'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def ct_list_eq_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> append.assoc ct_list_eq_commute ct_list_eq_def list_all2_appendI<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_extend_any1"><span class="command">lemma</span></span> ct_suffix_extend_any1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>TAny<span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span>"</span></span>
                            <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">bs</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ct_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_all2_lengthD assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> as_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">as'</span><span class="main">@</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id length_greater_0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span> <span class="main">(</span>TAny<span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ys_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ct_eq.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ct_list_eq_commute ct_list_eq_def list.rel_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> as_def ys_def ct_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_singleton_any"><span class="command">lemma</span></span> ct_suffix_singleton_any<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_suffix_extend_ct_list_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TAny<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span><span class="main">]</span> ct_suffix_nil
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_list_eq_def<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_cons_it"><span class="command">lemma</span></span> ct_suffix_cons_it<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs</span> <span class="main">(</span><span class="free">xs'</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_list_eq_refl ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_singleton"><span class="command">lemma</span></span> ct_suffix_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">]</span> <span class="free">cts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> ct_prefix <span class="main">[</span>TAny<span class="main">]</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_suffix_singleton_any ct_suffix_to_ct_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc_leI append_butlast_last_id assms butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ct_list_eq_commute
                         ct_prefix_nil<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ct_prefix_snoc ct_suffix_def impossible_Cons length_Cons
                         list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_less"><span class="command">lemma</span></span> ct_suffix_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">xs'</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_appendI ct_list_eq_def list_all2_append2<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_unfold_one"><span class="command">lemma</span></span> ct_suffix_unfold_one<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>ct_eq <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_prefix_code<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_to_ct_prefix<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-ct_suffix_shared"><span class="command">lemma</span></span> ct_suffix_shared<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts'</span> <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts</span> <span class="free">cts'</span> <span class="main">∨</span> ct_suffix <span class="free">cts'</span> <span class="free">cts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">&gt;</span> length <span class="free">cts'</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span>"</span></span>
                             <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ct_suffix_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil ct_suffix_cons_ct_list<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">as'</span><span class="main">@</span><span class="skolem">bs'</span>"</span></span>
                                <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts'</span> <span class="main">(</span>to_ct_list <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ct_suffix_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil ct_suffix_cons_ct_list<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ct1s</span></span> <span class="skolem"><span class="skolem">ct2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cts</span> <span class="main">=</span> <span class="skolem">ct1s</span><span class="main">@</span><span class="skolem">ct2s</span>"</span></span>
                         <span class="quoted"><span class="quoted">"length <span class="skolem">ct2s</span> <span class="main">=</span> length <span class="free">cts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="comment1">(* List.append_eq_conv_conj[of _ _ cts] *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' append_take_drop_id length_drop less_imp_le_nat nat_le_iff_add<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tts</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t list <span class="main">⇒</span> ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> t list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ttsa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t list <span class="main">⇒</span> ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> t list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="bound">x0</span> <span class="main">=</span> <span class="bound">v3</span> <span class="main">@</span> <span class="bound">v4</span> <span class="main">∧</span> ct_list_eq <span class="bound">x1</span> <span class="main">(</span>to_ct_list <span class="bound">v4</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="bound">x2</span> <span class="main">(</span>to_ct_list <span class="bound">v3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x0</span> <span class="main">=</span> <span class="skolem">tts</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">@</span> <span class="skolem">ttsa</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∧</span> ct_list_eq <span class="bound">x1</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ttsa</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="bound">x2</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tts</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bs'</span> <span class="main">=</span> <span class="skolem">tts</span> <span class="main">(</span><span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span> <span class="main">@</span> <span class="skolem">ttsa</span> <span class="main">(</span><span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span> <span class="main">∧</span> ct_list_eq <span class="skolem">ct2s</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ttsa</span> <span class="main">(</span><span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="skolem">ct1s</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tts</span> <span class="main">(</span><span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">cts</span> <span class="main">=</span> <span class="skolem">ct1s</span> <span class="main">@</span> <span class="skolem">ct2s</span>›</span></span> cts'_def<span class="main">(</span>1<span class="main">)</span> ct_suffix_cons_ct_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts'</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ttsa</span> <span class="main">(</span><span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ct_suffix <span class="free">cts'</span> <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ct2s</span> <span class="main">=</span> length <span class="free">cts'</span>›</span></span> cts'_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ct_list_eq_length ct_suffix_cons2 map_append to_ct_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">cts</span> <span class="main">=</span> <span class="skolem">ct1s</span> <span class="main">@</span> <span class="skolem">ct2s</span>›</span></span> ct_list_eq_shared ct_suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">cts'</span> <span class="main">≥</span> length <span class="free">cts</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span>"</span></span>
                             <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ct_suffix_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil ct_suffix_cons_ct_list<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="skolem">as'</span><span class="main">@</span><span class="skolem">bs'</span>"</span></span>
                                <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts'</span> <span class="main">(</span>to_ct_list <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ct_suffix_def to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil ct_suffix_cons_ct_list<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ct1s</span></span> <span class="skolem"><span class="skolem">ct2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cts'</span> <span class="main">=</span> <span class="skolem">ct1s</span><span class="main">@</span><span class="skolem">ct2s</span>"</span></span>
                         <span class="quoted"><span class="quoted">"length <span class="skolem">ct2s</span> <span class="main">=</span> length <span class="free">cts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> len <span class="comment1">(* List.append_eq_conv_conj[of _ _ cts] *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' append_take_drop_id length_drop nat_le_iff_add<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tts</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t list <span class="main">⇒</span> ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> t list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ttsa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t list <span class="main">⇒</span> ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> t list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="bound">x0</span> <span class="main">=</span> <span class="bound">v3</span> <span class="main">@</span> <span class="bound">v4</span> <span class="main">∧</span> ct_list_eq <span class="bound">x1</span> <span class="main">(</span>to_ct_list <span class="bound">v4</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="bound">x2</span> <span class="main">(</span>to_ct_list <span class="bound">v3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x0</span> <span class="main">=</span> <span class="skolem">tts</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">@</span> <span class="skolem">ttsa</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∧</span> ct_list_eq <span class="bound">x1</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ttsa</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="bound">x2</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tts</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">tts</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span> <span class="main">@</span> <span class="skolem">ttsa</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span> <span class="main">∧</span> ct_list_eq <span class="skolem">ct2s</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ttsa</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ct_suffix <span class="skolem">ct1s</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tts</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">cts'</span> <span class="main">=</span> <span class="skolem">ct1s</span> <span class="main">@</span> <span class="skolem">ct2s</span>›</span></span> cts_def<span class="main">(</span>1<span class="main">)</span> ct_suffix_cons_ct_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ttsa</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">ct2s</span> <span class="skolem">ct1s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ct_suffix <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ct2s</span> <span class="main">=</span> length <span class="free">cts</span>›</span></span> cts_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ct_list_eq_length ct_suffix_cons2 map_append to_ct_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">cts'</span> <span class="main">=</span> <span class="skolem">ct1s</span> <span class="main">@</span> <span class="skolem">ct2s</span>›</span></span> ct_list_eq_shared ct_suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">checker_type_suffix</span><span class="main">::</span><span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> checker_type <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker_type_suffix</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> suffix <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">checker_type_suffix</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">cts</span></span></span><span class="main">)</span> <span class="main">=</span> ct_suffix <span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">checker_type_suffix</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">cts</span></span></span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> ct_suffix <span class="free"><span class="bound"><span class="entity">cts</span></span></span> <span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">checker_type_suffix</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">consume</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> ct list <span class="main">⇒</span> checker_type"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">consume</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cons</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> ct_suffix <span class="free"><span class="bound"><span class="entity">cons</span></span></span> <span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                               <span class="keyword1">then</span> Type <span class="main">(</span>take <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">cons</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                               <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">consume</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">cts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cons</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> ct_suffix <span class="free"><span class="bound"><span class="entity">cons</span></span></span> <span class="free"><span class="bound"><span class="entity">cts</span></span></span>
                                  <span class="keyword1">then</span> TopType <span class="main">(</span>take <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">cts</span></span></span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">cons</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cts</span></span></span><span class="main">)</span>
                                  <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> ct_suffix <span class="free"><span class="bound"><span class="entity">cts</span></span></span> <span class="free"><span class="bound"><span class="entity">cons</span></span></span>
                                          <span class="keyword1">then</span> TopType <span class="main">[]</span>
                                          <span class="keyword1">else</span> Bot<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">consume</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">produce</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> checker_type <span class="main">⇒</span> checker_type"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">produce</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> TopType <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">@</span><span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">produce</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> Type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">produce</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">produce</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">produce</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">type_update</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> ct list <span class="main">⇒</span> checker_type <span class="main">⇒</span> checker_type"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">type_update</span> <span class="free"><span class="bound"><span class="entity">curr_type</span></span></span> <span class="free"><span class="bound"><span class="entity">cons</span></span></span> <span class="free"><span class="bound"><span class="entity">prods</span></span></span> <span class="main">=</span> produce <span class="main">(</span>consume <span class="free"><span class="bound"><span class="entity">curr_type</span></span></span> <span class="free"><span class="bound"><span class="entity">cons</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">prods</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">select_return_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>ct list<span class="main">]</span> <span class="main">⇒</span> ct <span class="main">⇒</span> ct <span class="main">⇒</span> checker_type"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">select_return_top</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">ct1</span></span></span> TAny <span class="main">=</span> TopType <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ct1</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">select_return_top</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> TAny <span class="free"><span class="bound"><span class="entity">ct2</span></span></span> <span class="main">=</span> TopType <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ct2</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">select_return_top</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>TSome <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">)</span> <span class="main">(</span>TSome <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span>
                                                   <span class="keyword1">then</span> <span class="main">(</span>TopType <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                                                   <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">type_update_select</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> checker_type"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">type_update_select</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">!</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">!</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">then</span> consume <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span>
                                    <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">type_update_select</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1">of</span>
                                        <span class="main">0</span> <span class="main">⇒</span> TopType <span class="main">[</span>TAny<span class="main">]</span>
                                      <span class="main">|</span> Suc <span class="main">0</span> <span class="main">⇒</span> type_update <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">(</span>TopType <span class="main">[</span>TAny<span class="main">]</span><span class="main">)</span>
                                      <span class="main">|</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">⇒</span> consume <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">[</span>TSome T_i32<span class="main">]</span>
                                      <span class="main">|</span> <span class="main"><span class="bound">_</span></span>  <span class="main">⇒</span> type_update <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span>
                                                          <span class="main">(</span>select_return_top <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">!</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">!</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">type_update_select</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">c_types_agree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> t list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c_types_agree</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">c_types_agree</span> <span class="main">(</span>TopType <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> ct_suffix <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">c_types_agree</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1" id="Wasm_Checker_Types-consume_type"><span class="command">lemma</span></span> consume_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">ts</span><span class="main">)</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">c_t</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">c_t</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts''</span><span class="main">.</span> ct_list_eq <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>to_ct_list <span class="bound">ts''</span><span class="main">)</span><span class="main">@</span><span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">c_t</span> <span class="main">=</span> Type <span class="bound">ts''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> ct_suffix <span class="free">ts'</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span> <span class="keyword1">then</span> Type <span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> length <span class="free">ts'</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span> <span class="keyword1">else</span> Bot<span class="main">)</span> <span class="main">=</span> <span class="free">c_t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c_t</span> <span class="main">≠</span> Bot"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ccs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> ct list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ccsa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ct list <span class="main">⇒</span> ct list <span class="main">⇒</span> ct list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">cs</span> <span class="bound">csa</span><span class="main">.</span> <span class="main">¬</span> ct_suffix <span class="bound">cs</span> <span class="bound">csa</span> <span class="main">∨</span> <span class="bound">csa</span> <span class="main">=</span> <span class="skolem">ccs</span> <span class="bound">cs</span> <span class="bound">csa</span> <span class="main">@</span> <span class="skolem">ccsa</span> <span class="bound">cs</span> <span class="bound">csa</span> <span class="main">∧</span> ct_list_eq <span class="main">(</span><span class="skolem">ccsa</span> <span class="bound">cs</span> <span class="bound">csa</span><span class="main">)</span> <span class="bound">cs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ct_suffixE <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts'</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span><span class="skolem">ccsa</span> <span class="free">ts'</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="free">ts'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span><span class="skolem">ccsa</span> <span class="free">ts'</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ccsa</span> <span class="free">ts'</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> map TSome <span class="free">ts</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f4 f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> suffixI suffix_take<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cs</span><span class="main">.</span> ct_list_eq <span class="main">(</span><span class="bound">cs</span> <span class="main">@</span> <span class="skolem">ccsa</span> <span class="free">ts'</span> <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">cs</span> <span class="main">@</span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 ct_list_eq_concat ct_list_eq_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tsa</span><span class="main">.</span> ct_list_eq <span class="main">(</span>map TSome <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>map TSome <span class="bound">tsa</span> <span class="main">@</span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">c_t</span> <span class="main">=</span> Type <span class="bound">tsa</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f6 f5 f4 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ct_list_eq_length length_map take_map<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-consume_top_geq"><span class="command">lemma</span></span> consume_top_geq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">c_t</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">≥</span> length <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">c_t</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">as</span><span class="main">@</span><span class="bound">bs</span> <span class="main">∧</span> ct_list_eq <span class="bound">bs</span> <span class="free">ts'</span> <span class="main">∧</span> <span class="free">c_t</span> <span class="main">=</span> TopType <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts'</span> <span class="free">ts</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_suffix <span class="free">ts'</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_suffix <span class="free">ts'</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_suffix <span class="free">ts</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TopType <span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> length <span class="free">ts'</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">c_t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 1 ct_list_eq_def
      <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append_eq_append_conv append_take_drop_id diff_diff_cancel length_drop list_all2_lengthD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms append_eq_append_conv ct_list_eq_commute
      <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.left_neutral ct_suffix_def ct_suffix_length le_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-consume_top_leq"><span class="command">lemma</span></span> consume_top_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">c_t</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">≤</span> length <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">c_t</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c_t</span> <span class="main">=</span> TopType <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms append_eq_conv_conj
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Checker_Types-consume_type_type"><span class="command">lemma</span></span> consume_type_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consume <span class="free">xs</span> <span class="free">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">t_int</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> Type <span class="bound">tn</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Wasm_Checker_Types-produce_type_type"><span class="command">lemma</span></span> produce_type_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"produce <span class="free">xs</span> <span class="free">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> Type <span class="bound">tn</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">cons</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Wasm_Checker_Types-consume_weaken_type"><span class="command">lemma</span></span> consume_weaken_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="free">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">t_int</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="free">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">t_int</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="free">tn</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="skolem">ts'</span> <span class="main">@</span> <span class="free">cons</span><span class="main">)</span> <span class="main">∧</span> Type <span class="free">t_int</span> <span class="main">=</span> Type <span class="skolem">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> consume_type<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cond<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="free">cons</span> <span class="main">(</span>to_ct_list <span class="free">tn</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t_int</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">tn</span> <span class="main">-</span> length <span class="free">cons</span><span class="main">)</span> <span class="free">tn</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">cons</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_assoc ct_suffix_def map_append<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">@</span><span class="free">t_int</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span> <span class="main">-</span> length <span class="free">cons</span><span class="main">)</span> <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> res take_append cond ct_suffix_length to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Wasm_Checker_Types-produce_weaken_type"><span class="command">lemma</span></span> produce_weaken_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"produce <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="free">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"produce <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="free">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tm</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">cons</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-produce_nil"><span class="command">lemma</span></span> produce_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"produce <span class="free">ts</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> to_ct_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-c_types_agree_id"><span class="command">lemma</span></span> c_types_agree_id<span class="main">:</span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>Type <span class="free">ts</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Checker_Types-c_types_agree_top1"><span class="command">lemma</span></span> c_types_agree_top1<span class="main">:</span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ct_suffix_ts_conv_suffix to_ct_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_nil<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-c_types_agree_top2"><span class="command">lemma</span></span> c_types_agree_top2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">ts</span> <span class="main">(</span>to_ct_list <span class="free">ts''</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="main">(</span><span class="free">ts'</span><span class="main">@</span><span class="free">ts''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_list_eq_commute ct_suffix_def to_ct_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Checker_Types-c_types_agree_imp_ct_list_eq"><span class="command">lemma</span></span> c_types_agree_imp_ct_list_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts'</span> <span class="bound">ts''</span><span class="main">.</span> <span class="main">(</span><span class="free">ts</span> <span class="main">=</span> <span class="bound">ts'</span><span class="main">@</span><span class="bound">ts''</span><span class="main">)</span> <span class="main">∧</span> ct_list_eq <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="bound">ts''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_suffix_def to_ct_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ct_list_eq_commute ct_list_eq_ts_conv_eq ct_suffix_ts_conv_suffix suffixE
                  to_ct_list_append<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-c_types_agree_not_bot_exists"><span class="command">lemma</span></span> c_types_agree_not_bot_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts_c</span><span class="main">.</span> c_types_agree <span class="free">ts</span> <span class="bound">ts_c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ct_suffix_exists
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-consume_c_types_agree"><span class="command">lemma</span></span> consume_c_types_agree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">ts</span><span class="main">)</span> <span class="free">cts</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="free">ctn</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c_t'</span><span class="main">.</span> consume <span class="free">ctn</span> <span class="free">cts</span> <span class="main">=</span> <span class="bound">c_t'</span> <span class="main">∧</span> c_types_agree <span class="bound">c_t'</span> <span class="free">ts'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ctn</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts</span> <span class="main">(</span>to_ct_list <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts</span> <span class="skolem">x1</span> <span class="main">∨</span> ct_suffix <span class="skolem">x1</span> <span class="free">cts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TopType 1 assms<span class="main">(</span>2<span class="main">)</span> ct_suffix_shared
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts</span> <span class="skolem">x1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="free">cts</span> <span class="main">=</span> TopType <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="free">cts</span><span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> length <span class="free">cts</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms 1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="free">cts</span><span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span><span class="main">)</span> <span class="free">ts'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 assms local_assms TopType ct_suffix_take
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> length_map take_map to_ct_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 TopType
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">x1</span> <span class="free">cts</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="free">cts</span> <span class="main">=</span> TopType <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_length<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TopType c_types_agree_top1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1" id="Wasm_Checker_Types-type_update_type"><span class="command">lemma</span></span> type_update_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update <span class="main">(</span>Type <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span> <span class="free">prods</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">≠</span> Bot"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts'</span> <span class="main">=</span> <span class="free">prods</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ts_c</span><span class="main">.</span> <span class="free">prods</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="bound">ts_c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ts_a</span> <span class="bound">ts_b</span><span class="main">.</span> <span class="free">prods</span> <span class="main">=</span> Type <span class="bound">ts_a</span> <span class="main">∧</span> <span class="free">ts</span> <span class="main">=</span> <span class="bound">ts_b</span><span class="main">@</span><span class="free">cons</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> Type <span class="main">(</span><span class="bound">ts_b</span><span class="main">@</span><span class="bound">ts_a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">prods</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> ct_suffix_ts_conv_suffix suffix_take to_ct_list_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_empty"><span class="command">lemma</span></span> type_update_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"type_update <span class="free">ts</span> <span class="free">cons</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> consume <span class="free">ts</span> <span class="free">cons</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> produce_nil
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_top_top"><span class="command">lemma</span></span> type_update_top_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span> <span class="main">(</span>Type <span class="free">prods</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="free">ts'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="free">ts'</span><span class="main">)</span> <span class="free">t_ag</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">prods</span><span class="main">)</span> <span class="free">ts'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t_ag'</span><span class="main">.</span> <span class="free">t_ag</span> <span class="main">=</span> <span class="bound">t_ag'</span><span class="main">@</span><span class="free">prods</span> <span class="main">∧</span> c_types_agree <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="main">(</span><span class="bound">t_ag'</span><span class="main">@</span><span class="free">cons</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_suffix <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts</span> <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_suffix <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ct_suffix <span class="free">ts</span> <span class="main">(</span>to_ct_list <span class="free">cons</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">prods</span><span class="main">)</span> <span class="free">ts'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t_ag'</span><span class="main">.</span> <span class="free">t_ag</span> <span class="main">=</span> <span class="bound">t_ag'</span><span class="main">@</span><span class="free">prods</span> <span class="main">∧</span> c_types_agree <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="main">(</span><span class="bound">t_ag'</span><span class="main">@</span><span class="free">cons</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">=</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> length <span class="free">cons</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span> <span class="main">@</span> to_ct_list <span class="free">prods</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_ag'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t_ag</span> <span class="main">=</span> <span class="skolem">t_ag'</span> <span class="main">@</span> <span class="free">prods</span>"</span></span>
                            <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>take <span class="main">(</span>length <span class="free">ts</span> <span class="main">-</span> length <span class="free">cons</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="skolem">t_ag'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ct_suffix_cons_ct_list1
      <span class="keyword1"><span class="command">unfolding</span></span> c_types_agree.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">ts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">t_ag'</span><span class="main">@</span><span class="free">cons</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 ct_suffix_imp_ct_list_eq ct_suffix_extend_ct_list_eq to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c_types_agree.simps<span class="main">(</span>2<span class="main">)</span> ct_list_eq_ts_conv_eq ct_suffix_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc c_types_agree.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> checker_type.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> consume.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                ct_list_eq_ts_conv_eq ct_suffix_cons_ct_list ct_suffix_def map_append
                produce.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> to_ct_list_def type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">prods</span><span class="main">)</span> <span class="free">ts'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t_ag'</span><span class="main">.</span> <span class="free">t_ag</span> <span class="main">=</span> <span class="bound">t_ag'</span><span class="main">@</span><span class="free">prods</span> <span class="main">∧</span> c_types_agree <span class="main">(</span>TopType <span class="free">ts</span><span class="main">)</span> <span class="main">(</span><span class="bound">t_ag'</span><span class="main">@</span><span class="free">cons</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_select_length0"><span class="command">lemma</span></span> type_update_select_length0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_select_length1"><span class="command">lemma</span></span> type_update_select_length1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts</span> <span class="main">[</span>TSome T_i32<span class="main">]</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"type_update <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">(</span>TopType <span class="main">[</span>TAny<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="free">cts</span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">∨</span> ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="free">cts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consume.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="free">cts</span> <span class="main">[</span>TSome T_i32<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> ct_suffix_imp_ct_list_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_length_conv ct_list_eq_commute diff_Suc_1 drop_0 list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>3<span class="main">)</span> consume_top_leq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_Suc_1 diff_is_0_eq length_Cons list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
              produce.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Wasm_Checker_Types-type_update_select_length2"><span class="command">lemma</span></span> type_update_select_length2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="free">cts</span> <span class="main">=</span> <span class="main">[</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">t2</span><span class="main">]</span> <span class="main">∧</span> ct_eq <span class="bound">t2</span> <span class="main">(</span>TSome T_i32<span class="main">)</span> <span class="main">∧</span> <span class="free">tm</span> <span class="main">=</span> TopType <span class="main">[</span><span class="bound">t1</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cts</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cts</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_Suc_conv numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">=</span> <span class="free">tm</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">∨</span> ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consume.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">(</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ct_suffix_length
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">y</span> <span class="main">(</span>TSome T_i32<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_eq_commute ct_list_eq_def ct_suffix_cons2 list.rel_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
              list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_select_length3"><span class="command">lemma</span></span> type_update_select_length3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="free">ctm</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cts'</span> <span class="bound">ct1</span> <span class="bound">ct2</span> <span class="bound">ct3</span><span class="main">.</span> <span class="free">cts</span> <span class="main">=</span> <span class="bound">cts'</span><span class="main">@</span><span class="main">[</span><span class="bound">ct1</span><span class="main">,</span> <span class="bound">ct2</span><span class="main">,</span> <span class="bound">ct3</span><span class="main">]</span> <span class="main">∧</span> ct_eq <span class="bound">ct3</span> <span class="main">(</span>TSome T_i32<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cts'</span></span> <span class="skolem"><span class="skolem">cts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cts</span> <span class="main">=</span> <span class="skolem">cts'</span><span class="main">@</span> <span class="skolem">cts''</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cts''</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id diff_diff_cancel length_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ct1</span></span> <span class="skolem"><span class="skolem">cts''2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cts''</span> <span class="main">=</span> <span class="skolem">ct1</span><span class="main">#</span><span class="skolem">cts''2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cts''2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cts'</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ct2</span></span> <span class="skolem"><span class="skolem">ct3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cts''</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">ct1</span><span class="main">,</span><span class="skolem">ct2</span><span class="main">,</span><span class="skolem">ct3</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cts''2</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_Suc_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> cts_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cts</span> <span class="main">=</span> <span class="skolem">cts'</span><span class="main">@</span> <span class="main">[</span><span class="skolem">ct1</span><span class="main">,</span><span class="skolem">ct2</span><span class="main">,</span><span class="skolem">ct3</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cts_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cts_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>type_update <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">(</span>select_return_top <span class="free">cts</span> <span class="main">(</span><span class="free">cts</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cts</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopType <span class="free">ctm</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c_mid</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">=</span> TopType <span class="skolem">c_mid</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consume.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">(</span><span class="skolem">cts'</span><span class="main">@</span> <span class="main">[</span><span class="skolem">ct1</span><span class="main">,</span><span class="skolem">ct2</span><span class="main">,</span><span class="skolem">ct3</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> consume_top_geq cts_def2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ct_suffix_def length_Cons list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">ct3</span> <span class="main">(</span>TSome T_i32<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_suffix_def ct_list_eq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append_eq_append_conv length_Cons list_all2_Cons list_all2_lengthD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cts_def2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_select_type_length3"><span class="command">lemma</span></span> type_update_select_type_length3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">ts'</span><span class="main">.</span> <span class="free">tn</span> <span class="main">=</span> <span class="bound">ts'</span><span class="main">@</span><span class="main">[</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t</span><span class="main">,</span> T_i32<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> tn_cond<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">tn</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">(</span><span class="free">tn</span><span class="main">!</span><span class="main">(</span>length <span class="free">tn</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">tn</span><span class="main">!</span><span class="main">(</span>length <span class="free">tn</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> tm_def<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">=</span> Type <span class="free">tm</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tn'</span></span> <span class="skolem"><span class="skolem">tn''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn_split<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tn</span> <span class="main">=</span> <span class="skolem">tn'</span><span class="main">@</span><span class="skolem">tn''</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"length <span class="skolem">tn''</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms tn_cond
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id diff_diff_cancel length_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">tn''2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tn''</span> <span class="main">=</span> <span class="skolem">t1</span><span class="main">#</span><span class="skolem">tn''2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tn''2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">t3</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tn''</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">t2</span><span class="main">,</span><span class="skolem">t3</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tn''2</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_Suc_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> tn_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tn</span> <span class="main">=</span> <span class="skolem">tn'</span><span class="main">@</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">t2</span><span class="main">,</span><span class="skolem">t3</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tn_split
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> t1_t2_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tn_cond
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_diff_Suc Suc_eq_plus1_left Suc_lessD tn''_def
                                  add_diff_cancel_right' diff_is_0_eq length_append neq0_conv
                                  not_less_eq_eq nth_Cons_0 nth_Cons_numeral
                                  nth_append numeral_2_eq_2 numeral_3_eq_3 numeral_One tn_split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                                  zero_less_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tn'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">t2</span><span class="main">,</span> <span class="skolem">t3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tn_def tm_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span> <span class="main">=</span> T_i32"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_suffix_unfold_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TAny<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"TSome T_i32"</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="main">(</span><span class="skolem">tn'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">t2</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"TSome <span class="skolem">t3</span>"</span></span><span class="main">]</span>
          ct_eq.simps<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> t1_t2_eq tn_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-select_return_top_exists"><span class="command">lemma</span></span> select_return_top_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"select_return_top <span class="free">cts</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> <span class="free">ctm</span> <span class="main">=</span> TopType <span class="bound">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_return_top.elims<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_select_top_exists"><span class="command">lemma</span></span> type_update_select_top_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> TopType <span class="bound">tn</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> checker_type.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Wasm_Checker_Types-type_update_select_conv_select_return_top"><span class="command">lemma</span></span> type_update_select_conv_select_return_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="free">cts</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>select_return_top <span class="free">cts</span> <span class="main">(</span><span class="free">cts</span><span class="main">!</span><span class="main">(</span>length <span class="free">cts</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cts</span><span class="main">!</span><span class="main">(</span>length <span class="free">cts</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> nat_def<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_if diff_Suc_1 le_Suc_ex numeral_3_eq_3 nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="free">cts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ct_suffix_extend_any1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="free">cts</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">=</span> TopType <span class="skolem">cts'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_def select_return_top_exists
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"select_return_top <span class="free">cts</span> <span class="main">(</span><span class="free">cts</span> <span class="main">!</span> Suc <span class="skolem">nat</span><span class="main">)</span> <span class="main">(</span><span class="free">cts</span> <span class="main">!</span> <span class="skolem">nat</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Types-select_return_top_ct_eq"><span class="command">lemma</span></span> select_return_top_ct_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"select_return_top <span class="free">cts</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">=</span> TopType <span class="free">ctm</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">cts</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="free">ctm</span><span class="main">)</span> <span class="free">cm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span> <span class="bound">cm'</span><span class="main">.</span> <span class="free">cm</span> <span class="main">=</span> <span class="bound">cm'</span><span class="main">@</span><span class="main">[</span><span class="bound">c'</span><span class="main">]</span>
                  <span class="main">∧</span> ct_suffix <span class="main">(</span>take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="bound">cm'</span><span class="main">)</span>
                  <span class="main">∧</span> ct_eq <span class="free">c1</span> <span class="main">(</span>TSome <span class="bound">c'</span><span class="main">)</span>
                  <span class="main">∧</span> ct_eq <span class="free">c2</span> <span class="main">(</span>TSome <span class="bound">c'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> TAny
  <span class="keyword1"><span class="command">note</span></span> outer_TAny <span class="main">=</span> TAny
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> TAny
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span> <span class="main">@</span> <span class="main">[</span>TAny<span class="main">]</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> outer_TAny  assms ct_suffix_cons_ct_list
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cm'</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cm</span> <span class="main">=</span> <span class="skolem">cm'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span>"</span></span>
                            <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="skolem">cm'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ct_suffix_cons_ct_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TAny<span class="main">]</span>"</span></span><span class="main">]</span>
            assms<span class="main">(</span>3<span class="main">)</span> c_types_agree.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ctm</span></span> <span class="quoted"><span class="free">cm</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI impossible_Cons length_Cons length_map list.exhaust list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
                list_all2_conv_all_nth zero_less_Suc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TAny outer_TAny ct_eq.simps<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TSome <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span> <span class="main">@</span> <span class="main">[</span>TSome <span class="skolem">x2</span><span class="main">]</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> outer_TAny assms ct_suffix_cons_ct_list
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cm'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cm</span> <span class="main">=</span> <span class="skolem">cm'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>"</span></span>
                          <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="skolem">cm'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ct_suffix_cons_ct_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TSome <span class="skolem">x2</span><span class="main">]</span>"</span></span><span class="main">]</span>
            assms<span class="main">(</span>3<span class="main">)</span> c_types_agree.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ctm</span></span> <span class="quoted"><span class="free">cm</span></span><span class="main">]</span> ct_list_eq_ts_conv_eq
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TSome outer_TAny
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TSome <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> outer_TSome <span class="main">=</span> TSome
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> TAny
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span> <span class="main">@</span> <span class="main">[</span>TSome <span class="skolem">x2</span><span class="main">]</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TSome assms ct_suffix_cons_ct_list
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cm'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cm</span> <span class="main">=</span> <span class="skolem">cm'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>"</span></span>
                          <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="skolem">cm'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ct_suffix_cons_ct_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TSome <span class="skolem">x2</span><span class="main">]</span>"</span></span><span class="main">]</span>
            assms<span class="main">(</span>3<span class="main">)</span> c_types_agree.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ctm</span></span> <span class="quoted"><span class="free">cm</span></span><span class="main">]</span> ct_list_eq_ts_conv_eq
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TSome TAny
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TSome <span class="skolem">x3</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> x_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">x3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> outer_TSome assms ct_suffix_cons_ct_list
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> select_return_top.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span> <span class="main">@</span> <span class="main">[</span>TSome <span class="skolem">x2</span><span class="main">]</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TSome outer_TSome assms ct_suffix_cons_ct_list
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> select_return_top.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cm'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cm</span> <span class="main">=</span> <span class="skolem">cm'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>"</span></span>
                          <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="skolem">cm'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ct_suffix_cons_ct_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">cts</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">cts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TSome <span class="skolem">x2</span><span class="main">]</span>"</span></span><span class="main">]</span>
            assms<span class="main">(</span>3<span class="main">)</span> c_types_agree.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ctm</span></span> <span class="quoted"><span class="free">cm</span></span><span class="main">]</span> ct_list_eq_ts_conv_eq
      <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TSome outer_TSome x_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Checker">
<div class="head">
<h1>Theory Wasm_Checker</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Executable Type Checker›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Checker <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Checker_Types.html">Wasm_Checker_Types</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">convert_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t <span class="main">⇒</span> t <span class="main">⇒</span> sx option <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">convert_cond</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>is_float_t <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">∧</span> is_float_t <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span>
                                                        <span class="main">∨</span> <span class="main">(</span>is_int_t <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">∧</span> is_int_t <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">∧</span> <span class="main">(</span>t_length <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">&lt;</span> t_length <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">same_lab_h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="main">(</span>t list<span class="main">)</span> list <span class="main">⇒</span> t list <span class="main">⇒</span> <span class="main">(</span>t list<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">same_lab_h</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">same_lab_h</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≥</span> length <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span>
                                 <span class="keyword1">then</span> None
                                 <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>
                                       <span class="keyword1">then</span> <span class="free">same_lab_h</span> <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lab_c</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                                       <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">same_lab</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="main">(</span>t list<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span>t list<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">same_lab</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span> <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">same_lab</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≥</span> length <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span>
                            <span class="keyword1">then</span> None
                            <span class="keyword1">else</span> same_lab_h <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">lab_c</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lab_c</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Checker-same_lab_h_conv_list_all"><span class="command">lemma</span></span> same_lab_h_conv_list_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"same_lab_h <span class="free">ils</span> <span class="free">ls</span> <span class="free">ts'</span> <span class="main">=</span> Some <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ls</span> <span class="main">∧</span> <span class="free">ls</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">ts</span><span class="main">)</span> <span class="free">ils</span> <span class="main">∧</span> <span class="free">ts'</span> <span class="main">=</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ils</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ils</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not_less option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Checker-same_lab_conv_list_all"><span class="command">lemma</span></span> same_lab_conv_list_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"same_lab <span class="free">ils</span> <span class="free">ls</span> <span class="main">=</span> Some <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ls</span> <span class="main">∧</span> <span class="free">ls</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">ts</span><span class="main">)</span> <span class="free">ils</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> same_lab.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span> <span class="quoted">"<span class="skolem">is</span>"</span> <span class="skolem">lab_c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> same_lab_h_conv_list_all
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> list_all_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_less option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> same_lab.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Checker-list_all_conv_same_lab_h"><span class="command">lemma</span></span> list_all_conv_same_lab_h<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ls</span> <span class="main">∧</span> <span class="free">ls</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">ts</span><span class="main">)</span> <span class="free">ils</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"same_lab_h <span class="free">ils</span> <span class="free">ls</span> <span class="free">ts</span> <span class="main">=</span> Some <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ils</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Checker-list_all_conv_same_lab"><span class="command">lemma</span></span> list_all_conv_same_lab<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ls</span> <span class="main">∧</span><span class="free">ls</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">ts</span><span class="main">)</span> <span class="main">(</span><span class="free">is</span><span class="main">@</span><span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"same_lab <span class="main">(</span><span class="free">is</span><span class="main">@</span><span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="free">ls</span> <span class="main">=</span> Some <span class="free">ts</span>"</span></span>                      
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is</span><span class="main">@</span><span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> list_all_conv_same_lab_h<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> same_lab.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> same_lab_h.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">b_e_type_checker</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t_context <span class="main">⇒</span>  b_e list <span class="main">⇒</span> tf <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">check</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t_context <span class="main">⇒</span> b_e list <span class="main">⇒</span> checker_type <span class="main">⇒</span> checker_type"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">check_single</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"t_context <span class="main">⇒</span>  b_e <span class="main">⇒</span> checker_type <span class="main">⇒</span> checker_type"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b_e_type_checker</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span> <span class="main">=</span> c_types_agree <span class="main">(</span><span class="free">check</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">tn</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="keyword1">of</span>
                     <span class="main">[]</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>
                   <span class="main">|</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="bound">es</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1">of</span> 
                                  Bot <span class="main">⇒</span> Bot
                                <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free">check</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="bound">es</span> <span class="main">(</span><span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*
foldl (λ ts e. (case ts of Bot ⇒ Bot | _ ⇒ check_single 𝒞 e ts)) es



primrec foldl :: "('b ⇒ 'a ⇒ 'b) ⇒ 'b ⇒ 'a list ⇒ 'b" where
foldl_Nil:  "foldl f a [] = a" |
foldl_Cons: "foldl f a (x # xs) = foldl f (f a x) xs"
*)</span>
  <span class="comment1">(* num ops *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span>typeof <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Unop_i <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Unop_f <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_float_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Binop_i <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Binop_f <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_float_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Testop <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Relop_i <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_int_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Relop_f <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">if</span> is_float_t <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                       <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>
                                       <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* convert *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Cvtop <span class="free"><span class="bound"><span class="entity">t1</span></span></span> Convert <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>convert_cond <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span>
                                                   <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">]</span><span class="main">)</span>
                                                   <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* reinterpret *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Cvtop <span class="free"><span class="bound"><span class="entity">t1</span></span></span> Reinterpret <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">∧</span> t_length <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">=</span> t_length <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">sx</span></span></span> <span class="main">=</span> None<span class="main">)</span>
                                                         <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">]</span><span class="main">)</span>
                                                         <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* unreachable, nop, drop, select *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Unreachable<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[]</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Nop<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Drop<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TAny<span class="main">]</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Select<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> type_update_select <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
  <span class="comment1">(* block *)</span>                                 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Block <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b_e_type_checker</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">)</span>
                                                <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">tn</span></span></span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>
                                                <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* loop *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Loop <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b_e_type_checker</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">)</span>
                                                <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="free"><span class="bound"><span class="entity">tn</span></span></span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>
                                                <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* if *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>If <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es1</span></span></span> <span class="free"><span class="bound"><span class="entity">es2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b_e_type_checker</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>
                                                    <span class="main">∧</span> <span class="free">b_e_type_checker</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span> <span class="main">_&gt;</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">)</span>
                                                <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tn</span></span></span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Type <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>
                                                <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* br *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Br <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                 <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span>
                                 <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* br_if *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Br_if <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                    <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">(</span><span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* br_table *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Br_table <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>same_lab <span class="main">(</span><span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>label <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span>
                                        None <span class="main">⇒</span> Bot
                                      <span class="main">|</span> Some <span class="bound">tls</span> <span class="main">⇒</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="bound">tls</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* return *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Return<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>return <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
                                   None <span class="main">⇒</span> Bot
                                 <span class="main">|</span> Some <span class="bound">tls</span> <span class="main">⇒</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="bound">tls</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* call *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>func_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                    <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="main">(</span>func_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
                                            <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="bound">tm</span><span class="main">)</span> <span class="main">⇒</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="bound">tn</span><span class="main">)</span> <span class="main">(</span>Type <span class="bound">tm</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* call_indirect *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Call_indirect <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>table <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>types_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                            <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="main">(</span>types_t <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
                                                    <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="bound">tm</span><span class="main">)</span> <span class="main">⇒</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="bound">tn</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Type <span class="bound">tm</span><span class="main">)</span><span class="main">)</span>
                                            <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* get_local *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Get_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                        <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span><span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">)</span>
                                        <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* set_local *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Set_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                        <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="main">(</span><span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span>
                                        <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* tee_local *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Tee_local <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                 <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="main">(</span><span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="main">(</span>local <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">)</span>
                                 <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* get_global *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Get_global <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span>
                                         <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span>tg_t <span class="main">(</span><span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
                                         <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* set_global *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Set_global <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">∧</span> is_mut <span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                                         <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome <span class="main">(</span>tg_t <span class="main">(</span><span class="main">(</span>global <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span>
                                         <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* load *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">tp_sx</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> load_store_t_bounds <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>option_projl <span class="free"><span class="bound"><span class="entity">tp_sx</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                 <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span><span class="main">)</span>
                                 <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* store *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Store <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">off</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> load_store_t_bounds <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">tp</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
                                             <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome T_i32<span class="main">,</span>TSome <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span>
                                             <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* current_memory *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> Current_memory <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">≠</span> None
                                         <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>
                                         <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>
  <span class="comment1">(* grow_memory *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_single</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> Grow_memory <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>memory <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="main">)</span> <span class="main">≠</span> None
                                      <span class="keyword1">then</span> type_update <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>
                                      <span class="keyword1">else</span> Bot<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Checker_Properties">
<div class="head">
<h1>Theory Wasm_Checker_Properties</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Correctness of Type Checker›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Checker_Properties <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Checker.html">Wasm_Checker</a> <a href="Wasm_Properties.html">Wasm_Properties</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_type_sound"><span class="command">lemma</span></span> b_e_check_single_type_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update <span class="main">(</span>Type <span class="free">x1</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t_in</span><span class="main">)</span> <span class="main">(</span>Type <span class="free">t_out</span><span class="main">)</span> <span class="main">=</span> Type <span class="free">x2</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>Type <span class="free">x2</span><span class="main">)</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t_in</span> <span class="main">_&gt;</span> <span class="free">t_out</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="main">(</span>Type <span class="free">x1</span><span class="main">)</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_e_typing.intros<span class="main">(</span>35<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> type_update_type<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_top_sound"><span class="command">lemma</span></span> b_e_check_single_top_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update <span class="main">(</span>TopType <span class="free">x1</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t_in</span><span class="main">)</span> <span class="main">(</span>Type <span class="free">t_out</span><span class="main">)</span> <span class="main">=</span> TopType <span class="free">x2</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="free">x2</span><span class="main">)</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t_in</span> <span class="main">_&gt;</span> <span class="free">t_out</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="main">(</span>TopType <span class="free">x1</span><span class="main">)</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_ag</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_ag_def<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="free">t_out</span><span class="main">)</span> <span class="free">x2</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="free">tm</span> <span class="main">=</span> <span class="skolem">t_ag</span> <span class="main">@</span> <span class="free">t_out</span>"</span></span>
                             <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="free">x1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t_ag</span> <span class="main">@</span> <span class="free">t_in</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> type_update_top_top<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t_ag</span><span class="main">@</span><span class="free">t_in</span> <span class="main">_&gt;</span> <span class="skolem">t_ag</span><span class="main">@</span><span class="free">t_out</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>35<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> t_ag_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_top_not_bot_sound"><span class="command">lemma</span></span> b_e_check_single_top_not_bot_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update <span class="free">ts</span> <span class="main">(</span>to_ct_list <span class="free">t_in</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> Bot"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="free">ts</span> <span class="bound">tn</span> <span class="main">∧</span> suffix <span class="free">t_in</span> <span class="bound">tn</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t_in</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t_int</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t_int</span> <span class="main">≠</span> Bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> TopType ct_suffix_ct_list_eq_exists ct_suffix_ts_conv_suffix
    <span class="keyword1"><span class="command">unfolding</span></span> consume.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil c_types_agree.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ct_suffix_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t_in</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t_int</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t_int</span> <span class="main">≠</span> Bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c_types_agree_id Type consume_type suffixI ct_suffix_ts_conv_suffix
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_type_not_bot_sound"><span class="command">lemma</span></span> b_e_check_single_type_not_bot_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_update <span class="free">ts</span> <span class="main">(</span>to_ct_list <span class="free">t_in</span><span class="main">)</span> <span class="main">(</span>Type <span class="free">t_out</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> Bot"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ts'</span> <span class="main">≠</span> Bot"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="free">ts'</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="free">t_in</span> <span class="main">_&gt;</span> <span class="free">t_out</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="free">ts</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms b_e_check_single_type_sound 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_def<span class="main">:</span><span class="quoted"><span class="quoted">"TopType <span class="skolem">x1'</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms b_e_check_single_top_sound TopType
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_def<span class="main">:</span><span class="quoted"><span class="quoted">"Type <span class="skolem">x2'</span> <span class="main">=</span> <span class="free">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms b_e_check_single_type_sound Type
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_sound_unop_testop_cvtop"><span class="command">lemma</span></span> b_e_check_single_sound_unop_testop_cvtop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">tn'</span> <span class="main">=</span> <span class="free">tm'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_i <span class="free">t</span> <span class="free">uu</span><span class="main">)</span> <span class="main">∨</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Testop <span class="free">t</span> <span class="free">uv</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> is_int_t <span class="free">t</span><span class="main">)</span>
           <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Unop_f <span class="free">t</span> <span class="free">uw</span><span class="main">)</span> <span class="main">∧</span> is_float_t <span class="free">t</span><span class="main">)</span>
           <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Cvtop <span class="free">t1</span> Convert <span class="free">t</span> <span class="free">sx</span><span class="main">)</span> <span class="main">∧</span> convert_cond <span class="free">t1</span> <span class="free">t</span> <span class="free">sx</span><span class="main">)</span>
           <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Cvtop <span class="free">t1</span> Reinterpret <span class="free">t</span> <span class="free">sx</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span> <span class="main">≠</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> t_length <span class="free">t1</span> <span class="main">=</span> t_length <span class="free">t</span> <span class="main">∧</span> <span class="free">sx</span> <span class="main">=</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="free">tm'</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tn'</span> <span class="main">≠</span> Bot"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tm'</span> <span class="main">≠</span> Bot"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="free">tn'</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Cvtop <span class="free">t1</span> Convert <span class="free">t</span> <span class="free">sx</span><span class="main">)</span> <span class="main">⟹</span> convert_cond <span class="free">t1</span> <span class="free">t</span> <span class="free">sx</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> temp0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Cvtop <span class="free">t1</span> Convert <span class="free">t</span> <span class="free">sx</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>type_update <span class="free">tn'</span> <span class="main">[</span>TSome <span class="free">t</span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> arity_1_result_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> convert_cond.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">(</span>Cvtop <span class="free">t1</span> Reinterpret <span class="free">t</span> <span class="free">sx</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>type_update <span class="free">tn'</span> <span class="main">[</span>TSome <span class="free">t</span><span class="main">]</span> <span class="main">(</span>Type <span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5<span class="main">)</span> arity_1_result_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"type_update <span class="free">tn'</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms arity_1_result_def
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> convert_cond.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> temp0 temp1 b_e.simps<span class="main"><span class="main">(</span></span>978<span class="main"><span class="main">,</span></span>979<span class="main"><span class="main">,</span></span>982<span class="main"><span class="main">)</span></span> check_single.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> check_single.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> check_single.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span>arity_1_result <span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_e_typing.intros<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>6<span class="main">,</span>9<span class="main">,</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> arity_1_result_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> 1 assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_sound_binop_relop"><span class="command">lemma</span></span> b_e_check_single_sound_binop_relop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">tn'</span> <span class="main">=</span> <span class="free">tm'</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∧</span> is_int_t <span class="free">t</span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∧</span> is_float_t <span class="free">t</span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span> <span class="main">∧</span> is_int_t <span class="free">t</span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span> <span class="main">∧</span> is_float_t <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="free">tm'</span> <span class="free">tm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tn'</span> <span class="main">≠</span> Bot"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">tm'</span> <span class="main">≠</span> Bot"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="free">tn'</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"type_update <span class="free">tn'</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">tm'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms arity_2_result_def
    <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span>arity_2_result <span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_e_typing.intros<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> arity_2_result_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_type_checker_sound"><span class="command">lemma</span></span> b_e_type_checker_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">tn'</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tm'</span> <span class="bound">tm</span><span class="main">.</span>
       check <span class="free">𝒞</span> <span class="free">es</span> <span class="skolem">tn'</span> <span class="main">=</span> <span class="bound">tm'</span> <span class="main">⟹</span>
       c_types_agree <span class="bound">tm'</span> <span class="bound">tm</span> <span class="main">⟹</span>
         <span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="skolem">tn'</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="bound">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tm'</span> <span class="bound">tm</span><span class="main">.</span>
       check_single <span class="free">𝒞</span> <span class="skolem">e</span> <span class="skolem">tn'</span> <span class="main">=</span> <span class="bound">tm'</span> <span class="main">⟹</span>
       c_types_agree <span class="bound">tm'</span> <span class="bound">tm</span> <span class="main">⟹</span>
       <span class="skolem">tn'</span> <span class="main">≠</span> Bot <span class="main">⟹</span>
       <span class="bound">tm'</span> <span class="main">≠</span> Bot <span class="main">⟹</span>
         <span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> c_types_agree <span class="skolem">tn'</span> <span class="bound">tn</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="bound">tn</span> <span class="main">_&gt;</span> <span class="bound">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_type_checker_check_check_single.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">tn'</span> <span class="skolem">tm</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒞</span> <span class="skolem">es'</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_e_type_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> check_expand<span class="main">:</span><span class="quoted"><span class="quoted">"check <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="main">(</span>check_single <span class="skolem">𝒞</span> <span class="skolem">e</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> TopType Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="skolem">𝒞</span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">ts'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_int_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t_int</span> <span class="main">_&gt;</span> <span class="skolem">tm</span><span class="main">)</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts'</span> <span class="skolem">t_int</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons TopType check_expand 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> ts'_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts</span> <span class="skolem">t_int'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t_int'</span> <span class="main">_&gt;</span> <span class="skolem">t_int</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons _ ts'_def<span class="main">]</span> TopType c_types_agree.simps<span class="main">(</span>3<span class="main">)</span> t_int_def<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> t_int_def<span class="main">(</span>1<span class="main">)</span> b_e_type_comp_conc Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> check_expand<span class="main">:</span><span class="quoted"><span class="quoted">"check <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="main">(</span>check_single <span class="skolem">𝒞</span> <span class="skolem">e</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> Type Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="skolem">𝒞</span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">ts'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_int_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="skolem">es</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t_int</span> <span class="main">_&gt;</span> <span class="skolem">tm</span><span class="main">)</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts'</span> <span class="skolem">t_int</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons Type check_expand 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> ts'_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts</span> <span class="skolem">t_int'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">t_int'</span> <span class="main">_&gt;</span> <span class="skolem">t_int</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons _ ts'_def<span class="main">]</span> Type c_types_agree.simps<span class="main">(</span>3<span class="main">)</span> t_int_def<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> t_int_def<span class="main">(</span>1<span class="main">)</span> b_e_type_comp_conc Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Bot
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒞</span> <span class="skolem">v</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span>typeof <span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span><span class="keyword1">C</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>typeof <span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> to_ct_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uu</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_int_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_unop_testop_cvtop 4
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_float_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_unop_testop_cvtop 5
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uw</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_int_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_binop_relop 6
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">ux</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_float_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_binop_relop 7
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uy</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_int_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_unop_testop_cvtop 8
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uz</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_int_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_binop_relop 9
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">va</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_float_t <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_binop_relop 10
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">𝒞</span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convert_cond <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">sx</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> convert_cond.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_unop_testop_cvtop 11
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">𝒞</span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≠</span> <span class="skolem">t2</span> <span class="main">∧</span>  t_length <span class="skolem">t1</span> <span class="main">=</span> t_length <span class="skolem">t2</span> <span class="main">∧</span> <span class="skolem">sx</span> <span class="main">=</span> None"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_sound_unop_testop_cvtop 12
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>11<span class="main">)</span> c_types_agree_not_bot_exists
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>12<span class="main">,</span>35<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Drop<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tm</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="skolem">tm</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>13<span class="main">,</span>35<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> c_types_agree_top1 Nil TopType
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ys</span> <span class="skolem">y</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>consume <span class="main">(</span>TopType <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 15 TopType type_update_empty
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> check_single.simps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> temp2<span class="main">:</span><span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="skolem">ys</span><span class="main">)</span> <span class="skolem">tm</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> consume_top_geq<span class="main">[</span><span class="operator">OF</span> temp1<span class="main">]</span> 15<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI add_diff_cancel_right' append_eq_conv_conj consume.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                        ct_suffix_def length_Cons length_append list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> trans_le_add2
                        zero_less_Suc<span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">[</span><span class="skolem">y</span><span class="main">]</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ct_list_eq_exists
              <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def list_all2_map2
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_all2_Cons1 list_all2_Nil<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts</span> <span class="main">(</span><span class="skolem">tm</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> temp2 ct_suffix_extend_ct_list_eq snoc TopType
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_ct_list_def<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>13<span class="main">,</span>35<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>consume <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 15 Type type_update_empty
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 15<span class="main">(</span>4<span class="main">)</span> ct_list_eq_def ct_suffix_def to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ys</span> <span class="skolem">y</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>consume <span class="main">(</span>Type <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 15 Type type_update_empty
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> check_single.simps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> temp2<span class="main">:</span><span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>Type <span class="skolem">ys</span><span class="main">)</span> <span class="skolem">tm</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 15<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> ct_suffix_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> One_nat_def butlast_conv_take butlast_snoc c_types_agree.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                              length_Cons list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">[</span>TSome <span class="skolem">y</span><span class="main">]</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ct_list_eq_exists
              <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def list_all2_map2
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_all2_Cons1 list_all2_Nil<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts</span> <span class="main">(</span><span class="skolem">tm</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> temp2 ct_suffix_extend_ct_list_eq snoc Type
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_list_eq_def to_ct_list_def<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>13<span class="main">,</span>35<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>16 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">consider</span></span>
          <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tm'</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TopType 16
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="skolem"><span class="skolem">tm''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tm</span> <span class="main">=</span> <span class="skolem">tm''</span><span class="main">@</span><span class="main">[</span><span class="skolem">t''</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 16<span class="main">(</span>2<span class="main">)</span> ct_suffix_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Nil_is_append_conv append_butlast_last_id checker_type.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                          ct_prefixI ct_prefix_nil<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> produce_nil<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Select<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="skolem">t''</span><span class="main">,</span><span class="skolem">t''</span><span class="main">,</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t''</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>14<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> TopType 16 1 tm_def b_e_typing.intros<span class="main">(</span>35<span class="main">)</span> c_types_agree.simps<span class="main">(</span>2<span class="main">)</span> c_types_agree_top1
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 16 TopType
          <span class="keyword1"><span class="command">unfolding</span></span> check_single.simps
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> x1_def<span class="main">:</span><span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">x1</span> <span class="main">[</span>TSome T_i32<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tm'</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> type_update_select_length1<span class="main">[</span><span class="operator">OF</span> _ 2 16<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="skolem"><span class="skolem">tm''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tm</span> <span class="main">=</span> <span class="skolem">tm''</span><span class="main">@</span><span class="main">[</span><span class="skolem">t''</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 16<span class="main">(</span>2<span class="main">)</span> ct_suffix_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv append_butlast_last_id c_types_agree.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ct_prefixI
                    ct_prefix_nil<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> to_ct_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tm''</span><span class="main">@</span><span class="main">[</span><span class="skolem">t''</span><span class="main">,</span><span class="skolem">t''</span><span class="main">]</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x1_def<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_types_agree_top2 list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> to_ct_list_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> TopType b_e_typing.intros<span class="main">(</span>14<span class="main">,</span>35<span class="main">)</span> tm_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 16 TopType
          <span class="keyword1"><span class="command">unfolding</span></span> check_single.simps
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ct1</span></span> <span class="skolem"><span class="skolem">ct2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">ct1</span><span class="main">,</span> <span class="skolem">ct2</span><span class="main">]</span>"</span></span>
                                         <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">ct2</span> <span class="main">(</span>TSome T_i32<span class="main">)</span>"</span></span>
                                         <span class="quoted"><span class="quoted">"<span class="skolem">tm'</span> <span class="main">=</span> TopType <span class="main">[</span><span class="skolem">ct1</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> type_update_select_length2<span class="main">[</span><span class="operator">OF</span> _ 3 16<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="skolem"><span class="skolem">tm''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tm</span> <span class="main">=</span> <span class="skolem">tm''</span><span class="main">@</span><span class="main">[</span><span class="skolem">t''</span><span class="main">]</span>"</span></span>
                                          <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">[</span><span class="skolem">ct1</span><span class="main">]</span> <span class="main">[</span><span class="main">(</span>TSome <span class="skolem">t''</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 16<span class="main">(</span>2<span class="main">)</span> c_types_agree_imp_ct_list_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">ct1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">tm</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 append_butlast_last_id append_eq_append_conv_if append_eq_conv_conj
                    ct_list_eq_length diff_Suc_1 length_Cons length_butlast length_map
                    list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> to_ct_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">x1</span> <span class="main">(</span>to_ct_list <span class="main">[</span> <span class="skolem">t''</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x1_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> ct_list_eq_def to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tm''</span><span class="main">@</span><span class="main">[</span><span class="skolem">t''</span><span class="main">]</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">t''</span><span class="main">,</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c_types_agree_top2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> TopType b_e_typing.intros<span class="main">(</span>14<span class="main">,</span>35<span class="main">)</span> tm_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> nat_def<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_if diff_Suc_1 le_Suc_ex numeral_3_eq_3 nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> tm'_def<span class="main">:</span><span class="quoted"><span class="quoted">"type_update_select <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 16 TopType
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tm_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>select_return_top <span class="skolem">x1</span>
                                    <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm_int</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="skolem">tm_int</span> <span class="main">≠</span> Bot"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nat_def 16<span class="main">(</span>4<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> type_update_select.simps
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>select_return_top <span class="skolem">x1</span>
                                       <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopType <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> select_return_top_exists
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">x1</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">∨</span> ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tm'_def nat_def 16<span class="main">(</span>4<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> tm'_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tm'</span> <span class="main">=</span> TopType <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tm'_def nat_def 16<span class="main">(</span>4<span class="main">)</span> x2_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cts'</span></span> <span class="skolem"><span class="skolem">ct1</span></span> <span class="skolem"><span class="skolem">ct2</span></span> <span class="skolem"><span class="skolem">ct3</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">cts'</span><span class="main">@</span><span class="main">[</span><span class="skolem">ct1</span><span class="main">,</span> <span class="skolem">ct2</span><span class="main">,</span> <span class="skolem">ct3</span><span class="main">]</span>"</span></span>
                                                    <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">ct3</span> <span class="main">(</span>TSome T_i32<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> type_update_select_length3 tm'_def 4
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">cm'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tm</span> <span class="main">=</span> <span class="skolem">cm'</span><span class="main">@</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">cts'</span> <span class="main">(</span>to_ct_list <span class="skolem">cm'</span><span class="main">)</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"ct_eq <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TSome <span class="skolem">c'</span><span class="main">)</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"ct_eq <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TSome <span class="skolem">c'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> select_return_top_ct_eq<span class="main">[</span><span class="operator">OF</span> x2_def 4<span class="main">]</span> tm'_eq 4 16<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> cm'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">cm'</span> <span class="main">=</span> <span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span>"</span></span>
                                        <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">cts'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ct_list_eq_cons_ct_list1 ct_list_eq_ts_conv_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ct_suffix_def to_ct_list_append<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">ct1</span> <span class="main">(</span>TSome <span class="skolem">c'</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"ct_eq <span class="skolem">ct2</span> <span class="main">(</span>TSome <span class="skolem">c'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cts'_def tm_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc append_Cons append_Nil length_append_singleton nth_append_length<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ts</span> <span class="main">(</span><span class="skolem">cm'</span><span class="main">@</span><span class="main">[</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">c'</span><span class="main">,</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c_types_agree_top2<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">]</span> cm'_def<span class="main">(</span>1<span class="main">)</span> TopType
                ct_list_eq_concat<span class="main">[</span><span class="operator">OF</span> ct_list_eq_commute<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cm'_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> cts'_def
          <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def ct_list_eq_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>14<span class="main">,</span>35<span class="main">)</span> tm_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">(* TODO: refactor *)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> x2_cond<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">x2</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x2</span><span class="main">!</span><span class="main">(</span>length <span class="skolem">x2</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x2</span><span class="main">!</span><span class="main">(</span>length <span class="skolem">x2</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 16
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> tm'_def<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 16 Type
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="skolem"><span class="skolem">ts''</span></span> <span class="keyword2"><span class="keyword">where</span></span> cts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">ts'</span><span class="main">@</span> <span class="skolem">ts''</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ts''</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x2_cond
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id diff_diff_cancel length_drop<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">ts''2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="skolem">t1</span><span class="main">#</span><span class="skolem">ts''2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ts''2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts'</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv numeral_3_eq_3<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">t3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">t2</span><span class="main">,</span><span class="skolem">t3</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts''2</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_Suc_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> cts_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">ts'</span><span class="main">@</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">t2</span><span class="main">,</span><span class="skolem">t3</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cts_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> ts'_suffix<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ts'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">t2</span><span class="main">,</span> <span class="skolem">t3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tm'_def 16<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> cts_def2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> tm'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tm'</span> <span class="main">=</span> Type <span class="main">(</span><span class="skolem">ts'</span><span class="main">@</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tm'_def 16<span class="main">(</span>4<span class="main">)</span> cts_def2
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">ts'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">t3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span>"</span></span>
                         <span class="quoted"><span class="quoted">"ct_list_eq <span class="skolem">bs</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ts'_suffix
        <span class="keyword1"><span class="command">unfolding</span></span> ct_suffix_def to_ct_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span> <span class="main">=</span> T_i32"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def ct_list_eq_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_map_conv append_eq_append_conv ct_eq.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                  length_Cons list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> list_all2_Cons2 list_all2_lengthD<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x2_cond cts_def2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append.left_neutral append_Cons append_assoc length_append_singleton
                        nth_append_length<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ts'</span><span class="main">@</span><span class="main">[</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">t1</span><span class="main">]</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cts_def2
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>14<span class="main">,</span>35<span class="main">)</span> Type tm'_def 16<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>17 <span class="skolem">𝒞</span> <span class="skolem">tn''</span> <span class="skolem">tm''</span> <span class="skolem">es</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="skolem">tn''</span><span class="main">)</span> <span class="main">(</span>Type <span class="skolem">tm''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>b_e_type_checker <span class="main">(</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">tm''</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="skolem">es</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 17
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Block <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span> <span class="skolem">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ 17<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 17<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>18 <span class="skolem">𝒞</span> <span class="skolem">tn''</span> <span class="skolem">tm''</span> <span class="skolem">es</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="skolem">tn''</span><span class="main">)</span> <span class="main">(</span>Type <span class="skolem">tm''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>b_e_type_checker <span class="main">(</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">tn''</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="skolem">es</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 18
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Loop <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span> <span class="skolem">es</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>16<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ 18<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 18<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>19 <span class="skolem">𝒞</span> <span class="skolem">tn''</span> <span class="skolem">tm''</span> <span class="skolem">es1</span> <span class="skolem">es2</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tn''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Type <span class="skolem">tm''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>b_e_type_checker <span class="main">(</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">tm''</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="skolem">es1</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span>b_e_type_checker <span class="main">(</span><span class="skolem">𝒞</span><span class="main">⦇</span>label <span class="main">:=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">tm''</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="skolem">es2</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 19
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>If <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span> <span class="skolem">es1</span> <span class="skolem">es2</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tn''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>17<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ 19<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 19<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>20 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 20
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_top_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 20<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
            b_e_typing.intros<span class="main">(</span>18<span class="main">)</span>
            b_e_typing.intros<span class="main">(</span>35<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>21 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">(</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 21
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Br_if <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>19<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 21<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>22 <span class="skolem">𝒞</span> <span class="quoted">"<span class="skolem">is</span>"</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tls</span></span> <span class="keyword2"><span class="keyword">where</span></span> tls_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>same_lab <span class="main">(</span><span class="skolem">is</span><span class="main">@</span><span class="main">[</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>label <span class="skolem">𝒞</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">tls</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tls</span> <span class="main">@</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 22
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_top_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 22<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
            b_e_typing.intros<span class="main">(</span>20<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> same_lab_conv_list_all<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tls_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
            b_e_typing.intros<span class="main">(</span>35<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>23 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>return <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">ts_r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="skolem">ts_r</span><span class="main">)</span> <span class="main">(</span>TopType <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 23
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_top_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 23<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
            b_e_typing.intros<span class="main">(</span>21<span class="main">,</span>35<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>24 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tn''</span></span> <span class="skolem"><span class="skolem">tm''</span></span> <span class="keyword2"><span class="keyword">where</span></span> func_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>func_t <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tf.exhaust
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="skolem">tn''</span><span class="main">)</span> <span class="main">(</span>Type <span class="skolem">tm''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 24
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>func_t <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 24
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Call <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>22<span class="main">)</span> func_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 24<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>25 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tn''</span></span> <span class="skolem"><span class="skolem">tm''</span></span> <span class="keyword2"><span class="keyword">where</span></span> type_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>types_t <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tn''</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tf.exhaust
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">tn''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Type <span class="skolem">tm''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 25
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>table <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>types_t <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 25
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Call_indirect <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">tn''</span><span class="main">@</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="skolem">tm''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>23<span class="main">)</span> type_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 25<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>26 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 26
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Get_local <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>24<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 26<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.map_disc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>27 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 27
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Set_local <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>25<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 27<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>28 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 28
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Tee_local <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="main">(</span>local <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>26<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 28<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>29 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span>tg_t <span class="main">(</span><span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 29
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Get_global <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>tg_t <span class="main">(</span><span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>27<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 29<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.map_disc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>30 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">[</span>tg_t <span class="main">(</span><span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">∧</span> is_mut <span class="main">(</span>global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 30
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>tg_mut <span class="main">=</span> T_mut<span class="main">,</span> tg_t <span class="main">=</span> <span class="skolem">t</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>global <span class="skolem">𝒞</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_mut_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Set_global <span class="skolem">i</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span>tg_t <span class="main">(</span>global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>28<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">𝒞</span></span> <span class="quoted"><span class="quoted">"tg_t <span class="main">(</span>global <span class="skolem">𝒞</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_mut_def tg_t_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 30<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>31 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">tp_sx</span> <span class="skolem">a</span> <span class="skolem">off</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>memory <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> load_store_t_bounds <span class="skolem">a</span> <span class="main">(</span>option_projl <span class="skolem">tp_sx</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 31
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Load <span class="skolem">t</span> <span class="skolem">tp_sx</span> <span class="skolem">a</span> <span class="skolem">off</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>29<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 31<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>32 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">tp</span> <span class="skolem">a</span> <span class="skolem">off</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">[</span>T_i32<span class="main">,</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>memory <span class="skolem">𝒞</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> load_store_t_bounds <span class="skolem">a</span> <span class="skolem">tp</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 32
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Store <span class="skolem">t</span> <span class="skolem">tp</span> <span class="skolem">a</span> <span class="skolem">off</span><span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span>T_i32<span class="main">,</span><span class="skolem">t</span><span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>30<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 32<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>33 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">[]</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"memory <span class="skolem">𝒞</span> <span class="main">≠</span> None"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> 33
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Current_memory<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>31<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 33<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.map_disc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>34 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"type_update <span class="skolem">ts</span> <span class="main">(</span>to_ct_list <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Type <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tm'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"memory <span class="skolem">𝒞</span> <span class="main">≠</span> None"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> 34
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">⊢</span> <span class="main">[</span>Grow_memory<span class="main">]</span> <span class="main">:</span> <span class="main">(</span><span class="main">[</span>T_i32<span class="main">]</span> <span class="main">_&gt;</span> <span class="main">[</span>T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_typing.intros<span class="main">(</span>32<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_type_not_bot_sound<span class="main">[</span><span class="operator">OF</span> _ 34<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-check_single_imp"><span class="command">lemma</span></span> check_single_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> id
         <span class="main">∨</span> check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update_select <span class="bound">ctn</span><span class="main">)</span>
         <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cons</span> <span class="bound">prods</span><span class="main">.</span> <span class="main">(</span>check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="bound">cons</span> <span class="bound">prods</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">True</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">True</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> <span class="free">ctm</span> <span class="main">⟹</span>
       <span class="free">ctm</span> <span class="main">≠</span> Bot <span class="main">⟹</span>
         <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_type_checker_check_check_single.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">tn</span> <span class="skolem">tm</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">𝒞</span> <span class="skolem">v</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uu</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uw</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">ux</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uy</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">uz</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">va</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">𝒞</span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> convert_cond.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">𝒞</span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>16 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>17 <span class="skolem">𝒞</span> <span class="skolem">tn</span> <span class="skolem">tm</span> <span class="skolem">es</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>18 <span class="skolem">𝒞</span> <span class="skolem">tn</span> <span class="skolem">tm</span> <span class="skolem">es</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>19 <span class="skolem">𝒞</span> <span class="skolem">tn</span> <span class="skolem">tm</span> <span class="skolem">es1</span> <span class="skolem">es2</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>20 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>21 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>22 <span class="skolem">𝒞</span> <span class="quoted">"<span class="skolem">is</span>"</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.case_eq_if type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>23 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.case_eq_if type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>24 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tf.case tf.exhaust type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>25 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tf.case tf.exhaust type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>26 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>27 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>28 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>29 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>30 <span class="skolem">𝒞</span> <span class="skolem">i</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>31 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">tp_sx</span> <span class="skolem">a</span> <span class="skolem">off</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>32 <span class="skolem">𝒞</span> <span class="skolem">t</span> <span class="skolem">tp</span> <span class="skolem">a</span> <span class="skolem">off</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>33 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>34 <span class="skolem">𝒞</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-check_equiv_fold"><span class="command">lemma</span></span> check_equiv_fold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="free">ts</span> <span class="main">=</span> foldl <span class="main">(</span><span class="main">λ</span> <span class="bound">ts</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ts</span> <span class="keyword1">of</span> Bot <span class="main">⇒</span> Bot <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> check_single <span class="free">𝒞</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span> <span class="free">es</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span> <span class="skolem">ts</span> <span class="main">=</span> <span class="skolem">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> Bot"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ts'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">es</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ts'_def Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-check_neq_bot_snoc"><span class="command">lemma</span></span> check_neq_bot_snoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="free">ts</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="free">ts</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-check_unfold_snoc"><span class="command">lemma</span></span> check_unfold_snoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="free">ts</span> <span class="main">≠</span> Bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="free">ts</span> <span class="main">=</span> check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>check <span class="free">𝒞</span> <span class="free">es</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ts</span> <span class="keyword1">of</span> Bot <span class="main">⇒</span> Bot <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> check_single <span class="free">𝒞</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f_simp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ts</span><span class="main">.</span> <span class="bound">ts</span> <span class="main">≠</span> Bot <span class="main">⟹</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">e</span> <span class="bound">ts</span> <span class="main">=</span> check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">≠</span> Bot <span class="main">⟹</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">e</span> <span class="skolem">ts</span> <span class="main">=</span> check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="free">ts</span> <span class="main">=</span> foldl <span class="main">(</span><span class="main">λ</span> <span class="bound">ts</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ts</span> <span class="keyword1">of</span> Bot <span class="main">⇒</span> Bot <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> check_single <span class="free">𝒞</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span> <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_equiv_fold
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ts</span> <span class="keyword1">of</span> Bot <span class="main">⇒</span> Bot <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> check_single <span class="free">𝒞</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">es</span><span class="main">@</span><span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> foldl_conv_foldr
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">e</span> <span class="main">(</span>foldr <span class="main">(</span><span class="main">λ</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ts</span> <span class="keyword1">of</span> Bot <span class="main">⇒</span> Bot <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> check_single <span class="free">𝒞</span> <span class="bound">e</span> <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">es</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">e</span> <span class="main">(</span>check <span class="free">𝒞</span> <span class="free">es</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> foldr_conv_foldl<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="free">es</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span> rev_rev_ident<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">es</span></span><span class="main">]</span> check_equiv_fold
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>check <span class="free">𝒞</span> <span class="free">es</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f_simp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-check_single_imp_weakening"><span class="command">lemma</span></span> check_single_imp_weakening<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span> <span class="main">=</span> <span class="free">ctm</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">≠</span> Bot"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="free">ctn</span> <span class="free">t1s</span>"</span></span>
          <span class="quoted"><span class="quoted">"c_types_agree <span class="free">ctm</span> <span class="free">t2s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ctm'</span><span class="main">.</span> check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> <span class="bound">ctm'</span> <span class="main">∧</span> c_types_agree <span class="bound">ctm'</span> <span class="free">t2s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> id"</span></span> 
         <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update_select <span class="bound">ctn</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">cons</span> <span class="bound">prods</span><span class="main">.</span> <span class="main">(</span>check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="bound">cons</span> <span class="bound">prods</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_single_imp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">(* TODO: better proof *)</span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">note</span></span> outer_2 <span class="main">=</span> 2
    <span class="keyword1"><span class="command">hence</span></span> t1s_cond<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">t1s</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">(</span><span class="free">t1s</span><span class="main">!</span><span class="main">(</span>length <span class="free">t1s</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t1s</span><span class="main">!</span><span class="main">(</span>length <span class="free">t1s</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ctm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">=</span> consume <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c_t</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_t_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">=</span> Type <span class="skolem">c_t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> t2s_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2s</span> <span class="main">=</span> <span class="skolem">c_t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> t2s_len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">t2s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> t1s_cond ctm_def c_t_def assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI Suc_n_not_le_n checker_type.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                diff_is_0_eq dual_order.trans length_0_conv length_Cons length_greater_0_conv
                nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> numeral_3_eq_3 take_eq_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> t1s_suffix_full<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ctm_def ct_suffix_less
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> t1s_suffix<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ctm_def ct_suffix_less
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id last.simps list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">t1s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1s_suffix2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t1s</span> <span class="main">=</span> <span class="skolem">t1s'</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">,</span>T_i32<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> type_update_select_type_length3 assms<span class="main">(</span>1<span class="main">)</span> c_t_def outer_2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> t2s_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2s</span> <span class="main">=</span> <span class="skolem">t1s'</span><span class="main">@</span><span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ctm_def c_t_def t2s_eq t1s_suffix assms<span class="main">(</span>2<span class="main">)</span> t1s_suffix_full
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ctn</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">consider</span></span>
          <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 TopType
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> ct_suffix_singleton to_ct_list_def t2s_len
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> TopType ct_suffix_imp_ct_list_eq ct_suffix_shared t1s_suffix
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def append_Nil c_types_agree.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ct_list_eq_commute ct_suffix_def
                    diff_self_eq_0 drop_0 length_Cons list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> TopType <span class="main">[</span>TAny<span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> outer_2 TopType 2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> t2s_len ct_suffix_singleton
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_ct_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> t1s_suffix2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_list_eq_ts_conv_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> temp1<span class="main">:</span><span class="quoted"><span class="quoted">"to_ct_list <span class="free">t1s</span> <span class="main">=</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> t1s_suffix2 to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ct_suffix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_cons_it<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> TopType 3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> temp1 append_Nil ct_suffix_cons2 ct_suffix_def length_Cons length_map
                          list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> numeral_2_eq_2 to_ct_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> temp3<span class="main">:</span><span class="quoted"><span class="quoted">"ct_list_eq <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 3 ct_suffix_imp_ct_list_eq
          <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI ct_list_eq_commute diff_is_0_eq drop_0 length_Cons length_map lessI
                    list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> numeral_2_eq_2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> temp4<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="skolem">x1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> ct_suffix_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TSome <span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TSome T_i32<span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">]</span>
                ct_suffix_extend_ct_list_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> ct_suffix_nil
          <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span>take <span class="main">1</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> temp3 ct_suffix_nil ct_list_eq_commute ct_suffix_extend_ct_list_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">1</span> <span class="skolem">x1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_ct_list <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> butlast_conv_take ct_list_eq_take diff_Suc_1 length_Cons
                          list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> TopType 2 3 ct_suffix_nil temp3 temp4 t2s_def to_ct_list_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc ct_suffix_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> nat_def<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_if diff_Suc_1 le_Suc_ex numeral_3_eq_3 nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1'</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">x''</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1_split<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">x''</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x1'</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span><span class="main">.</span> <span class="skolem">x1</span> <span class="main">=</span> <span class="bound">x1'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">x''</span><span class="main">]</span> <span class="main">⟹</span> <span class="skolem">thesis</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1'</span></span> <span class="skolem"><span class="skolem">x1''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn_split<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">x1'</span><span class="main">@</span><span class="skolem">x1''</span>"</span></span>
                               <span class="quoted"><span class="quoted">"length <span class="skolem">x1''</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 4
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id diff_diff_cancel length_drop<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">x1''2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1''</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">#</span><span class="skolem">x1''2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1''2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv numeral_3_eq_3<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">x''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn''_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1''</span><span class="main">=</span> <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">x''</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> List.length_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x1''2</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_Suc_conv<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> tn_split local_assms
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">x''</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t</span><span class="main">,</span> T_i32<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> t1s_suffix2 assms<span class="main">(</span>3<span class="main">)</span> TopType
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ct_eq <span class="skolem">x''</span> <span class="main">(</span>TSome T_i32<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> to_ct_list_def ct_suffix_unfold_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span>"</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ct_eq <span class="skolem">x'</span> <span class="main">(</span>TSome <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> to_ct_list_def ct_suffix_unfold_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="main">(</span><span class="skolem">t1s'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">x1'</span> <span class="main">(</span>to_ct_list <span class="skolem">t1s'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ct_eq <span class="skolem">x</span> <span class="main">(</span>TSome <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> to_ct_list_def ct_suffix_unfold_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"to_ct_list <span class="main">(</span><span class="skolem">t1s'</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x1'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x1_split
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> x'_ind<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">!</span><span class="main">(</span>length <span class="skolem">x1</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x1_split List.nth_append_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> x_ind<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">!</span><span class="main">(</span>length <span class="skolem">x1</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x1_split
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">[</span>TSome T_i32<span class="main">]</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b x1_split ct_suffix_def ct_list_eq_def ct_suffixI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">]</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>select_return_top <span class="skolem">x1</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">!</span><span class="main">(</span>length <span class="skolem">x1</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">!</span><span class="main">(</span>length <span class="skolem">x1</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> type_update_select_conv_select_return_top<span class="main">[</span><span class="operator">OF</span> _ 4<span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> 2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">...</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">x'</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> x1_split 4 nat_def 2 x_ind x'_ind c d
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t2s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c t2s_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="main">(</span><span class="skolem">x1'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>to_ct_list <span class="free">t2s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ct_suffix_unfold_one<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TSome <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">x1'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_ct_list <span class="skolem">t1s'</span><span class="main">)</span>"</span></span><span class="main">]</span> c d
                t2s_def
          <span class="keyword1"><span class="command">unfolding</span></span> to_ct_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> TopType
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cons</span></span> <span class="skolem"><span class="skolem">prods</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_s_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="skolem">cons</span> <span class="skolem">prods</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> ctm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">=</span> type_update <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span> <span class="skolem">cons</span> <span class="skolem">prods</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> cons_suffix<span class="main">:</span><span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">cons</span> <span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> t_int_def<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span> <span class="skolem">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="main">(</span>take <span class="main">(</span>length <span class="free">t1s</span> <span class="main">-</span> length <span class="skolem">cons</span><span class="main">)</span> <span class="free">t1s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ctm_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> ctm_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">=</span> produce <span class="main">(</span>Type <span class="main">(</span>take <span class="main">(</span>length <span class="free">t1s</span> <span class="main">-</span> length <span class="skolem">cons</span><span class="main">)</span> <span class="free">t1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">prods</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ctm_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ctn</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">x1</span> <span class="main">(</span>to_ct_list <span class="free">t1s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ctm_def2
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">prods</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> consume_c_types_agree<span class="main">[</span><span class="operator">OF</span> t_int_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> ctm_def2 assms<span class="main">(</span>4<span class="main">)</span> c_s_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_types_agree.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> type_update.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> ctm_def3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ctm</span> <span class="main">=</span> Type <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free">t1s</span> <span class="main">-</span> length <span class="skolem">cons</span><span class="main">)</span> <span class="free">t1s</span><span class="main">)</span><span class="main">@</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ctm_def2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">x1</span> <span class="skolem">cons</span> <span class="main">∨</span> ct_suffix <span class="skolem">cons</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ct_suffix_shared assms<span class="main">(</span>3<span class="main">)</span> TopType cons_suffix
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">x1</span> <span class="skolem">cons</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">cons</span> <span class="main">=</span> TopType <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_length<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> TopType <span class="main">(</span>to_ct_list <span class="skolem">x2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> c_s_def TopType Type
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> TopType ctm_def3 assms<span class="main">(</span>4<span class="main">)</span> c_types_agree_top2 ct_list_eq_refl
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ct_suffix <span class="skolem">cons</span> <span class="skolem">x1</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">cons</span> <span class="main">=</span> TopType <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="skolem">cons</span> <span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_length<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">ctn</span> <span class="main">=</span> TopType <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="skolem">cons</span> <span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">@</span> to_ct_list <span class="skolem">x2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> c_s_def TopType Type
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>take <span class="main">(</span>length <span class="free">t1s</span> <span class="main">-</span> length <span class="skolem">cons</span> <span class="main">)</span> <span class="free">t1s</span><span class="main">)</span> <span class="main">@</span>  <span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="free">t2s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> ctm_def3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="skolem">cons</span> <span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">t1s</span> <span class="main">-</span> length <span class="skolem">cons</span><span class="main">)</span> <span class="free">t1s</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> consume_c_types_agree<span class="main">[</span><span class="operator">OF</span> t_int_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> 4 TopType
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>TopType <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="skolem">cons</span> <span class="main">)</span> <span class="skolem">x1</span> <span class="main">@</span> to_ct_list <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">t1s</span> <span class="main">-</span> length <span class="skolem">cons</span><span class="main">)</span> <span class="free">t1s</span> <span class="main">@</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> c_types_agree.simps to_ct_list_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ct_suffix_cons2 ct_suffix_cons_it ct_suffix_extend_ct_list_eq<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> ctm_def3 assms 3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Bot
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_type_checker_compose"><span class="command">lemma</span></span> b_e_type_checker_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">(</span><span class="free">t2s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="main">(</span><span class="free">es</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t3s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="free">t2s</span><span class="main">)</span><span class="main">)</span> <span class="free">t3s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ctm</span></span> <span class="keyword2"><span class="keyword">where</span></span> ctm_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="free">t2s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ctm</span>"</span></span>
                                <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ctm</span> <span class="free">t3s</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">ctm</span> <span class="main">≠</span> Bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span><span class="main">)</span> <span class="free">t2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ctn</span></span> <span class="keyword2"><span class="keyword">where</span></span> ctn_def<span class="main">:</span><span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ctn</span>"</span></span>
                                <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ctn</span> <span class="free">t2s</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">ctn</span> <span class="main">≠</span> Bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> check_single_imp_weakening<span class="main">[</span><span class="operator">OF</span> ctm_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> ctn_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ctm_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
          check_unfold_snoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_type_type"><span class="command">lemma</span></span> b_e_check_single_type_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tn</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>Type <span class="bound">tn</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> id"</span></span> 
         <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update_select <span class="bound">ctn</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">cons</span> <span class="bound">prods</span><span class="main">.</span> <span class="main">(</span>check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="bound">cons</span> <span class="bound">prods</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_single_imp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">note</span></span> outer_2 <span class="main">=</span> 2
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">consider</span></span>
          <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms 2 TopType
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms outer_2 TopType produce_type_type
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms 2 TopType
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> nat_def<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">x1</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_if diff_Suc_1 le_Suc_ex numeral_3_eq_3 nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms 2 TopType
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"produce <span class="main">(</span><span class="keyword1">if</span> ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="skolem">x1</span> <span class="keyword1">then</span> TopType <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x1</span> <span class="main">-</span> length <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span><span class="main">)</span> <span class="skolem">x1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> ct_suffix <span class="skolem">x1</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="keyword1">then</span> TopType <span class="main">[]</span> <span class="keyword1">else</span> Bot<span class="main">)</span> <span class="main">(</span>select_return_top <span class="skolem">x1</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> Suc <span class="skolem">nat</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">!</span> <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Type <span class="free">tm</span>"</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tts</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"checker_type <span class="main">⇒</span> t list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ca</span> <span class="bound">ts</span><span class="main">.</span> produce <span class="bound">c</span> <span class="bound">ca</span> <span class="main">≠</span> Type <span class="bound">ts</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">c</span> <span class="main">=</span> Type <span class="main">(</span><span class="skolem">tts</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> produce_type_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ts</span><span class="main">.</span> <span class="main">¬</span> ct_suffix <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="skolem">x1</span> <span class="main">∨</span> Type <span class="free">tm</span> <span class="main">≠</span> Type <span class="bound">ts</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ts</span><span class="main">.</span> <span class="main">¬</span> ct_suffix <span class="skolem">x1</span> <span class="main">[</span>TAny<span class="main">,</span> TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">∨</span> Type <span class="free">tm</span> <span class="main">≠</span> Type <span class="bound">ts</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> f3 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> assms 2 TopType nat_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cons</span></span> <span class="skolem"><span class="skolem">prods</span></span> <span class="keyword2"><span class="keyword">where</span></span> check_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="skolem">cons</span> <span class="skolem">prods</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"produce <span class="main">(</span>consume <span class="free">xs</span> <span class="skolem">cons</span><span class="main">)</span> <span class="skolem">prods</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms check_def consume_type_type produce_type_type
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_weaken_type"><span class="command">lemma</span></span> b_e_check_single_weaken_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> id"</span></span> 
         <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update_select <span class="bound">ctn</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">cons</span> <span class="bound">prods</span><span class="main">.</span> <span class="main">(</span>check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="bound">cons</span> <span class="bound">prods</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_single_imp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">hence</span></span> cond<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">tn</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">(</span><span class="free">tn</span><span class="main">!</span><span class="main">(</span>length <span class="free">tn</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">tn</span><span class="main">!</span><span class="main">(</span>length <span class="free">tn</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">=</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tm</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> consume_weaken_type
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>length <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>length <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cond
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add.commute add_leE nth_append_length_plus numeral_Bit1 numeral_One
                      one_add_one ordered_cancel_comm_monoid_diff_class.diff_add_assoc2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cons</span></span> <span class="skolem"><span class="skolem">prods</span></span> <span class="keyword2"><span class="keyword">where</span></span> check_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="skolem">cons</span> <span class="skolem">prods</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"produce <span class="main">(</span>consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="skolem">cons</span><span class="main">)</span> <span class="skolem">prods</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_int_def<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="skolem">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="skolem">t_int</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> check_def
            consume_weaken_type<span class="main">[</span><span class="operator">OF</span> t_int_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
            produce_weaken_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t_int</span></span> <span class="quoted"><span class="skolem">prods</span></span> <span class="quoted"><span class="free">tm</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_single_weaken_top"><span class="command">lemma</span></span> b_e_check_single_weaken_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">=</span> TopType <span class="free">tm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopType <span class="free">tm</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> id"</span></span> 
         <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update_select <span class="bound">ctn</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">cons</span> <span class="bound">prods</span><span class="main">.</span> <span class="main">(</span>check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="bound">cons</span> <span class="bound">prods</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_single_imp assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> checker_type.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cons</span></span> <span class="skolem"><span class="skolem">prods</span></span> <span class="keyword2"><span class="keyword">where</span></span> check_def<span class="main">:</span><span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ctn</span><span class="main">.</span> type_update <span class="bound">ctn</span> <span class="skolem">cons</span> <span class="skolem">prods</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"produce <span class="main">(</span>consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="skolem">cons</span><span class="main">)</span> <span class="skolem">prods</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="free">tm</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_int_def<span class="main">:</span><span class="quoted"><span class="quoted">"consume <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="skolem">cons</span> <span class="main">=</span> <span class="main">(</span>Type <span class="skolem">t_int</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> consume.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> produce.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> check_def consume_weaken_type
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">prods</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_weaken_type"><span class="command">lemma</span></span> b_e_check_weaken_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Type <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tm</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">tn</span></span> <span class="quoted"><span class="free">tm</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="skolem">e</span> <span class="main">(</span>check <span class="free">𝒞</span> <span class="skolem">es</span> <span class="main">(</span>Type <span class="skolem">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Type <span class="skolem">tm</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_unfold_snoc<span class="main">[</span><span class="operator">OF</span> check_neq_bot_snoc<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_check_single_weaken_type b_e_check_single_type_type snoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> check_unfold_snoc checker_type.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-check_bot"><span class="command">lemma</span></span> check_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> Bot <span class="main">=</span> Bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list.case_eq_if<span class="main">)</span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_check_weaken_top"><span class="command">lemma</span></span> b_e_check_weaken_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="free">tn</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>TopType <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">tn</span></span> <span class="quoted"><span class="free">tm</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>check_single <span class="free">𝒞</span> <span class="skolem">e</span> <span class="main">(</span>Type <span class="skolem">tn</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="skolem">e</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="skolem">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopType <span class="skolem">x1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_weaken_top
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TopType Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_single <span class="free">𝒞</span> <span class="skolem">e</span> <span class="main">(</span>Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="skolem">tn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Type <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="skolem">x2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_e_check_single_weaken_type
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons Type
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Bot
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> check_bot Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_type_checker_weaken"><span class="command">lemma</span></span> b_e_type_checker_weaken<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">t2s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">ts</span><span class="main">@</span><span class="free">t1s</span> <span class="main">_&gt;</span> <span class="free">ts</span><span class="main">@</span><span class="free">t2s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_types_agree <span class="main">(</span>check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span><span class="main">)</span> <span class="free">t2s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ctn</span></span> <span class="keyword2"><span class="keyword">where</span></span> ctn_def<span class="main">:</span><span class="quoted"><span class="quoted">"check <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span>Type <span class="free">t1s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ctn</span>"</span></span>
                                <span class="quoted"><span class="quoted">"c_types_agree <span class="skolem">ctn</span> <span class="free">t2s</span>"</span></span>
                                <span class="quoted"><span class="quoted">"<span class="skolem">ctn</span> <span class="main">≠</span> Bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ctn</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TopType <span class="skolem">x1</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ctn_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> b_e_check_weaken_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_assoc b_e_type_checker.simps c_types_agree_imp_ct_list_eq c_types_agree_top2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Type <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ctn_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> b_e_check_weaken_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">t1s</span></span> <span class="quoted"><span class="skolem">x2</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Bot
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ctn_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Checker_Properties-b_e_type_checker_complete"><span class="command">lemma</span></span> b_e_type_checker_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">tn</span></span> <span class="quoted"><span class="free">tm</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_typing.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>select <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ct_list_eq <span class="main">[</span>TAny<span class="main">,</span> TSome T_i32<span class="main">]</span> <span class="main">[</span>TSome <span class="skolem">t</span><span class="main">,</span> TSome T_i32<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_ct_list_def ct_list_eq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ct_suffix_extend_ct_list_eq<span class="main">[</span><span class="operator">OF</span> ct_suffix_nil<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>TSome <span class="skolem">t</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> to_ct_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br_table <span class="skolem">𝒞</span> <span class="skolem">ts</span> <span class="quoted">"<span class="skolem">is</span>"</span> <span class="skolem">i</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> list_all_conv_same_lab<span class="main">[</span><span class="operator">OF</span> br_table<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_ct_list_def ct_suffix_nil ct_suffix_cons_it<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>set_global <span class="skolem">i</span> <span class="skolem">𝒞</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> to_ct_list_def ct_suffix_refl is_mut_def tg_t_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>composition <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">e</span> <span class="skolem">t3s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_checker_compose
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>weakening <span class="skolem">𝒞</span> <span class="skolem">es</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b_e_type_checker_weaken
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_ct_list_def ct_suffix_refl ct_suffix_nil ct_suffix_cons_it
                    ct_suffix_singleton_any<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> b_e_typing_equiv_b_e_type_checker<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒞</span> <span class="main">⊢</span> <span class="free">es</span> <span class="main">:</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>b_e_type_checker <span class="free">𝒞</span> <span class="free">es</span> <span class="main">(</span><span class="free">tn</span> <span class="main">_&gt;</span> <span class="free">tm</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b_e_type_checker_sound b_e_type_checker_complete
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Interpreter">
<div class="head">
<h1>Theory Wasm_Interpreter</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹WebAssembly Interpreter›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Interpreter <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm.html">Wasm</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> res_crash <span class="main">=</span>
  CError
<span class="main">|</span> CExhaustion

<span class="keyword1"><span class="command">datatype</span></span> res <span class="main">=</span>
  RCrash <span class="quoted">res_crash</span>
<span class="main">|</span> RTrap
<span class="main">|</span> RValue <span class="quoted"><span class="quoted">"v list"</span></span>  

<span class="keyword1"><span class="command">datatype</span></span> res_step <span class="main">=</span>
  RSCrash <span class="quoted">res_crash</span>
<span class="main">|</span> RSBreak <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"v list"</span></span>
<span class="main">|</span> RSReturn <span class="quoted"><span class="quoted">"v list"</span></span>
<span class="main">|</span> RSNormal <span class="quoted"><span class="quoted">"e list"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">crash_error</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">crash_error</span> <span class="main">≡</span> RSCrash CError"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> depth <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> fuel <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">type_synonym</span></span> config_tuple <span class="main">=</span> <span class="quoted"><span class="quoted">"s <span class="main">×</span> v list <span class="main">×</span> e list"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> config_one_tuple <span class="main">=</span> <span class="quoted"><span class="quoted">" s <span class="main">×</span> v list <span class="main">×</span> v list <span class="main">×</span> e"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> res_tuple <span class="main">=</span> <span class="quoted"><span class="quoted">"s <span class="main">×</span> v list <span class="main">×</span> res_step"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">split_vals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"b_e list <span class="main">⇒</span> v list <span class="main">×</span> b_e list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">split_vals</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">vs'</span><span class="main">,</span> <span class="bound">es'</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_vals</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="keyword1">in</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">#</span><span class="bound">vs'</span><span class="main">,</span> <span class="bound">es'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_vals</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">split_vals_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"e list <span class="main">⇒</span> v list <span class="main">×</span> e list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">split_vals_e</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span> <span class="keyword1">C</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">vs'</span><span class="main">,</span> <span class="bound">es'</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_vals_e</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="keyword1">in</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">#</span><span class="bound">vs'</span><span class="main">,</span> <span class="bound">es'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_vals_e</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">split_n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"v list <span class="main">⇒</span> nat <span class="main">⇒</span> v list <span class="main">×</span> v list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">split_n</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_n</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_n</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">es'</span><span class="main">,</span> <span class="bound">es''</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_n</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">in</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="bound">es'</span><span class="main">,</span> <span class="bound">es''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Interpreter-split_n_conv_take_drop"><span class="command">lemma</span></span> split_n_conv_take_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"split_n <span class="free">es</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">es</span><span class="main">,</span> drop <span class="free">n</span> <span class="free">es</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_n.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter-split_n_length"><span class="command">lemma</span></span> split_n_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_n <span class="free">es</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">es1</span><span class="main">,</span> <span class="free">es2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">es</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">es1</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> split_n_conv_take_drop
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Interpreter-split_n_conv_app"><span class="command">lemma</span></span> split_n_conv_app<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_n <span class="free">es</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">es1</span><span class="main">,</span> <span class="free">es2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="free">es1</span><span class="main">@</span><span class="free">es2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> split_n_conv_take_drop
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter-app_conv_split_n"><span class="command">lemma</span></span> app_conv_split_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="free">es1</span><span class="main">@</span><span class="free">es2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"split_n <span class="free">es</span> <span class="main">(</span>length <span class="free">es1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">es1</span><span class="main">,</span> <span class="free">es2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> split_n_conv_take_drop
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter-split_vals_const_list"><span class="command">lemma</span></span> split_vals_const_list<span class="main">:</span> <span class="quoted"><span class="quoted">"split_vals <span class="main">(</span>map EConst <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vs</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter-split_vals_e_const_list"><span class="command">lemma</span></span> split_vals_e_const_list<span class="main">:</span> <span class="quoted"><span class="quoted">"split_vals_e <span class="main">(</span><span class="main">$$*</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vs</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter-split_vals_e_conv_app"><span class="command">lemma</span></span> split_vals_e_conv_app<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_vals_e <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">$$*</span> <span class="free">as</span><span class="main">)</span><span class="main">@</span><span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_vals_e.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">v</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"split_vals_e <span class="skolem">es</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> surj_pair<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">expect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">expect</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span>
                     Some <span class="bound">a'</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">a'</span>
                   <span class="main">|</span> None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vs_to_es</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" v list <span class="main">⇒</span> e list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs_to_es</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">$$*</span> <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">e_is_trap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"e <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">e_is_trap</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span> Trap <span class="main">⇒</span> True <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">es_is_trap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"e list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">es_is_trap</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="keyword1">of</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">⇒</span> e_is_trap <span class="bound">e</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"e_is_trap <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> Trap<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e_is_trap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"es_is_trap <span class="free">es</span> <span class="main">=</span> <span class="main">(</span><span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">es</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> es_is_trap_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> outer_Cons<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> outer_Cons es_is_trap_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> es_is_trap_def outer_Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> 
  <span class="free">mem_grow_impl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> nat <span class="main">⇒</span> mem option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  mem_grow_impl_correct<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mem_grow_impl</span> <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> Some <span class="free">m'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>mem_grow <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m'</span><span class="main">)</span>"</span></span>

<span class="comment1">(*
definition mem_grow_impl:: "mem ⇒ nat ⇒ mem option" where
  "mem_grow_impl m n = Some (mem_grow m n)"

lemma mem_grow_impl_correct:
  "(mem_grow_impl m n = Some m') ⟹ (mem_grow m n = m')"
  unfolding mem_grow_impl_def
*)</span>
<span class="keyword1"><span class="command">axiomatization</span></span> 
  <span class="free">host_apply_impl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"s <span class="main">⇒</span> tf <span class="main">⇒</span> host <span class="main">⇒</span> v list <span class="main">⇒</span> <span class="main">(</span>s <span class="main">×</span> v list<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  host_apply_impl_correct<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">host_apply_impl</span> <span class="free">s</span> <span class="free">tf</span> <span class="free">h</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="free">m'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">hs</span><span class="main">.</span> host_apply <span class="free">s</span> <span class="free">tf</span> <span class="free">h</span> <span class="free">vs</span> <span class="bound">hs</span> <span class="main">=</span> Some <span class="free">m'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span>                                                                               
    <span class="entity">run_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"depth <span class="main">⇒</span> nat <span class="main">⇒</span> config_tuple <span class="main">⇒</span> res_tuple"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">run_one_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"depth <span class="main">⇒</span> nat <span class="main">⇒</span> config_one_tuple <span class="main">⇒</span> res_tuple"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run_step</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">ves</span><span class="main">,</span> <span class="bound">es'</span><span class="main">)</span> <span class="main">=</span> split_vals_e <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="keyword1">in</span>
                             <span class="keyword1">case</span> <span class="bound">es'</span> <span class="keyword1">of</span>
                               <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                             <span class="main">|</span> <span class="bound">e</span><span class="main">#</span><span class="bound">es''</span> <span class="main">⇒</span>
                               <span class="keyword1">if</span> e_is_trap <span class="bound">e</span>
                                 <span class="keyword1">then</span>
                                   <span class="keyword1">if</span> <span class="main">(</span><span class="bound">es''</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">ves</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
                                     <span class="keyword1">then</span>
                                       <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span>
                                     <span class="keyword1">else</span>
                                       <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                                 <span class="keyword1">else</span>
                                   <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">vs'</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">run_one_step</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span><span class="main">(</span>rev <span class="bound">ves</span><span class="main">)</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="keyword1">in</span>
                                    <span class="keyword1">case</span> <span class="bound">r</span> <span class="keyword1">of</span>
                                      RSNormal <span class="bound">res</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> RSNormal <span class="main">(</span><span class="bound">res</span><span class="main">@</span><span class="bound">es''</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_one_step</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>B_E›</span></span>›</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>UNOPS›</span></span>›</span>
        <span class="main">$</span><span class="main">(</span>Unop_i T_i32 <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span>
         <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
            <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
              <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>app_unop_i <span class="bound">iop</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Unop_i T_i64 <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt64 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt64 <span class="main">(</span>app_unop_i <span class="bound">iop</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Unop_i <span class="main"><span class="bound">_</span></span> <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Unop_f T_f32 <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstFloat32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstFloat32 <span class="main">(</span>app_unop_f <span class="bound">fop</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Unop_f T_f64 <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstFloat64 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstFloat64 <span class="main">(</span>app_unop_f <span class="bound">fop</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Unop_f <span class="main"><span class="bound">_</span></span> <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>BINOPS›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Binop_i T_i32 <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstInt32 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                expect <span class="main">(</span>app_binop_i <span class="bound">iop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Binop_i T_i64 <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt64 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstInt64 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                expect <span class="main">(</span>app_binop_i <span class="bound">iop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt64 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Binop_i <span class="main"><span class="bound">_</span></span> <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Binop_f T_f32 <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstFloat32 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstFloat32 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                expect <span class="main">(</span>app_binop_f <span class="bound">fop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstFloat32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Binop_f T_f64 <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
           <span class="main">(</span>ConstFloat64 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstFloat64 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
              expect <span class="main">(</span>app_binop_f <span class="bound">fop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstFloat64 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
         <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Binop_f <span class="main"><span class="bound">_</span></span> <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>TESTOPS›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Testop T_i32 <span class="bound">testop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_testop_i <span class="bound">testop</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Testop T_i64 <span class="bound">testop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt64 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_testop_i <span class="bound">testop</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Testop <span class="main"><span class="bound">_</span></span> <span class="bound">testop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>RELOPS›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Relop_i T_i32 <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstInt32 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_i <span class="bound">iop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Relop_i T_i64 <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt64 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstInt64 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_i <span class="bound">iop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Relop_i <span class="main"><span class="bound">_</span></span> <span class="bound">iop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Relop_f T_f32 <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstFloat32 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstFloat32 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_f <span class="bound">fop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Relop_f T_f64 <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstFloat64 <span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>ConstFloat64 <span class="bound">c1</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>wasm_bool <span class="main">(</span>app_relop_f <span class="bound">fop</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Relop_f <span class="main"><span class="bound">_</span></span> <span class="bound">fop</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>CONVERT›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Cvtop <span class="bound">t2</span> Convert <span class="bound">t1</span> <span class="bound">sx</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>types_agree <span class="bound">t1</span> <span class="bound">v</span><span class="main">)</span>
                  <span class="keyword1">then</span>
                    expect <span class="main">(</span>cvt <span class="bound">t2</span> <span class="bound">sx</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="bound">v'</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Cvtop <span class="bound">t2</span> Reinterpret <span class="bound">t1</span> <span class="bound">sx</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>types_agree <span class="bound">t1</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">sx</span> <span class="main">=</span> None<span class="main">)</span>
                  <span class="keyword1">then</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>wasm_deserialise <span class="main">(</span>bits <span class="bound">v</span><span class="main">)</span> <span class="bound">t2</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>UNREACHABLE›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Unreachable <span class="main">⇒</span>
          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>NOP›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Nop <span class="main">⇒</span>
          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>DROP›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Drop <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>SELECT›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Select <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">v2</span><span class="main">#</span><span class="bound">v1</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="keyword1">if</span> int_eq <span class="bound">c</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="bound">v2</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="bound">v1</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>BLOCK›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Block <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">es</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">≥</span> length <span class="bound">t1s</span>
             <span class="keyword1">then</span>
               <span class="keyword1">let</span> <span class="main">(</span><span class="bound">ves'</span><span class="main">,</span> <span class="bound">ves''</span><span class="main">)</span> <span class="main">=</span> split_n <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">(</span>length <span class="bound">t1s</span><span class="main">)</span> <span class="keyword1">in</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves''</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>Label <span class="main">(</span>length <span class="bound">t2s</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">else</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LOOP›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Loop <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">es</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">≥</span> length <span class="bound">t1s</span>
             <span class="keyword1">then</span>
               <span class="keyword1">let</span> <span class="main">(</span><span class="bound">ves'</span><span class="main">,</span> <span class="bound">ves''</span><span class="main">)</span> <span class="main">=</span> split_n <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">(</span>length <span class="bound">t1s</span><span class="main">)</span> <span class="keyword1">in</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves''</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>Label <span class="main">(</span>length <span class="bound">t1s</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Loop <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">es</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="main">$*</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">else</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>IF›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>If <span class="bound">tf</span> <span class="bound">es1</span> <span class="bound">es2</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                <span class="keyword1">if</span> int_eq <span class="bound">c</span> <span class="main">0</span>
                  <span class="keyword1">then</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="bound">tf</span> <span class="bound">es2</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="bound">tf</span> <span class="bound">es1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>BR›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Br <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSBreak <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>BR_IF›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Br_if <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                <span class="keyword1">if</span> int_eq <span class="bound">c</span> <span class="main">0</span>
                  <span class="keyword1">then</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>BR_TABLE›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Br_table <span class="bound">js</span> <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
             <span class="keyword1">let</span> <span class="bound">k</span> <span class="main">=</span> nat_of_int <span class="bound">c</span> <span class="keyword1">in</span>
                <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="bound">js</span>
                  <span class="keyword1">then</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="main">(</span><span class="bound">js</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>CALL›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Call <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="main">(</span>sfunc <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>CALL_INDIRECT›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Call_indirect <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>stab <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>nat_of_int <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span>
                  Some <span class="bound">cl</span> <span class="main">⇒</span>
                    <span class="keyword1">if</span> <span class="main">(</span>stypes <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="main">=</span> cl_type <span class="bound">cl</span><span class="main">)</span>
                      <span class="keyword1">then</span>
                        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="bound">cl</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">else</span>
                        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
                <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>RETURN›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Return <span class="main">⇒</span>
          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSReturn <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>GET_LOCAL›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Get_local <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span>
             <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>SET_LOCAL›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Set_local <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span>
                 <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">[</span><span class="bound">j</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">]</span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">)</span>
                 <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>TEE_LOCAL›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Tee_local <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="main">(</span><span class="bound">v</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Set_local <span class="bound">j</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>GET_GLOBAL›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Get_global <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>sglob_val <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>SET_GLOBAL›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Set_global <span class="bound">j</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>supdate_glob <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LOAD›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Load <span class="bound">t</span> None <span class="bound">a</span> <span class="bound">off</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">k</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               expect <span class="main">(</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span>
                    expect <span class="main">(</span>load <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="bound">k</span><span class="main">)</span> <span class="bound">off</span> <span class="main">(</span>t_length <span class="bound">t</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="main">λ</span><span class="bound">bs</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>wasm_deserialise <span class="bound">bs</span> <span class="bound">t</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LOAD PACKED›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Load <span class="bound">t</span> <span class="main">(</span>Some <span class="main">(</span><span class="bound">tp</span><span class="main">,</span> <span class="bound">sx</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">off</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">k</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               expect <span class="main">(</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span>
                    expect <span class="main">(</span>load_packed <span class="bound">sx</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="bound">k</span><span class="main">)</span> <span class="bound">off</span> <span class="main">(</span>tp_length <span class="bound">tp</span><span class="main">)</span> <span class="main">(</span>t_length <span class="bound">t</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="main">λ</span><span class="bound">bs</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>wasm_deserialise <span class="bound">bs</span> <span class="bound">t</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>STORE›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Store <span class="bound">t</span> None <span class="bound">a</span> <span class="bound">off</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="bound">v</span><span class="main">#</span><span class="main">(</span>ConstInt32 <span class="bound">k</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>types_agree <span class="bound">t</span> <span class="bound">v</span><span class="main">)</span>
                 <span class="keyword1">then</span>
                   expect <span class="main">(</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                      <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span>
                         expect <span class="main">(</span>store <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="bound">k</span><span class="main">)</span> <span class="bound">off</span> <span class="main">(</span>bits <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>t_length <span class="bound">t</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="main">λ</span><span class="bound">mem'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>mem<span class="main">:=</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="bound">j</span> <span class="main">:=</span> <span class="bound">mem'</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                 <span class="keyword1">else</span>
                   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>STORE_PACKED›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span><span class="main">(</span>Store <span class="bound">t</span> <span class="main">(</span>Some <span class="bound">tp</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">off</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
                  <span class="bound">v</span><span class="main">#</span><span class="main">(</span>ConstInt32 <span class="bound">k</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>types_agree <span class="bound">t</span> <span class="bound">v</span><span class="main">)</span>
                      <span class="keyword1">then</span>
                        expect <span class="main">(</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                           <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span>
                              expect <span class="main">(</span>store_packed <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="bound">k</span><span class="main">)</span> <span class="bound">off</span> <span class="main">(</span>bits <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>tp_length <span class="bound">tp</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">(</span><span class="main">λ</span><span class="bound">mem'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>mem<span class="main">:=</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="bound">j</span> <span class="main">:=</span> <span class="bound">mem'</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                      <span class="keyword1">else</span>
                        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
                <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>CURRENT_MEMORY›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Current_memory <span class="main">⇒</span>
          expect <span class="main">(</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>int_of_nat <span class="main">(</span>mem_size <span class="main">(</span><span class="main">(</span>s.mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>GROW_MEMORY›</span></span>›</span>
      <span class="main">|</span> <span class="main">$</span>Grow_memory <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span>ConstInt32 <span class="bound">c</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span> <span class="main">⇒</span>
                expect <span class="main">(</span>smem_ind <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span>
                     <span class="keyword1">let</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span>mem_size <span class="main">(</span><span class="main">(</span>s.mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
                     <span class="main">(</span>expect <span class="main">(</span>mem_grow_impl <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="bound">c</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span><span class="main">λ</span><span class="bound">mem'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦇</span>mem<span class="main">:=</span> <span class="main">(</span><span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">[</span><span class="bound">j</span> <span class="main">:=</span> <span class="bound">mem'</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 <span class="main">(</span>int_of_nat <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>ConstInt32 int32_minus_one<span class="main">)</span><span class="main">#</span><span class="bound">ves'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
           <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>VAL›</span></span> - should not be executed›</span>
      <span class="main">|</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">v</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>E›</span></span>›</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>CALLCL›</span></span>›</span>
      <span class="main">|</span> Callcl <span class="bound">cl</span> <span class="main">⇒</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="bound">cl</span> <span class="keyword1">of</span>
             Func_native <span class="bound">i'</span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">ts</span> <span class="bound">es</span> <span class="main">⇒</span>
               <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> length <span class="bound">t1s</span> <span class="keyword1">in</span>
               <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">t2s</span> <span class="keyword1">in</span>
               <span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">≥</span> <span class="bound">n</span>
                 <span class="keyword1">then</span>
                   <span class="keyword1">let</span> <span class="main">(</span><span class="bound">ves'</span><span class="main">,</span> <span class="bound">ves''</span><span class="main">)</span> <span class="main">=</span> split_n <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="bound">n</span> <span class="keyword1">in</span>
                   <span class="keyword1">let</span> <span class="bound">zs</span> <span class="main">=</span> n_zeros <span class="bound">ts</span> <span class="keyword1">in</span>
                     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves''</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Local <span class="bound">m</span> <span class="bound">i'</span> <span class="main">(</span><span class="main">(</span>rev <span class="bound">ves'</span><span class="main">)</span><span class="main">@</span><span class="bound">zs</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span><span class="main">(</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">es</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="keyword1">else</span>
                   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
           <span class="main">|</span> Func_host <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">f</span> <span class="main">⇒</span>
               <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> length <span class="bound">t1s</span> <span class="keyword1">in</span>
               <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">t2s</span> <span class="keyword1">in</span>
               <span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="main">≥</span> <span class="bound">n</span>
                 <span class="keyword1">then</span>
                   <span class="keyword1">let</span> <span class="main">(</span><span class="bound">ves'</span><span class="main">,</span> <span class="bound">ves''</span><span class="main">)</span> <span class="main">=</span> split_n <span class="free"><span class="bound"><span class="entity">ves</span></span></span> <span class="bound">n</span> <span class="keyword1">in</span>
                   <span class="keyword1">case</span> host_apply_impl <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="bound">t1s</span> <span class="main">_&gt;</span> <span class="bound">t2s</span><span class="main">)</span> <span class="bound">f</span> <span class="main">(</span>rev <span class="bound">ves'</span><span class="main">)</span> <span class="keyword1">of</span>
                     Some <span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">rves</span><span class="main">)</span> <span class="main">⇒</span> 
                       <span class="keyword1">if</span> list_all2 types_agree <span class="bound">t2s</span> <span class="bound">rves</span>
                         <span class="keyword1">then</span>
                           <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves''</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">$$*</span> <span class="bound">rves</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">else</span>
                           <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                   <span class="main">|</span> None <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="bound">ves''</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
                 <span class="keyword1">else</span>
                   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LABEL›</span></span>›</span>
      <span class="main">|</span> Label <span class="bound">ln</span> <span class="bound">les</span> <span class="bound">es</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> es_is_trap <span class="bound">es</span>
            <span class="keyword1">then</span>
              <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">else</span>
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>const_list <span class="bound">es</span><span class="main">)</span>
                  <span class="keyword1">then</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="bound">es</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> <span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="free">run_step</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> <span class="bound">es</span><span class="main">)</span> <span class="keyword1">in</span>
                    <span class="main">(</span><span class="keyword1">case</span> <span class="bound">res</span> <span class="keyword1">of</span>
                       RSBreak <span class="main">0</span> <span class="bound">bvs</span> <span class="main">⇒</span>
                         <span class="keyword1">if</span> <span class="main">(</span>length <span class="bound">bvs</span> <span class="main">≥</span> <span class="bound">ln</span><span class="main">)</span>
                           <span class="keyword1">then</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>take <span class="bound">ln</span> <span class="bound">bvs</span><span class="main">)</span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="bound">les</span><span class="main">)</span><span class="main">)</span>
                           <span class="keyword1">else</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> crash_error<span class="main">)</span>
                     <span class="main">|</span> RSBreak <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="bound">bvs</span> <span class="main">⇒</span>
                         <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> RSBreak <span class="bound">n</span> <span class="bound">bvs</span><span class="main">)</span>
                     <span class="main">|</span> RSReturn <span class="bound">rvs</span> <span class="main">⇒</span>
                         <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> RSReturn <span class="bound">rvs</span><span class="main">)</span>
                     <span class="main">|</span> RSNormal <span class="bound">es'</span> <span class="main">⇒</span>
                         <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Label <span class="bound">ln</span> <span class="bound">les</span> <span class="bound">es'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LOCAL›</span></span>›</span>
     <span class="main">|</span> Local <span class="bound">ln</span> <span class="bound">j</span> <span class="bound">vls</span> <span class="bound">es</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> es_is_trap <span class="bound">es</span>
            <span class="keyword1">then</span>
              <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">else</span>
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>const_list <span class="bound">es</span><span class="main">)</span>
                  <span class="keyword1">then</span>
                    <span class="keyword1">if</span> <span class="main">(</span>length <span class="bound">es</span> <span class="main">=</span> <span class="bound">ln</span><span class="main">)</span>
                      <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="bound">es</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                  <span class="keyword1">else</span>
                    <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">of</span>
                      <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                    <span class="main">|</span> Suc <span class="bound">d'</span> <span class="main">⇒</span>
                        <span class="keyword1">let</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">vls'</span><span class="main">,</span> <span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="free">run_step</span> <span class="bound">d'</span> <span class="bound">j</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="bound">vls</span><span class="main">,</span> <span class="bound">es</span><span class="main">)</span> <span class="keyword1">in</span>
                        <span class="main">(</span><span class="keyword1">case</span> <span class="bound">res</span> <span class="keyword1">of</span>
                           RSReturn <span class="bound">rvs</span> <span class="main">⇒</span>
                             <span class="keyword1">if</span> <span class="main">(</span>length <span class="bound">rvs</span> <span class="main">≥</span> <span class="bound">ln</span><span class="main">)</span>
                               <span class="keyword1">then</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>take <span class="bound">ln</span> <span class="bound">rvs</span><span class="main">)</span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="keyword1">else</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span>
                         <span class="main">|</span> RSNormal <span class="bound">es'</span> <span class="main">⇒</span>
                             <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSNormal <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">ves</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Local <span class="bound">ln</span> <span class="bound">j</span> <span class="bound">vls'</span> <span class="bound">es'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> RSCrash CExhaustion<span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>TRAP›</span></span> - should not be executed›</span>
     <span class="main">|</span> Trap <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> crash_error<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"e list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">as</span> <span class="skolem">b</span> <span class="skolem">bs</span>
    <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">as</span><span class="main">,</span> <span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> split_vals_e <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">(</span>size <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>size_list size <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local_assms<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> split_vals_e_conv_app
            size_list_estimation'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="quoted">"size <span class="skolem">b</span>"</span></span> <span class="quoted">size</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> size_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span>case_sum
                               <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>size_list size <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
                               <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> size <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">run_v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fuel <span class="main">⇒</span> depth <span class="main">⇒</span> nat <span class="main">⇒</span> config_tuple <span class="main">⇒</span> <span class="main">(</span>s <span class="main">×</span> res<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run_v</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>es_is_trap <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>
                                    <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> RTrap<span class="main">)</span>
                                    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>const_list <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>
                                           <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> RValue <span class="main">(</span>fst <span class="main">(</span>split_vals_e <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                           <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">vs'</span><span class="main">,</span><span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>run_step <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
                                                 <span class="keyword1">case</span> <span class="bound">res</span> <span class="keyword1">of</span>
                                                   RSNormal <span class="bound">es'</span> <span class="main">⇒</span> <span class="free">run_v</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">vs'</span><span class="main">,</span><span class="bound">es'</span><span class="main">)</span>
                                                 <span class="main">|</span> RSCrash <span class="bound">error</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> RCrash <span class="bound">error</span><span class="main">)</span>
                                                 <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> RCrash CError<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_v</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> RCrash CExhaustion<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Interpreter_Properties">
<div class="head">
<h1>Theory Wasm_Interpreter_Properties</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness of Interpreter›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wasm_Interpreter_Properties <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Interpreter.html">Wasm_Interpreter</a> <a href="Wasm_Properties.html">Wasm_Properties</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-is_const_list_vs_to_es_list"><span class="command">lemma</span></span> is_const_list_vs_to_es_list<span class="main">:</span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$$*</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_const_list
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-not_const_vs_to_es_list"><span class="command">lemma</span></span> not_const_vs_to_es_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>is_const <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs1</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs2</span> <span class="main">≠</span> <span class="main">$$*</span> <span class="free">vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vs</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs1</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs2</span> <span class="main">=</span> <span class="main">$$*</span> <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="main">(</span><span class="free">vs1</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs1</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">@</span> <span class="free">vs2</span> <span class="main">≠</span> <span class="main">$$*</span> <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-neq_label_nested"><span class="command">lemma</span></span> neq_label_nested<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span>Label <span class="free">n</span> <span class="free">les</span> <span class="free">es</span><span class="main">]</span> <span class="main">≠</span> <span class="free">es</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size_list size <span class="main">[</span>Label <span class="free">n</span> <span class="free">les</span> <span class="free">es</span><span class="main">]</span> <span class="main">&gt;</span> size_list size <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-neq_local_nested"><span class="command">lemma</span></span> neq_local_nested<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">lvs</span> <span class="free">es</span><span class="main">]</span> <span class="main">≠</span> <span class="free">es</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size_list size <span class="main">[</span>Local <span class="free">n</span> <span class="free">i</span> <span class="free">lvs</span> <span class="free">es</span><span class="main">]</span> <span class="main">&gt;</span> size_list size <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-trap_not_value"><span class="command">lemma</span></span> trap_not_value<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span>Trap<span class="main">]</span> <span class="main">≠</span> <span class="main">$$*</span><span class="free">es</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">thm</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-lfilled_single"><span class="command">lemma</span></span> lfilled_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">k</span> <span class="free">lholed</span> <span class="free">es</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">e</span> <span class="main">≠</span> Label <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">es</span> <span class="main">=</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">∧</span> <span class="free">lholed</span> <span class="main">=</span> LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∨</span> <span class="free">es</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">es'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv append_self_conv2 butlast_append butlast_snoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">es'</span> <span class="skolem">l</span> <span class="skolem">es''</span> <span class="skolem">k</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">e</span> <span class="main">≠</span> Label <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> LN<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Cons_eq_append_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-lfilled_eq"><span class="command">lemma</span></span> lfilled_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
          <span class="quoted"><span class="quoted">"Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="free">es'</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="free">es'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">es'</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">vs</span> <span class="skolem">lholed</span> <span class="skolem">n</span> <span class="skolem">les'</span> <span class="skolem">l</span> <span class="skolem">les''</span> <span class="skolem">k</span> <span class="skolem">les</span> <span class="skolem">lfilledk</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"LRec <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">les'</span> <span class="skolem">l</span> <span class="skolem">les''</span>"</span></span> <span class="quoted"><span class="skolem">es'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">les'</span> <span class="skolem">lfilledk</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">les''</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-lfilled_size"><span class="command">lemma</span></span> lfilled_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="free">j</span> <span class="free">lholed</span> <span class="free">es</span> <span class="free">LI</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"size_list size <span class="free">LI</span> <span class="main">≥</span> size_list size <span class="free">es</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">thm</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">es</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_simple_not_eq"><span class="command">lemma</span></span> reduce_simple_not_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="free">es'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label_const <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> neq_label_nested
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>br <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">lholed</span> <span class="skolem">LI</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size_list size <span class="main">[</span>Label <span class="skolem">n</span> <span class="skolem">es</span> <span class="skolem">LI</span><span class="main">]</span> <span class="main">&gt;</span> size_list size <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lfilled_size<span class="main">[</span><span class="operator">OF</span> br<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>local_const <span class="skolem">es</span> <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> neq_local_nested
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>return <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">j</span> <span class="skolem">lholed</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">vls</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"size_list size <span class="main">[</span>Local <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">vls</span> <span class="skolem">es</span><span class="main">]</span> <span class="main">&gt;</span> size_list size <span class="skolem">vs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lfilled_size<span class="main">[</span><span class="operator">OF</span> return<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_not_eq"><span class="command">lemma</span></span> reduce_not_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="free">es'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple_not_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_host_Some <span class="skolem">cl</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">f</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">hs</span> <span class="skolem">s'</span> <span class="skolem">vcs'</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vcs'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rev_cases<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lfilled_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_simple_not_value"><span class="command">lemma</span></span> reduce_simple_not_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">$$*</span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>block <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">m</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const <span class="main">(</span><span class="main">$</span>Block <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_const_vs_to_es_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>loop <span class="skolem">vs</span> <span class="skolem">n</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">m</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const <span class="main">(</span><span class="main">$</span>Loop <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_const_vs_to_es_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trap <span class="skolem">lholed</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> trap<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> L0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const Trap<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> L0 not_const_vs_to_es_list
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_not_value"><span class="command">lemma</span></span> reduce_not_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">$$*</span> <span class="free">ves</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ves</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple_not_value
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_native <span class="skolem">cl</span> <span class="skolem">i'</span> <span class="skolem">j</span> <span class="skolem">ts</span> <span class="skolem">es</span> <span class="skolem">s</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">k</span> <span class="skolem">m</span> <span class="skolem">zs</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const <span class="main">(</span>Callcl <span class="skolem">cl</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_const_vs_to_es_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_host_Some <span class="skolem">cl</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">f</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vcs'</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const <span class="main">(</span>Callcl <span class="skolem">cl</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_const_vs_to_es_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>callcl_host_None <span class="skolem">cl</span> <span class="skolem">t1s</span> <span class="skolem">t2s</span> <span class="skolem">f</span> <span class="skolem">ves</span> <span class="skolem">vcs</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const <span class="main">(</span>Callcl <span class="skolem">cl</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_const_vs_to_es_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lfilled.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>L0 <span class="skolem">lvs</span> <span class="skolem">lholed</span> <span class="skolem">les'</span> <span class="skolem">les</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lvs</span> <span class="main">@</span> <span class="skolem">les</span> <span class="main">@</span> <span class="skolem">les'</span> <span class="main">=</span> <span class="main">$$*</span> <span class="skolem">ves</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">lvs</span> <span class="main">@</span> <span class="skolem">les</span> <span class="main">@</span> <span class="skolem">les'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="skolem">les</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">$</span><span class="keyword1">C</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs1</span><span class="main">.</span> <span class="skolem">les</span> <span class="main">=</span> <span class="main">$$*</span> <span class="bound">vs1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ex_map_conv<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> L0<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LN <span class="skolem">lvs</span> <span class="skolem">lholed</span> <span class="skolem">ln</span> <span class="skolem">les'</span> <span class="skolem">l</span> <span class="skolem">les''</span> <span class="skolem">k</span> <span class="skolem">les</span> <span class="skolem">lfilledk</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_const <span class="main">(</span>Label <span class="skolem">ln</span> <span class="skolem">les'</span> <span class="skolem">lfilledk</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_const_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> not_const_vs_to_es_list
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_simple_not_nil"><span class="command">lemma</span></span> reduce_simple_not_nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trap <span class="skolem">es</span> <span class="skolem">lholed</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">lholed</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_not_nil"><span class="command">lemma</span></span> reduce_not_nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple_not_nil
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lfilled_size<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> label<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add_is_0 le_0_eq list.exhaust list.size<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.size_gen<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_simple_not_trap"><span class="command">lemma</span></span> reduce_simple_not_trap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce_simple.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_not_trap"><span class="command">lemma</span></span> reduce_not_trap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_simple_not_trap
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">les</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">es</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> lfilled_single reduce_not_nil<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> label<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_simple_call"><span class="command">lemma</span></span> reduce_simple_call<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">⦇</span><span class="main">[</span><span class="main">$</span>Call <span class="free">j</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reduce_simple.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Call <span class="free">j</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> lfilled_single
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-reduce_call"><span class="command">lemma</span></span> reduce_call<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">[</span><span class="main">$</span>Call <span class="free">j</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">es'</span> <span class="main">=</span> <span class="main">[</span>Callcl <span class="main">(</span>sfunc <span class="free">s</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">$</span>Call <span class="free">j</span><span class="main">]</span><span class="main">::</span> e list"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reduce.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>label <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span> <span class="skolem">i</span> <span class="skolem">s'</span> <span class="skolem">vs'</span> <span class="skolem">es'</span> <span class="skolem">k</span> <span class="skolem">lholed</span> <span class="skolem">les'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">=</span> <span class="main">[</span><span class="main">$</span>Call <span class="free">j</span><span class="main">]</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="skolem">lholed</span> <span class="main">=</span> LBase <span class="main">[]</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce_not_nil<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> lfilled_single<span class="main">[</span><span class="operator">OF</span> label<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="skolem">les'</span> <span class="main">=</span> <span class="main">[</span>Callcl <span class="main">(</span>sfunc <span class="skolem">s</span> <span class="skolem">i</span> <span class="free">j</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> label<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> Lfilled.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"LBase <span class="main">[]</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Callcl <span class="main">(</span>sfunc <span class="skolem">s</span> <span class="skolem">i</span> <span class="free">j</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">les'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reduce_simple_call<span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_unreachable_result"><span class="command">lemma</span></span> run_one_step_basic_unreachable_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Unreachable<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_nop_result"><span class="command">lemma</span></span> run_one_step_basic_nop_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Nop<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_drop_result"><span class="command">lemma</span></span> run_one_step_basic_drop_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Drop<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_select_result"><span class="command">lemma</span></span> run_one_step_basic_select_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Select<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1a</span> <span class="skolem">aa</span> <span class="skolem">listaa</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt32 <span class="skolem">x1a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">=</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">listaa</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">listaa</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">x1a</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_block_result"><span class="command">lemma</span></span> run_one_step_basic_block_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span><span class="main">(</span>Block <span class="free">x51</span> <span class="free">x52</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x51</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf.exhaust
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves'</span></span> <span class="skolem"><span class="skolem">ves''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"split_n <span class="free">ves</span> <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves'</span><span class="main">,</span> <span class="skolem">ves''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_loop_result"><span class="command">lemma</span></span> run_one_step_basic_loop_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span><span class="main">(</span>Loop <span class="free">x61</span> <span class="free">x62</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x61</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf.exhaust
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves'</span></span> <span class="skolem"><span class="skolem">ves''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"split_n <span class="free">ves</span> <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves'</span><span class="main">,</span> <span class="skolem">ves''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_if_result"><span class="command">lemma</span></span> run_one_step_basic_if_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span><span class="main">(</span>If <span class="free">x71</span> <span class="free">x72</span> <span class="free">x73</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt32 <span class="skolem">x1a</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">x1a</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_br_result"><span class="command">lemma</span></span> run_one_step_basic_br_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Br <span class="free">x8</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="bound">vrs</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSBreak <span class="bound">r</span> <span class="bound">vrs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_br_if_result"><span class="command">lemma</span></span> run_one_step_basic_br_if_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Br_if <span class="free">x9</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">x1</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_br_table_result"><span class="command">lemma</span></span> run_one_step_basic_br_table_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Br_table <span class="free">js</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"nat_of_int <span class="skolem">x1</span> <span class="main">&lt;</span> length <span class="free">js</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_return_result"><span class="command">lemma</span></span> run_one_step_basic_return_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Return<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vrs</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSReturn <span class="bound">vrs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_call_result"><span class="command">lemma</span></span> run_one_step_basic_call_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Call <span class="free">x12</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_call_indirect_result"><span class="command">lemma</span></span> run_one_step_basic_call_indirect_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Call_indirect <span class="free">x13</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">cl</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons assms ConstInt32
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cl</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"stypes <span class="free">s</span> <span class="free">i</span> <span class="free">x13</span> <span class="main">=</span> cl_type <span class="skolem">cl</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_get_local_result"><span class="command">lemma</span></span> run_one_step_basic_get_local_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Get_local <span class="free">x14</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x14</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_set_local_result"><span class="command">lemma</span></span> run_one_step_basic_set_local_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Set_local <span class="free">x15</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x15</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_tee_local_result"><span class="command">lemma</span></span> run_one_step_basic_tee_local_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Tee_local <span class="free">x16</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_get_global_result"><span class="command">lemma</span></span> run_one_step_basic_get_global_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Get_global <span class="free">x17</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_set_global_result"><span class="command">lemma</span></span> run_one_step_basic_set_global_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Set_global <span class="free">x18</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_load_result"><span class="command">lemma</span></span> run_one_step_basic_load_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Load <span class="free">x191</span> <span class="free">x192</span> <span class="free">x193</span> <span class="free">x194</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x192</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> None
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms None
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="skolem">x1</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">aa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt32 <span class="skolem">x1</span>"</span></span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms None Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"load <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">aa</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="free">x194</span> <span class="main">(</span>t_length <span class="free">x191</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Some
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">x1</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">aa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt32 <span class="skolem">x1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Some Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"load_packed <span class="skolem">y</span> <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">aa</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="free">x194</span> <span class="main">(</span>tp_length <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>t_length <span class="free">x191</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_store_result"><span class="command">lemma</span></span> run_one_step_basic_store_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Store <span class="free">x201</span> <span class="free">x202</span> <span class="free">x203</span> <span class="free">x204</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x202</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> None
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> outer_Cons <span class="main">=</span> Cons
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms None
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms None outer_Cons
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"types_agree <span class="free">x201</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">aa</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt32 <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"types_agree <span class="free">x201</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">aa</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms None outer_Cons Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"store <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">aa</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">k</span><span class="main">)</span> <span class="free">x204</span> <span class="main">(</span>bits <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>t_length <span class="free">x201</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a''</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> outer_Cons <span class="main">=</span> Cons
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Some
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Some outer_Cons
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"types_agree <span class="free">x201</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">aa</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt32 <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"types_agree <span class="free">x201</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">aa</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms Some outer_Cons Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"store_packed <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">aa</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">k</span><span class="main">)</span> <span class="free">x204</span> <span class="main">(</span>bits <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>tp_length <span class="skolem">a''</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_current_memory_result"><span class="command">lemma</span></span> run_one_step_basic_current_memory_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Current_memory<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_grow_memory_result"><span class="command">lemma</span></span> run_one_step_basic_grow_memory_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Grow_memory<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">a'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt32 <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">a'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"mem_grow_impl <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">a'</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_const_result"><span class="command">lemma</span></span> run_one_step_basic_const_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>EConst <span class="free">x23</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_unop_i_result"><span class="command">lemma</span></span> run_one_step_basic_unop_i_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Unop_i <span class="free">x241</span> <span class="free">x242</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x241</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x241</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_unop_f_result"><span class="command">lemma</span></span> run_one_step_basic_unop_f_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Unop_f <span class="free">x251</span> <span class="free">x252</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x251</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x251</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_binop_i_result"><span class="command">lemma</span></span> run_one_step_basic_binop_i_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Binop_i <span class="free">x261</span> <span class="free">x262</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> outer_Cons <span class="main">=</span> Cons
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms outer_Cons
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x261</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x261</span> <span class="main">=</span> T_i32"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt32 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt32 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_i <span class="free">x262</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x261</span> <span class="main">=</span> T_i64"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt64 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt64 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_i <span class="free">x262</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x261</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x261</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_binop_f_result"><span class="command">lemma</span></span> run_one_step_basic_binop_f_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Binop_f <span class="free">x271</span> <span class="free">x272</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> outer_Cons <span class="main">=</span> Cons
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms outer_Cons
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x271</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x271</span> <span class="main">=</span> T_f32"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstFloat32 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstFloat32 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_f <span class="free">x272</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x271</span> <span class="main">=</span> T_f64"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstFloat64 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstFloat64 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_f <span class="free">x272</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x271</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x271</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_testop_result"><span class="command">lemma</span></span> run_one_step_basic_testop_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Testop <span class="free">x281</span> <span class="free">x282</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x281</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x281</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_relop_i_result"><span class="command">lemma</span></span> run_one_step_basic_relop_i_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Relop_i <span class="free">x291</span> <span class="free">x292</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> outer_Cons <span class="main">=</span> Cons
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms outer_Cons
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x291</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x291</span> <span class="main">=</span> T_i32"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt32 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt32 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_relop_i <span class="free">x292</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x291</span> <span class="main">=</span> T_i64"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstInt64 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstInt64 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_relop_i <span class="free">x292</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x291</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x291</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_relop_f_result"><span class="command">lemma</span></span> run_one_step_basic_relop_f_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Relop_f <span class="free">x301</span> <span class="free">x302</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> outer_Cons <span class="main">=</span> Cons
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms outer_Cons
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x301</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x301</span> <span class="main">=</span> T_f32"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstFloat32 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstFloat32 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_relop_f <span class="free">x302</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x301</span> <span class="main">=</span> T_f64"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ConstFloat64 <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ConstFloat64 <span class="skolem">x2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_Cons Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_relop_f <span class="free">x302</span> <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x301</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x301</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_basic_cvtop_result"><span class="command">lemma</span></span> run_one_step_basic_cvtop_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span>Cvtop <span class="free">t2</span> <span class="free">x312</span> <span class="free">t1</span> <span class="free">sx</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x312</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">ves'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">ves'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x312</span> <span class="main">=</span> Convert"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cvt <span class="free">t2</span> <span class="free">sx</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"types_agree <span class="free">t1</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">ves'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ves</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">ves'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x312</span> <span class="main">=</span> Reinterpret"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">sx</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"types_agree <span class="free">t1</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_trap_result"><span class="command">lemma</span></span> run_one_step_trap_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span>Trap<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_callcl_result"><span class="command">lemma</span></span> run_one_step_callcl_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span>Callcl <span class="free">cl</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> cl_type_is<span class="main">:</span><span class="quoted"><span class="quoted">"cl_type <span class="free">cl</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf.exhaust
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves'</span></span> <span class="skolem"><span class="skolem">ves''</span></span> <span class="keyword2"><span class="keyword">where</span></span> split_n_is<span class="main">:</span><span class="quoted"><span class="quoted">"split_n <span class="free">ves</span> <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves'</span><span class="main">,</span> <span class="skolem">ves''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">cl</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_native <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="skolem">x13</span> <span class="skolem">x14</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms cl_type_is split_n_is
      <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_host <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"host_apply_impl <span class="free">s</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">x22</span> <span class="main">(</span>rev <span class="skolem">ves'</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms cl_type_is split_n_is Func_host
        <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main">)</span>  <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">s'</span> <span class="skolem">vcs'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms cl_type_is split_n_is Func_host Some
          <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="skolem">t2s</span> <span class="skolem">vcs'</span>"</span></span><span class="main">)</span>  <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_label_result"><span class="command">lemma</span></span> run_one_step_label_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span>Label <span class="free">x41</span> <span class="free">x42</span> <span class="free">x43</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">rvs</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSBreak <span class="bound">r</span> <span class="bound">rvs</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">rvs</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSReturn <span class="bound">rvs</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">res</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_local_result"><span class="command">lemma</span></span> run_one_step_local_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span>Local <span class="free">x51</span> <span class="free">x52</span> <span class="free">x53</span> <span class="free">x54</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSNormal <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">res</span> <span class="main">=</span> RSCrash <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x54</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">note</span></span> outer_False <span class="main">=</span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"const_list <span class="free">x54</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms outer_False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">x54</span> <span class="main">=</span> <span class="free">x51</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms outer_False
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">d</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">res</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="skolem">d'</span> <span class="free">x52</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">x53</span><span class="main">,</span> <span class="free">x54</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s'</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">,</span> <span class="skolem">res</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms outer_False False Suc
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">res</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSReturn <span class="skolem">x3</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms outer_False False rs_def Suc
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x51</span> <span class="main">≤</span> length <span class="skolem">x3</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_break"><span class="command">lemma</span></span> run_one_step_break<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="free">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">$</span>Br <span class="free">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">.</span> <span class="free">e</span> <span class="main">=</span> Label <span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Unreachable
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_unreachable_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Nop
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Drop
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_drop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Select
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_select_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Block <span class="skolem">x51</span> <span class="skolem">x52</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_block_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">x61</span> <span class="skolem">x62</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_loop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x71</span> <span class="skolem">x72</span> <span class="skolem">x73</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_if_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br <span class="skolem">x8</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_br_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br_if <span class="skolem">x9</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_br_if_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br_table <span class="skolem">x10</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_br_table_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Return
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_return_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Call <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_call_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Call_indirect <span class="skolem">x13</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_call_indirect_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Get_local <span class="skolem">x14</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_get_local_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set_local <span class="skolem">x15</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_set_local_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tee_local <span class="skolem">x16</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_tee_local_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Get_global <span class="skolem">x17</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set_global <span class="skolem">x18</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_set_global_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Load <span class="skolem">x191</span> <span class="skolem">x192</span> <span class="skolem">x193</span> <span class="skolem">x194</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_load_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Store <span class="skolem">x201</span> <span class="skolem">x202</span> <span class="skolem">x203</span> <span class="skolem">x204</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_store_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Current_memory
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_current_memory_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Grow_memory
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_grow_memory_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EConst <span class="skolem">x23</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Unop_i <span class="skolem">x241</span> <span class="skolem">x242</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_unop_i_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Unop_f <span class="skolem">x251</span> <span class="skolem">x252</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_unop_f_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Binop_i <span class="skolem">x261</span> <span class="skolem">x262</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_binop_i_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Binop_f <span class="skolem">x271</span> <span class="skolem">x272</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_binop_f_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Testop <span class="skolem">x281</span> <span class="skolem">x282</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_testop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Relop_i <span class="skolem">x291</span> <span class="skolem">x292</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_relop_i_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Relop_f <span class="skolem">x301</span> <span class="skolem">x302</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_relop_f_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cvtop <span class="skolem">x311</span> <span class="skolem">x312</span> <span class="skolem">x313</span> <span class="skolem">x314</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_cvtop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Trap
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Callcl <span class="skolem">x3</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms run_one_step_callcl_result
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Label <span class="skolem">x41</span> <span class="skolem">x42</span> <span class="skolem">x43</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Local <span class="skolem">x51</span> <span class="skolem">x52</span> <span class="skolem">x53</span> <span class="skolem">x54</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms run_one_step_local_result
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_return"><span class="command">lemma</span></span> run_one_step_return<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">=</span> <span class="main">$</span>Return<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">.</span> <span class="free">e</span> <span class="main">=</span> Label <span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">x1</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Unreachable
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_unreachable_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Nop
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Drop
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_drop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Select
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_select_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Block <span class="skolem">x51</span> <span class="skolem">x52</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_block_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">x61</span> <span class="skolem">x62</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_loop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x71</span> <span class="skolem">x72</span> <span class="skolem">x73</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_if_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br <span class="skolem">x8</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_br_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br_if <span class="skolem">x9</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_br_if_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br_table <span class="skolem">x10</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_br_table_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Return
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_return_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Call <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_call_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Call_indirect <span class="skolem">x13</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_call_indirect_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Get_local <span class="skolem">x14</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_get_local_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set_local <span class="skolem">x15</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_set_local_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tee_local <span class="skolem">x16</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_tee_local_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Get_global <span class="skolem">x17</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set_global <span class="skolem">x18</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_set_global_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Load <span class="skolem">x191</span> <span class="skolem">x192</span> <span class="skolem">x193</span> <span class="skolem">x194</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_load_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Store <span class="skolem">x201</span> <span class="skolem">x202</span> <span class="skolem">x203</span> <span class="skolem">x204</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_store_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Current_memory
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_current_memory_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Grow_memory
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_grow_memory_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EConst <span class="skolem">x23</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Unop_i <span class="skolem">x241</span> <span class="skolem">x242</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_unop_i_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Unop_f <span class="skolem">x251</span> <span class="skolem">x252</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_unop_f_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Binop_i <span class="skolem">x261</span> <span class="skolem">x262</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_binop_i_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Binop_f <span class="skolem">x271</span> <span class="skolem">x272</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_binop_f_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Testop <span class="skolem">x281</span> <span class="skolem">x282</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_testop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Relop_i <span class="skolem">x291</span> <span class="skolem">x292</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_relop_i_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Relop_f <span class="skolem">x301</span> <span class="skolem">x302</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_relop_f_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cvtop <span class="skolem">x311</span> <span class="skolem">x312</span> <span class="skolem">x313</span> <span class="skolem">x314</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_basic_cvtop_result assms Basic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Trap
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Callcl <span class="skolem">x3</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms run_one_step_callcl_result
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Label <span class="skolem">x41</span> <span class="skolem">x42</span> <span class="skolem">x43</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Local <span class="skolem">x51</span> <span class="skolem">x52</span> <span class="skolem">x53</span> <span class="skolem">x54</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms run_one_step_local_result
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_break_imp_not_trap_const_list"><span class="command">lemma</span></span> run_step_break_imp_not_trap_const_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="free">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="free">es</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"split_vals_e <span class="free">es</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_vals_e_const_list e_type_const_conv_vs
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_return_imp_not_trap_const_list"><span class="command">lemma</span></span> run_step_return_imp_not_trap_const_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="free">es</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"split_vals_e <span class="free">es</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_vals_e_const_list e_type_const_conv_vs
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="free">es</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_label_break_imp_break"><span class="command">lemma</span></span> run_one_step_label_break_imp_break<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">ves</span><span class="main">,</span> Label <span class="free">ln</span> <span class="free">les</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="free">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="free">es</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="skolem"><span class="skolem">res''</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">,</span> <span class="skolem">res''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local_assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">res''</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSBreak <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms local_assms rs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x21</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ln</span> <span class="main">≤</span> length <span class="skolem">x22</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_one_step_label_return_imp_return"><span class="command">lemma</span></span> run_one_step_label_return_imp_return<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">ves</span><span class="main">,</span> Label <span class="free">n</span> <span class="free">les</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const_list <span class="free">es</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>const_list <span class="free">es</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="skolem"><span class="skolem">res''</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">,</span> <span class="skolem">res''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local_assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">res''</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSBreak <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms local_assms rs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x21</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> length <span class="skolem">x22</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">thm</span></span> run_step_run_one_step.induct

<span class="comment1">(* These definitions are needed because the automatic induction process hangs if they are unrolled *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">run_step_break_imp_lfilled_prop</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run_step_break_imp_lfilled_prop</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">vs</span><span class="main">,</span><span class="bound">es</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>run_step <span class="bound">d</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">vs</span><span class="main">,</span><span class="bound">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span><span class="main">,</span> RSBreak <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">∧</span> <span class="bound">vs</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">lfilled</span> <span class="bound">es_c</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> Lfilled_exact <span class="main">(</span><span class="bound">n'</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">n'</span><span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">run_one_step_break_imp_lfilled_prop</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run_one_step_break_imp_lfilled_prop</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">vs</span><span class="main">,</span><span class="bound">ves</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> run_one_step <span class="bound">d</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">vs</span><span class="main">,</span><span class="bound">ves</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span><span class="main">,</span> RSBreak <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span> <span class="main">⟶</span>
       <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">∧</span> <span class="bound">vs</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="main">=</span> <span class="bound">ves</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">=</span> <span class="main">$</span>Br <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">lfilled</span> <span class="bound">es_c</span> <span class="bound">es</span> <span class="bound">les'</span> <span class="bound">ln</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> Lfilled_exact <span class="main">(</span><span class="bound">n'</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">n'</span><span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="bound">es</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">=</span> Label <span class="bound">ln</span> <span class="bound">les'</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_break_imp_lfilled"><span class="command">lemma</span></span> run_step_break_imp_lfilled<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="free">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span>
         <span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">lfilled</span> <span class="bound">es_c</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span>
                            Lfilled_exact <span class="main">(</span><span class="bound">n'</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">n'</span><span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="free">es</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ves</span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>run_step_break_imp_lfilled_prop <span class="free">s'</span> <span class="free">vs'</span> <span class="free">n</span> <span class="free">res</span><span class="main">)</span> <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>run_one_step_break_imp_lfilled_prop <span class="free">s'</span> <span class="free">vs'</span> <span class="free">n</span> <span class="free">res</span><span class="main">)</span> <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">ves</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">ves</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span>  <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">es</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">ves</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> run_step_run_one_step.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="skolem">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves</span></span> <span class="skolem"><span class="skolem">es'</span></span> <span class="keyword2"><span class="keyword">where</span></span> split_vals_es<span class="main">:</span><span class="quoted"><span class="quoted">"split_vals_e <span class="skolem">es</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves</span><span class="main">,</span> <span class="skolem">es'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> es'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local_assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es'</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> a_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> Trap"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local_assms split_vals_es
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Trap"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">as</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ves</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="skolem"><span class="skolem">res''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">,</span> <span class="skolem">res''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ros_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="skolem">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local_assms split_vals_es es'_def a_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">res''</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> run_one_step.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"run_one_step_break_imp_lfilled_prop  <span class="free">s'</span> <span class="free">vs'</span> <span class="skolem">n</span> <span class="free">res</span> <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> rev <span class="skolem">ves</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 split_vals_es a_def es'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="skolem"><span class="skolem">lfilled</span></span> <span class="skolem"><span class="skolem">es_c</span></span> <span class="skolem"><span class="skolem">les</span></span> <span class="skolem"><span class="skolem">les'</span></span> <span class="skolem"><span class="skolem">ln</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">=</span> <span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">$</span>Br <span class="skolem">n</span><span class="main">)</span> <span class="main">∨</span>
           <span class="skolem">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span>Lfilled_exact <span class="main">(</span><span class="skolem">n'</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">n'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">es_c</span><span class="main">)</span> <span class="skolem">les</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> Label <span class="skolem">ln</span> <span class="skolem">les'</span> <span class="skolem">les</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ros_def
        <span class="keyword1"><span class="command">unfolding</span></span> run_one_step_break_imp_lfilled_prop_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span>
        <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">$</span>Br <span class="skolem">n</span>"</span></span>
      <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"Lfilled_exact <span class="main">(</span><span class="skolem">n'</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">n'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">es_c</span><span class="main">)</span> <span class="skolem">les</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Label <span class="skolem">ln</span> <span class="skolem">les'</span> <span class="skolem">les</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">lfilled</span> <span class="bound">es_c</span><span class="main">.</span>  <span class="bound">n'</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">∧</span> Lfilled_exact <span class="main">(</span><span class="bound">n'</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">n'</span><span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> es'_def split_vals_e_conv_app<span class="main">[</span><span class="operator">OF</span> split_vals_es<span class="main">]</span> Lfilled_exact.intros<span class="main">(</span>1<span class="main">)</span> is_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ves</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> test<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$$*</span> <span class="skolem">ves</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_const_list
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> Lfilled_exact.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> test _ 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ln</span></span> <span class="quoted"><span class="skolem">les'</span></span> <span class="quoted"><span class="skolem">as</span></span><span class="main">]</span> es'_def split_vals_e_conv_app<span class="main">[</span><span class="operator">OF</span> split_vals_es<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 append_Cons append_Nil less_imp_le_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> run_step_break_imp_lfilled_prop_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ves</span> <span class="skolem">e</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span><span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">ves</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="skolem">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>a<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">$</span>Br <span class="skolem">n</span>"</span></span> <span class="main">|</span> <span class="main">(</span>b<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">.</span> <span class="skolem">e</span> <span class="main">=</span> Label <span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_break<span class="main">[</span><span class="operator">OF</span> local_assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">=</span> <span class="skolem">ves</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">$</span>Br <span class="skolem">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">lfilled</span> <span class="bound">es_c</span> <span class="bound">es</span> <span class="bound">les'</span> <span class="bound">ln</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span> <span class="main">∧</span> Lfilled_exact <span class="main">(</span><span class="bound">n'</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="bound">n'</span><span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="bound">es</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">=</span> Label <span class="bound">ln</span> <span class="bound">les'</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> a
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> local_assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> b
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ln</span></span> <span class="skolem"><span class="skolem">les</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">es</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="skolem">ves</span><span class="main">,</span>  Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="skolem">n</span> <span class="free">res</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> rs_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSBreak <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> run_one_step_label_break_imp_break
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"run_step_break_imp_lfilled_prop <span class="free">s'</span> <span class="free">vs'</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">res</span> <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> e_def _ run_step_break_imp_not_trap_const_list<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> e_def rs_def
        <span class="keyword1"><span class="command">unfolding</span></span> run_step_break_imp_lfilled_prop_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> run_one_step_break_imp_lfilled_prop_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> run_step_break_imp_lfilled_prop_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_return_imp_lfilled"><span class="command">lemma</span></span> run_step_return_imp_lfilled<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">lfilled</span> <span class="bound">es_c</span><span class="main">.</span> Lfilled_exact <span class="bound">n</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="free">es</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ves</span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">lfilled</span> <span class="bound">es_c</span><span class="main">.</span> Lfilled_exact <span class="bound">n</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="free">es</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">ves</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSReturn <span class="free">res</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">=</span> <span class="skolem">ves</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">$</span>Return<span class="main">)</span> <span class="main">∨</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">lfilled</span> <span class="bound">ves</span> <span class="bound">es_c</span> <span class="bound">es</span> <span class="bound">n'</span> <span class="bound">les'</span><span class="main">.</span> Lfilled_exact <span class="bound">n</span> <span class="bound">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="free">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">@</span> <span class="bound">es_c</span><span class="main">)</span> <span class="bound">es</span> <span class="main">∧</span>
              <span class="skolem">e</span> <span class="main">=</span> Label <span class="bound">n'</span> <span class="bound">les'</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">ves</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="free">res</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="skolem">ves</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="free">res</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> run_step_run_one_step.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves</span></span> <span class="skolem"><span class="skolem">es'</span></span> <span class="keyword2"><span class="keyword">where</span></span> split_vals_es<span class="main">:</span><span class="quoted"><span class="quoted">"split_vals_e <span class="skolem">es</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves</span><span class="main">,</span> <span class="skolem">es'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> es'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es'</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> a_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> e_is_trap <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> split_vals_es
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Trap"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">as</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ves</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="skolem"><span class="skolem">res''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">vs</span><span class="main">,</span><span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">,</span> <span class="skolem">res''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ros_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">vs</span><span class="main">,</span><span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s'</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">,</span> RSReturn <span class="skolem">res</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> split_vals_es es'_def a_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">res''</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> run_one_step.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">lfilled</span></span> <span class="skolem"><span class="skolem">les_c</span></span> <span class="skolem"><span class="skolem">les</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="skolem"><span class="skolem">les'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">res</span> <span class="main">=</span> rev <span class="skolem">ves</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">$</span>Return<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Lfilled_exact <span class="skolem">n</span> <span class="skolem">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">@</span> <span class="skolem">les_c</span><span class="main">)</span> <span class="skolem">les</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> Label <span class="skolem">n'</span> <span class="skolem">les'</span> <span class="skolem">les</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> split_vals_es<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> _ es'_def a_def ros_def<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span>
      <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">=</span> rev <span class="skolem">ves</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">$</span>Return"</span></span>
    <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Lfilled_exact <span class="skolem">n</span> <span class="skolem">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">res</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">@</span> <span class="skolem">les_c</span><span class="main">)</span> <span class="skolem">les</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">=</span> Label <span class="skolem">n'</span> <span class="skolem">les'</span> <span class="skolem">les</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> es'_def split_vals_e_conv_app<span class="main">[</span><span class="operator">OF</span> split_vals_es<span class="main">]</span> Lfilled_exact.intros<span class="main">(</span>1<span class="main">)</span> is_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ves</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$$*</span> <span class="skolem">ves</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_const_list
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 Lfilled_exact.intros<span class="main">(</span>2<span class="main">)</span> es'_def split_vals_e_conv_app<span class="main">[</span><span class="operator">OF</span> split_vals_es<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">ves</span> <span class="skolem">e</span> <span class="skolem">s'</span> <span class="skolem">vs'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>a<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">$</span>Return"</span></span> <span class="main">|</span> <span class="main">(</span>b<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">.</span> <span class="skolem">e</span> <span class="main">=</span> Label <span class="bound">n</span> <span class="bound">les</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> run_one_step_return<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> a
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> b
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">les</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">es</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="skolem">ves</span><span class="main">,</span>  Label <span class="skolem">n</span> <span class="skolem">les</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s'</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">,</span> RSReturn <span class="skolem">res</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"run_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s'</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">,</span> RSReturn <span class="skolem">res</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> run_one_step_label_return_imp_return
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> e_def _ run_step_return_imp_not_trap_const_list<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> e_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_basic_unop_testop_sound"><span class="command">lemma</span></span> run_step_basic_unop_testop_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span><span class="free">b_e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSNormal <span class="free">es'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Unop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">b_e</span> <span class="main">=</span> Unop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">b_e</span> <span class="main">=</span> Testop <span class="free">t</span> <span class="free">testop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="free">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span><span class="free">b_e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Unop_i <span class="free">t</span> <span class="free">iop</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Unop_f <span class="free">t</span> <span class="free">fop</span>"</span></span> <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Testop <span class="free">t</span> <span class="free">testop</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> b_e_cases <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> T_i32
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons ConstInt32
           is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt64 <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> T_i64
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons ConstInt64
           is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstFloat32 <span class="skolem">x3</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> T_f32
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons ConstFloat32
           is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstFloat64 <span class="skolem">x4</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> T_f64
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons ConstFloat64
           is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_basic_binop_relop_sound"><span class="command">lemma</span></span> run_step_basic_binop_relop_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span><span class="free">b_e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSNormal <span class="free">es'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span> <span class="main">∨</span> <span class="free">b_e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span> <span class="main">∨</span> <span class="free">b_e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span> <span class="main">∨</span> <span class="free">b_e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="free">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span><span class="free">b_e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span>
    <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Binop_i <span class="free">t</span> <span class="free">iop</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Binop_f <span class="free">t</span> <span class="free">fop</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Relop_i <span class="free">t</span> <span class="free">irop</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">b_e</span> <span class="main">=</span> Relop_f <span class="free">t</span> <span class="free">frop</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> b_e_cases <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> outer_Cons<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">v1</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v2</span> <span class="skolem">list'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> outer_Cons
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">v2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">=</span> ConstInt32 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> ConstInt32 <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> T_i32"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons outer_Cons
             is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list'</span>"</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_i <span class="free">iop</span> <span class="skolem">c2</span> <span class="skolem">c1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">=</span> ConstInt64 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> ConstInt64 <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> T_i64"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons outer_Cons
             is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list'</span>"</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_i <span class="free">iop</span> <span class="skolem">c2</span> <span class="skolem">c1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">=</span> ConstFloat32 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> ConstFloat32 <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> T_f32"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons outer_Cons
             is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list'</span>"</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_f <span class="free">fop</span> <span class="skolem">c2</span> <span class="skolem">c1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">=</span> ConstFloat64 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> ConstFloat64 <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> T_f64"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Cons outer_Cons
             is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list'</span>"</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"app_binop_f <span class="free">fop</span> <span class="skolem">c2</span> <span class="skolem">c1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b_e_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wasm_Interpreter_Properties-run_step_basic_sound"><span class="command">lemma</span></span> run_step_basic_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">ves</span><span class="main">,</span><span class="main">$</span><span class="free">b_e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSNormal <span class="free">es'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="free">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span><span class="free">b_e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b_e</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Unreachable
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">ves</span>"</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>22<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Nop
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">ves</span>"</span></span><span class="main">]</span>
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>23<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Drop
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vs_to_es <span class="free">ves</span> <span class="main">=</span> vs_to_es <span class="skolem">list</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">a</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              Drop assms Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Select
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> outer_outer_cons<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Select assms
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1a</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> outer_cons<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms outer_outer_cons ConstInt32 Select
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a''</span> <span class="skolem">list''</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vs_to_es <span class="free">ves</span> <span class="main">=</span> vs_to_es <span class="skolem">list''</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> <span class="skolem">a''</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> <span class="skolem">a'</span><span class="main">,</span> <span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">x1a</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> outer_outer_cons outer_cons ConstInt32
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list''</span>"</span></span><span class="main">]</span>
                  progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
                  reduce_simple.intros<span class="main">(</span>25<span class="main">,</span>26<span class="main">)</span>
                  assms outer_outer_cons outer_cons Cons ConstInt32 Select
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">x1a</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Block <span class="skolem">x51</span> <span class="skolem">x52</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x51</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tf <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Block assms
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"split_n <span class="free">ves</span> <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">ves'</span> <span class="skolem">ves''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vs_to_es <span class="free">ves</span> <span class="main">=</span> vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> vs_to_es <span class="skolem">ves'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> split_n_conv_app
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">es'</span> <span class="main">=</span> vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> <span class="main">[</span>Label <span class="main">(</span>length <span class="skolem">t2s</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>vs_to_es <span class="skolem">ves'</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">x52</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Block assms Tf True Pair
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves''</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vs_to_es <span class="skolem">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Block <span class="skolem">x51</span> <span class="skolem">x52</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves''</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Label <span class="main">(</span>length <span class="skolem">t2s</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>vs_to_es <span class="skolem">ves'</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">x52</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Tf reduce_simple.intros<span class="main">(</span>27<span class="main">)</span> split_n_length<span class="main">[</span><span class="operator">OF</span> Pair True<span class="main">]</span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
                is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves'</span>"</span></span><span class="main">]</span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves''</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Block
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">x61</span> <span class="skolem">x62</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x61</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tf <span class="skolem">t1s</span> <span class="skolem">t2s</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Loop assms
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">≤</span> length <span class="free">ves</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"split_n <span class="free">ves</span> <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">ves'</span> <span class="skolem">ves''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vs_to_es <span class="free">ves</span> <span class="main">=</span> vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> vs_to_es <span class="skolem">ves'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> split_n_conv_app
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">es'</span> <span class="main">=</span> vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> <span class="main">[</span>Label <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Loop <span class="skolem">x61</span> <span class="skolem">x62</span><span class="main">]</span> <span class="main">(</span>vs_to_es <span class="skolem">ves'</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">x62</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Loop assms Tf True Pair
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves''</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vs_to_es <span class="skolem">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span>Loop <span class="skolem">x61</span> <span class="skolem">x62</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="free">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves''</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Label <span class="main">(</span>length <span class="skolem">t1s</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Loop <span class="skolem">x61</span> <span class="skolem">x62</span><span class="main">]</span> <span class="main">(</span>vs_to_es <span class="skolem">ves'</span> <span class="main">@</span> <span class="main">(</span><span class="main">$*</span> <span class="skolem">x62</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Tf reduce_simple.intros<span class="main">(</span>28<span class="main">)</span> split_n_length<span class="main">[</span><span class="operator">OF</span> Pair True<span class="main">]</span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
                is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves'</span>"</span></span><span class="main">]</span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves''</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Loop
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x71</span> <span class="skolem">x72</span> <span class="skolem">x73</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms If
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vs_to_es <span class="free">ves</span> <span class="main">=</span> vs_to_es <span class="skolem">list</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">x1</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
              reduce_simple.intros<span class="main">(</span>29<span class="main">,</span>30<span class="main">)</span>
              assms Cons If ConstInt32
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">x1</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br <span class="skolem">x8</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br_if <span class="skolem">x9</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Br_if
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vs_to_es <span class="free">ves</span> <span class="main">=</span> vs_to_es <span class="skolem">list</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">x1</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Cons
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>34<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>35<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
              assms Cons Br_if ConstInt32
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int_eq <span class="skolem">x1</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Br_table <span class="skolem">x10</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Br_table
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>36<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>37<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
                assms Br_table Cons
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">x10</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Return
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Call <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
            is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">ves</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Call_indirect <span class="skolem">x13</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Call_indirect
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">c</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stab <span class="free">s</span> <span class="free">i</span> <span class="main">(</span>nat_of_int <span class="skolem">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> None
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> assms Call_indirect Cons ConstInt32
                  progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
                  is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">cl</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stypes <span class="free">s</span> <span class="free">i</span> <span class="skolem">x13</span> <span class="main">=</span> cl_type <span class="skolem">cl</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">list</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">,</span> <span class="main">$</span>Call_indirect <span class="skolem">x13</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">list</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>Callcl <span class="skolem">cl</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> True Some is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> assms Call_indirect Cons ConstInt32 Some True
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">list</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">$</span><span class="keyword1">C</span> ConstInt32 <span class="skolem">c</span><span class="main">,</span> <span class="main">$</span>Call_indirect <span class="skolem">x13</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">list</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Trap<span class="main">]</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> False Some is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> assms Call_indirect Cons ConstInt32 Some False
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Get_local <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">vs1</span><span class="main">@</span><span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">@</span><span class="skolem">vs2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> id_take_nth_drop
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Get_local True
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">ves</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set_local <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms      
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Set_local
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">vs1</span><span class="main">@</span><span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">@</span><span class="skolem">vs2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> id_take_nth_drop True
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms Set_local True Cons
                progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
                is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tee_local <span class="skolem">x16</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Tee_local
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>41<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Get_global <span class="skolem">x17</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
            progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main">]</span>
            is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">ves</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set_global <span class="skolem">x18</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Set_global
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Load <span class="skolem">x191</span> <span class="skolem">x192</span> <span class="skolem">x193</span> <span class="skolem">x194</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x192</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Load assms None
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Load assms None Cons ConstInt32
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main">]</span>
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"load <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">x194</span> <span class="main">(</span>t_length <span class="skolem">x191</span><span class="main">)</span>"</span></span> <span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> outer_some<span class="main">:</span><span class="main">(</span>Some <span class="skolem">tp_sx</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Load assms outer_some
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">tp_sx</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">tp</span> <span class="skolem">sx</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Load assms outer_some Cons ConstInt32 Pair
                  progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">]</span>
                  progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">]</span>
                  is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"load_packed <span class="skolem">sx</span> <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">x194</span> <span class="main">(</span>tp_length <span class="skolem">tp</span><span class="main">)</span> <span class="main">(</span>t_length <span class="skolem">x191</span><span class="main">)</span>"</span></span><span class="main">)</span>
               <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Store <span class="skolem">t</span> <span class="skolem">tp</span> <span class="skolem">a</span> <span class="skolem">off</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> outer_Cons<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Store assms
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Store outer_Cons assms
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Store outer_Cons Cons assms
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>types_agree <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword3"><span class="command">case</span></span> outer_Some<span class="main">:</span><span class="main">(</span>Some <span class="skolem">j</span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> None
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> Store outer_Cons Cons assms True outer_Some ConstInt32
                      progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span><span class="main">]</span>
                      progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span><span class="main">]</span>
                      is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list'</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"store <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">off</span> <span class="main">(</span>bits <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>t_length <span class="skolem">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
                   <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">the_tp</span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> Store outer_Cons Cons assms True outer_Some ConstInt32
                      progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">]</span>
                      progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span><span class="main">]</span>
                      is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list'</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"store_packed <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">off</span> <span class="main">(</span>bits <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>tp_length <span class="skolem">the_tp</span><span class="main">)</span>"</span></span><span class="main">)</span>
                   <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tp</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Current_memory
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Current_memory 
              progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>20<span class="main"><span class="main">)</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">ves</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_const_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Grow_memory
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Grow_memory
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"smem_ind <span class="free">s</span> <span class="free">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstInt32 <span class="skolem">x1</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms Grow_memory Cons ConstInt32
                             progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>21<span class="main"><span class="main">)</span></span><span class="main">]</span>
                             progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>22<span class="main"><span class="main">)</span></span><span class="main">]</span>
              is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"mem_grow_impl <span class="main">(</span>s.mem <span class="free">s</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>nat_of_int <span class="skolem">x1</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_grow_impl_correct is_const_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EConst <span class="skolem">x23</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Unop_i <span class="skolem">x241</span> <span class="skolem">x242</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_unop_testop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Unop_f <span class="skolem">x251</span> <span class="skolem">x252</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_unop_testop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Binop_i <span class="skolem">x261</span> <span class="skolem">x262</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_binop_relop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Binop_f <span class="skolem">x271</span> <span class="skolem">x272</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_binop_relop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Testop <span class="skolem">x281</span> <span class="skolem">x282</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_unop_testop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Relop_i <span class="skolem">x291</span> <span class="skolem">x292</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_binop_relop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Relop_f <span class="skolem">x301</span> <span class="skolem">x302</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_step_basic_binop_relop_sound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cvtop <span class="skolem">t2</span> <span class="skolem">cvtop</span> <span class="skolem">t1</span> <span class="skolem">sx</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ves</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Cvtop
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cvtop</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"types_agree <span class="skolem">t1</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Convert
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Convert assms Cvtop Cons
                progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>20<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cvt <span class="skolem">t2</span> <span class="skolem">sx</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Reinterpret
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Reinterpret assms Cvtop Cons
                progress_L0_left<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>21<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">list</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">sx</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cvtop</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> run_step_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSNormal <span class="free">es'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">s</span><span class="main">;</span><span class="free">vs</span><span class="main">;</span><span class="free">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="free">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ves</span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>run_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSNormal <span class="free">es'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">vs</span><span class="main">,</span> <span class="bound">es</span><span class="main">)</span><span class="main">.</span> <span class="main">⦇</span><span class="bound">s</span><span class="main">;</span><span class="bound">vs</span><span class="main">;</span><span class="bound">es</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="bound">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="free">es</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>run_one_step <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">vs</span><span class="main">,</span><span class="skolem">ves</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">vs'</span><span class="main">,</span> RSNormal <span class="free">es'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">vs</span><span class="main">,</span> <span class="bound">ves</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">⦇</span><span class="bound">s</span><span class="main">;</span><span class="bound">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="bound">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="bound">i</span> <span class="main">⦇</span><span class="free">s'</span><span class="main">;</span><span class="free">vs'</span><span class="main">;</span><span class="free">es'</span><span class="main">⦈</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">,</span> <span class="skolem">ves</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">i</span></span> <span class="main">_</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">i</span></span> <span class="main">_</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="free">es'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="free">es'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> run_step_run_one_step.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves</span></span> <span class="skolem"><span class="skolem">ses</span></span> <span class="keyword2"><span class="keyword">where</span></span> ves_def<span class="main">:</span><span class="quoted"><span class="quoted">"split_vals_e <span class="skolem">es</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves</span><span class="main">,</span> <span class="skolem">ses</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ses</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> ves_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Trap"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c_ves<span class="main">:</span><span class="quoted"><span class="quoted">"const_list <span class="main">(</span><span class="main">$$*</span> <span class="skolem">ves</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> is_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ves</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">list</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ves</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons 1<span class="main">(</span>2<span class="main">)</span> ves_def True
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">list</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ves</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons 1<span class="main">(</span>2<span class="main">)</span> ves_def split_vals_e_conv_app<span class="main">[</span><span class="operator">OF</span> ves_def<span class="main">]</span> True progress_L0_trap<span class="main">[</span><span class="operator">OF</span> c_ves<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">os</span></span> <span class="skolem"><span class="skolem">ovs</span></span> <span class="skolem"><span class="skolem">oes</span></span> <span class="keyword2"><span class="keyword">where</span></span> ros_def<span class="main">:</span><span class="quoted"><span class="quoted">"run_one_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="main">(</span>rev <span class="skolem">ves</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">os</span><span class="main">,</span> <span class="skolem">ovs</span><span class="main">,</span> <span class="skolem">oes</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">roes</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">oes</span> <span class="main">=</span> RSNormal <span class="skolem">roes</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> ves_def Cons False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">oes</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">os</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ovs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> es'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="skolem">roes</span> <span class="main">@</span> <span class="skolem">list</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> ves_def Cons ros_def False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">roes</span> <span class="main">=</span> <span class="main">[</span>Trap<span class="main">]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> run_one_step.simps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> ros_red<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">(</span><span class="main">$$*</span> <span class="skolem">ves</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="skolem">roes</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ves_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> _ Cons<span class="main">]</span> ros_def False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> run_one_step.simps<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">(</span><span class="main">$$*</span> <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">@</span><span class="skolem">list</span><span class="main">⦈</span> <span class="main">↝_</span> <span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="skolem">roes</span><span class="main">@</span><span class="skolem">list</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> ros_red<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> es'_def Cons split_vals_e_conv_app<span class="main">[</span><span class="operator">OF</span> ves_def<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">ves</span> <span class="skolem">e</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">x1</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> run_step_basic_sound 2<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Trap
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Callcl <span class="skolem">cl</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1s</span></span> <span class="skolem"><span class="skolem">t2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cl_type <span class="skolem">cl</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tf.exhaust<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">thesis</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1s</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t2s</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> local_defs <span class="main">=</span> calculation
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ves</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> outer_True<span class="main">:</span>True
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ves'</span></span> <span class="skolem"><span class="skolem">ves''</span></span> <span class="keyword2"><span class="keyword">where</span></span> true_defs<span class="main">:</span><span class="quoted"><span class="quoted">"split_n <span class="skolem">ves</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ves'</span><span class="main">,</span> <span class="skolem">ves''</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ves'_length<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>rev <span class="skolem">ves'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> split_n_length<span class="main">[</span><span class="operator">OF</span> true_defs outer_True<span class="main">]</span> inj_basic_econst length_rev map_injective
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cl</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_native <span class="skolem">i'</span> <span class="skolem">tf</span> <span class="skolem">fts</span> <span class="skolem">fes</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="main">(</span>vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> <span class="main">[</span>Local <span class="main">(</span>length <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">i'</span> <span class="main">(</span>rev <span class="skolem">ves'</span> <span class="main">@</span> <span class="main">(</span>n_zeros <span class="skolem">fts</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">fes</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Callcl local_defs outer_True true_defs
            <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Callcl <span class="skolem">cl</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">(</span><span class="main">[</span>Local <span class="main">(</span>length <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">i'</span> <span class="main">(</span>rev <span class="skolem">ves'</span> <span class="main">@</span> <span class="main">(</span>n_zeros <span class="skolem">fts</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">$</span>Block <span class="main">(</span><span class="main">[]</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">fes</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>5<span class="main">)</span> local_defs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> Func_native ves'_length
            <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Callcl progress_L0_left is_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="skolem">ves''</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> split_n_conv_app<span class="main">[</span><span class="operator">OF</span> true_defs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func_host <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"host_apply_impl <span class="skolem">s</span> <span class="main">(</span><span class="skolem">t1s</span> <span class="main">_&gt;</span> <span class="skolem">t2s</span><span class="main">)</span> <span class="skolem">x22</span> <span class="main">(</span>rev <span class="skolem">ves'</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> None
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> <span class="main">[</span>Trap<span class="main">]</span> "</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Callcl local_defs outer_True true_defs Func_host
              <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> is_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="skolem">ves''</span><span class="main">)</span>"</span></span><span class="main">]</span>
                    reduce.intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ _ ves'_length local_defs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
                    split_n_conv_app<span class="main">[</span><span class="operator">OF</span> true_defs<span class="main">]</span>
                    progress_L0_left Callcl Func_host local_defs<span class="main">(</span>1<span class="main">)</span>
              <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">rs</span> <span class="skolem">rves</span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Callcl local_defs outer_True true_defs Func_host Some
                <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"list_all2 types_agree <span class="skolem">t2s</span> <span class="skolem">rves</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
                      <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span>
                      <span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> vs_to_es <span class="skolem">ves''</span> <span class="main">@</span> <span class="main">(</span><span class="main">$$*</span> <span class="skolem">rves</span><span class="main">)</span> "</span></span>
                  <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Callcl local_defs outer_True true_defs Func_host Pair Some      
                  <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> progress_L0_left reduce.intros<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ _ ves'_length local_defs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> Pair
                        Callcl Func_host local_defs<span class="main">(</span>1<span class="main">)</span> True is_const_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="skolem">ves''</span><span class="main">)</span>"</span></span><span class="main">]</span>
                        split_n_conv_app<span class="main">[</span><span class="operator">OF</span> true_defs<span class="main">]</span> host_apply_impl_correct<span class="main">[</span><span class="operator">OF</span> Some<span class="main">]</span>
                  <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Callcl local_defs
          <span class="keyword1"><span class="command">unfolding</span></span> cl_type_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cl</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">es</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"es_is_trap <span class="skolem">es</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> is_const_list_vs_to_es_list
                Label progress_L0<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>32<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> outer_outer_false <span class="main">=</span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>const_list <span class="skolem">es</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> outer_outer_false Label reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>31<span class="main"><span class="main">)</span></span><span class="main">]</span>
                  progress_L0<span class="main">[</span><span class="operator">OF</span> _ is_const_list_vs_to_es_list<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?es_c</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="skolem"><span class="skolem">es''</span></span> <span class="keyword2"><span class="keyword">where</span></span> run_step_is<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">,</span> <span class="skolem">es''</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es''</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> RSCrash
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Label 2<span class="main">(</span>3<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSBreak <span class="skolem">bn</span> <span class="skolem">bvs</span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bn</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> 0
              <span class="keyword1"><span class="command">have</span></span> run_step_is_break0<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="skolem">d</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">,</span> RSBreak <span class="main">0</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> run_step_is RSBreak 0
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> es'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>take <span class="skolem">ln</span> <span class="skolem">bvs</span><span class="main">)</span><span class="main">@</span><span class="skolem">ves</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">les</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s''</span> <span class="main">∧</span> <span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs''</span> <span class="main">∧</span> <span class="skolem">ln</span> <span class="main">≤</span> length <span class="skolem">bvs</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Label 2<span class="main">(</span>3<span class="main">)</span> RSBreak
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ln</span> <span class="main">≤</span> length <span class="skolem">bvs</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">lfilled</span></span> <span class="skolem"><span class="skolem">es_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_eqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">=</span><span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln</span> <span class="main">≤</span> length <span class="skolem">bvs</span>"</span></span> <span class="quoted"><span class="quoted">"Lfilled_exact <span class="skolem">n</span> <span class="skolem">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">bvs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">n</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">es_c</span><span class="main">)</span> <span class="skolem">es</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> run_step_break_imp_lfilled<span class="main">[</span><span class="operator">OF</span> run_step_is_break0<span class="main">]</span> RSBreak es'_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lfilled'</span></span> <span class="keyword2"><span class="keyword">where</span></span> lfilled_int<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">n</span> <span class="skolem">lfilled'</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">bvs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">n</span><span class="main">]</span><span class="main">)</span> <span class="skolem">es</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> lfilled_collapse2<span class="main">[</span><span class="operator">OF</span> Lfilled_exact_imp_Lfilled<span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lfilled''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="skolem">n</span> <span class="skolem">lfilled''</span> <span class="main">(</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">bvs</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">bvs</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Br <span class="skolem">n</span><span class="main">]</span><span class="main">)</span> <span class="skolem">es</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> lfilled_collapse1<span class="main">[</span><span class="operator">OF</span> lfilled_int<span class="main">]</span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">bvs</span>"</span></span><span class="main">]</span> local_eqs<span class="main">(</span>3<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span>Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">bvs</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">bvs</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">les</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> reduce_simple.intros<span class="main">(</span>33<span class="main">)</span> local_eqs<span class="main">(</span>3<span class="main">)</span> is_const_list_vs_to_es_list
                <span class="keyword1"><span class="command">unfolding</span></span> drop_map
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">[</span>Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">bvs</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">bvs</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">les</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span> local_eqs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">bvs</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">bvs</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">les</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> 1 is_const_list_vs_to_es_list<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> Label
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> es'_def
                <span class="keyword1"><span class="command">unfolding</span></span> drop_map rev_take<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Label 2<span class="main">(</span>3<span class="main">)</span> RSBreak
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSReturn <span class="skolem">x3</span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Label 2<span class="main">(</span>3<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSNormal <span class="skolem">x4</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">x4</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs''</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Label 2<span class="main">(</span>3<span class="main">)</span> run_step_is
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   <span class="comment1">(* v* label_n {e* } Li end e* *)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">1</span> <span class="main">(</span>LRec <span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span> <span class="skolem">ln</span> <span class="skolem">les</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="skolem">es</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">es</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">es</span></span><span class="main">]</span>
                    Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
                    is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="main">1</span> <span class="main">(</span>LRec <span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span> <span class="skolem">ln</span> <span class="skolem">les</span> <span class="main">(</span>LBase <span class="main">[]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="skolem">x4</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>Label <span class="skolem">ln</span> <span class="skolem">les</span> <span class="skolem">x4</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Lfilled.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">x4</span></span><span class="main">]</span>
                    Lfilled.intros<span class="main">(</span>2<span class="main">)</span>
                    is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> const_list_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> inner_reduce<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s''</span><span class="main">;</span><span class="skolem">vs''</span><span class="main">;</span><span class="skolem">x4</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Label outer_outer_false False<span class="main">]</span> run_step_is RSNormal
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> Label 2<span class="main">(</span>3<span class="main">)</span> outer_outer_false False run_step_is
                    reduce.intros<span class="main">(</span>23<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inner_reduce<span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Local <span class="skolem">ln</span> <span class="skolem">j</span> <span class="skolem">vls</span> <span class="skolem">es</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"es_is_trap <span class="skolem">es</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> is_const_list_vs_to_es_list
                Local progress_L0<span class="main">[</span><span class="operator">OF</span> reduce.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>39<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> outer_outer_false <span class="main">=</span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>const_list <span class="skolem">es</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> outer_true <span class="main">=</span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">es</span> <span class="main">=</span> <span class="skolem">ln</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Local outer_true outer_outer_false is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main">]</span>
                  reduce.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reduce_simple.intros<span class="main"><span class="main">(</span></span>38<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> outer_true True<span class="main"><span class="main">]</span></span><span class="main">]</span>
                  progress_L0<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?es_c</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Local outer_outer_false outer_true is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 0
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Local outer_outer_false False is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d'</span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="skolem"><span class="skolem">vls'</span></span> <span class="skolem"><span class="skolem">les'</span></span> <span class="keyword2"><span class="keyword">where</span></span> run_step_is<span class="main">:</span><span class="quoted"><span class="quoted">"run_step <span class="skolem">d'</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vls</span><span class="main">,</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">vls'</span><span class="main">,</span> <span class="skolem">les'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">les'</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> RSCrash
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Local 2<span class="main">(</span>3<span class="main">)</span> Suc
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSBreak <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Local 2<span class="main">(</span>3<span class="main">)</span> Suc
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSReturn <span class="skolem">x3</span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> es'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">es'</span> <span class="main">=</span> <span class="main">(</span>vs_to_es <span class="main">(</span><span class="main">(</span>take <span class="skolem">ln</span> <span class="skolem">x3</span><span class="main">)</span><span class="main">@</span><span class="skolem">ves</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s''</span> <span class="main">∧</span> <span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span> <span class="main">∧</span> <span class="skolem">ln</span> <span class="main">≤</span> length <span class="skolem">x3</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> outer_outer_false False run_step_is Local 2<span class="main">(</span>3<span class="main">)</span> Suc
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ln</span> <span class="main">≤</span> length <span class="skolem">x3</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">lfilled</span></span> <span class="skolem"><span class="skolem">es_c</span></span> <span class="keyword2"><span class="keyword">where</span></span> local_eqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">=</span><span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln</span> <span class="main">≤</span> length <span class="skolem">x3</span>"</span></span> <span class="quoted"><span class="quoted">"Lfilled_exact <span class="skolem">n</span> <span class="skolem">lfilled</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">x3</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span> <span class="main">@</span> <span class="skolem">es_c</span><span class="main">)</span> <span class="skolem">es</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> run_step_is run_step_return_imp_lfilled RSReturn
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lfilled'</span></span> <span class="keyword2"><span class="keyword">where</span></span> lfilled_int<span class="main">:</span><span class="quoted"><span class="quoted">"Lfilled <span class="skolem">n</span> <span class="skolem">lfilled'</span> <span class="main">(</span><span class="main">(</span>vs_to_es <span class="skolem">x3</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="skolem">es</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> lfilled_collapse2<span class="main">[</span><span class="operator">OF</span> Lfilled_exact_imp_Lfilled<span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lfilled''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Lfilled <span class="skolem">n</span> <span class="skolem">lfilled''</span> <span class="main">(</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">x3</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">$</span>Return<span class="main">]</span><span class="main">)</span> <span class="skolem">es</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> lfilled_collapse1<span class="main">[</span><span class="operator">OF</span> lfilled_int<span class="main">]</span> is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">x3</span>"</span></span><span class="main">]</span> local_eqs<span class="main">(</span>3<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="main">[</span>Local <span class="skolem">ln</span> <span class="skolem">j</span> <span class="skolem">vls</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝</span> <span class="main">⦇</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">x3</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> reduce_simple.intros<span class="main">(</span>40<span class="main">)</span> local_eqs<span class="main">(</span>3<span class="main">)</span> is_const_list_vs_to_es_list
                <span class="keyword1"><span class="command">unfolding</span></span> drop_map
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">[</span>Local <span class="skolem">ln</span> <span class="skolem">j</span> <span class="skolem">vls</span> <span class="skolem">es</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">x3</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> reduce.intros<span class="main">(</span>1<span class="main">)</span> local_eqs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vs</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">i</span> <span class="main">⦇</span><span class="skolem">s'</span><span class="main">;</span><span class="skolem">vs'</span><span class="main">;</span><span class="main">(</span>vs_to_es <span class="skolem">ves</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">x3</span> <span class="main">-</span> <span class="skolem">ln</span><span class="main">)</span> <span class="main">(</span>vs_to_es <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> progress_L0<span class="main">[</span><span class="operator">OF</span> 1 is_const_list_vs_to_es_list<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> Local
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> es'_def
                <span class="keyword1"><span class="command">unfolding</span></span> drop_map rev_take<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RSNormal <span class="skolem">x4</span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> inner_reduce<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="skolem">s</span><span class="main">;</span><span class="skolem">vls</span><span class="main">;</span><span class="skolem">es</span><span class="main">⦈</span> <span class="main">↝_</span><span class="skolem">j</span> <span class="main">⦇</span><span class="skolem">s''</span><span class="main">;</span><span class="skolem">vls'</span><span class="main">;</span><span class="skolem">x4</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Local outer_outer_false False<span class="main">]</span> run_step_is Suc
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> Local 2<span class="main">(</span>3<span class="main">)</span> Local outer_outer_false False run_step_is Suc
                      reduce.intros<span class="main">(</span>24<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inner_reduce<span class="main">]</span> RSNormal
                      progress_L0_left is_const_list_vs_to_es_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ves</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> run_step.simps<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Wasm_Checker_Printing">
<div class="head">
<h1>Theory Wasm_Checker_Printing</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Wasm_Checker_Printing <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="Wasm_Checker.html">../Wasm_Checker</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">typing</span> <span class="main">=</span> b_e_type_checker"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Interpreter_Printing">
<div class="head">
<h1>Theory Wasm_Interpreter_Printing</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Wasm_Interpreter_Printing <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="Wasm_Interpreter_Properties.html">../Wasm_Interpreter_Properties</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">=</span> run_v <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">63</span><span class="main">)</span> <span class="numeral">300</span>"</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">host_apply_impl</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.host'_apply'_impl"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">mem_grow_impl</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.mem'_grow'_impl"</span>

<span class="comment1">(* memory *)</span>

<span class="keyword1"><span class="command">declare</span></span> Rep_bytes_inverse<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstype</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Rep_mem_inverse<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstype</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> bytes <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Int64.t"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">type_constructor</span></span> mem <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapperTypes.memory"</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">mem_size</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.size"</span>
<span class="comment1">(* | constant mem_grow ⇀ (OCaml) "ImplWrapper.grow" *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">load</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.load"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">store</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.store"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">load_packed</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.load'_packed"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">store_packed</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.store'_packed"</span>

<span class="keyword1"><span class="command">declare</span></span> mem_size_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> store_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> load_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> store_packed_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> load_packed_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Type_Abs_Printing">
<div class="head">
<h1>Theory Wasm_Type_Abs_Printing</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Wasm_Type_Abs_Printing <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="Wasm.html">../Wasm</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(* Maps types to Andreas' Ocaml implementation - a thin wrapper over Ocaml ints/floats for the most part. *)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> i32 <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.t"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">type_constructor</span></span> i64 <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.t"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">type_constructor</span></span> f32 <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.t"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">type_constructor</span></span> f64 <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.t"</span>

<span class="comment1">(* zero consts *)</span>
<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">zero_i32_inst.zero_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.zero"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">zero_i64_inst.zero_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.zero"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">zero_f32_inst.zero_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.zero"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">zero_f64_inst.zero_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.zero"</span>

<span class="comment1">(* intra-{int,float} conversions *)</span>
<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_wrap</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"(I32Wrapper'_convert.wrap'_i64)"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_extend_u</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"(I64Wrapper'_convert.extend'_u'_i32)"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_extend_s</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"(I64Wrapper'_convert.extend'_s'_i32)"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_demote</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"(F32Wrapper'_convert.demote'_f64)"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_promote</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"(F64Wrapper'_convert.promote'_f32)"</span>

<span class="comment1">(* arithmetic *)</span>
<span class="keyword1"><span class="command">code_printing</span></span>
<span class="comment1">(* INT32 *)</span>
  <span class="comment1">(* UNOPS *)</span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_clz_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.clz"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_ctz_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.ctz"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_popcnt_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.popcnt"</span>
  <span class="comment1">(* BINOPS - wrap *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_add_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.add"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_sub_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.sub"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_mul_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.mul"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_div_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.div'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_div_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.div'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_rem_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.rem'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_rem_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.rem'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_and_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.and'_"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_or_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.or'_"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_xor_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.xor"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_shl_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.shl"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_shr_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.shr'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_shr_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.shr'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_rotl_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.rotl"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_rotr_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.rotr"</span>
  <span class="comment1">(* TESTOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_eqz_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.eqz"</span>
  <span class="comment1">(* RELOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_eq_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.eq"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_lt_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.lt'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_lt_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.lt'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_gt_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.gt'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_gt_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.gt'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_le_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.le'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_le_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.le'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_ge_u_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.ge'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_ge_s_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.ge'_s"</span>
  <span class="comment1">(* CONVERSIONS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f32_convert_ui32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper'_convert.convert'_u'_i32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f32_convert_si32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper'_convert.convert'_s'_i32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f64_convert_ui32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper'_convert.convert'_u'_i32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f64_convert_si32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper'_convert.convert'_s'_i32"</span>
  <span class="comment1">(* VALUE CONVERSIONS - wrap *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.int_of_nat_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.int32'_of'_big'_int (Arith.integer'_of'_nat _)"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i32_inst.nat_of_int_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Arith.Nat (I32Wrapper.big'_int'_of'_int32 _)"</span>
  <span class="comment1">(* SIGN EXTENDING DESERIALISATION TODO *)</span>

<span class="comment1">(* INT64 *)</span>
  <span class="comment1">(* UNOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_clz_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.clz"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_ctz_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.ctz"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_popcnt_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.popcnt"</span>
  <span class="comment1">(* BINOPS - wrap *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_add_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.add"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_sub_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.sub"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_mul_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.mul"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_div_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.div'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_div_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.div'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_rem_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.rem'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_rem_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.rem'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_and_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.and'_"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_or_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.or'_"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_xor_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.xor"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_shl_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.shl"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_shr_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.shr'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_shr_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.shr'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_rotl_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.rotl"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_rotr_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.rotr"</span>
  <span class="comment1">(* TESTOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_eqz_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.eqz"</span>
  <span class="comment1">(* RELOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_eq_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.eq"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_lt_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.lt'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_lt_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.lt'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_gt_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.gt'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_gt_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.gt'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_le_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.le'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_le_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.le'_s"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_ge_u_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.ge'_u"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_ge_s_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.ge'_s"</span>
  <span class="comment1">(* CONVERSIONS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f32_convert_ui64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper'_convert.convert'_u'_i64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f32_convert_si64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper'_convert.convert'_s'_i64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f64_convert_ui64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper'_convert.convert'_u'_i64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">f64_convert_si64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper'_convert.convert'_s'_i64"</span>
  <span class="comment1">(* VALUE CONVERSIONS - wrap *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.int_of_nat_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper.int64'_of'_big'_int (Arith.integer'_of'_nat _)"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_int_i64_inst.nat_of_int_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Arith.Nat (I64Wrapper.big'_int'_of'_int64 _)"</span>

<span class="comment1">(* FLOAT32 *)</span>
  <span class="comment1">(* UNOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_neg_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.neg"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_abs_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.abs"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_ceil_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.ceil"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_floor_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.floor"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_trunc_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.trunc"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_nearest_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.nearest"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_sqrt_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.sqrt"</span>
  <span class="comment1">(* BINOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_add_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.add"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_sub_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.sub"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_mul_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.mul"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_div_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.div"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_min_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.min"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_max_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.max"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_copysign_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.copysign"</span>
  <span class="comment1">(* RELOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_eq_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.eq"</span>
<span class="comment1">(* | constant wasm_float_f32_inst.float_ne_f32 ⇀ (OCaml) "F32Wrapper.ne" *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_lt_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.lt"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_gt_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.gt"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_le_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.le"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f32_inst.float_ge_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F32Wrapper.ge"</span>
  <span class="comment1">(* CONVERSIONS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">ui32_trunc_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper'_convert.trunc'_u'_f32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">si32_trunc_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper'_convert.trunc'_s'_f32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">ui64_trunc_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper'_convert.trunc'_u'_f32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">si64_trunc_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper'_convert.trunc'_s'_f32"</span>
<span class="comment1">(* FLOAT64 *)</span>
  <span class="comment1">(* UNOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_neg_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.neg"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_abs_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.abs"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_ceil_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.ceil"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_floor_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.floor"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_trunc_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.trunc"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_nearest_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.nearest"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_sqrt_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.sqrt"</span>
  <span class="comment1">(* BINOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_add_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.add"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_sub_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.sub"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_mul_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.mul"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_div_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.div"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_min_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.min"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_max_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.max"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_copysign_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.copysign"</span>
  <span class="comment1">(* RELOPS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_eq_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.eq"</span>
<span class="comment1">(* | constant wasm_float_f64_inst.float_ne_f64 ⇀ (OCaml) "F64Wrapper.ne" *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_lt_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.lt"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_gt_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.gt"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_le_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.le"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_float_f64_inst.float_ge_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"F64Wrapper.ge"</span>
  <span class="comment1">(* CONVERSIONS *)</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">ui32_trunc_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper'_convert.trunc'_u'_f64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">si32_trunc_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper'_convert.trunc'_s'_f64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">ui64_trunc_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper'_convert.trunc'_u'_f64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">si64_trunc_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I64Wrapper'_convert.trunc'_s'_f64"</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">serialise_i32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.serialise_i32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">serialise_i64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.serialise_i64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">serialise_f32</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.serialise_f32"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">serialise_f64</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.serialise_f64"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_deserialise</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.deserialise"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">wasm_bool</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.bool"</span>
<span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">int32_minus_one</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"I32Wrapper.minus'_one"</span>

<span class="comment1">(* host *)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> host <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapperTypes.host'_function'_t"</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Printing">
<div class="head">
<h1>Theory Wasm_Printing</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Wasm_Printing <span class="keyword2"><span class="keyword">imports</span></span> <a href="Wasm_Checker_Printing.html">Wasm_Checker_Printing</a> <a href="Wasm_Interpreter_Printing.html">Wasm_Interpreter_Printing</a> <a href="Wasm_Type_Abs_Printing.html">Wasm_Type_Abs_Printing</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="keyword2"><span class="keyword">open</span></span> <span class="quoted"><span class="quoted">typing</span></span> <span class="quoted"><span class="quoted">run</span></span> <span class="keyword2"><span class="keyword">in</span></span> OCaml

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wasm_Interpreter_Printing_Pure">
<div class="head">
<h1>Theory Wasm_Interpreter_Printing_Pure</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Wasm_Interpreter_Printing_Pure
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Wasm_Interpreter_Properties.html">../Wasm_Interpreter_Properties</a>"</span>
    <a href="Wasm_Type_Abs_Printing.html">Wasm_Type_Abs_Printing</a>
   <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span>
   <span class="quoted">"<a href="../Native_Word/Code_Target_Bits_Int.html">Native_Word.Code_Target_Bits_Int</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  mem_grow_impl_is<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mem_grow_impl <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> Some <span class="main">(</span>mem_grow <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">=</span> run_v <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">63</span><span class="main">)</span> <span class="numeral">300</span>"</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">host_apply_impl</span> <span class="main">⇀</span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"ImplWrapper.host'_apply'_impl"</span>

<span class="keyword1"><span class="command">declare</span></span> Rep_bytes_inverse<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstype</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Rep_mem_inverse<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstype</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> write_bytes.rep_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstract</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">and</span></span> read_bytes.rep_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstract</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">and</span></span> mem_append.rep_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstract</span><span class="main">]</span>

<span class="keyword1" id="Wasm_Interpreter_Printing_Pure-bytes_takefill_rep_eq"><span class="command">lemma</span></span> bytes_takefill_rep_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_bytes <span class="main">(</span>bytes_takefill <span class="free">b</span> <span class="free">n</span> <span class="free">bs</span><span class="main">)</span> <span class="main">=</span> takefill <span class="free">b</span> <span class="free">n</span> <span class="main">(</span>Rep_bytes <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bytes_takefill.rep_eq Rep_uint8_inverse
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wasm_Interpreter_Printing_Pure-bytes_replicate_rep_eq"><span class="command">lemma</span></span> bytes_replicate_rep_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_bytes <span class="main">(</span>bytes_replicate <span class="free">n</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> replicate <span class="free">n</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bytes_replicate.rep_eq Rep_uint8_inverse
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="keyword2"><span class="keyword">open</span></span> <span class="quoted"><span class="quoted">run</span></span> <span class="keyword2"><span class="keyword">in</span></span> OCaml

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>