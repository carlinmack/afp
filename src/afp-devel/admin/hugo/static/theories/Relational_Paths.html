<div id="More_Relation_Algebra">
<div class="head">
<h1>Theory More_Relation_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      (More) Relation Algebra
   Author:     Walter Guttmann, Peter Hoefner
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
               Peter Hoefner &lt;peter at hoefner-online.de&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹(More) Relation Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory presents fundamental properties of relation algebras, which are not present in the AFP entry on relation algebras but could be integrated there \cite{ArmstrongFosterStruthWeber2014}.
Many theorems concern vectors and points.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> More_Relation_Algebra

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Relation_Algebra/Relation_Algebra_RTC.html">Relation_Algebra.Relation_Algebra_RTC</a> <a href="../Relation_Algebra/Relation_Algebra_Functions.html">Relation_Algebra.Relation_Algebra_Functions</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  trancl <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  converse <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>102<span class="main">]</span> 101<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bijective</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bijective</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_sur <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">reflexive</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reflexive</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="main">1'</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">symmetric</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">symmetric</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">transitive</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">transitive</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General theorems›</span></span>

<span class="keyword1" id="More_Relation_Algebra-x_leq_triple_x"><span class="command">lemma</span></span> x_leq_triple_x<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1'</span> <span class="main">⋅</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="main">1'</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dedekind<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">;</span><span class="main">1</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc dedekind mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-inj_triple"><span class="command">lemma</span></span> inj_triple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms eq_iff inf_absorb2 is_inj_def mult_1_left mult_subdistr x_leq_triple_x<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-p_fun_triple"><span class="command">lemma</span></span> p_fun_triple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc eq_iff is_p_fun_def mult_isol mult_oner x_leq_triple_x<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-loop_backward_forward"><span class="command">lemma</span></span> loop_backward_forward<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_times inf.cobounded2 test_dom test_domain test_eq_conv galois_2 inf.commute
           sup.commute<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-inj_sur_semi_swap"><span class="command">lemma</span></span> inj_sur_semi_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_inj <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_inj_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol order.trans mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">z</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_sur <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sur_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor order.trans mult_1_left<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-inj_sur_semi_swap_short"><span class="command">lemma</span></span> inj_sur_semi_swap_short<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹is_inj <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_inj_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_invol inf.orderI inf_absorb1 inj_p_fun ss_422iii<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_sur <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sur_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as assms inj_sur_semi_swap conv_contrav conv_invol conv_iso<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-bij_swap"><span class="command">lemma</span></span> bij_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inj_sur_semi_swap conv_invol<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following result is \cite[Proposition 4.2.2(iv)]{SchmidtStroehlein1993}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-ss422iv"><span class="command">lemma</span></span> ss422iv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> le_infI maddux_20 order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_left modular_1_var comp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> conv_iso mult_double_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_assoc is_p_fun_def mult_isol mult_1_right
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following results are variants of \cite[Proposition 4.2.3]{SchmidtStroehlein1993}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-ss423conv"><span class="command">lemma</span></span> ss423conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_iso inj_p_fun is_map_def ss423 sur_total<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-ss423bij"><span class="command">lemma</span></span> ss423bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms is_map_def p_fun_inj ss423 total_sur<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-inj_distr"><span class="command">lemma</span></span> inj_distr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span><span class="main">;</span><span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="free">z</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> mult_subdistr_var <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">using</span></span> assms conv_iso inj_p_fun p_fun_distl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="More_Relation_Algebra-test_converse"><span class="command">lemma</span></span> test_converse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_times inf_le2 is_test_def test_eq_conv<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-injective_down_closed"><span class="command">lemma</span></span> injective_down_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms conv_iso dual_order.trans is_inj_def mult_isol_var<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-injective_sup"><span class="command">lemma</span></span> injective_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> conv_contrav conv_e conv_invol conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">t</span><span class="main">;</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">t</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add distrib_left distrib_right' sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inj_def le_supI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_inj_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about vectors›</span></span>

<span class="keyword1" id="More_Relation_Algebra-vector_meet_comp"><span class="command">lemma</span></span> vector_meet_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">;</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">v</span><span class="main">⋅</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_one inf_top_right is_vector_def vector_1<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-vector_meet_comp'"><span class="command">lemma</span></span> vector_meet_comp'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">v</span><span class="main">⋅</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms vector_meet_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="More_Relation_Algebra-vector_meet_comp_x"><span class="command">lemma</span></span> vector_meet_comp_x<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">⋅</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc inf_top.right_neutral is_vector_def one_idem_mult vector_1<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-vector_meet_comp_x'"><span class="command">lemma</span></span> vector_meet_comp_x'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">⋅</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inf_top.right_neutral ra_1<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-vector_prop1"><span class="command">lemma</span></span> vector_prop1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms compl_inf_bot inf_top.right_neutral one_compl one_idem_mult vector_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following results and a number of others in this theory are from \cite{Guttmann2017a}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-ee"><span class="command">lemma</span></span> ee<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">e</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">v</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms annir mult_isor vector_prop1 comp_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> annil antisym bot_least comp_assoc mult_isol<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-et"><span class="command">lemma</span></span> et<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> mult_isol_var comp_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc le_bot vector_prop1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_isol_var comp_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc le_bot vector_prop1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about points›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">point</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">point</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> is_vector <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> bijective <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_swap"><span class="command">lemma</span></span> point_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol inj_sur_semi_swap point_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about singletons›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">singleton</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">singleton</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> bijective <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> bijective <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_injective"><span class="command">lemma</span></span> singleton_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms injective_down_closed maddux_20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="More_Relation_Algebra-injective_inv"><span class="command">lemma</span></span> injective_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms singleton_injective injective_sup bot_least et<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-singleton_is_point"><span class="command">lemma</span></span> singleton_is_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"point <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_assoc is_vector_def point_def<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-singleton_transp"><span class="command">lemma</span></span> singleton_transp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"singleton <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-point_to_singleton"><span class="command">lemma</span></span> point_to_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"singleton <span class="main">(</span><span class="main">1'</span><span class="main">⋅</span><span class="free">p</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms dom_def_aux_var dom_one is_vector_def point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="More_Relation_Algebra-singleton_singletonT"><span class="command">lemma</span></span> singleton_singletonT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms singleton_injective is_inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Minimality›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">minimum</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minimum</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Regressively finite›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">regressively_finite</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">regressively_finite</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">.</span> is_vector <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="bound">v</span> <span class="main">⟶</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="More_Relation_Algebra-regressively_finite_minimum"><span class="command">lemma</span></span> regressively_finite_minimum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regressively_finite <span class="free">R</span> <span class="main">⟹</span> is_vector <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> minimum <span class="free">R</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> galois_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="More_Relation_Algebra-regressively_finite_irreflexive"><span class="command">lemma</span></span> regressively_finite_irreflexive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regressively_finite <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_test_def test_comp_eq_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc mult_subdistr<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_invol conv_times conv_zero galois_aux ss_p18<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation algebras satisfying the Tarski rule›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_tarski <span class="main">=</span> relation_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tarski<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about points›</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_equations"><span class="command">lemma</span></span> point_equations<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">;</span><span class="main">1</span><span class="main">=</span><span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">=</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms is_point_def is_vector_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms is_point_def is_vector_def tarski vector_comp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_one conv_zero is_point_def is_vector_def tarski<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_one is_point_def is_vector_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following result is \cite[Proposition 2.4.5(i)]{SchmidtStroehlein1993}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_singleton"><span class="command">lemma</span></span> point_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> comp_assoc is_vector_def tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="free">v</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">v</span> <span class="main">⋅</span> <span class="main">1</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dedekind <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_subdistl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> conv_iso mult_double_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_inj_def is_point_def mult_isor mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_not_equal_aux"><span class="command">lemma</span></span> point_not_equal_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">-</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_nn<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms galois_aux2 is_point_def point_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">-</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_compl_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following result is part of \cite[Proposition 2.4.5(ii)]{SchmidtStroehlein1993}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_not_equal"><span class="command">lemma</span></span> point_not_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">≤</span><span class="main">-</span><span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≤</span><span class="main">-</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span> <span class="main">⟷</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms point_not_equal_aux is_point_def vector_compl vector_mult point_singleton
              inf.orderI inf.cobounded1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">≤</span><span class="main">-</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> galois_aux inf.orderE is_point_def order.refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">;</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_galois_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">;</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> compl_bot_eq conv_galois_2 galois_aux maddux_141 mult_1_right
              point_equations<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_is_point"><span class="command">lemma</span></span> point_is_point<span class="main">:</span>
  <span class="quoted"><span class="quoted">"point <span class="free">x</span> <span class="main">⟷</span> is_point <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_point_def point_def surj_one tarski<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> is_point_def is_vector_def mult_assoc point_def sur_def_var1 tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="More_Relation_Algebra-point_in_vector_or_complement"><span class="command">lemma</span></span> point_in_vector_or_complement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_assoc is_vector_def point_def tarski vector_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">p</span><span class="main">;</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top.left_neutral modular_2_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_assoc point_def ss423conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_in_vector_or_complement_iff"><span class="command">lemma</span></span> point_in_vector_or_complement_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">¬</span><span class="main">(</span><span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms annir compl_top_eq galois_aux inf.orderE one_compl point_def ss423conv tarski
          top_greatest point_in_vector_or_complement<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-different_points_consequences"><span class="command">lemma</span></span> different_points_consequences<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="free">q</span><span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms compl_le_swap1 inf.absorb1 inf.absorb2 point_def point_in_vector_or_complement<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="free">q</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_vector_def point_def ss423conv top_le<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_compl conv_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about singletons›</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_pq"><span class="command">lemma</span></span> singleton_pq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"singleton <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms comp_assoc point_def point_equations<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="More_Relation_Algebra-singleton_equal_aux"><span class="command">lemma</span></span> singleton_equal_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≤</span><span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> pLp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> maddux_21 ss423conv<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tarski
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> annir singleton_injective inf.commute inf_top.right_neutral inj_triple
              mult_assoc surj_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">;</span><span class="main">(</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dedekind <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_iso mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pLp <span class="keyword1"><span class="command">using</span></span> mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">q</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> singleton_singletonT <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_equal"><span class="command">lemma</span></span> singleton_equal<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">q</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≤</span><span class="free">p</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> singleton_equal_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms singleton_equal_aux singleton_transp conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 p2 inf.boundedI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">q</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dedekind <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">q</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor comp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">q</span><span class="main">;</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_contrav conv_invol conv_one is_inj_def mult_assoc mult_isol
              one_idem_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_nonsplit"><span class="command">lemma</span></span> singleton_nonsplit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≤</span><span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms injective_down_closed mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms conv_iso injective_down_closed mult_isol_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 comp_assoc sur_def_var1 tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_one mult.semigroup_axioms sur_def_var1 semigroup.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms singleton_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_nonzero"><span class="command">lemma</span></span> singleton_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"point <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms singleton_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_point_def point_is_point<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_sum"><span class="command">lemma</span></span> singleton_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">p</span><span class="main">≤</span><span class="free">x</span> <span class="main">∨</span> <span class="free">p</span><span class="main">≤</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≤</span><span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≤</span><span class="free">x</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">p</span><span class="main">≤</span><span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a inf.orderI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms singleton_nonsplit galois_aux inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≤</span><span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> as <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_1 inf.orderE<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup.coboundedI1 sup.coboundedI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-singleton_iff"><span class="command">lemma</span></span> singleton_iff<span class="main">:</span>
 <span class="quoted"><span class="quoted">"singleton <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> comp_assoc conv_contrav conv_invol conv_one is_inj_def le_sup_iff one_idem_mult
        sur_def_var1 tarski<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-singleton_not_atom_in_relation_algebra_tarski"><span class="command">lemma</span></span> singleton_not_atom_in_relation_algebra_tarski<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="free">p</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="free">p</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">nitpick</span></span> <span class="main">[</span>expect<span class="main">=</span>genuine<span class="main">]</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_tarski *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation algebras satisfying the point axiom›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_point <span class="main">=</span> relation_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> point_axiom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="bound">z</span> <span class="main">.</span> point <span class="bound">y</span> <span class="main">∧</span> point <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">;</span><span class="bound">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about points›</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_exists"><span class="command">lemma</span></span> point_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> point <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> eq_iff is_inj_def is_sur_def is_vector_def point_axiom point_def<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-point_below_vector"><span class="command">lemma</span></span> point_below_vector<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> point <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="skolem">y</span> <span class="main">∧</span> point <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">;</span><span class="skolem">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> point_axiom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="skolem">z</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_contrav conv_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">;</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="skolem">z</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc is_vector_def mult_isor<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_one is_vector_def point_def sur_def_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_point *)</span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_tarski_point <span class="main">=</span> relation_algebra_tarski <span class="main">+</span> relation_algebra_point
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="More_Relation_Algebra-atom_is_singleton"><span class="command">lemma</span></span> atom_is_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="free">p</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"singleton <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms singleton_nonzero singleton_pq point_axiom<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-singleton_iff_atom"><span class="command">lemma</span></span> singleton_iff_atom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"singleton <span class="free">p</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="free">p</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> singleton_nonsplit singleton_nonzero atom_is_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="More_Relation_Algebra-maddux_tarski"><span class="command">lemma</span></span> maddux_tarski<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≤</span><span class="free">x</span> <span class="main">∧</span> is_p_fun <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="skolem">p</span> <span class="main">∧</span> point <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">;</span><span class="skolem">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms point_axiom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">;</span><span class="skolem">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singleton_nonzero singleton_pq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="main">(</span><span class="skolem">p</span><span class="main">;</span><span class="skolem">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> singleton_singletonT singleton_pq singleton_transp is_inj_def p_fun_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Intermediate Point Theorem \cite[Proposition 2.4.8]{SchmidtStroehlein1993}›</span></span>

<span class="keyword1" id="More_Relation_Algebra-intermediate_point_theorem"><span class="command">lemma</span></span> intermediate_point_theorem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">y</span><span class="main">;</span><span class="free">r</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span> <span class="main">.</span> point <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="bound">q</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">y</span><span class="main">;</span><span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_assoc is_vector_def point_def vector_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf.absorb2 is_point_def maddux_141 point_is_point mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="main">.</span> point <span class="bound">q</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≤</span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 point_below_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="main">.</span> point <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="bound">q</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> point_swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="main">.</span> point <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="bound">q</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">y</span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_assoc mult_isol order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_tarski_point *)</span>

<span class="comment1">(*
The following shows that rtc can be defined with only 2 axioms.
This should eventually go into AFP/Relation_Algebra_RTC.relation_algebra_rtc.
There the class definition should be replaced with:

class relation_algebra_rtc = relation_algebra + star_op +
  assumes rtc_unfoldl: "1' + x ; x<span class="hidden">⇧</span><sup>⋆</sup> ≤ x<span class="hidden">⇧</span><sup>⋆</sup>"
      and rtc_inductl: "z + x ; y ≤ y ⟶ x<span class="hidden">⇧</span><sup>⋆</sup> ; z ≤ y"

and the following lemmas:
*)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="More_Relation_Algebra-unfoldl_inductl_implies_unfoldr"><span class="command">lemma</span></span> unfoldl_inductl_implies_unfoldr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1'</span> <span class="main">+</span> <span class="bound">x</span><span class="main">;</span><span class="main">(</span><span class="free">rtc</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">rtc</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">;</span><span class="bound">z</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">rtc</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1'</span> <span class="main">+</span> <span class="free">rtc</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">rtc</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms le_sup_iff mult_oner order.trans subdistl_eq sup_absorb2 sup_ge1<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-star_transpose_swap"><span class="command">lemma</span></span> star_transpose_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1'</span> <span class="main">+</span> <span class="bound">x</span><span class="main">;</span><span class="main">(</span><span class="free">rtc</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">rtc</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">;</span><span class="bound">z</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">rtc</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rtc</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rtc</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_add conv_contrav conv_e conv_iso mult_1_right
             unfoldl_inductl_implies_unfoldr <span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_add conv_contrav conv_e conv_invol conv_iso mult_1_right
          unfoldl_inductl_implies_unfoldr<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-unfoldl_inductl_implies_inductr"><span class="command">lemma</span></span> unfoldl_inductl_implies_inductr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1'</span> <span class="main">+</span> <span class="bound">x</span><span class="main">;</span><span class="main">(</span><span class="free">rtc</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">rtc</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">;</span><span class="bound">z</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">rtc</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">z</span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">;</span><span class="free">rtc</span><span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_add conv_contrav conv_iso star_transpose_swap<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">tc</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_acyclic</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_acyclic</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General theorems›</span></span>

<span class="keyword1" id="More_Relation_Algebra-star_denest_10"><span class="command">lemma</span></span> star_denest_10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">+</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bubble_sort sup.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Relation_Algebra-star_star_plus"><span class="command">lemma</span></span> star_star_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> sup.left_commute star_plus_one star_unfoldl_eq sup.commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two lemmas are from \cite{Guttmann2018b}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-cancel_separate"><span class="command">lemma</span></span> cancel_separate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conway.dagger_unfoldl_distr distrib_left mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms join_isol star_invol star_plus_one star_subdist_var_2 sup.absorb2 sup.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left le_supI1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtc_inductl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-cancel_separate_inj_converse"><span class="command">lemma</span></span> cancel_separate_inj_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms cancel_separate is_inj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conway.dagger_unfoldl_distr le_supI mult_1_right mult_isol sup.cobounded1<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-cancel_separate_p_fun_converse"><span class="command">lemma</span></span> cancel_separate_p_fun_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sup_commute assms cancel_separate_inj_converse p_fun_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="More_Relation_Algebra-cancel_separate_converse_idempotent"><span class="command">lemma</span></span> cancel_separate_converse_idempotent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cancel_separate cancel_separate_p_fun_converse church_rosser_equiv is_inj_def
          star_denest_var_6<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-triple_star"><span class="command">lemma</span></span> triple_star<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms cancel_separate_inj_converse cancel_separate_p_fun_converse<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-inj_xxts"><span class="command">lemma</span></span> inj_xxts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cancel_separate_inj_converse distrib_right less_eq_def star_ext<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-plus_top"><span class="command">lemma</span></span> plus_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conway.dagger_unfoldr_distr sup_top_left<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-top_plus"><span class="command">lemma</span></span> top_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conway.dagger_unfoldr_distr star_denest_var_2 star_ext star_slide_var
           sup_top_left top_unique<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-plus_conv"><span class="command">lemma</span></span> plus_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_conv star_slide_var<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-inj_implies_step_forwards_backwards"><span class="command">lemma</span></span> inj_implies_step_forwards_backwards<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_e dedekind mult_1_right mult_isor star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_idem meet_interchange mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_inj_def meet_isor mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc rtc_inductl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.cobounded2 mult_isor order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Acyclic relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following result is from \cite{Guttmann2017c}.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_inv"><span class="command">lemma</span></span> acyclic_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">≤</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_double_iso top_greatest is_vector_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_galois_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">;</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_galois_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">+</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span> et<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> independence2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1'</span> <span class="main">+</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> ee boffa_var bot_least <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">;</span><span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">;</span><span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 assms<span class="main">(</span>2-3<span class="main">)</span> ee independence2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">+</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_single_step"><span class="command">lemma</span></span> acyclic_single_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dual_order.trans mult_isol mult_oner star_ref<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_reachable_points"><span class="command">lemma</span></span> acyclic_reachable_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> eq_iff inf.absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inj_distr is_point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="main">1'</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acyclic_single_step assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abel_semigroup.commute inf.abel_semigroup_axioms
          meet_isor mult_isor<span class="main">)</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> bot_unique is_point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_trans"><span class="command">lemma</span></span> acyclic_trans<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">≥</span><span class="free">x</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms compl_mono conv_galois_2 conv_iso double_compl mult_onel star_1l<span class="main">)</span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans plus_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_trans'"><span class="command">lemma</span></span> acyclic_trans'<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="main">1'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_galois_1 conv_galois_2 order_trans star_trans<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Regressively finite›</span></span>

<span class="keyword1" id="More_Relation_Algebra-regressively_finite_acyclic"><span class="command">lemma</span></span> regressively_finite_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regressively_finite <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_conv test_converse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol modular_1_var mult_isor mult_oner mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_invol modular_2_var mult_isol mult_isor star_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conway.dagger_unfoldr_distr inf.commute sup.cobounded1 top_le<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_aux ss_p18<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">notation</span></span> power <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">↑</span>"</span> 80<span class="main">)</span>

<span class="keyword1" id="More_Relation_Algebra-power_suc_below_plus"><span class="command">lemma</span></span> power_suc_below_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↑</span> Suc <span class="free">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> mult_isol star_ref <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol_var order_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc *)</span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc_tarski <span class="main">=</span> relation_algebra_rtc <span class="main">+</span> relation_algebra_tarski
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="More_Relation_Algebra-point_loop_not_acyclic"><span class="command">lemma</span></span> point_loop_not_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> Suc <span class="free">n</span> <span class="main">;</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_acyclic <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">;</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dual_order.trans point_def point_is_point ss423bij power_suc_below_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">;</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> point_def point_is_point ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> order.trans point_not_equal<span class="main">(</span>1<span class="main">)</span> point_not_equal<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc_point <span class="main">=</span> relation_algebra_rtc <span class="main">+</span> relation_algebra_point

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc_tarski_point <span class="main">=</span> relation_algebra_rtc_tarski <span class="main">+</span> relation_algebra_rtc_point <span class="main">+</span>
                                          relation_algebra_tarski_point

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Finite graphs: the axiom says the algebra has finitely many elements.
This means the relations have a finite base set.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc_tarski_point_finite <span class="main">=</span> relation_algebra_rtc_tarski_point <span class="main">+</span> finite
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For a finite acyclic relation, the powers eventually vanish.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_power_vanishes"><span class="command">lemma</span></span> acyclic_power_vanishes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> <span class="free">x</span> <span class="main">↑</span> Suc <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> is_point <span class="bound">p</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↑</span> <span class="var">?n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="skolem">p</span> <span class="main">∧</span> point <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">;</span><span class="skolem">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> point_axiom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="var">?p</span><span class="main">;</span><span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="var">?n</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="bound">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">↑</span><span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span><span class="main">↑</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="var">?n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="skolem">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">↑</span><span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span><span class="main">↑</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
        <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="var">?n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="skolem">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span><span class="main">≤</span><span class="var">?n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span><span class="main">≤</span><span class="var">?n</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="skolem">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="skolem">n</span><span class="main">-</span>one_class.one<span class="main">)</span> <span class="main">;</span> <span class="free">x</span> <span class="main">;</span> <span class="skolem">f</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc_diff_le diff_Suc_1 diff_Suc_Suc power_Suc2<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="skolem">f</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 5 intermediate_point_theorem point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> Suc <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">r</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">m</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="var">?g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="bound">i</span> <span class="main">∧</span> <span class="var">?g</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">⟶</span> is_point <span class="main">(</span><span class="var">?g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="var">?g</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≤</span><span class="skolem">n</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_point <span class="main">(</span><span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_point <span class="main">(</span><span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> 6 point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="bound">j</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">⟶</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="skolem">j</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span>Suc <span class="skolem">n</span>"</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="skolem">j</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="main">;</span> <span class="var">?g</span> <span class="skolem">j</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">case</span></span> True
                        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword3"><span class="command">case</span></span> False
                        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="skolem">j</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> 5 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="skolem">j</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> 7 False Suc_diff_le comp_assoc mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">using</span></span> 6 False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False le_Suc_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>Suc <span class="skolem">n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="bound">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="var">?n</span> <span class="main">.</span> is_point <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="var">?n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">k</span> <span class="main">.</span> <span class="bound">k</span><span class="main">≤</span><span class="var">?n</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="var">?A</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> is_point <span class="bound">p</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="var">?A</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="skolem">f</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pigeonhole<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?n</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="var">?n</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inj_on_def mem_Collect_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> 8 9 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_le Suc_leI assms diff_Suc_Suc order_less_imp_le
                            point_loop_not_acyclic<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms neqE point_loop_not_acyclic Suc_diff_le Suc_leI assms diff_Suc_Suc
                        order_less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir power.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Hence finite acyclic relations are regressively finite.›</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_regressively_finite"><span class="command">lemma</span></span> acyclic_regressively_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"regressively_finite <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms acyclic_trans' compl_le_swap1 order_trans star_ref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">↑</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acyclic_power_vanishes <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="skolem">v</span> <span class="main">⟶</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">↑</span> Suc <span class="skolem">n</span> <span class="main">;</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">↑</span> Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Relation_Algebra-acyclic_is_regressively_finite"><span class="command">lemma</span></span> acyclic_is_regressively_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span> <span class="main">⟷</span> regressively_finite <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> acyclic_regressively_finite regressively_finite_acyclic <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* end relation_algebra_rtc_tarski_point_finite *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Paths">
<div class="head">
<h1>Theory Paths</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relational Characterisation of Paths
   Author:     Walter Guttmann, Peter Hoefner
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
               Peter Hoefner &lt;peter at hoefner-online.de&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relational Characterisation of Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory provides the relation-algebraic characterisations of paths, as defined in Sections 3--5 of \cite{BerghammerFurusawaGuttmannHoefner2020}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Paths

<span class="keyword2"><span class="keyword">imports</span></span> <a href="More_Relation_Algebra.html">More_Relation_Algebra</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_tarski
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Paths-path_concat_aux_0"><span class="command">lemma</span></span> path_concat_aux_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">;</span><span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tarski assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_one eq_refl inf_absorb1 inf_top_left is_vector_def ra_2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span> <span class="main">=</span> <span class="free">w</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor mult_isol mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_vector_def comp_assoc conv_contrav conv_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">v</span><span class="main">;</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context relation_algebra_tarski *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequences without the Tarski rule›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definitions for path classifications›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">connected</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">connected</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">many_strongly_connected</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">many_strongly_connected</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">one_strongly_connected</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_strongly_connected</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> connected <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_p_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cycle</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cycle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> many_strongly_connected <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">start_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">start_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">end_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">end_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_start_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_start_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_end_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_end_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_start_end_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_start_end_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">has_start_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_start_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">has_end_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_end_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">has_start_end_points</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_start_end_points</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">backward_terminating</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">backward_terminating</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">forward_terminating</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">forward_terminating</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">terminating</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">terminating</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">backward_finite</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">backward_finite</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">forward_finite</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">forward_finite</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">finite</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finite</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_start_points_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_start_points_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> no_start_points <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_end_points_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_end_points_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> no_end_points <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_start_end_points_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_start_end_points_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> no_start_end_points <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">has_start_points_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_start_points_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> has_start_points <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">has_end_points_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_end_points_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> has_end_points <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">has_start_end_points_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_start_end_points_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> has_start_end_points <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">backward_terminating_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">backward_terminating_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> backward_terminating <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">forward_terminating_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">forward_terminating_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> forward_terminating <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">terminating_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">terminating_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> terminating <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">backward_finite_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">backward_finite_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> backward_finite <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">forward_finite_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">forward_finite_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> forward_finite <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">finite_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finite_path</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> finite <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General properties›</span></span>

<span class="keyword1" id="Paths-reachability_from_z_in_y"><span class="command">lemma</span></span> reachability_from_z_in_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conway.dagger_unfoldl_distr galois_1 galois_aux inf.orderE<span class="main">)</span>

<span class="keyword1" id="Paths-reachable_imp"><span class="command">lemma</span></span> reachable_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conway.dagger_unfoldr_distr le_supE point_swap star_conv<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Basic equivalences›</span></span>

<span class="keyword1" id="Paths-no_start_end_points_iff"><span class="command">lemma</span></span> no_start_end_points_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"no_start_end_points <span class="free">x</span> <span class="main">⟷</span> no_start_points <span class="free">x</span> <span class="main">∧</span> no_end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-has_start_end_points_iff"><span class="command">lemma</span></span> has_start_end_points_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_start_end_points <span class="free">x</span> <span class="main">⟷</span> has_start_points <span class="free">x</span> <span class="main">∧</span> has_end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_eq_top_iff<span class="main">)</span>

<span class="keyword1" id="Paths-terminating_iff"><span class="command">lemma</span></span> terminating_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"terminating <span class="free">x</span> <span class="main">⟷</span> backward_terminating <span class="free">x</span> <span class="main">∧</span> forward_terminating <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-finite_iff"><span class="command">lemma</span></span> finite_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">x</span> <span class="main">⟷</span> backward_finite <span class="free">x</span> <span class="main">∧</span> forward_finite <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1 inf.boundedI<span class="main">)</span>

<span class="keyword1" id="Paths-no_start_end_points_path_iff"><span class="command">lemma</span></span> no_start_end_points_path_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"no_start_end_points_path <span class="free">x</span> <span class="main">⟷</span> no_start_points_path <span class="free">x</span> <span class="main">∧</span> no_end_points_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-has_start_end_points_path_iff"><span class="command">lemma</span></span> has_start_end_points_path_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">x</span> <span class="main">⟷</span> has_start_points_path <span class="free">x</span> <span class="main">∧</span> has_end_points_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> has_start_end_points_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-terminating_path_iff"><span class="command">lemma</span></span> terminating_path_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"terminating_path <span class="free">x</span> <span class="main">⟷</span> backward_terminating_path <span class="free">x</span> <span class="main">∧</span> forward_terminating_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-finite_path_iff"><span class="command">lemma</span></span> finite_path_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_path <span class="free">x</span> <span class="main">⟷</span> backward_finite_path <span class="free">x</span> <span class="main">∧</span> forward_finite_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> finite_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Closure under converse›</span></span>

<span class="keyword1" id="Paths-connected_conv"><span class="command">lemma</span></span> connected_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> connected <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_add conv_contrav conv_iso conv_one star_conv<span class="main">)</span>

<span class="keyword1" id="Paths-conv_many_strongly_connected"><span class="command">lemma</span></span> conv_many_strongly_connected<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> many_strongly_connected <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_one_strongly_connected"><span class="command">lemma</span></span> conv_one_strongly_connected<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> one_strongly_connected <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_iso conv_one star_conv<span class="main">)</span>

<span class="keyword1" id="Paths-conv_path"><span class="command">lemma</span></span> conv_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path <span class="free">x</span> <span class="main">⟷</span> path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> connected_conv inj_p_fun path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_cycle"><span class="command">lemma</span></span> conv_cycle<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cycle <span class="free">x</span> <span class="main">⟷</span> cycle <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_no_start_points"><span class="command">lemma</span></span> conv_no_start_points<span class="main">:</span>
  <span class="quoted"><span class="quoted">"no_start_points <span class="free">x</span> <span class="main">⟷</span> no_end_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-conv_no_start_end_points"><span class="command">lemma</span></span> conv_no_start_end_points<span class="main">:</span>
  <span class="quoted"><span class="quoted">"no_start_end_points <span class="free">x</span> <span class="main">⟷</span> no_start_end_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_has_start_points"><span class="command">lemma</span></span> conv_has_start_points<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span> <span class="main">⟷</span> has_end_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_invol conv_one<span class="main">)</span>

<span class="keyword1" id="Paths-conv_has_start_end_points"><span class="command">lemma</span></span> conv_has_start_end_points<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_start_end_points <span class="free">x</span> <span class="main">⟷</span> has_start_end_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_invol conv_one inf_eq_top_iff<span class="main">)</span>

<span class="keyword1" id="Paths-conv_backward_terminating"><span class="command">lemma</span></span> conv_backward_terminating<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span> <span class="main">⟷</span> forward_terminating <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_iso conv_one<span class="main">)</span>

<span class="keyword1" id="Paths-conv_terminating"><span class="command">lemma</span></span> conv_terminating<span class="main">:</span>
  <span class="quoted"><span class="quoted">"terminating <span class="free">x</span> <span class="main">⟷</span> terminating <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> conv_compl conv_contrav conv_one conv_times inf.commute le_iff_inf mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_compl conv_contrav conv_invol conv_one conv_times inf.commute le_iff_inf mult_assoc<span class="main">)</span>

<span class="keyword1" id="Paths-conv_backward_finite"><span class="command">lemma</span></span> conv_backward_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_finite <span class="free">x</span> <span class="main">⟷</span> forward_finite <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_add conv_compl conv_contrav conv_iso conv_one star_conv<span class="main">)</span>

<span class="keyword1" id="Paths-conv_finite"><span class="command">lemma</span></span> conv_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">x</span> <span class="main">⟷</span> finite <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_iff conv_backward_finite conv_invol<span class="main">)</span>

<span class="keyword1" id="Paths-conv_no_start_points_path"><span class="command">lemma</span></span> conv_no_start_points_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"no_start_points_path <span class="free">x</span> <span class="main">⟷</span> no_end_points_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_no_start_end_points_path"><span class="command">lemma</span></span> conv_no_start_end_points_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"no_start_end_points_path <span class="free">x</span> <span class="main">⟷</span> no_start_end_points_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_has_start_points_path"><span class="command">lemma</span></span> conv_has_start_points_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_start_points_path <span class="free">x</span> <span class="main">⟷</span> has_end_points_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_has_start_points conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_has_start_end_points_path"><span class="command">lemma</span></span> conv_has_start_end_points_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">x</span> <span class="main">⟷</span> has_start_end_points_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_has_start_end_points conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_backward_terminating_path"><span class="command">lemma</span></span> conv_backward_terminating_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span> <span class="main">⟷</span> forward_terminating_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_backward_terminating conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_terminating_path"><span class="command">lemma</span></span> conv_terminating_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"terminating_path <span class="free">x</span> <span class="main">⟷</span> terminating_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_path conv_terminating <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_backward_finite_path"><span class="command">lemma</span></span> conv_backward_finite_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_finite_path <span class="free">x</span> <span class="main">⟷</span> forward_finite_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_backward_finite conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-conv_finite_path"><span class="command">lemma</span></span> conv_finite_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_path <span class="free">x</span> <span class="main">⟷</span> finite_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conv_finite conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equivalences for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>connected›</span></span></span></span>›</span></span>

<span class="keyword1" id="Paths-connected_iff2"><span class="command">lemma</span></span> connected_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol modular_var_3 vector_meet_comp_x'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 mult_isor star_star_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_isol star_slide_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_inj_def comp_assoc join_iso mult_1_right mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modular_var_3 vector_meet_comp_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor star_star_plus sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_iso star_slide_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc is_p_fun_def join_isol mult_1_right mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-connected_iff3"><span class="command">lemma</span></span> connected_iff3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms connected_conv connected_iff2 inj_p_fun p_fun_inj conv_invol add_commute<span class="main">)</span>

<span class="keyword1" id="Paths-connected_iff4"><span class="command">lemma</span></span> connected_iff4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> connected_conv conv_invol add_commute<span class="main">)</span>

<span class="keyword1" id="Paths-connected_iff5"><span class="command">lemma</span></span> connected_iff5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> comp_assoc plus_top top_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-connected_iff6"><span class="command">lemma</span></span> connected_iff6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms connected_iff2 comp_assoc plus_conv plus_top top_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-connected_iff7"><span class="command">lemma</span></span> connected_iff7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms connected_iff3 conv_contrav conv_invol conv_one top_plus vector_meet_comp_x<span class="main">)</span>

<span class="keyword1" id="Paths-connected_iff8"><span class="command">lemma</span></span> connected_iff8<span class="main">:</span>
  <span class="quoted"><span class="quoted">"connected <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> connected_iff4 comp_assoc conv_contrav conv_invol conv_one plus_conv star_conv top_plus<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equivalences and implications for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>many_strongly_connected›</span></span></span></span>›</span></span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_1"><span class="command">lemma</span></span> many_strongly_connected_iff_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_iso eq_iff star_conv star_invol star_iso<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_2"><span class="command">lemma</span></span> many_strongly_connected_iff_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> many_strongly_connected_iff_1 loop_backward_forward inf_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as eq_iff mult_1_right mult_isol star_ref sup.absorb1 conv_invol eq_refl galois_1
              inf.absorb_iff1 inf.commute star_unfoldl_eq sup_mono many_strongly_connected_iff_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_trans star_1l many_strongly_connected_iff_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_3"><span class="command">lemma</span></span> many_strongly_connected_iff_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol many_strongly_connected_iff_1<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_4"><span class="command">lemma</span></span> many_strongly_connected_iff_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol many_strongly_connected_iff_2<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_5"><span class="command">lemma</span></span> many_strongly_connected_iff_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conway.dagger_unfoldr_distr star_conv star_denest_var_2
          star_invol star_trans_eq star_unfoldl_eq sup.boundedE many_strongly_connected_iff_2<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_6"><span class="command">lemma</span></span> many_strongly_connected_iff_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans star_1l star_conv star_inductl_star star_invol star_slide_var
          many_strongly_connected_iff_1 many_strongly_connected_iff_5<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_7"><span class="command">lemma</span></span> many_strongly_connected_iff_7<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym conv_invol star_slide_var star_unfoldl_eq many_strongly_connected_iff_5<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_5_eq"><span class="command">lemma</span></span> many_strongly_connected_iff_5_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.refl star_slide_var many_strongly_connected_iff_5 many_strongly_connected_iff_7<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_6_eq"><span class="command">lemma</span></span> many_strongly_connected_iff_6_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> many_strongly_connected_iff_6 many_strongly_connected_iff_7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_no_start_end_points"><span class="command">lemma</span></span> many_strongly_connected_implies_no_start_end_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_start_end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conway.dagger_unfoldl_distr mult_assoc sup_top_left conv_invol
        many_strongly_connected_iff_7<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_8"><span class="command">lemma</span></span> many_strongly_connected_implies_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mult_isol<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_9"><span class="command">lemma</span></span> many_strongly_connected_implies_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms eq_refl phl_cons1 star_ext star_slide_var<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_10"><span class="command">lemma</span></span> many_strongly_connected_implies_10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_assoc mult_isol<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_10_eq"><span class="command">lemma</span></span> many_strongly_connected_implies_10_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_assoc mult_isol<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isor x_leq_triple_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_11"><span class="command">lemma</span></span> many_strongly_connected_implies_11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_iso mult_isol star_1l star_slide_var<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_11_eq"><span class="command">lemma</span></span> many_strongly_connected_implies_11_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc conv_invol many_strongly_connected_iff_5_eq
          many_strongly_connected_implies_10_eq<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_12"><span class="command">lemma</span></span> many_strongly_connected_implies_12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc mult_isol star_1l star_slide_var<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_12_eq"><span class="command">lemma</span></span> many_strongly_connected_implies_12_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc star_slide_var many_strongly_connected_implies_10_eq<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_13"><span class="command">lemma</span></span> many_strongly_connected_implies_13<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms star_slide_var many_strongly_connected_implies_11 mult.assoc<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_implies_13_eq"><span class="command">lemma</span></span> many_strongly_connected_implies_13_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol many_strongly_connected_iff_7 many_strongly_connected_implies_10_eq<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_8"><span class="command">lemma</span></span> many_strongly_connected_iff_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> many_strongly_connected_iff_1<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_invol dual_order.trans mult_isol x_leq_triple_x assms comp_assoc
          dual_order.trans is_p_fun_def order.refl prod_star_closure star_ref<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_9"><span class="command">lemma</span></span> many_strongly_connected_iff_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_iso inj_p_fun star_conv star_slide_var
          many_strongly_connected_iff_1 many_strongly_connected_iff_8<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_10"><span class="command">lemma</span></span> many_strongly_connected_iff_10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mult_isol mult_oner order_trans star_ref many_strongly_connected_iff_8<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_10_eq"><span class="command">lemma</span></span> many_strongly_connected_iff_10_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_10 many_strongly_connected_implies_10_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_11"><span class="command">lemma</span></span> many_strongly_connected_iff_11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc conv_contrav conv_iso inj_p_fun plus_conv star_conv
          many_strongly_connected_iff_10 many_strongly_connected_iff_2<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_11_eq"><span class="command">lemma</span></span> many_strongly_connected_iff_11_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_11 many_strongly_connected_implies_11_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_12"><span class="command">lemma</span></span> many_strongly_connected_iff_12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dual_order.trans mult_double_iso mult_oner star_ref star_slide_var
          many_strongly_connected_iff_8 many_strongly_connected_implies_12<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_12_eq"><span class="command">lemma</span></span> many_strongly_connected_iff_12_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_12 many_strongly_connected_implies_12_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_13"><span class="command">lemma</span></span> many_strongly_connected_iff_13<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc conv_contrav conv_iso inj_p_fun star_conv star_slide_var
          many_strongly_connected_iff_1 many_strongly_connected_iff_12<span class="main">)</span>

<span class="keyword1" id="Paths-many_strongly_connected_iff_13_eq"><span class="command">lemma</span></span> many_strongly_connected_iff_13_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_13 many_strongly_connected_implies_13_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equivalences and implications for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>one_strongly_connected›</span></span></span></span>›</span></span>

<span class="keyword1" id="Paths-one_strongly_connected_iff"><span class="command">lemma</span></span> one_strongly_connected_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> connected <span class="free">x</span> <span class="main">∧</span> many_strongly_connected <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> top_greatest x_leq_triple_x mult_double_iso top_greatest dual_order.trans
              many_strongly_connected_iff_1 comp_assoc conv_contrav conv_invol conv_iso le_supI2
              star_conv<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_iso conv_one conway.dagger_denest star_conv star_invol
          star_sum_unfold star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_1"><span class="command">lemma</span></span> one_strongly_connected_iff_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol mult_isor x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left mult_assoc sup.absorb_iff1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> many_strongly_connected_implies_13 one_strongly_connected_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.trans star_1l <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_1_eq"><span class="command">lemma</span></span> one_strongly_connected_iff_1_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_invol mult_double_iso plus_conv star_slide_var top_greatest
          top_plus many_strongly_connected_implies_10_eq one_strongly_connected_iff eq_iff
          one_strongly_connected_iff_1<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_2"><span class="command">lemma</span></span> one_strongly_connected_iff_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol eq_refl less_eq_def one_strongly_connected_iff<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_3"><span class="command">lemma</span></span> one_strongly_connected_iff_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_invol conv_iso conv_one star_conv
          one_strongly_connected_iff_1<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_3_eq"><span class="command">lemma</span></span> one_strongly_connected_iff_3_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol one_strongly_connected_iff_1_eq one_strongly_connected_iff_2<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_4_eq"><span class="command">lemma</span></span> one_strongly_connected_iff_4_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc top_plus many_strongly_connected_iff_7 one_strongly_connected_iff
              one_strongly_connected_iff_1_eq<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_invol conv_one plus_conv top_plus
          one_strongly_connected_iff_1_eq<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_5_eq"><span class="command">lemma</span></span> one_strongly_connected_iff_5_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> comp_assoc conv_contrav conv_invol conv_one plus_conv top_plus many_strongly_connected_iff_7
      one_strongly_connected_iff one_strongly_connected_iff_3_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_6_aux"><span class="command">lemma</span></span> one_strongly_connected_iff_6_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc maddux_21 mult_isol top_plus<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_implies_6_eq"><span class="command">lemma</span></span> one_strongly_connected_implies_6_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc many_strongly_connected_iff_7 many_strongly_connected_implies_10_eq
          one_strongly_connected_iff one_strongly_connected_iff_3_eq<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_7_aux"><span class="command">lemma</span></span> one_strongly_connected_iff_7_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_infI maddux_20 maddux_21 plus_top top_plus vector_meet_comp_x'<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_implies_7_eq"><span class="command">lemma</span></span> one_strongly_connected_implies_7_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_7 one_strongly_connected_iff one_strongly_connected_iff_3_eq
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Paths-one_strongly_connected_implies_8"><span class="command">lemma</span></span> one_strongly_connected_implies_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms one_strongly_connected_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_4"><span class="command">lemma</span></span> one_strongly_connected_iff_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_strongly_connected_iff_4_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor star_slide_var comp_assoc conv_invol modular_var_3 vector_meet_comp_x
              order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_assoc is_inj_def mult_isol mult_oner <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.trans star_1l <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_5"><span class="command">lemma</span></span> one_strongly_connected_iff_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> one_strongly_connected_iff_5_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc mult_double_iso order.trans star_slide_var top_greatest top_plus
          many_strongly_connected_iff_12 many_strongly_connected_iff_7 one_strongly_connected_iff_3<span class="main">)</span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_6"><span class="command">lemma</span></span> one_strongly_connected_iff_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_strongly_connected_implies_6_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol mult_isor x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc mult_double_iso top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc is_p_fun_def mult_isor mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> one_strongly_connected_iff_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-one_strongly_connected_iff_6_eq"><span class="command">lemma</span></span> one_strongly_connected_iff_6_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> one_strongly_connected_implies_6_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms one_strongly_connected_iff_6<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Start points and end points›</span></span>

<span class="keyword1" id="Paths-start_end_implies_terminating"><span class="command">lemma</span></span> start_end_implies_terminating<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_end_points <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"terminating <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-start_points_end_points_conv"><span class="command">lemma</span></span> start_points_end_points_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">=</span> end_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-start_point_at_most_one"><span class="command">lemma</span></span> start_point_at_most_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> isvec<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc is_vector_def one_compl vector_1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_one inf.cobounded2 mult_1_right mult_isol one_conv ra_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_def mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_iso mult_1_right star_unfoldl_eq subdistl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide_var add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_def is_inj_def comp_assoc distrib_left join_iso less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_isol mult_isol mult_isor sup.mono top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_compl inf.assoc inf.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> isvec <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vector_meet_comp'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_compl is_inj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-start_point_zero_point"><span class="command">lemma</span></span> start_point_zero_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> is_point <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms start_point_at_most_one comp_assoc is_point_def is_vector_def vector_compl vector_mult
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-start_point_iff1"><span class="command">lemma</span></span> start_point_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_point <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span><span class="main">(</span>no_start_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms start_point_zero_point galois_aux2 is_point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-end_point_at_most_one"><span class="command">lemma</span></span> end_point_at_most_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_path compl_bot_eq conv_invol inj_def_var1 is_point_def top_greatest
          start_point_zero_point<span class="main">)</span>

<span class="keyword1" id="Paths-end_point_zero_point"><span class="command">lemma</span></span> end_point_zero_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> is_point <span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms conv_path start_point_zero_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-end_point_iff1"><span class="command">lemma</span></span> end_point_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_point <span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span><span class="main">(</span>no_end_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms end_point_zero_point galois_aux2 is_point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-predecessor_point'"><span class="command">lemma</span></span> predecessor_point'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">s</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> eq_iff is_vector_def point_def ss423conv top_greatest<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> comp_assoc conv_contrav conv_invol eq_iff inj_compose is_vector_def
                mult_isol path_def point_def ss423conv sur_def_var1 top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-predecessor_point"><span class="command">lemma</span></span> predecessor_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"point<span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> predecessor_point' assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-points_of_path_iff"><span class="command">lemma</span></span> points_of_path_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> aux9 inf.commute sup.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Path concatenation preliminaries›</span></span>

<span class="keyword1" id="Paths-path_concat_aux_1"><span class="command">lemma</span></span> path_concat_aux_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux6_var de_morgan_3 inf.left_commute inf_compl_bot inf_sup_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concat_aux_2"><span class="command">lemma</span></span> path_concat_aux_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf.assoc inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_invol inf.commute path_concat_aux_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concat_aux3_1"><span class="command">lemma</span></span> path_concat_aux3_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_invol mult_isol x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol mult_isor mult_assoc top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_def comp_assoc mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide_var star_star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms path_def is_inj_def join_iso mult_isol mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concat_aux3_2"><span class="command">lemma</span></span> path_concat_aux3_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_invol mult_isor x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol mult_isor mult_assoc top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc distrib_left star_star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms path_def is_p_fun_def join_iso mult_isor mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concat_aux3_3"><span class="command">lemma</span></span> path_concat_aux3_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_invol mult_isor x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol mult_isor mult_assoc top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_concat_aux3_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc distrib_left star_star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms path_def is_p_fun_def join_iso mult_isor mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concat_aux_3"><span class="command">lemma</span></span> path_concat_aux_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isol_var mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc mult_double_iso top_greatest join_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc mult_double_iso top_greatest join_iso join_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc mult_double_iso top_greatest join_iso join_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc mult_double_iso top_greatest join_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def path_concat_aux3_1 path_concat_aux3_2 path_concat_aux3_3 join_iso join_isol
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concat_aux_4"><span class="command">lemma</span></span> path_concat_aux_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_star_plus add_comm join_isol mult_isol top_greatest<span class="main">)</span>

<span class="keyword1" id="Paths-path_concat_aux_5"><span class="command">lemma</span></span> path_concat_aux_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> start_points <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_def path_concat_aux_4 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.trans path_concat_aux3_1 path_concat_aux_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol_var mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc inf_top_right is_vector_def one_idem_mult vector_1 vector_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc inf_top_right is_vector_def one_idem_mult vector_1 vector_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vector_meet_comp_x vector_meet_comp_x' diff_eq inf.assoc inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> aux1 aux2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_eq join_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_conditions_disjoint_points_iff"><span class="command">lemma</span></span> path_conditions_disjoint_points_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> start_points <span class="free">x</span> <span class="main">⋅</span> end_points <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">1</span> <span class="main">+</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.left_commute inf_bot_right inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">⋅</span> end_points <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_inf_bot inf.assoc inf.commute inf.left_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> start_points <span class="free">x</span> <span class="main">⋅</span> end_points <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> start_points <span class="free">x</span> <span class="main">⋅</span> end_points <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">⋅</span> end_points <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_bot_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_iso meet_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> start_points <span class="free">x</span> <span class="main">⋅</span> end_points <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_bot_left inf.commute inf.left_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* end relation_algebra_rtc *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequences with the Tarski rule›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General theorems›</span></span>

<span class="keyword1" id="Paths-reachable_implies_predecessor"><span class="command">lemma</span></span> reachable_implies_predecessor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> independence1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> point_swap star_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> contra assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> independence1 is_point_def point_singleton point_is_point<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-acyclic_imp_one_step_different_points"><span class="command">lemma</span></span> acyclic_imp_one_step_different_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> acyclic_reachable_points assms point_is_point point_not_equal<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Start points and end points›</span></span>

<span class="keyword1" id="Paths-start_point_iff2"><span class="command">lemma</span></span> start_point_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_point <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> has_start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_iso conv_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> conv_contrav conv_one inf.commute is_vector_def one_idem_mult ra_2 vector_1
              vector_meet_comp_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tarski comp_assoc one_compl ra_1 ss_p18<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> is_point <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_point_def start_point_zero_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-end_point_iff2"><span class="command">lemma</span></span> end_point_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_point <span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> has_end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol conv_has_start_points conv_path start_point_iff2<span class="main">)</span>

<span class="keyword1" id="Paths-edge_is_path"><span class="command">lemma</span></span> edge_is_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> path_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc is_point_def le_supI1 star_ext vector_rectangle point_equations<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_p_fun_def assms comp_assoc conv_contrav conv_invol is_inj_def is_point_def
                vector_2_var vector_meet_comp_x' point_equations<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_inj_def assms conv_invol conv_times is_point_def p_fun_mult_var vector_meet_comp<span class="main">)</span>

<span class="keyword1" id="Paths-edge_start"><span class="command">lemma</span></span> edge_start<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> point_not_equal inf.absorb1<span class="main">)</span>

<span class="keyword1" id="Paths-edge_end"><span class="command">lemma</span></span> edge_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms edge_start <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-loop_no_start"><span class="command">lemma</span></span> loop_no_start<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-loop_no_end"><span class="command">lemma</span></span> loop_no_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">p</span><span class="main">;</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Paths-start_point_no_predecessor"><span class="command">lemma</span></span> start_point_no_predecessor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span>start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top.right_neutral modular_1_aux'<span class="main">)</span>

<span class="keyword1" id="Paths-end_point_no_successor"><span class="command">lemma</span></span> end_point_no_successor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol start_point_no_predecessor<span class="main">)</span>

<span class="keyword1" id="Paths-start_to_end"><span class="command">lemma</span></span> start_to_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_res_aux compl_bot_eq inf.left_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> end_point_at_most_one assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_inj_def comp_assoc mult_isol mult_oner le_supI1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc is_vector_def one_compl vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz tarski <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc is_vector_def one_compl vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> a assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_concat_aux_5 comp_assoc eq_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_acyclic"><span class="command">lemma</span></span> path_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_points_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> pt<span class="main">:</span> <span class="quoted"><span class="quoted">"point<span class="main">(</span><span class="var">?r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms point_is_point start_point_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_times inf.assoc inf.left_idem inf_le2 many_strongly_connected_iff_7
              mult_oner star_subid<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav inf.commute maddux_20 meet_double_iso plus_top star_conv star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span><span class="main">⋅</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_assoc conv_contrav conv_invol conv_one inf.assoc
              is_vector_def one_idem_mult vector_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc inf_top.right_neutral is_vector_def one_compl one_idem_mult vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mult_isor
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> connected_iff4 dual_order.trans mult_subdistr path_concat_aux3_3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right star_star_plus sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_isol mult_isol plus_top top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right inf_absorb2 mult_assoc mult_subdistr one_idem_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def inj_implies_step_forwards_backwards sup_absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maddux_20<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="var">?r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pt comp_assoc point_def ss423conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> start_point_no_predecessor annil conv_contrav conv_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> galois_aux le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equivalences for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>terminating›</span></span></span></span>›</span></span>

<span class="keyword1" id="Paths-backward_terminating_iff1"><span class="command">lemma</span></span> backward_terminating_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span> <span class="main">⟷</span> has_start_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor mult_isol comp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_compl conv_contrav conv_invol conv_one mult_assoc one_compl one_idem_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">with</span></span> tarski <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> top_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> backward_terminating <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-backward_terminating_iff2_aux"><span class="command">lemma</span></span> backward_terminating_iff2_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol modular_var_3 vector_meet_comp_x vector_meet_comp_x'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_def mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_star_plus star_slide_var add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_def is_inj_def join_iso mult_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right star_slide_var star_star_plus sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_iso mult_isor star_slide_var top_greatest add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-backward_terminating_iff2"><span class="command">lemma</span></span> backward_terminating_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backward_terminating_iff1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_one<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute aux1 conv_compl conv_contrav conv_invol conv_one modular_2_var<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_invol conv_one inf.commute inf_top_left
                one_compl ra_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> backward_terminating_iff2_aux inf.commute inf.assoc mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_compl conv_compl conv_contrav conv_invol conv_one inf_top_left ra_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> conv_compl conv_invol conv_times modular_1_var star_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_isol_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_isol star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-backward_terminating_iff3_aux"><span class="command">lemma</span></span> backward_terminating_iff3_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol modular_var_3 vector_meet_comp_x vector_meet_comp_x'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isor path_concat_aux3_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_star_plus star_slide_var add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_def is_inj_def join_iso mult_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right star_slide_var star_star_plus sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_iso mult_isor star_slide_var top_greatest add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-backward_terminating_iff3"><span class="command">lemma</span></span> backward_terminating_iff3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backward_terminating_iff1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_one<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute aux1 conv_compl conv_contrav conv_invol conv_one modular_2_var<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_invol conv_one inf.commute inf_top_left one_compl ra_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> backward_terminating_iff3_aux inf.commute inf.assoc mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_aux2 inf.commute maddux_21<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_compl conv_contrav conv_iso conv_one inf.absorb2 star_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1'</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left star_unfoldl_eq sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_isol star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-backward_terminating_iff4"><span class="command">lemma</span></span> backward_terminating_iff4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> backward_terminating_iff3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_compl conv_iso star_conv conv_contrav conv_one<span class="main">)</span>

<span class="keyword1" id="Paths-forward_terminating_iff1"><span class="command">lemma</span></span> forward_terminating_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forward_terminating <span class="free">x</span> <span class="main">⟷</span> has_end_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc eq_refl le_bot one_compl tarski top_greatest<span class="main">)</span>

<span class="keyword1" id="Paths-forward_terminating_iff2"><span class="command">lemma</span></span> forward_terminating_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forward_terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms backward_terminating_iff1 backward_terminating_iff2 end_point_iff2
          forward_terminating_iff1 compl_bot_eq conv_compl conv_invol conv_one conv_path
          double_compl start_point_iff2<span class="main">)</span>

<span class="keyword1" id="Paths-forward_terminating_iff3"><span class="command">lemma</span></span> forward_terminating_iff3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forward_terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms backward_terminating_iff1 backward_terminating_iff3 end_point_iff2
          forward_terminating_iff1 compl_bot_eq conv_compl conv_invol conv_one conv_path
          double_compl start_point_iff2<span class="main">)</span>

<span class="keyword1" id="Paths-forward_terminating_iff4"><span class="command">lemma</span></span> forward_terminating_iff4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forward_terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> forward_terminating_iff2 conv_contrav conv_iso star_conv assms conv_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Paths-terminating_iff1"><span class="command">lemma</span></span> terminating_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"terminating <span class="free">x</span> <span class="main">⟷</span> has_start_end_points <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_terminating_iff1 forward_terminating_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-terminating_iff2"><span class="command">lemma</span></span> terminating_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_terminating_iff2 forward_terminating_iff2 conv_compl conv_iso star_conv
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Paths-terminating_iff3"><span class="command">lemma</span></span> terminating_iff3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"terminating <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_terminating_iff4 forward_terminating_iff3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-backward_terminating_path_irreflexive"><span class="command">lemma</span></span> backward_terminating_path_irreflexive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_inj_def path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.bounded_iff inf.commute mult_1_right mult_subdistl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 meet_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_times inf.cobounded1 is_test_def test_eq_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_le_swap1 conv_galois_1 inf.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1 maddux_20<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtc_inductl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compl_le_swap1 galois_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms backward_terminating_iff3 inf.order_iff le_infI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_self_conjugate<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-forward_terminating_path_end_points_1"><span class="command">lemma</span></span> forward_terminating_path_end_points_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_aux maddux_20<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms forward_terminating_iff3 inf.absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1'</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_sup_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> modular_1_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> plus_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inf_top_right modular_1' mult_subdistl plus_conv plus_top<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-forward_terminating_path_end_points_2"><span class="command">lemma</span></span> forward_terminating_path_end_points_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isol top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms forward_terminating_path_end_points_1 comp_assoc mult_isol mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute mult_assoc one_compl ra_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc compl_le_swap1 conv_galois_1 conv_invol p_fun_compl path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-forward_terminating_path_end_points_3"><span class="command">lemma</span></span> forward_terminating_path_end_points_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms forward_terminating_path_end_points_1 comp_assoc mult_isor inf.coboundedI1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>end_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute mult_assoc one_compl ra_1 <span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-backward_terminating_path_start_points_1"><span class="command">lemma</span></span> backward_terminating_path_start_points_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms forward_terminating_path_end_points_1 conv_backward_terminating_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-backward_terminating_path_start_points_2"><span class="command">lemma</span></span> backward_terminating_path_start_points_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span>start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms forward_terminating_path_end_points_2 conv_backward_terminating_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-backward_terminating_path_start_points_3"><span class="command">lemma</span></span> backward_terminating_path_start_points_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms forward_terminating_path_end_points_3 conv_backward_terminating_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="comment1">(* lemma not shown in the paper; not necessary for other theorems *)</span>
<span class="keyword1" id="Paths-path_aux1a"><span class="command">lemma</span></span> path_aux1a<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> end_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms end_point_iff2 forward_terminating_iff1 end_point_iff1 galois_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="comment1">(* lemma not shown in the paper; not necessary for other theorems *)</span>
<span class="keyword1" id="Paths-path_aux1b"><span class="command">lemma</span></span> path_aux1b<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> start_points <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms start_point_iff2 backward_terminating_iff1 start_point_iff1 galois_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="comment1">(* lemma not shown in the paper; not necessary for other theorems *)</span>
<span class="keyword1" id="Paths-path_aux1"><span class="command">lemma</span></span> path_aux1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> end_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> start_points <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms path_aux1a path_aux1b <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equivalences for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>finite›</span></span></span></span>›</span></span>

<span class="keyword1" id="Paths-backward_finite_iff_msc"><span class="command">lemma</span></span> backward_finite_iff_msc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_finite <span class="free">x</span> <span class="main">⟷</span> many_strongly_connected <span class="free">x</span> <span class="main">∨</span> backward_terminating <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_finite <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">∨</span> backward_terminating <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">∨</span> backward_terminating <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol many_strongly_connected_iff_1 sup_bot_right<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc tarski<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_compl conv_contrav conv_invol conv_one one_compl<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">∨</span> backward_terminating <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span> <span class="main">∨</span> backward_terminating <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"backward_finite <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_ext sup.coboundedI1 sup.coboundedI2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-forward_finite_iff_msc"><span class="command">lemma</span></span> forward_finite_iff_msc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"forward_finite <span class="free">x</span> <span class="main">⟷</span> many_strongly_connected <span class="free">x</span> <span class="main">∨</span> forward_terminating <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> backward_finite_iff_msc conv_backward_finite conv_backward_terminating conv_invol<span class="main">)</span>

<span class="keyword1" id="Paths-finite_iff_msc"><span class="command">lemma</span></span> finite_iff_msc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">x</span> <span class="main">⟷</span> many_strongly_connected <span class="free">x</span> <span class="main">∨</span> terminating <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> backward_finite_iff_msc forward_finite_iff_msc finite_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Path concatenation›</span></span>

<span class="keyword1" id="Paths-path_concatenation"><span class="command">lemma</span></span> path_concatenation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> path_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 inf_sup_distrib2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sup_eq_bot_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sup_eq_bot_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_inj_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def is_inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> path_def is_inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> aux1 annir comp_assoc conv_one le_bot modular_var_2 one_idem_mult
                  path_concat_aux_2 schroeder_2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bot_least le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_p_fun_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def is_p_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> path_def is_p_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_prop2 inf.commute inf_top.left_neutral maddux_20 mult_isol order_trans
                  schroeder_1_var<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> aux2 annir inf_commute path_concat_aux_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bot_least le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> join_iso join_isol star_subdist <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest star_subdist sup.mono sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"start_points <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_concat_aux_0<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span>start_points <span class="free">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_vector_def comp_assoc one_compl one_idem_mult ra_1<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> as
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_compl conv_contrav conv_one inf.orderE inf_bot_right
                      inf_top.right_neutral maddux_141<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>start_points <span class="free">y</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path_concat_aux_5<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span>start_points <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_iso comp_assoc conv_contrav conv_invol conv_one
                      star_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> path_concat_aux_5<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">y</span><span class="main">;</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc le_supI2 less_eq_def one_idem_mult star_denest star_subdist_var_1
                    sup.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"start_points <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_concat_aux_0<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span>start_points <span class="free">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc is_vector_def one_compl vector_1_comm<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> as assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> backward_terminating_iff1 galois_aux2 start_point_iff1 start_point_iff2
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> path_concat_aux_5<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> conv_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>end_points <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span>start_points <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_assoc star_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path_concat_aux_5<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">y</span><span class="main">;</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc dual_order.trans le_supI1 one_idem_mult star_ext<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concatenation_with_edge"><span class="command">lemma</span></span> path_concatenation_with_edge<span class="main">:</span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> path_concatenation<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point<span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> end_point_zero_point path_aux1a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="main">(</span><span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> edge_is_path 1 assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span> 1 bot_least comp_assoc compl_le_swap1 conv_galois_2 double_compl
              end_point_iff1 le_supE point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tarski top_le<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="main">(</span><span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 1 edge_start comp_assoc compl_top_eq double_compl inf.absorb_iff2 inf.commute
              inf_top_right modular_2_aux' point_equations<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> annir compl_le_swap1 compl_top_eq conv_galois_2 double_compl
                      inf.absorb_iff2 inf.commute modular_1' modular_2_aux' point_equations<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concatenation_cycle_free"><span class="command">lemma</span></span> path_concatenation_cycle_free<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> path_concatenation<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inf.left_commute inf_bot_right inf_commute<span class="main">)</span>

<span class="keyword1" id="Paths-path_concatenation_start_points_approx"><span class="command">lemma</span></span> path_concatenation_start_points_approx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> start_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concatenation_end_points_approx"><span class="command">lemma</span></span> path_concatenation_end_points_approx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
     <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> end_points <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> end_points <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_le1 meet_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concatenation_start_points"><span class="command">lemma</span></span> path_concatenation_start_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_aux inf.absorb1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.assoc inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concatenation_end_points"><span class="command">lemma</span></span> path_concatenation_end_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> end_points <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> galois_aux inf.absorb1 inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_concatenation_cycle_free_complete"><span class="command">lemma</span></span> path_concatenation_cycle_free_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">∧</span> start_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> start_points <span class="free">x</span> <span class="main">∧</span> end_points <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> end_points <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms path_concatenation_cycle_free path_concatenation_end_points path_concatenation_start_points
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Path restriction (path from a given point)›</span></span>

<span class="keyword1" id="Paths-reachable_points_iff"><span class="command">lemma</span></span> reachable_points_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_infI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">;</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol_var<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc eq_iff point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_is_point<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 mult_isor mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">+</span> <span class="main">-</span><span class="main">1'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc is_vector_def mult_isol point_def sup.coboundedI1 top_greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> compl_mono conv_galois_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 distrib_right inf_commute mult_1_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> join_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> galois_2 inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_from_given_point"><span class="command">lemma</span></span> path_from_given_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> path_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> uni<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_commute is_p_fun_def p_fun_mult_var path_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abel_semigroup.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_times inf.abel_semigroup_axioms inj_p_fun
              is_p_fun_def p_fun_mult_var path_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
    <span class="comment1">(* some aux statements about ?t and ?u *)</span>
    <span class="keyword1"><span class="command">have</span></span> t_plus_u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">+</span> <span class="var">?u</span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> t_times_u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">;</span> <span class="var">?u</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.left_commute is_test_def test_comp_eq_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> t_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">=</span><span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf.cobounded2 is_test_def test_eq_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> txu_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="var">?u</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="var">?t</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="var">?t</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult.semigroup_axioms mult_isol_var mult_subdistr order.refl
                        point_def semigroup.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?u</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI1 mult_isor<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_bot_eq compl_le_swap1 conv_contrav conv_galois_1 t_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> txux_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="var">?u</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> annil le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="comment1">(* end some aux statements about ?t and ?u *)</span>

    <span class="keyword1"><span class="command">have</span></span> tx_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="var">?t</span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="var">?u</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> t_plus_u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right' mult_onel<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?t</span><span class="main">;</span><span class="main">(</span><span class="var">?u</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="var">?u</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">+</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> txux_zero star_denest_10 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc le_bot<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?t</span><span class="main">;</span><span class="var">?u</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="var">?u</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">+</span><span class="var">?t</span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="var">?u</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">+</span><span class="var">?t</span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> le_bot t_times_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil inf.commute inf_bot_right le_supI mult_onel mult_subdistr<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">hence</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="var">?t</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf.cobounded2 order.trans prod_star_closure star_ref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> t_conv <span class="keyword1"><span class="command">have</span></span> aux_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="var">?t</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_self_conjugate_var g_iso star_conv<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> aux aux_trans <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">+</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="var">?t</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_mono distrib_right' distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_concat_aux3_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="var">?t</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dual_order.trans mult_double_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> t_conv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?t</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_assoc conv_contrav <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> connected_iff2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inj reachable_points_iff uni <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult_assoc point_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute vector_1_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">+</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> galois_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 vector_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult_assoc point_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 vector_2 inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_assoc mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> galois_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 vector_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_sup_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> meet_iso mult_subdistr_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_from_given_point'"><span class="command">lemma</span></span> path_from_given_point'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_points_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span> <span class="comment1">(* p has a successor hence path not empty *)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms path_from_given_point<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms path_from_given_point<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> start_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> comp_assoc is_vector_def point_equations<span class="main">(</span>1<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vector_1 assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conway.dagger_unfoldl_distr inf.orderI inf_greatest
                  inf_sup_absorb<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inj_distr point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="main">1'</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_acyclic
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_e meet_iso mult_isor star_conv star_slide_var test_converse<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 vector_2 inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 galois_aux le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> compl_le_swap1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms path_from_given_point<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> end_points<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> comp_assoc is_vector_def point_equations<span class="main">(</span>1<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span>end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc is_vector_def one_compl vector_1_comm<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_meet_comp_x'<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_concat_aux3_3 sup.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_star_plus sup.commute<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> join_isol mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_1 inf.assoc inf.commute sup_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_iso conv_one dual_order.trans inf.cobounded1 inf.right_idem
                    inf_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">;</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_def vector_meet_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">+</span> <span class="free">p</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conway.dagger_unfoldl_distr sup_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> sup.absorb2 sup.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 inf_commute mult_assoc vector_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI2 mult_isor<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> galois_1 galois_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cycles›</span></span>

<span class="keyword1" id="Paths-selfloop_is_cycle"><span class="command">lemma</span></span> selfloop_is_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_point <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cycle <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms edge_is_path<span class="main">)</span>

<span class="keyword1" id="Paths-start_point_no_cycle"><span class="command">lemma</span></span> start_point_no_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_points_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cycle <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_implies_no_start_end_points no_start_end_points_iff
      start_point_iff1 start_point_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-end_point_no_cycle"><span class="command">lemma</span></span> end_point_no_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_end_points_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cycle <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms end_point_iff2 end_point_iff1 many_strongly_connected_implies_no_start_end_points
      no_start_end_points_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-cycle_no_points"><span class="command">lemma</span></span> cycle_no_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf_compl_bot many_strongly_connected_implies_no_start_end_points<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Path concatenation to cycle›</span></span>

<span class="keyword1" id="Paths-path_path_equals_cycle_aux"><span class="command">lemma</span></span> path_path_equals_cycle_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">=</span> end_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"start_points<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sp<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point<span class="main">(</span><span class="var">?s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> start_point_iff2 has_start_end_points_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ep<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point<span class="main">(</span><span class="var">?e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> end_point_iff2 has_start_end_points_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="var">?s</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> backward_terminating_path_start_points_2 end_point_iff2 ep
                forward_terminating_iff1 forward_terminating_path_end_points_2 comp_assoc
                conv_contrav conv_invol conv_iso inf.boundedI point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_equations<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span>
                star_conv sp start_point_iff2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="var">?s</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inf_top_right ra_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="var">?s</span><span class="main">;</span><span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ep comp_assoc point_equations<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span> start_to_end comp_assoc conv_contrav conv_invol
                conv_iso mult_double_iso star_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc star_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_iso prod_star_closure star_conv star_denest star_ext star_iso
                star_trans_eq sup_ge1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_conv star_trans_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_path_equals_cycle"><span class="command">lemma</span></span> path_path_equals_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">=</span> end_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span> <span class="main">=</span> start_points <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cycle<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> path_concatenation<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_start_end_points_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_path_equals_cycle_aux assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> sup.commute le_supI many_strongly_connected_iff_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_edge_equals_cycle"><span class="command">lemma</span></span> path_edge_equals_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cycle<span class="main">(</span><span class="free">x</span> <span class="main">+</span> end_points<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> path_path_equals_cycle<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"end_points <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?e</span><span class="main">;</span><span class="var">?s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> sp<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point<span class="main">(</span><span class="var">?s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> start_point_iff2 assms has_start_end_points_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ep<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point<span class="main">(</span><span class="var">?e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> end_point_iff2 assms has_start_end_points_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_start_end_points_path <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> edge_is_path
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms edge_end edge_start end_point_iff2 end_point_iff1 galois_aux2
              has_start_end_points_iff inf.left_idem inf_compl_bot_right start_point_iff2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> end_points <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sp ep edge_end annil conv_zero inf.left_idem inf_compl_bot_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> start_points <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> edge_start ep conv_contrav conv_invol sp<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="var">?e</span><span class="main">;</span><span class="var">?s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="var">?e</span><span class="main">;</span><span class="var">?s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="var">?e</span><span class="main">;</span><span class="var">?s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="var">?e</span><span class="main">;</span><span class="var">?s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="var">?e</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="var">?s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="var">?s</span><span class="main">;</span><span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sp comp_assoc point_equations<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="var">?e</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="var">?s</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sp ep comp_assoc point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sp ep inf.assoc point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Break cycles›</span></span>

<span class="keyword1" id="Paths-cycle_remove_edge"><span class="command">lemma</span></span> cycle_remove_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> path_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def is_p_fun_def p_fun_mult_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_inj<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_def inf.cobounded1 injective_down_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> aux4_comm inf.absorb2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="main">(</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc star_slide<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> top_greatest join_isol mult_double_iso <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc is_vector_def point_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> comp_assoc mult_isol point_def ss423conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> many_strongly_connected_iff_3 mult_isol star_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 conv_iso mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">s</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_conv comp_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">s</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc join_isol mult_isol mult_isor top_greatest<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_is_point<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">e</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> is_inj_def point_def join_iso mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol_var<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> connected_iff4 one_strongly_connected_iff one_strongly_connected_implies_8
              path_concat_aux3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc join_isol mult_isol mult_isor<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 triple_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_def vector_compl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> meet_iso mult_subdistr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> many_strongly_connected_implies_no_start_end_points meet_iso
            no_start_end_points_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_1_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">s</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 galois_aux inf.boundedI inf.cobounded1 inf.commute mult_isor schroeder_2
                vector_1_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_compl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_def vector_compl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> meet_iso mult_subdistr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> many_strongly_connected_implies_no_start_end_points meet_iso
            no_start_end_points_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_1_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 galois_aux inf.boundedI inf.cobounded1 inf.commute mult_isor schroeder_2
                vector_1_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-cycle_remove_edge'"><span class="command">lemma</span></span> cycle_remove_edge'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">≠</span><span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> start_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> end_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> cycle_remove_edge<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> start_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> start_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> point_def vector_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> comp_assoc edge_end point_equations<span class="main">(</span>1<span class="main">)</span> point_equations<span class="main">(</span>3<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> conv_iso meet_iso point_def ss423conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> many_strongly_connected_implies_no_start_end_points meet_iso mult_isol
                    top_greatest<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">e</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_1_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_anti is_vector_def meet_isor mult_isol mult_isor point_def
                    top_greatest<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">s</span> <span class="main">=</span><span class="free">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms predecessor_point' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">s</span><span class="main">;</span><span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">+</span><span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_equations<span class="main">(</span>1<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span><span class="main">;</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 conv_contrav inf.commute inf_sup_absorb modular_1'<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.coboundedI1 mult_isor point_equations<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> point_is_point
                    top_greatest<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">s</span> <span class="main">⋅</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">;</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_def vector_meet_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">s</span> <span class="main">;</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> galois_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">;</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> inf_commute point_def vector_meet_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 2
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> conv_compl conv_invol conv_one conv_times galois_aux
                      inf.assoc point_def point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_is_point schroeder_2
                      vector_meet_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> cycle_remove_edge<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> end_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> end_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="comment1">(* just copied and adapted the proof of the previous case (start_point) *)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector<span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_def vector_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">e</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> comp_assoc edge_end point_equations<span class="main">(</span>1<span class="main">)</span> point_equations<span class="main">(</span>3<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">s</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span> meet_iso point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> many_strongly_connected_implies_no_start_end_points meet_iso mult_isol
                    top_greatest<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_1_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span> <span class="main">;</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_anti is_vector_def meet_isor mult_isol mult_isor point_def
                    top_greatest<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_compl<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">=</span><span class="free">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms predecessor_point' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_invol conv_iso conv_path<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">e</span><span class="main">;</span><span class="main">(</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">+</span><span class="main">-</span><span class="main">(</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> point_equations<span class="main">(</span>1<span class="main">)</span> point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">e</span><span class="main">;</span><span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 conv_contrav conv_invol inf.commute inf_sup_absorb modular_1'<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf.coboundedI1 mult_isor point_equations<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> point_is_point top_greatest<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">⋅</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_def vector_meet_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> galois_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">e</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> inf_commute point_def vector_meet_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 2
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> conv_one galois_aux inf.assoc point_def point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                      point_is_point schroeder_2 vector_meet_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">;</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> cycle_remove_edge<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context relation_algebra_rtc_tarski *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Rooted_Paths">
<div class="head">
<h1>Theory Rooted_Paths</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relational Characterisation of Rooted Paths
   Author:     Walter Guttmann, Peter Hoefner
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
               Peter Hoefner &lt;peter at hoefner-online.de&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relational Characterisation of Rooted Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We characterise paths together with a designated root.
This is important as often algorithms start with a single vertex, and then build up a path, a tree or another structure.
An example is Dijkstra's shortest path algorithm.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rooted_Paths

<span class="keyword2"><span class="keyword">imports</span></span> <a href="Paths.html">Paths</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General theorems›</span></span>

<span class="keyword1" id="Rooted_Paths-step_has_target"><span class="command">lemma</span></span> step_has_target<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms inf.commute inf_bot_right schroeder_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-end_point_char"><span class="command">lemma</span></span> end_point_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> antisym bot_least compl_bot_eq conv_galois_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_tarski
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General theorems concerning points›</span></span>

<span class="keyword1" id="Rooted_Paths-successor_point"><span class="command">lemma</span></span> successor_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"point <span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_compose is_point_def is_vector_def mult_assoc point_is_point<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-no_end_point_char"><span class="command">lemma</span></span> no_end_point_char<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_assoc end_point_char is_vector_def point_in_vector_or_complement_iff<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-no_end_point_char_converse"><span class="command">lemma</span></span> no_end_point_char_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms no_end_point_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_tarski *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequences without the Tarski rule›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definitions for path classifications›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">path_root</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_root</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_p_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">connected_root</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">connected_root</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">backward_finite_path_root</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">backward_finite_path_root</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> connected_root <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_p_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">backward_terminating_path_root</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">backward_terminating_path_root</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> backward_finite_path_root <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cycle_root</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cycle_root</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_p_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">non_empty_cycle_root</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">non_empty_cycle_root</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> backward_finite_path_root <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">finite_path_root_end</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finite_path_root_end</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> backward_finite_path_root <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">terminating_path_root_end</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">terminating_path_root_end</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> finite_path_root_end <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equivalent formulations of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>connected_root›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rooted_Paths-connected_root_iff1"><span class="command">lemma</span></span> connected_root_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc is_vector_def point_def ss423conv<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-connected_root_iff2"><span class="command">lemma</span></span> connected_root_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_invol conv_iso conv_one star_conv star_slide_var
          connected_root_iff1<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-connected_root_aux"><span class="command">lemma</span></span> connected_root_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-connected_root_iff3"><span class="command">lemma</span></span> connected_root_iff3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms antisym connected_root_aux connected_root_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-connected_root_iff4"><span class="command">lemma</span></span> connected_root_iff4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_invol conv_one star_conv star_slide_var connected_root_iff3<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Consequences of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>connected_root›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rooted_Paths-has_root_contra"><span class="command">lemma</span></span> has_root_contra<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms comp_assoc independence1 conv_zero ss_p18 connected_root_iff3
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rooted_Paths-has_root"><span class="command">lemma</span></span> has_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> has_root_contra assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-connected_root_move_root"><span class="command">lemma</span></span> connected_root_move_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc mult_isol phl_cons1 star_slide_var star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-root_cycle_converse"><span class="command">lemma</span></span> root_cycle_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms conv_zero has_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rooted paths›</span></span>

<span class="keyword1" id="Rooted_Paths-path_iff_aux_1"><span class="command">lemma</span></span> path_iff_aux_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms ss423conv<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-path_iff_aux_2"><span class="command">lemma</span></span> path_iff_aux_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">r</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add conv_contrav conv_invol star_conv sup.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol conv_iso path_iff_aux_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-path_iff_backward"><span class="command">lemma</span></span> path_iff_backward<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> path_iff_aux_2 mult_isor point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_assoc inj_p_fun p_fun_triple <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_double_iso top_greatest point_def is_vector_def comp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> comp_assoc mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_supI2 mult_isol star_ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> cancel_separate_converse_idempotent <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add conv_contrav conv_invol conv_one mult_assoc star_conv sup.orderE sup.orderI
              sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-empty_path_root_end"><span class="command">lemma</span></span> empty_path_root_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> assms has_root backward_finite_path_root_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms antisym conv_e conv_zero independence1 is_inj_def mult_oner point_swap
          backward_finite_path_root_def ss423conv sur_def_var1 x_leq_triple_x<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-path_root_acyclic"><span class="command">lemma</span></span> path_root_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_times inf.assoc inf.left_idem inf_le2 many_strongly_connected_iff_7 mult_oner star_subid<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav inf.commute maddux_20 meet_double_iso plus_top star_conv star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">⋅</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_assoc conv_contrav conv_invol conv_one inf.assoc is_vector_def one_idem_mult vector_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> path_root_def point_def inf_top_right vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mult_isor path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right star_star_plus sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_isol mult_isol plus_top top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right inf_absorb2 mult_assoc mult_subdistr one_idem_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inj_implies_step_forwards_backwards sup_absorb2 path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maddux_20<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">⋅</span><span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc order.refl point_def ss423conv path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> annil conv_contrav conv_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> galois_aux le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Start points and end points›</span></span>

<span class="keyword1" id="Rooted_Paths-start_points_in_root_aux"><span class="command">lemma</span></span> start_points_in_root_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf_top.left_neutral modular_var_2 mult_assoc connected_root_iff3
              backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_inj_def mult_assoc mult_isor backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-start_points_in_root"><span class="command">lemma</span></span> start_points_in_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms galois_1 sup_commute connected_root_iff3 backward_finite_path_root_def
      start_points_in_root_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-start_points_not_zero_contra"><span class="command">lemma</span></span> start_points_not_zero_contra<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> galois_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> comp_res compl_bot_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> has_root_contra galois_aux schroeder_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-start_points_not_zero"><span class="command">lemma</span></span> start_points_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms start_points_not_zero_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Backwards terminating and backwards finite›</span></span>

<span class="keyword1" id="Rooted_Paths-backward_terminating_path_root_aux"><span class="command">lemma</span></span> backward_terminating_path_root_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_res compl_bot_eq compl_le_swap1 mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dual_order.trans maddux_20 start_points_in_root_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_connected_aux"><span class="command">lemma</span></span> backward_finite_path_connected_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_times vector_1_comm comp_assoc conv_contrav assms
              backward_finite_path_root_def point_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc is_inj_def mult_1_right mult_isol point_def
              backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms galois_1 start_points_in_root_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="var">?v</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> meet_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_one inf_commute is_vector_def point_def
              backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc inf_commute is_vector_def star_conv vector_1 assms
                      backward_finite_path_root_def point_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_isol mult_isor star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms backward_finite_path_root_def is_p_fun_def mult_1_right mult_assoc mult_isol_var
              star_1l star_inductl_star<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_iso star_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute is_vector_def comp_assoc vector_1 assms backward_finite_path_root_def
              point_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_compl inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_connected"><span class="command">lemma</span></span> backward_finite_path_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="skolem">r</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation distrib_left star_star_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_iso comp_assoc is_p_fun_def mult_isor backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="skolem">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 backward_finite_path_connected_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="skolem">r</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_inductl comp_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 backward_finite_path_root_def connected_root_iff3 star_slide_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup.commute comp_assoc conv_add conv_contrav conv_invol conv_iso
              conv_one star_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_path"><span class="command">lemma</span></span> backward_finite_path_root_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms path_def backward_finite_path_connected backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_path_root"><span class="command">lemma</span></span> backward_finite_path_root_path_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_finite_path_root_def le_supI1 star_star_plus path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-zero_backward_terminating_path_root"><span class="command">lemma</span></span> zero_backward_terminating_path_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms is_inj_def is_p_fun_def backward_finite_path_root_def<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_move_root"><span class="command">lemma</span></span> backward_finite_path_root_move_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms connected_root_move_root backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cycle›</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_var_axioms_1"><span class="command">lemma</span></span> non_empty_cycle_root_var_axioms_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">∧</span> is_inj <span class="free">x</span> <span class="main">∧</span> is_p_fun <span class="free">x</span> <span class="main">∧</span> point <span class="free">r</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> connected_root_iff2 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_loop"><span class="command">lemma</span></span> non_empty_cycle_root_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms connected_root_iff3 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-cycle_root_end_empty"><span class="command">lemma</span></span> cycle_root_end_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms has_root_contra point_swap backward_finite_path_root_def
          backward_finite_path_root_move_root star_conv<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-cycle_root_end_empty_var"><span class="command">lemma</span></span> cycle_root_end_empty_var<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> many_strongly_connected <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms cycle_root_end_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Terminating path›</span></span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_connected"><span class="command">lemma</span></span> terminating_path_root_end_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc inf_top.left_neutral modular_var_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms backward_finite_path_root_def connected_root_iff3 comp_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms cancel_separate_p_fun_converse comp_assoc backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span> <span class="main">+</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_assoc independence1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms annil independence1 is_inj_def mult_isor mult_oner backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_forward_finite"><span class="command">lemma</span></span> terminating_path_root_end_forward_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">e</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms terminating_path_root_end_connected inj_p_fun connected_root_iff2
      backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequences with the Tarski rule›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some (more) results about points›</span></span>

<span class="keyword1" id="Rooted_Paths-point_reachable_converse"><span class="command">lemma</span></span> point_reachable_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf.idem inf_bot_right mult_1_right schroeder_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_vector_def mult_assoc tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">r</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_vector_def mult_assoc point_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_invol conv_iso star_conv star_slide_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Roots›</span></span>

<span class="keyword1" id="Rooted_Paths-root_in_start_points"><span class="command">lemma</span></span> root_in_start_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> comp_assoc is_vector_def tarski<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc one_idem_mult phl_seq top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> comp_res compl_bot_eq compl_le_swap1 inf.boundedI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-root_equals_start_points"><span class="command">lemma</span></span> root_equals_start_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms antisym point_def backward_finite_path_root_def start_points_in_root root_in_start_points
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-root_equals_end_points"><span class="command">lemma</span></span> root_equals_end_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> end_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol step_has_target ss_p18 root_equals_start_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-root_in_edge_sources"><span class="command">lemma</span></span> root_in_edge_sources<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> is_vector_def mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_assoc conway.dagger_unfoldl_distr dual_order.trans maddux_20 sup.commute
              sup_absorb2 tarski top_greatest<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rooted Paths›</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_path_root_iff_aux"><span class="command">lemma</span></span> non_empty_path_root_iff_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_e conv_times inf.cobounded2 is_test_def test_eq_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_subdistr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_double_iso one_idem_mult top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> comp_assoc maddux_20 tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_root_def point_def is_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb_iff1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="main">1'</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_star_plus star_unfoldl_eq sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 inf_sup_distrib1 mult_isor order_refl sup_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">r</span><span class="main">;</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 sup.coboundedI2 sup.order_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Backwards terminating and backwards finite›</span></span>

<span class="keyword1" id="Rooted_Paths-backward_terminating_path_root_2"><span class="command">lemma</span></span> backward_terminating_path_root_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_terminating_iff2 path_def backward_terminating_path_root_aux
      backward_finite_path_connected backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-backward_terminating_path_root"><span class="command">lemma</span></span> backward_terminating_path_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_finite_path_root_path backward_terminating_path_root_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹(Non-empty) Cycle›</span></span>

<span class="keyword1" id="Rooted_Paths-cycle_iff"><span class="command">lemma</span></span> cycle_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms no_end_point_char_converse<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_iff"><span class="command">lemma</span></span> non_empty_cycle_root_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms connected_root_iff3 cycle_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_terminating_or_cycle"><span class="command">lemma</span></span> backward_finite_path_root_terminating_or_cycle<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> backward_terminating_path_root <span class="free">r</span> <span class="free">x</span> <span class="main">∨</span> non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> cycle_iff backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_msc"><span class="command">lemma</span></span> non_empty_cycle_root_msc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_point_def
    <span class="keyword1"><span class="command">using</span></span> conjI assms is_vector_def mult_assoc point_def inj_compose p_fun_inj
      cycle_iff backward_finite_path_root_def root_cycle_converse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc mult_isol star_slide_var non_empty_cycle_root_loop<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 bot_least point_def point_is_point point_reachable_converse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">1'</span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_inj_def mult_double_iso backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conway.dagger_unfoldl_distr distrib_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">+</span> <span class="main">1'</span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_p_fun_def join_isol mult_assoc mult_isor backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_inductl comp_assoc conway.dagger_unfoldl_distr le_supI order_prop<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms maddux_20 connected_root_iff3 backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conway.dagger_unfoldl_distr sup_absorb2 non_empty_cycle_root_loop<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol x_leq_triple_x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms connected_root_iff4 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_inj_def mult_1_right mult_assoc mult_isol backward_finite_path_root_def
              star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_one is_vector_def point_def backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms is_vector_def mult_assoc point_def
              backward_finite_path_root_def vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span><span class="main">;</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_inj_def mult_1_right mult_assoc mult_isol mult_isor point_def
              backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> many_strongly_connected_iff_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_msc_cycle"><span class="command">lemma</span></span> non_empty_cycle_root_msc_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms backward_finite_path_root_path non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_non_empty"><span class="command">lemma</span></span> non_empty_cycle_root_non_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms cycle_iff annil backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_rtc_symmetric"><span class="command">lemma</span></span> non_empty_cycle_root_rtc_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_point_exchange"><span class="command">lemma</span></span> non_empty_cycle_root_point_exchange<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> inj_sur_semi_swap point_def non_empty_cycle_root_msc
          backward_finite_path_root_def star_conv<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_rtc_tc"><span class="command">lemma</span></span> non_empty_cycle_root_rtc_tc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_7 non_empty_cycle_root_loop non_empty_cycle_root_msc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_no_start_end_points"><span class="command">lemma</span></span> non_empty_cycle_root_no_start_end_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_implies_no_start_end_points non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root"><span class="command">lemma</span></span> non_empty_cycle_root_move_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cycle_iff dual_order.trans backward_finite_path_root_move_root start_points_in_root
          root_equals_start_points non_empty_cycle_root_non_empty<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_loop_converse"><span class="command">lemma</span></span> non_empty_cycle_root_loop_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms less_eq_def non_empty_cycle_root_rtc_tc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_same_reachable"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_same_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms many_strongly_connected_iff_7 connected_root_iff3 connected_root_move_root
          backward_finite_path_root_def non_empty_cycle_root_msc non_empty_cycle_root_rtc_tc<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_same_reachable_2"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_same_reachable_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_move_root_same_reachable non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_msc"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_msc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_rtc_tc"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_rtc_tc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_move_root non_empty_cycle_root_rtc_tc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_loop_converse"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_loop_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_loop non_empty_cycle_root_move_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_loop"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_loop_converse non_empty_cycle_root_move_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_msc_plus"><span class="command">lemma</span></span> non_empty_cycle_root_msc_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_7 non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_tc_start_points"><span class="command">lemma</span></span> non_empty_cycle_root_tc_start_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms connected_root_iff3 backward_finite_path_root_def non_empty_cycle_root_msc_plus
          non_empty_cycle_root_no_start_end_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_rtc_start_points"><span class="command">lemma</span></span> non_empty_cycle_root_rtc_start_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms non_empty_cycle_root_rtc_tc non_empty_cycle_root_tc_start_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_converse_start_end_points"><span class="command">lemma</span></span> non_empty_cycle_root_converse_start_end_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_invol conv_one inf.boundedI maddux_20 maddux_21 vector_meet_comp_x
          non_empty_cycle_root_no_start_end_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_start_end_points_plus"><span class="command">lemma</span></span> non_empty_cycle_root_start_end_points_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms eq_iff one_strongly_connected_iff one_strongly_connected_implies_7_eq
      backward_finite_path_connected non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_converse_plus"><span class="command">lemma</span></span> non_empty_cycle_root_converse_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_2 non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_plus_converse"><span class="command">lemma</span></span> non_empty_cycle_root_plus_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms many_strongly_connected_iff_7 non_empty_cycle_root_msc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_converse"><span class="command">lemma</span></span> non_empty_cycle_root_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol inj_p_fun connected_root_iff3 backward_finite_path_root_def
          non_empty_cycle_root_msc_plus non_empty_cycle_root_tc_start_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_forward"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_forward<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms backward_finite_path_root_move_root non_empty_cycle_root_no_start_end_points
          non_empty_cycle_root_point_exchange non_empty_cycle_root_rtc_start_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_move_root_forward_cycle"><span class="command">lemma</span></span> non_empty_cycle_root_move_root_forward_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc independence1 ss_p18 non_empty_cycle_root_move_root_forward
          non_empty_cycle_root_msc_plus non_empty_cycle_root_non_empty
          non_empty_cycle_root_tc_start_points<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_equivalences"><span class="command">lemma</span></span> non_empty_cycle_root_equivalences<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms cycle_iff no_end_point_char non_empty_cycle_root_no_start_end_points
      non_empty_cycle_root_point_exchange non_empty_cycle_root_rtc_start_points
<span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_chord"><span class="command">lemma</span></span> non_empty_cycle_root_chord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_move_root_same_reachable non_empty_cycle_root_point_exchange
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_var_axioms_2"><span class="command">lemma</span></span> non_empty_cycle_root_var_axioms_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">∧</span> is_inj <span class="free">x</span> <span class="main">∧</span> is_p_fun <span class="free">x</span> <span class="main">∧</span> point <span class="free">r</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff backward_finite_path_root_def non_empty_cycle_root_no_start_end_points
              non_empty_cycle_root_tc_start_points<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol p_fun_inj connected_root_iff2 connected_root_iff3
          non_empty_cycle_root_var_axioms_1 non_empty_cycle_root_msc_plus
          non_empty_cycle_root_rtc_start_points non_empty_cycle_root_rtc_tc<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_var_axioms_3"><span class="command">lemma</span></span> non_empty_cycle_root_var_axioms_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">∧</span> is_inj <span class="free">x</span> <span class="main">∧</span> is_p_fun <span class="free">x</span> <span class="main">∧</span> point <span class="free">r</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc eq_refl backward_finite_path_root_def star_inductl_var_eq2
              non_empty_cycle_root_no_start_end_points non_empty_cycle_root_rtc_start_points
              non_empty_cycle_root_tc_start_points<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir comp_assoc conv_contrav no_end_point_char non_empty_cycle_root_var_axioms_2<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_subset_equals"><span class="command">lemma</span></span> non_empty_cycle_root_subset_equals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="free">y</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_assoc non_empty_cycle_root_msc non_empty_cycle_root_msc_plus
          non_empty_cycle_root_rtc_tc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> comp_assoc conv_iso mult_double_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> backward_finite_path_root_def is_inj_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans mult_isor order.refl prod_star_closure star_ref<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">y</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conway.dagger_unfoldl_distr le_supI sup.cobounded1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc rtc_inductl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">;</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> non_empty_cycle_root_msc non_empty_cycle_root_rtc_start_points <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> backward_finite_path_root_def ss422iv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_subset_equals_change_root"><span class="command">lemma</span></span> non_empty_cycle_root_subset_equals_change_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">q</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> dual_order.trans mult_isor non_empty_cycle_root_no_start_end_points<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> connected_root_move_root backward_finite_path_root_def
              non_empty_cycle_root_no_start_end_points non_empty_cycle_root_rtc_start_points<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> non_empty_cycle_root_subset_equals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_equivalences_2"><span class="command">lemma</span></span> non_empty_cycle_root_equivalences_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
     <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_no_start_end_points non_empty_cycle_root_rtc_start_points
<span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Rooted_Paths-cycle_root_non_empty"><span class="command">lemma</span></span> cycle_root_non_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cycle_root <span class="free">r</span> <span class="free">x</span> <span class="main">⟷</span> non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_assoc maddux_20 tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult_isor point_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ra_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 backward_finite_path_root_def inf.boundedE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> backward_finite_path_root_def inf.orderE maddux_20 non_empty_cycle_root_plus_converse
              ra_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Start points and end points›</span></span>

<span class="keyword1" id="Rooted_Paths-start_points_path_aux"><span class="command">lemma</span></span> start_points_path_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms compl_inf_bot inf.commute non_empty_cycle_root_no_start_end_points
          backward_finite_path_root_terminating_or_cycle<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-start_points_path"><span class="command">lemma</span></span> start_points_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms start_points_path_aux<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-root_in_start_points_2"><span class="command">lemma</span></span> root_in_start_points_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_zero eq_refl galois_aux2 root_equals_start_points start_points_path_aux<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-root_equals_start_points_2"><span class="command">lemma</span></span> root_equals_start_points_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> start_points <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf_bot_left ss_p18 root_equals_start_points start_points_path<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-start_points_injective"><span class="command">lemma</span></span> start_points_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms compl_bot_eq inj_def_var1 point_def backward_finite_path_root_def top_greatest
          root_equals_start_points_2<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-backward_terminating_path_root_aux_2"><span class="command">lemma</span></span> backward_terminating_path_root_aux_2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bot_least backward_terminating_path_root_aux start_points_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-start_points_not_zero_iff"><span class="command">lemma</span></span> start_points_not_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> start_points <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_zero inf_compl_bot backward_finite_path_root_def start_points_not_zero_contra
          start_points_path_aux<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Backwards terminating and backwards finite: Part II›</span></span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_acyclic_terminating_aux"><span class="command">lemma</span></span> backward_finite_path_root_acyclic_terminating_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> has_root_contra no_end_point_char backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> connected_root_iff3 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="main">⋅</span><span class="main">(</span><span class="main">-</span><span class="main">1'</span><span class="main">;</span><span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_compl conv_contrav conv_e conv_iso meet_isor mult_isor star_conv
              star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inj_distr annil inf_compl_bot mult_1_left point_def
              backward_finite_path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> start_points <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 galois_aux inf.boundedI le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> annir le_bot start_points_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_acyclic_terminating_iff"><span class="command">lemma</span></span> backward_finite_path_root_acyclic_terminating_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">;</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms backward_finite_path_root_acyclic_terminating_aux<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms backward_finite_path_root_path_root path_root_acyclic <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_acyclic_terminating"><span class="command">lemma</span></span> backward_finite_path_root_acyclic_terminating<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">x</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms backward_finite_path_root_acyclic_terminating_aux<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_one_strongly_connected"><span class="command">lemma</span></span> non_empty_cycle_root_one_strongly_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="free">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_strongly_connected <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms one_strongly_connected_iff order_trans star_1l star_star_plus sup.absorb2
          non_empty_cycle_root_msc non_empty_cycle_root_start_end_points_plus<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_nodes_reachable"><span class="command">lemma</span></span> backward_finite_path_root_nodes_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms connected_root_iff3 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> join_iso start_points_in_root_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isor sup.absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_sur_semi_swap point_def backward_finite_path_root_def star_conv
                  inj_sur_semi_swap_short<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_backward_terminating"><span class="command">lemma</span></span> terminating_path_root_end_backward_terminating<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">r</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms non_empty_cycle_root_move_root_forward_cycle
      backward_finite_path_root_terminating_or_cycle <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_converse"><span class="command">lemma</span></span> terminating_path_root_end_converse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">e</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms terminating_path_root_end_backward_terminating backward_finite_path_root_def
          conv_invol terminating_path_root_end_forward_finite point_swap star_conv<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_forward_terminating"><span class="command">lemma</span></span> terminating_path_root_end_forward_terminating<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="free">r</span> <span class="free">x</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="free">e</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms terminating_path_root_end_converse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequences with the Tarski rule and the point axiom›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_point
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rooted paths›</span></span>

<span class="keyword1" id="Rooted_Paths-path_root_iff"><span class="command">lemma</span></span> path_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> path_root <span class="bound">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> path_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_def path_iff_backward point_def path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> path_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inj_def is_p_fun_def point_exists path_root_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss_p18<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_assoc is_vector_def one_idem_mult point_below_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 path_def path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_path_root_iff"><span class="command">lemma</span></span> non_empty_path_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> path_root <span class="bound">r</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> path <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> non_empty_cycle_root_non_empty path_root_def zero_backward_terminating_path_root path_root_iff
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">using</span></span> path_root_iff non_empty_path_root_iff_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹(Non-empty) Cycle›</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_root_iff"><span class="command">lemma</span></span> non_empty_cycle_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> non_empty_cycle_root <span class="bound">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> cycle <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> non_empty_cycle_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> non_empty_cycle_root_msc_cycle non_empty_cycle_root_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> many_strongly_connected_implies_no_start_end_points ss_p18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_assoc is_vector_def one_idem_mult point_below_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 one_strongly_connected_iff path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_vector_def mult_isor point_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_assoc mult_isol x_leq_triple_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_double_iso top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"connected_root <span class="skolem">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"non_empty_cycle_root <span class="skolem">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 path_def backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> non_empty_cycle_root <span class="bound">r</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_cycle_subset_equals"><span class="command">lemma</span></span> non_empty_cycle_subset_equals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms le_bot non_empty_cycle_root_subset_equals_change_root non_empty_cycle_root_iff<span class="main">)</span>

<span class="keyword1" id="Rooted_Paths-cycle_root_iff"><span class="command">lemma</span></span> cycle_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> cycle_root <span class="bound">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> cycle <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> path_def point_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cycle_root_non_empty non_empty_cycle_root_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Backwards terminating and backwards finite›</span></span>

<span class="keyword1" id="Rooted_Paths-backward_terminating_path_root_iff"><span class="command">lemma</span></span> backward_terminating_path_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_terminating_path_root <span class="bound">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> backward_terminating_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_terminating_path_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> backward_terminating_path_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_terminating_path_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> point_exists zero_backward_terminating_path_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"start_points <span class="free">x</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_point <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 start_point_iff2 backward_terminating_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="var">?r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top.right_neutral modular_1_aux'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_assoc mult_isol x_leq_triple_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 mult_isor path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1'</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_star_plus star_unfoldl_eq sup.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right' mult_onel<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_assoc distrib_left sup.commute sup.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> join_iso mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="main">1'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc join_isol mult_isol path_def is_p_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_1 inf.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">;</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute one_compl ra_1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="var">?r</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_is_point backward_finite_path_root_def path_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_backward_terminating_path_root_iff"><span class="command">lemma</span></span> non_empty_backward_terminating_path_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟷</span> backward_terminating_path <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> backward_finite_path_root_path backward_terminating_path_root_2 conv_zero
               inf.cobounded1 non_empty_cycle_root_non_empty<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> backward_terminating_path_root_iff root_equals_start_points <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_backward_terminating_path_root_iff'"><span class="command">lemma</span></span> non_empty_backward_terminating_path_root_iff'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"backward_finite_path_root <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟷</span> backward_terminating_path <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> start_point_no_predecessor non_empty_backward_terminating_path_root_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rooted_Paths-backward_finite_path_root_iff"><span class="command">lemma</span></span> backward_finite_path_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_finite_path_root <span class="bound">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> backward_finite_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_finite_path_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"backward_finite_path <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> backward_finite_iff_msc non_empty_cycle_root_msc backward_finite_path_root_path
              backward_finite_path_root_terminating_or_cycle backward_terminating_path_root<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"backward_finite_path <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_finite_path_root <span class="bound">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> backward_finite_iff_msc point_exists non_empty_cycle_root_iff
              zero_backward_terminating_path_root backward_terminating_path_root_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_backward_finite_path_root_iff"><span class="command">lemma</span></span> non_empty_backward_finite_path_root_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">.</span> backward_finite_path_root <span class="bound">r</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> backward_finite_path <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> backward_finite_path_root_iff annir backward_finite_path_root_def le_bot
              no_end_point_char ss_p18<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> backward_finite_path_root_iff backward_finite_path_root_def point_def root_in_edge_sources <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Terminating›</span></span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_aux"><span class="command">lemma</span></span> terminating_path_root_end_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="bound">e</span> <span class="main">.</span> terminating_path_root_end <span class="bound">r</span> <span class="free">x</span> <span class="bound">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> point_exists zero_backward_terminating_path_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="skolem">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> backward_terminating_path_root_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms backward_terminating_iff1 conv_backward_terminating_path conv_invol
                      conv_zero inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path_root <span class="skolem">e</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> backward_terminating_path_root_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 3 root_in_edge_sources backward_finite_path_root_def point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span><span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 connected_root_iff3 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span><span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 4 backward_finite_path_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-terminating_path_root_end_iff"><span class="command">lemma</span></span> terminating_path_root_end_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">e</span> <span class="main">.</span> terminating_path_root_end <span class="bound">r</span> <span class="free">x</span> <span class="bound">e</span><span class="main">)</span> <span class="main">⟷</span> terminating_path <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="bound">e</span> <span class="main">.</span> terminating_path_root_end <span class="bound">r</span> <span class="free">x</span> <span class="bound">e</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"terminating_path <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inj_def is_p_fun_def path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> many_strongly_connected <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 cycle_root_end_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 backward_terminating_path_root terminating_path_root_end_backward_terminating <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> backward_finite_path_root <span class="bound">e</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 terminating_path_root_end_converse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 backward_terminating_path_root terminating_path_root_end_converse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_backward_terminating_path<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.boundedI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"terminating_path <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="bound">e</span> <span class="main">.</span> terminating_path_root_end <span class="bound">r</span> <span class="free">x</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> terminating_path_root_end_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rooted_Paths-non_empty_terminating_path_root_end_iff"><span class="command">lemma</span></span> non_empty_terminating_path_root_end_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"terminating_path_root_end <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> terminating_path <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> conv_zero non_empty_backward_terminating_path_root_iff terminating_path_root_end_iff<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> terminating_path_root_end_iff terminating_path_root_end_forward_terminating
      root_equals_end_points terminating_path_root_end_backward_terminating root_equals_start_points
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rooted_Paths-non_empty_finite_path_root_end_iff"><span class="command">lemma</span></span> non_empty_finite_path_root_end_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_path_root_end <span class="main">(</span>start_points <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span>end_points <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> terminating_path <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> non_empty_terminating_path_root_end_iff end_point_no_successor <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_point *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Path_Algorithms">
<div class="head">
<h1>Theory Path_Algorithms</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Correctness of Path Algorithms
   Author:     Walter Guttmann, Peter Hoefner
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
               Peter Hoefner &lt;peter at hoefner-online.de&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Correctness of Path Algorithms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
To show that our theory of paths integrates with verification tasks, we verify the correctness of three basic path algorithms.
Algorithms at the presented level are executable and can serve prototyping purposes.
Data refinement can be carried out to move from such algorithms to more efficient programs.
The total-correctness proofs use a library developed in \cite{Guttmann2018c}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Path_Algorithms

<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Hoare/Hoare_Logic.html">HOL-Hoare.Hoare_Logic</a>"</span> <a href="Rooted_Paths.html">Rooted_Paths</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  trancl <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> choose_singleton_point_signature <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">choose_singleton</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">choose_point</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc_tarski_choose_point <span class="main">=</span>
  relation_algebra_rtc_tarski <span class="main">+</span> choose_singleton_point_signature <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> choose_singleton_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> singleton <span class="main">(</span>choose_singleton <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> choose_singleton_decreasing<span class="main">:</span> <span class="quoted"><span class="quoted">"choose_singleton <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> choose_point_point<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> point <span class="main">(</span>choose_point <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> choose_point_decreasing<span class="main">:</span> <span class="quoted"><span class="quoted">"choose_point <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 75<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span>
  composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*</span>"</span> 75<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Construction of a path›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Our first example is a basic greedy algorithm that constructs a path from a vertex $x$ to a different vertex $y$ of a directed acyclic graph $D$.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">construct_path_inv</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span>
    is_acyclic <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> terminating_path <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> start_points <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> end_points <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">construct_path_inv_simp</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span>
    is_acyclic <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> terminating_path <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> start_points <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> end_points <span class="free"><span class="bound"><span class="entity">W</span></span></span>"</span></span>

<span class="keyword1" id="Path_Algorithms-construct_path_pre"><span class="command">lemma</span></span> construct_path_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">D</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">y</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms is_inj_def is_p_fun_def path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> cycle_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following three lemmas are auxiliary lemmas for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>construct_path_inv›</span></span></span></span>.
They are pulled out of the main proof to have more structure.
›</span></span>

<span class="keyword1" id="Path_Algorithms-path_inv_points"><span class="command">lemma</span></span> path_inv_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"point <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="main">(</span>choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms choose_point_point comp_assoc is_vector_def point_def reachable_implies_predecessor<span class="main">)</span>

<span class="keyword1" id="Path_Algorithms-path_inv_choose_point_decrease"><span class="command">lemma</span></span> path_inv_choose_point_decrease<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">W</span> <span class="main">+</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="free">W</span> <span class="main">≤</span> <span class="free">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="comment1">(* "connected_root q W" *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_invol conv_iso conv_terminating_path
              forward_terminating_path_end_points_1 plus_conv point_def ss423bij
              terminating_path_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⋅</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="free">D</span><span class="main">*</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">*</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> choose_point_decreasing meet_iso meet_isor inf_mono assms connected_root_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">D</span> <span class="main">⋅</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">*</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inj_distr point_def conv_contrav conv_invol conv_iso meet_isor
              mult_isol_var mult_isor star_conv star_slide_var star_subdist sup.commute sup.orderE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acyclic_trans assms conv_zero step_has_target eq_iff galois_aux ss_p18<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> galois_aux le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"point <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> path_inv_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> point_is_point
            choose_point_decreasing edge_end end_point_char end_point_no_successor<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.boundedI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-end_points"><span class="command">lemma</span></span> end_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> start_points <span class="main">(</span><span class="free">W</span> <span class="main">+</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> end_points <span class="main">(</span><span class="free">W</span> <span class="main">+</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> start_points <span class="var">?W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">" start_points <span class="var">?W</span> <span class="main">≤</span> <span class="var">?q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> path_inv_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                choose_point_decreasing edge_end edge_start sup.commute
                path_concatenation_start_points_approx point_is_point eq_iff sup_bot_left<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≤</span> start_points <span class="var">?W</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc point_equations<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_is_point aux4 conv_zero
                  choose_point_decreasing choose_point_point conv_contrav conv_one point_def
                  inf.orderE inf_compl_bot inf_compl_bot_right is_vector_def maddux_142
                  sup_bot_left sur_def_var1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span><span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?q</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms path_inv_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> path_inv_choose_point_decrease
                  acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> choose_point_decreasing inf.orderE
                  inf_compl_bot sup_inf_absorb edge_start point_is_point sup_bot_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?q</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="var">?q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">q</span> <span class="main">+</span> <span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_sup inf_sup_distrib2 meet_assoc sup.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?W</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.left_commute distrib_right' compl_sup inf.cobounded2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≤</span> start_points <span class="var">?W</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> end_points <span class="var">?W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> point_nq<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="var">?q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> path_inv_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> yp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> choose_point_decreasing cycle_no_points<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                finite_iff finite_iff_msc forward_finite_iff_msc path_aux1a path_edge_equals_cycle
                point_is_point point_not_equal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> terminating_iff1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation sup_assoc sup_inf_absorb<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> yp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="var">?q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="var">?q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="var">?q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> point_nq
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_assoc conv_contrav conv_one is_vector_def point_def sur_def_var1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="var">?W</span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-construct_path_inv"><span class="command">lemma</span></span> construct_path_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="main">(</span>choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="main">(</span><span class="free">W</span> <span class="main">+</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> point_y<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">≤</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms choose_point_decreasing le_sup_iff point_def ss423bij inf.boundedE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="var">?q</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">*</span><span class="free">q</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms conv_galois_2 order_trans star_1l <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_decreasing comp_assoc dual_order.trans mult_isol star_slide_var<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> point_nq<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> path_inv_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> pathW<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="var">?W</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms edge_is_path point_is_point point_nq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span><span class="main">*</span><span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">-</span><span class="main">(</span><span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms point_nq
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> different_points_consequences<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_def sur_def_var1
               acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> choose_point_decreasing comp_assoc
               is_vector_def point_def point_equations<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> point_is_point<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="free">W</span><span class="main">)</span><span class="main">*</span><span class="free">W</span><span class="main">*</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms terminating_path_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms path_inv_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> acyclic_reachable_points choose_point_decreasing
                  edge_end point_is_point comp_assoc point_def sur_total total_one<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">⋅</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms point_nq
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc conv_contrav conv_one is_vector_def point_def sur_def_var1<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="var">?W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms path_inv_choose_point_decrease
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a conv_contrav conv_iso conv_one inf_mono less_eq_def subdistl_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> compl_inf_bot eq_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> b c d e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_assoc edge_is_path path_concatenation_cycle_free
                                point_is_point sup.commute point_nq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?q</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_zero dist_alt edge_start inf_compl_bot_right modular_1_aux' modular_2_aux'
              point_is_point sup.left_idem sup_bot_left point_nq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms end_points<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_contrav conv_invol cycle_no_points<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> end_point_iff2 has_start_end_points_iff path_aux1b path_edge_equals_cycle point_is_point start_point_iff2 sup_bot_left top_greatest pathW<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟷</span> <span class="var">?q</span> <span class="main">=</span> start_points <span class="var">?W</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> end_points <span class="var">?W</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms end_points <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"terminating <span class="var">?W</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms end_points end_point_iff2 has_start_end_points_iff point_is_point start_point_iff2
            terminating_iff1 pathW point_nq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> construct_path_partial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">q</span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">W</span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">{</span> is_acyclic <span class="free">D</span> <span class="main">∧</span> point <span class="free">y</span> <span class="main">∧</span> point <span class="free">x</span> <span class="main">∧</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span> <span class="main">}</span>
  W <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  q <span class="main">:=</span> <span class="free">y</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">x</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_path_inv <span class="bound">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="bound">W</span> <span class="main">}</span>
     <span class="keyword1">DO</span> p <span class="main">:=</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="bound">q</span><span class="main">)</span><span class="main">;</span>
        W <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>
        q <span class="main">:=</span> <span class="bound">p</span>
     <span class="keyword1">OD</span>
  <span class="main">{</span> <span class="bound">W</span> <span class="main">≤</span> <span class="free">D</span> <span class="main">∧</span> terminating_path <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> start_points <span class="bound">W</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> end_points <span class="bound">W</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For termination, we additionally need finiteness.›</span></span>

<span class="keyword1"><span class="command">context</span></span> finite
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Path_Algorithms-decrease_set"><span class="command">lemma</span></span> decrease_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mono assms card_seteq finite mem_Collect_eq not_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc_tarski_choose_point_finite <span class="main">=</span>
      relation_algebra_rtc_tarski_choose_point <span class="main">+</span> relation_algebra_rtc_tarski_point_finite
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Path_Algorithms-decrease_variant"><span class="command">lemma</span></span> decrease_variant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mono assms card_seteq linorder_not_le dual_order.trans finite_code mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Path_Algorithms-construct_path_inv_termination"><span class="command">lemma</span></span> construct_path_inv_termination<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">W</span> <span class="main">+</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">W</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> decrease_variant<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?W</span> <span class="main">≤</span> <span class="main">-</span><span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms galois_aux inf_compl_bot_right maddux_142 mult_isor order_trans top_greatest<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?q</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="var">?W</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms end_points<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> choose_point_decreasing compl_sup inf.absorb1
              inf_compl_bot_right sup.commute sup_bot.left_neutral conv_zero end_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> construct_path_total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">q</span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">W</span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> is_acyclic <span class="free">D</span> <span class="main">∧</span> point <span class="free">y</span> <span class="main">∧</span> point <span class="free">x</span> <span class="main">∧</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span> <span class="main">]</span>
  W <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  q <span class="main">:=</span> <span class="free">y</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">x</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_path_inv <span class="bound">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="bound">W</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">W</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> p <span class="main">:=</span> choose_point <span class="main">(</span><span class="free">D</span><span class="main">*</span><span class="bound">q</span><span class="main">)</span><span class="main">;</span>
        W <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>
        q <span class="main">:=</span> <span class="bound">p</span>
     <span class="keyword1">OD</span>
  <span class="main">[</span> <span class="bound">W</span> <span class="main">≤</span> <span class="free">D</span> <span class="main">∧</span> terminating_path <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> start_points <span class="bound">W</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> end_points <span class="bound">W</span><span class="main">)</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CollectI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_inv_termination <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point_finite *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Topological sorting›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In our second example we look at topological sorting.
Given a directed acyclic graph, the problem is to construct a linear order of its vertices that contains $x$ before $y$ for each edge $(x,y)$ of the graph.
If the input graph models dependencies between tasks, the output is a linear schedule of the tasks that respects all dependencies.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_choose_point
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">topological_sort_inv</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">topological_sort_inv</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span>
         regressively_finite <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> terminating_path <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⋅</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span>
         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> end_points <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> is_vector <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1" id="Path_Algorithms-topological_sort_pre"><span class="command">lemma</span></span> topological_sort_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regressively_finite <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"topological_sort_inv <span class="main">(</span>choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> point_q<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> annir choose_point_point galois_aux2 is_inj_def is_sur_def
                          is_vector_def one_idem_mult point_def ss_p18 inf_top_left one_compl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_decreasing conv_invol end_point_char eq_iff inf_bot_left schroeder_2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inj_def is_p_fun_def path_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">*</span><span class="var">?q</span> <span class="main">≤</span> <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_decreasing compl_bot_eq conv_galois_1 inf_compl_bot_left2 le_inf_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> point_q point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-topological_sort_inv"><span class="command">lemma</span></span> topological_sort_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"topological_sort_inv <span class="free">q</span> <span class="free">v</span> <span class="free">R</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"topological_sort_inv <span class="main">(</span>choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span> <span class="main">+</span>
                      choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span> <span class="main">(</span><span class="free">W</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">+</span> <span class="var">?p</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> point_p<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_point compl_bot_eq double_compl galois_aux2 comp_assoc is_vector_def
              vector_compl vector_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ep_np<span class="main">:</span> <span class="quoted"><span class="quoted">"end_points <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 choose_point_decreasing edge_end le_supI1 point_in_vector_or_complement_iff
              point_is_point<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> sp_q<span class="main">:</span> <span class="quoted"><span class="quoted">"start_points <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_contrav conv_invol edge_start point_is_point<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ep_sp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> end_points <span class="free">W</span> <span class="main">=</span> start_points <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="free">v</span><span class="main">⋅</span><span class="main">-</span><span class="free">q</span><span class="main">⋅</span><span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_p is_vector_def mult_assoc point_def point_equations<span class="main">(</span>3<span class="main">)</span> point_is_point
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_decreasing dual_order.trans galois_aux inf.cobounded2 inf.commute<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"regressively_finite <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="var">?v</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_isol_var order.trans order_prop star_subdist<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">W</span><span class="main">*</span><span class="main">1</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> aux4 double_compl inf_absorb2 distrib_right<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">W</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> point_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_one is_vector_def mult_assoc point_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">*</span>end_points <span class="free">W</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> forward_terminating_path_end_points_1 join_iso mult_isor terminating_path_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil eq_refl<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">W</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conway.dagger_unfoldl_distr mult_assoc sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_isol_var star_slide_var star_subdist sup_ge2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="var">?p</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> choose_point_decreasing compl_le_swap1 inf_le1 order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">*</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux inf_le2 schroeder_2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="var">?p</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="var">?p</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> point_p is_inj_def meet_isor point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> regressively_finite_irreflexive galois_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> bot_least inf.absorb_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="var">?v</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="var">?p</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="var">?p</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add distrib_left distrib_right inf_sup_distrib1 sup.commute sup.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a b c d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_sup_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> pathW<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="var">?W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_p edge_is_path point_is_point sup_bot_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> fw_path<span class="main">:</span> <span class="quoted"><span class="quoted">"forward_terminating_path <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> terminating_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> bw_path<span class="main">:</span> <span class="quoted"><span class="quoted">"backward_terminating_path <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms point_p sp_q
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_backward_terminating conv_has_start_points conv_path edge_is_path
                forward_terminating_iff1 point_is_point start_point_iff2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> fw_path bw_path ep_sp 1 a1 path_concatenation_cycle_free <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"terminating <span class="var">?W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> start_end_implies_terminating<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_start_points <span class="var">?W</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> sp_q pathW
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> point_is_point start_point_iff2 sup_bot.left_neutral<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> ep_sp 1 pathW
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_start_end_points_iff path_concatenation_start_points start_point_iff2
                terminating_iff1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_end_points <span class="var">?W</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> point_p ep_np ep_sp pathW end_point_iff2 point_is_point <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">using</span></span> point_p ep_np ep_sp 1 pathW
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> end_point_iff2 path_concatenation_end_points point_is_point<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="var">?v</span><span class="main">⋅</span><span class="main">-</span><span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> point_p is_vector_def mult_assoc point_def point_equations<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
                point_is_point aux4 distrib_right' inf_absorb2 sup.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="main">⋅</span><span class="main">-</span><span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_decreasing compl_le_swap1 inf.cobounded1 inf.orderE order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?p</span> <span class="main">=</span> end_points <span class="var">?W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ep_np ep_sp 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_concatenation_end_points sup_bot_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">*</span><span class="var">?v</span> <span class="main">≤</span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> choose_point_decreasing conv_galois_1 inf.cobounded2 order.trans sup.coboundedI1
              sup_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> point_p point_def vector_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-topological_sort_post"><span class="command">lemma</span></span> topological_sort_post<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"topological_sort_inv <span class="free">q</span> <span class="free">v</span> <span class="free">R</span> <span class="free">W</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≤</span> <span class="free">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> terminating_path <span class="free">W</span> <span class="main">∧</span> <span class="main">(</span><span class="free">W</span> <span class="main">+</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1'</span><span class="main">*</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≤</span> <span class="free">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" backward_terminating <span class="free">W</span> <span class="main">∧</span> <span class="free">W</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">W</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⋅</span> <span class="main">-</span> <span class="free">q</span> <span class="main">+</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1'</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_bot_eq conv_one conv_zero double_compl inf_top.left_neutral is_inj_def
                  le_bot mult_1_right one_idem_mult point_def ss_p18 star_zero sup.absorb2 top_le<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms backward_terminating_path_irreflexive le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">*</span><span class="main">-</span><span class="main">1'</span><span class="main">*</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tarski<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">1'</span><span class="main">*</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc distrib_left mult_1_left sup_top_left distrib_right sup_compl_top<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1'</span><span class="main">*</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="free">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl galois_aux4 inf.absorb_iff2 inf_top.left_neutral<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> topological_sort_partial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">q</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">v</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">W</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">{</span> regressively_finite <span class="free">R</span> <span class="main">}</span>
  W <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  q <span class="main">:=</span> choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
  v <span class="main">:=</span> <span class="bound">q</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">1</span>
    <span class="keyword1">INV</span> <span class="main">{</span> topological_sort_inv <span class="bound">q</span> <span class="bound">v</span> <span class="free">R</span> <span class="bound">W</span> <span class="main">}</span>
     <span class="keyword1">DO</span> p <span class="main">:=</span> choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        W <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">q</span><span class="main">*</span><span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>
        q <span class="main">:=</span> <span class="bound">p</span><span class="main">;</span>
        v <span class="main">:=</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">p</span>
     <span class="keyword1">OD</span>
  <span class="main">{</span> <span class="free">R</span> <span class="main">≤</span> <span class="bound">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> terminating_path <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span> <span class="main">+</span> <span class="bound">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1'</span><span class="main">*</span><span class="main">1</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point *)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_choose_point_finite
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Path_Algorithms-topological_sort_inv_termination"><span class="command">lemma</span></span> topological_sort_inv_termination<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"topological_sort_inv <span class="free">q</span> <span class="free">v</span> <span class="free">R</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">+</span> choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> decrease_variant<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">+</span> <span class="var">?p</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?v</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> choose_point_decreasing inf.boundedE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"point <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> choose_point_point compl_bot_eq double_compl galois_aux2 comp_assoc is_vector_def
              vector_compl vector_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?p</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir compl_sup inf.absorb1 inf_compl_bot_right maddux_20 no_end_point_char<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Use precondition <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_acyclic›</span></span></span></span> instead of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>regressively_finite›</span></span></span></span>.
They are equivalent for finite graphs.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> topological_sort_total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">q</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">v</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">W</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> is_acyclic <span class="free">R</span> <span class="main">]</span>
  W <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  q <span class="main">:=</span> choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
  v <span class="main">:=</span> <span class="bound">q</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">1</span>
    <span class="keyword1">INV</span> <span class="main">{</span> topological_sort_inv <span class="bound">q</span> <span class="bound">v</span> <span class="free">R</span> <span class="bound">W</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">v</span> <span class="main">}</span> <span class="main">}</span>
      <span class="keyword1">DO</span> p <span class="main">:=</span> choose_point <span class="main">(</span>minimum <span class="free">R</span> <span class="main">(</span><span class="main">-</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
         W <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">q</span><span class="main">*</span><span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>
         q <span class="main">:=</span> <span class="bound">p</span><span class="main">;</span>
         v <span class="main">:=</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">p</span>
      <span class="keyword1">OD</span>
   <span class="main">[</span> <span class="free">R</span> <span class="main">≤</span> <span class="bound">W</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> terminating_path <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span> <span class="main">+</span> <span class="bound">W</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1'</span><span class="main">*</span><span class="main">1</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> acyclic_regressively_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CollectI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_inv_termination <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> topological_sort_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point_finite *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Construction of a tree›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Our last application is a correctness proof of an algorithm that constructs a non-empty cycle for a given directed graph.
This works in two steps.
The first step is to construct a directed tree from a given root along the edges of the graph.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_choose_point
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">construct_tree_pre</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">construct_tree_pre</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">construct_tree_inv</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">construct_tree_inv</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> construct_tree_pre <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> is_acyclic <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span>
                                         <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∧</span>
                                         is_vector <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">construct_tree_post</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">construct_tree_post</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> is_acyclic <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span>
                                        <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Path_Algorithms-construct_tree_pre"><span class="command">lemma</span></span> construct_tree_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"construct_tree_pre <span class="free">x</span> <span class="free">y</span> <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="free">x</span> <span class="free">x</span> <span class="free">y</span> <span class="main">0</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inj_def point_def<span class="main">)</span>

<span class="keyword1" id="Path_Algorithms-construct_tree_inv_aux"><span class="command">lemma</span></span> construct_tree_inv_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="free">v</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"singleton <span class="main">(</span>choose_singleton <span class="main">(</span><span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> choose_singleton_singleton<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux conv_compl conv_galois_1 conv_galois_2 conv_invol double_compl
              star_inductl_var<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_isol order_trans sup.cobounded1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">using</span></span> assms point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-construct_tree_inv"><span class="command">lemma</span></span> construct_tree_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="free">v</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="main">(</span><span class="free">v</span> <span class="main">+</span> choose_singleton <span class="main">(</span><span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">(</span><span class="free">D</span> <span class="main">+</span>
                               choose_singleton <span class="main">(</span><span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_singleton <span class="main">(</span><span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">+</span> <span class="var">?e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">+</span> <span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> choose_singleton_decreasing inf.boundedE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_acyclic <span class="var">?D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms acyclic_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="var">?D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 construct_tree_inv_aux assms injective_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≤</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sup.boundedI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> choose_singleton_decreasing inf.boundedE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span><span class="main">*</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span><span class="main">*</span><span class="free">x</span> <span class="main">=</span> <span class="var">?e</span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?e</span><span class="main">*</span><span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mult_isol<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> annir comp_assoc vector_prop1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="var">?D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sup_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="main">1</span><span class="main">*</span><span class="var">?e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="main">1</span><span class="main">*</span><span class="main">(</span><span class="var">?e</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf.absorb1 join_iso<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="main">1</span><span class="main">*</span><span class="main">(</span><span class="var">?e</span> <span class="main">⋅</span> <span class="free">v</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_assoc conv_compl inf.assoc vector_compl vector_meet_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="main">1</span><span class="main">*</span><span class="main">(</span><span class="var">?e</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> join_isol mult_subdistl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="var">?e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf.commute mult_assoc vector_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="var">?e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="var">?e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms join_isol mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_sup_iff prod_star_closure star_ext star_subdist<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≤</span> <span class="var">?v</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sup.boundedI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≤</span> <span class="var">?v</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> conv_add distrib_left le_supI1 conv_iso dual_order.trans mult_isol_var order_prop<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="var">?e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 inf.absorb_iff2 modular_1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="main">*</span><span class="main">1</span><span class="main">*</span><span class="var">?e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc le_infI2 mult_isol_var<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?v</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_invol conv_iso conv_one mult_assoc mult_isol_var sup.cobounded1
                sup_ge2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">≤</span> <span class="var">?v</span><span class="main">*</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_vector <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_assoc is_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-construct_tree_post"><span class="command">lemma</span></span> construct_tree_post<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="free">v</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_tree_post <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">*</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_contrav conv_invol conv_iso star_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms le_supE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> star_inductl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sup.boundedI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 assms order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main">*</span><span class="main">(</span><span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">D</span><span class="main">*</span><span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conway.dagger_unfoldl_distr distrib_left mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">D</span><span class="main">*</span><span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1'</span><span class="main">*</span><span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_inj_def mult_assoc mult_isor<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main">*</span><span class="main">(</span><span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"construct_tree_post <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> construct_tree_partial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">v</span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">D</span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">{</span> construct_tree_pre <span class="free">x</span> <span class="free">y</span> <span class="free">R</span> <span class="main">}</span>
  D <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  v <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">v</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_tree_inv <span class="bound">v</span> <span class="free">x</span> <span class="free">y</span> <span class="bound">D</span> <span class="free">R</span> <span class="main">}</span>
     <span class="keyword1">DO</span> e <span class="main">:=</span> choose_singleton <span class="main">(</span><span class="bound">v</span><span class="main">*</span><span class="main">-</span><span class="bound">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">;</span>
        D <span class="main">:=</span> <span class="bound">D</span> <span class="main">+</span> <span class="bound">e</span><span class="main">;</span>
        v <span class="main">:=</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>
     <span class="keyword1">OD</span>
  <span class="main">{</span> construct_tree_post <span class="free">x</span> <span class="free">y</span> <span class="bound">D</span> <span class="free">R</span> <span class="main">}</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
 <span class="keyword1"><span class="command">using</span></span> construct_tree_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">using</span></span> construct_tree_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">using</span></span> construct_tree_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point *)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_choose_point_finite
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Path_Algorithms-construct_tree_inv_termination"><span class="command">lemma</span></span> construct_tree_inv_termination<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="free">v</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">+</span> choose_singleton <span class="main">(</span><span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> decrease_variant<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_singleton <span class="main">(</span><span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">+</span> <span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">≤</span> <span class="free">v</span><span class="main">*</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> choose_singleton_decreasing inf.boundedE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"singleton <span class="var">?e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> construct_tree_inv_aux assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?v</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="main">*</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 conv_compl conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="main">*</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_vector_def mult_isor one_compl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir compl_sup inf.absorb1 inf_compl_bot_right surj_one tarski<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> construct_tree_total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">v</span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">D</span></span></span></span></span></span></span></span></span></span></span></span></span>
 <span class="main">[</span> construct_tree_pre <span class="free">x</span> <span class="free">y</span> <span class="free">R</span> <span class="main">]</span>
 D <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
 v <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
 <span class="keyword1">WHILE</span> <span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">v</span>
   <span class="keyword1">INV</span> <span class="main">{</span> construct_tree_inv <span class="bound">v</span> <span class="free">x</span> <span class="free">y</span> <span class="bound">D</span> <span class="free">R</span> <span class="main">}</span>
   <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">v</span> <span class="main">}</span> <span class="main">}</span>
    <span class="keyword1">DO</span> e <span class="main">:=</span> choose_singleton <span class="main">(</span><span class="bound">v</span><span class="main">*</span><span class="main">-</span><span class="bound">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">;</span>
       D <span class="main">:=</span> <span class="bound">D</span> <span class="main">+</span> <span class="bound">e</span><span class="main">;</span>
       v <span class="main">:=</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>
    <span class="keyword1">OD</span>
 <span class="main">[</span> construct_tree_post <span class="free">x</span> <span class="free">y</span> <span class="bound">D</span> <span class="free">R</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CollectI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_inv_termination <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point_finite *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Construction of a non-empty cycle›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The second step is to construct a path from the root to a given vertex in the tree.
Adding an edge back to the root gives the cycle.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_choose_point
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">comment</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">comment</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">≡</span> <span class="keyword1">SKIP</span>"</span></span> <span class="comment1">(* instead of inner comments *)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">construct_cycle_inv</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">construct_cycle_inv</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> construct_tree_inv <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1" id="Path_Algorithms-construct_cycle_pre"><span class="command">lemma</span></span> construct_cycle_pre<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> is_acyclic <span class="free">R</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> choose_point <span class="main">(</span><span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> choose_point <span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="free">y</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_cycle_inv <span class="free">x</span> <span class="free">x</span> <span class="free">y</span> <span class="main">0</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> point_y<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> choose_point_point is_vector_def mult_assoc galois_aux ss_p18<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> conv_e conv_times inf.cobounded1 inf.commute
                many_strongly_connected_iff_6_eq mult_oner star_subid<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> plus_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">*</span><span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_e conv_invol modular_2_var mult_oner star_slide_var<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">*</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">*</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_isor one_idem_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> point_y inj_distr point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_galois_1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> compl_le_swap1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a comp_anti <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms galois_aux ss_p18 choose_point_decreasing<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf.absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> point_y annir point_equations<span class="main">(</span>2<span class="main">)</span> point_is_point tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> point_x<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> point_y assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inj_distr is_vector_def mult_assoc point_def choose_point_point<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> point_y choose_point_decreasing inf_le1 order.trans point_swap star_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> tree_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"construct_tree_inv <span class="free">x</span> <span class="free">x</span> <span class="free">y</span> <span class="main">0</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> point_x construct_tree_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> choose_point_decreasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">*</span><span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> point_y inj_distr point_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> point_y point_def ss423bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-construct_cycle_pre2"><span class="command">lemma</span></span> construct_cycle_pre2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"construct_cycle_inv <span class="free">v</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">R</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"construct_path_inv <span class="free">y</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">D</span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> <span class="free">D</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms construct_tree_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inj_def is_p_fun_def path_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> is_point_def point_is_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Path_Algorithms-construct_cycle_post"><span class="command">lemma</span></span> construct_cycle_post<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>construct_path_inv <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="free">D</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">D</span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> <span class="free">D</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">W</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> cycle <span class="main">(</span><span class="free">W</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">+</span> <span class="free">y</span><span class="main">*</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms acyclic_imp_one_step_different_points<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> no_trivial_inverse point_def ss423bij
              sup_bot.monoid_axioms monoid.left_neutral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≤</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> order_trans sup.boundedI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">W</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms construct_tree_pre edge_is_path less_eq_def path_edge_equals_cycle
              point_is_point terminating_iff1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"many_strongly_connected <span class="main">(</span><span class="free">W</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms construct_tree_pre bot_least conv_zero less_eq_def
              path_edge_equals_cycle star_conv star_subid terminating_iff1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> construct_cycle_partial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">q</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">v</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">C</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">D</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">W</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">{</span> <span class="main">¬</span> is_acyclic <span class="free">R</span> <span class="main">}</span>
  y <span class="main">:=</span> choose_point <span class="main">(</span><span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">;</span>
  x <span class="main">:=</span> choose_point <span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="bound">y</span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span>
  D <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  v <span class="main">:=</span> <span class="bound">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">v</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_cycle_inv <span class="bound">v</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">D</span> <span class="free">R</span> <span class="main">}</span>
     <span class="keyword1">DO</span> e <span class="main">:=</span> choose_singleton <span class="main">(</span><span class="bound">v</span><span class="main">*</span><span class="main">-</span><span class="bound">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">;</span>
        D <span class="main">:=</span> <span class="bound">D</span> <span class="main">+</span> <span class="bound">e</span><span class="main">;</span>
        v <span class="main">:=</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>
     <span class="keyword1">OD</span><span class="main">;</span>
  comment <span class="main">{</span> is_acyclic <span class="free">D</span> <span class="main">∧</span> point <span class="free">y</span> <span class="main">∧</span> point <span class="free">x</span> <span class="main">∧</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span> <span class="main">}</span><span class="main">;</span>
  W <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  q <span class="main">:=</span> <span class="bound">y</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">x</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_path_inv <span class="bound">q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">D</span> <span class="bound">W</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">D</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">*</span><span class="bound">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span> <span class="main">}</span>
     <span class="keyword1">DO</span> p <span class="main">:=</span> choose_point <span class="main">(</span><span class="bound">D</span><span class="main">*</span><span class="bound">q</span><span class="main">)</span><span class="main">;</span>
        W <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>
        q <span class="main">:=</span> <span class="bound">p</span>
     <span class="keyword1">OD</span><span class="main">;</span>
  comment <span class="main">{</span> <span class="free">W</span> <span class="main">≤</span> <span class="free">D</span> <span class="main">∧</span> terminating_path <span class="free">W</span> <span class="main">∧</span> <span class="main">(</span><span class="free">W</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">q</span><span class="main">=</span><span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">W</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">=</span> start_points <span class="free">W</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> end_points <span class="free">W</span><span class="main">)</span> <span class="main">}</span><span class="main">;</span>
  C <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">y</span><span class="main">*</span><span class="bound">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>
  <span class="main">{</span> <span class="bound">C</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> cycle <span class="bound">C</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
  <span class="keyword1"><span class="command">using</span></span> construct_cycle_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_cycle_pre2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_cycle_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point *)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc_tarski_choose_point_finite
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> construct_cycle_total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">q</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">v</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">C</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">D</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">W</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> <span class="main">¬</span> is_acyclic <span class="free">R</span> <span class="main">]</span>
  y <span class="main">:=</span> choose_point <span class="main">(</span><span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">;</span>
  x <span class="main">:=</span> choose_point <span class="main">(</span><span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="bound">y</span> <span class="main">⋅</span> <span class="free">R</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span>
  D <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  v <span class="main">:=</span> <span class="bound">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">v</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_cycle_inv <span class="bound">v</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">D</span> <span class="free">R</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">v</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> e <span class="main">:=</span> choose_singleton <span class="main">(</span><span class="bound">v</span><span class="main">*</span><span class="main">-</span><span class="bound">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span><span class="main">;</span>
        D <span class="main">:=</span> <span class="bound">D</span> <span class="main">+</span> <span class="bound">e</span><span class="main">;</span>
        v <span class="main">:=</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">*</span><span class="main">1</span>
     <span class="keyword1">OD</span><span class="main">;</span>
  comment <span class="main">{</span> is_acyclic <span class="free">D</span> <span class="main">∧</span> point <span class="free">y</span> <span class="main">∧</span> point <span class="free">x</span> <span class="main">∧</span> <span class="free">D</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">y</span> <span class="main">≤</span> <span class="free">D</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span> <span class="main">}</span><span class="main">;</span>
  W <span class="main">:=</span> <span class="main">0</span><span class="main">;</span>
  q <span class="main">:=</span> <span class="bound">y</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">x</span>
    <span class="keyword1">INV</span> <span class="main">{</span> construct_path_inv <span class="bound">q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">D</span> <span class="bound">W</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">D</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">*</span><span class="bound">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">R</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">W</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> p <span class="main">:=</span> choose_point <span class="main">(</span><span class="bound">D</span><span class="main">*</span><span class="bound">q</span><span class="main">)</span><span class="main">;</span>
        W <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">;</span>
        q <span class="main">:=</span> <span class="bound">p</span>
     <span class="keyword1">OD</span><span class="main">;</span>
  comment <span class="main">{</span> <span class="free">W</span> <span class="main">≤</span> <span class="free">D</span> <span class="main">∧</span> terminating_path <span class="free">W</span> <span class="main">∧</span> <span class="main">(</span><span class="free">W</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">q</span><span class="main">=</span><span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">W</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">=</span> start_points <span class="free">W</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> end_points <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">;</span>
  C <span class="main">:=</span> <span class="bound">W</span> <span class="main">+</span> <span class="bound">y</span><span class="main">*</span><span class="bound">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>
 <span class="main">[</span> <span class="bound">C</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">≤</span> <span class="free">R</span> <span class="main">∧</span> cycle <span class="bound">C</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc</span>
  <span class="keyword1"><span class="command">using</span></span> construct_cycle_pre <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CollectI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_tree_inv_termination <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">using</span></span> construct_cycle_pre2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CollectI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> construct_path_inv_termination <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> construct_cycle_post <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc_tarski_choose_point_finite *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>